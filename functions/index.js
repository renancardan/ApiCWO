const functions = require("firebase-functions");
const app = require("express")();
const admin = require("firebase-admin");
admin.initializeApp();
const db = admin.firestore();
var axios = require("axios");
const cors = require('cors')({origin: true});



app.post("/Msgpizzacia", async  function (request, response){
    cors(request, response, async () => {
    var EMPRESA = request.body.Id
    //var URL_WHATS = "https://api.z-api.io/instances/3A9D95BC49F730DF458B76215AA2744C/token/A2A3E65C2FE0E21916E8A2AE";
    
//Guardando Mensagens Que Chegou    
var Mensagem = request.body.Msg;
var Type = request.body.Msg.type;
var Midia = request.body.Midia;
var NomeWhats = "";

    await db.collection("MensagensRobo").add({
        body: Mensagem,
        name: "Chegou Mensagem",
        Midia:Midia,
     
    })
    .then((docRef) => {
        console.log("Document written with ID: ", docRef.id);
    })
    .catch((error) => {
        console.error("Error adding document: ", error);
    });


   
   

 
      

   

    var resposta = {};
    if(Mensagem.body !== 'ATIVAR FUNIL BASICO'){
        var TelefonCli = Mensagem.from.replace("@c.us", "")
        console.log(TelefonCli)
            await db.collection("ClienteEmpre")
            .where("Empresa", "array-contains", EMPRESA)
            .where("Telefone", "==", TelefonCli)
            .get().then(async (querySnapshot1) => {
    
         
              if(querySnapshot1.size  !== 0){ //O Cliente já está cadastrado 
                
           // Aqui vai pegar os dados da Empresas, Mensgens, e o Tempo Maximo de Chat
    
                var MsgEmp = {} 
                var TempChat
                var DadoEmp = {}

                await db.collection("EmrpesaSite")
                .doc(EMPRESA)
                .get().then(async(doc) => {
                    MsgEmp = doc.data().MsgAuto;
                    TempChat = doc.data().TempoChat;
                    DadoEmp = doc.data();
                });
           
        
            
        
        
           //Pegando o Nome e o Id Do Cliente
             var NomeCli = "";
             var IdCli ="";
             await querySnapshot1.forEach((doc1) => {
                 NomeCli =  doc1.data().Nome;
                 IdCli = doc1.id;
                })
          
        
            //Montando o horario limite de chat
            var Horario = new Date().getTime() - (TempChat*3600000);
            console.log(Horario)
        
            //Aqui vamos ver se existe algum chat ja iniciado, pega o id e a fase de mensagem
              var IdChat = "";
              var FaMsg = "";
              var MemoriaSessao = [];
              var MemoriaPedido = {};
              var MemoriaProduto = [];
              var MemoriaSubSessao = [];
              var EstaNaRegra = true;
              var Robo = true;
              var PedidoCri ="";
              var SessaoEsta = "";
              var MemoriaSabores = 0;
              var SaboresEsco = 0;
              var RoboAtivado = true;
              var SubSesion ={}
            
              await db.collection("ChatCliente")
                .where("Empresa", "==", EMPRESA)
                .where("Id", "==", IdCli)
                .where("Ativo", "==", true)
                .where("DataInicio", ">=", Horario)
                .get().then(async (querySnapshot2) => {

                    
                    if(querySnapshot2.size  !== 0){//Se Existe Um Chat Em Anadamento Entra Aqui 


                console.log("Existe um Chat")
                    await querySnapshot2.forEach((doc2) => {
                        IdChat = doc2.id;
                        FaMsg =doc2.data().FaseMsg;
                        EstaNaRegra = doc2.data().DigiteNaRegra;
                        MemoriaSessao = doc2.data().MemSessao;
                        MemoriaPedido = doc2.data().MemPedido;
                        MemoriaProduto = doc2.data().MemProdutos?doc2.data().MemProdutos:[]; 
                        MemoriaSubSessao = doc2.data().MemSubSessao?doc2.data().MemSubSessao:[]; 
                        SubSesion= doc2.data().SubSessao?doc2.data().SubSessao:{}; 
                        Robo = doc2.data().Robotizado;
                        PedidoCri = doc2.data().Pedido;
                        SessaoEsta = doc2.data().Sessao?doc2.data().Sessao:""; 
                        MemoriaSabores = doc2.data().MenSabor?doc2.data().MenSabor:0;
                       SaboresEsco = doc2.data().EscolhaSabor?doc2.data().EscolhaSabor:0; 
                       MemoriaBairro = doc2.data().MemBairro?doc2.data().MemBairro:{};
                       RoboAtivado = doc2.data().RoboAtivo; 
                       console.log("Robo2 "+doc2.data().RoboAtivo)                      
                       })
                     console.log("Robo "+RoboAtivado)
                     if(RoboAtivado){//O Robo Esta Ativado Pelo Atendente
                                // Existe  um Chat que foi enviado a Mensagem de Apresentação de Pedido de Nome
                                                if(FaMsg === "Msg1B" ){// Recebendo o Nome do Cliente, Perguntando O que deseja realizar
                                                                    
                                                    //montar a mensagem   
                                                    var QMsg= MsgEmp.Msg2A.Msg.length;
                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                    var Result =parseInt(Sorteio);
                                                    var Num = Result-1;
                                                    var AutoMsg = MsgEmp.Msg2A.Msg[Num];
                                                    var TempMsg =  MsgEmp.Msg2A.TempoSeg;

                                                    console.log(MsgEmp.Msg2A.Msg)
                                                    console.log("Qmsg: "+QMsg)       
                                                    console.log("Soteio: "+Sorteio)                 
                                                    console.log("Msg: "+AutoMsg)


                                                    var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                    var Result2 =parseInt(Sorteio2);
                                                    var Num2 = Result2-1;
                                                    var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                    var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;

                                                    console.log(MsgEmp.Msg3A.Msg)
                                                    console.log("Qmsg: "+QMsg2)       
                                                    console.log("Soteio: "+Sorteio2)                 
                                                    console.log("Msg: "+AutoMsg2)

                                                    //mensagens de estimulo para continuar o atendimento
                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                                                    var Result3 =parseInt(Sorteio3);
                                                    var Result4 =parseInt(Sorteio4);
                                                    var Result5 =parseInt(Sorteio5);

                                                    var Num3 = Result3-1;
                                                    var Num4 = Result4-1;
                                                    var Num5 = Result5-1;
                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();


                                                    //Aqui vou ta salvando  o Nome do Cliente
                                                    await db.collection("ClienteEmpre")
                                                    .doc(IdCli)
                                                    .update({
                                                    Nome: Mensagem.body,
                                                    })
                                                    .then(async() => {

                                                    }) 

                                                    //Mudando a Fase do Chat
                                                    await db.collection("ChatCliente")
                                                    .doc(IdChat)
                                                    .update({
                                                    NomeCliente:Mensagem.body,
                                                    FaseMsg: "Msg3A",
                                                    MsgFutura1:{
                                                        Ativo:true,
                                                        Msg:AutoMsg3,
                                                        Tempo:Tempo3,
                                                    },
                                                    MsgFutura2:{
                                                        Ativo:true,
                                                        Msg:AutoMsg4,
                                                        Tempo:Tempo4,
                                                    },
                                                    MsgFutura3:{
                                                        Ativo:true,
                                                        Msg:AutoMsg5,
                                                        Tempo:Tempo5,
                                                    },
                                                    UltimaMsg:{
                                                        Autor:EMPRESA,
                                                        body:`${Mensagem.body}${AutoMsg2}`,
                                                        date:new Date().getTime()+5000,
                                                        Type: "botao"
                                                    },
                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                        Autor:IdCli,
                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                        date:new Date().getTime(),
                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                    }, 
                                                    {
                                                        Autor:EMPRESA,
                                                        body:`${Mensagem.body}${AutoMsg}`,
                                                        date:new Date().getTime()+5000,
                                                        Type:"text"
                                                    },
                                                    {
                                                        Autor:EMPRESA,
                                                        body:`${Mensagem.body}${AutoMsg2}`,
                                                        Botao:MsgEmp.Msg3A.Botao,
                                                        date:new Date().getTime()+10000,
                                                        Type:"botao"
                                                    }
                                                    
                                                    )
                                                    })
                                                    .then(async() => {
                                                        var MsgButon =`${Mensagem.body}${AutoMsg2}`
                                                        //Aqui vou está enviando uma mensagem
                                                        console.log(TempMsg)
                                                        console.log(TempMsg2)
                                                        response.json({ Inf:[{Msg:`${Mensagem.body}${AutoMsg}`, Tempo: TempMsg, Type:"text"}, {Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                        
                                                    }) 


                                                
                                                    
                                                    } else if(FaMsg === "Msg3A" ){//Recebendo o que Deseja realizar Um Pedido, Perguntando Qual Sessão
                                                        var NumIni = parseInt(Mensagem.body)
                                                        // Mensagem  que escolheu fazer o pedido
                                                        if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){

                                                            var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                            await db.collection("MenusSite")
                                                            .where("Empresa", "==", EMPRESA)
                                                            .where("Ativo", "==", true)
                                                            .get().then(async (querySnapshot23) => {
                                                                await querySnapshot23.forEach((doc23) => {

                                                                    Menus.push({
                                                                        id:doc23.id,
                                                                        body:doc23.data().nome,
                                                                        GrupTamanho:doc23.data().GrupTamanho,
                                                                        MemFim:doc23.data().MemFim,
                                                                        Tamanho:doc23.data().Tamanho,
                                                                    })
                                                                
                                                                    })

                                                            });


                                                            //montar a mensagem   
                                                        var QMsg= MsgEmp.Msg4A.Msg.length;
                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                        var Result =parseInt(Sorteio);
                                                        var Num = Result-1;
                                                        var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                        var TempMsg =  MsgEmp.Msg4A.TempoSeg;

                                                        //  console.log(MsgEmp.Msg2A.Msg)
                                                        //  console.log("Qmsg: "+QMsg)       
                                                        //  console.log("Soteio: "+Sorteio)                 
                                                        //  console.log("Msg: "+AutoMsg)


                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                        var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                        var Result2 =parseInt(Sorteio2);
                                                        var Num2 = Result2-1;
                                                        var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                        var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                        
                                                        //mensagens de estimulo para continuar o atendimento
                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                                                        var Result3 =parseInt(Sorteio3);
                                                        var Result4 =parseInt(Sorteio4);
                                                        var Result5 =parseInt(Sorteio5);

                                                        var Num3 = Result3-1;
                                                        var Num4 = Result4-1;
                                                        var Num5 = Result5-1;
                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                        var  Letras = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "X", "Z"];
                                                        var SortLet = Math.floor(Math.random() * (Letras.length - 1 + 1)) + 1;
                                                        var NumAr=SortLet-1
                                                        await db.collection("MesaItem").add({
                                                            NomeCli:NomeCli,
                                                            TelCli:TelefonCli,
                                                            Ativo:true,
                                                            Cliente:IdCli,
                                                            IdChat:IdChat,
                                                            Empresa:EMPRESA,
                                                            Codigo: Letras[NumAr]+new Date().getTime(),
                                                            Mesa:"Externo",
                                                            Itens:[],
                                                            ValorTotaL:0,
                                                            ValorEntrega:0,
                                                            ComissaaEntrega:0,
                                                            dataCriacao:new Date().getTime(),
                                                            Fechado:false,
                                                            IniciandoProducao:false,
                                                            IniciandoEntrega:false,
                                                            ConcluidoEntregado:false,
                                                            ConcluidoProducao:false,
                                                            ConfirmacaoPedido:false,
                                                            FormaDepagamento:null,
                                                            ExtratoPix:null,
                                                            End:{
                                                                Bairro:"",
                                                                Rua:"",
                                                                Numero:"",
                                                                Proximo:"",
                                                                Localizacao:{
                                                                    lat:null,
                                                                    lng:null,
                                                                }
                                                                },
                                                            TelEntregador:"",
                                                        
                                                            }).then(async (dif) => {
                                                                // Aqui ta entrando pos não esta no modo rocbo e ele não digitou errado
                                                                if(Robo === true && EstaNaRegra === true){
                                                        await db.collection("ChatCliente")
                                                        .doc(IdChat)
                                                        .update({
                                                        FaseMsg: "Msg4A",
                                                        MsgFutura1:{
                                                            Ativo:true,
                                                            Msg:AutoMsg3,
                                                            Tempo:Tempo3,
                                                        },
                                                        MsgFutura2:{
                                                            Ativo:true,
                                                            Msg:AutoMsg4,
                                                            Tempo:Tempo4,
                                                        },
                                                        MsgFutura3:{
                                                            Ativo:true,
                                                            Msg:AutoMsg5,
                                                            Tempo:Tempo5,
                                                        },
                                                        Pedido:dif.id,
                                                        MemSessao:Menus,
                                                        Reclamaçoes:null,
                                                        Localização:null,
                                                        DigiteNaRegra:true,
                                                        Robotizado:true, 
                                                        UltimaMsg:{
                                                            Autor:EMPRESA,
                                                            body:`${NomeCli}${AutoMsg}`,
                                                            date:new Date().getTime()+5000,
                                                            Type:"botao"
                                                        },
                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                            Autor:IdCli,
                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                            date:new Date().getTime(),
                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                        }, 
                                                        {
                                                            Autor:EMPRESA,
                                                            body:`${NomeCli}${AutoMsg}`,
                                                            Botao:Menus,
                                                            date:new Date().getTime()+5000,
                                                            Type:"botao"
                                                        },
                                                        
                                                        
                                                        )
                                                        })
                                                        .then(async() => {
                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                            console.log(TempMsg)
                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                    
                                                        }) 
                                                            //aqui vai entrar por que ele ele digitou errado e não está mais no modo robo 
                                                            }else {
                                                                await db.collection("ChatCliente")
                                                                .doc(IdChat)
                                                                .update({
                                                                FaseMsg: "Msg4A",
                                                                MsgFutura1:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg3,
                                                                    Tempo:Tempo3,
                                                                },
                                                                MsgFutura2:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg4,
                                                                    Tempo:Tempo4,
                                                                },
                                                                MsgFutura3:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg5,
                                                                    Tempo:Tempo5,
                                                                },
                                                                Pedido:dif.id,
                                                                MemSessao:Menus,
                                                                Reclamaçoes:null,
                                                                Localização:null,
                                                                DigiteNaRegra:true,
                                                                Robotizado:true, 
                                                                UltimaMsg:{
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                    Autor:IdCli,
                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                    date:new Date().getTime(),
                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                }, 
                                                                {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                date:new Date().getTime()+2000,
                                                                Type:"text"
                                                            },
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    Botao:Menus,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                
                                                                
                                                                )
                                                                })
                                                                .then(async() => {
                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                    console.log(TempMsg)

                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                }) 

                                                            }
                                                        //Mudando a Fase do Chat
                                                        
                                                        
                                                        
                                                            
                                                                
                                                            })

                                                        



                                                        } else if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                        // Cliente clicou em voltar 
                                                            //montar a mensagem   
                                                            var QMsg= MsgEmp.Msg2A.Msg.length;
                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                            var Result =parseInt(Sorteio);
                                                            var Num = Result-1;
                                                            var AutoMsg = MsgEmp.Msg2A.Msg[Num];
                                                            var TempMsg =  MsgEmp.Msg2A.TempoSeg;

                                                            console.log(MsgEmp.Msg2A.Msg)
                                                            console.log("Qmsg: "+QMsg)       
                                                            console.log("Soteio: "+Sorteio)                 
                                                            console.log("Msg: "+AutoMsg)


                                                            var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                            var Result2 =parseInt(Sorteio2);
                                                            var Num2 = Result2-1;
                                                            var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                            var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;

                                                            console.log(MsgEmp.Msg3A.Msg)
                                                            console.log("Qmsg: "+QMsg2)       
                                                            console.log("Soteio: "+Sorteio2)                 
                                                            console.log("Msg: "+AutoMsg2)

                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                        var Result9 =parseInt(Sorteio9);
                                                        var Num9 = Result9-1;
                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                            //mensagens de estimulo para continuar o atendimento
                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                
                                                            var Result3 =parseInt(Sorteio3);
                                                            var Result4 =parseInt(Sorteio4);
                                                            var Result5 =parseInt(Sorteio5);
                                                
                                                            var Num3 = Result3-1;
                                                            var Num4 = Result4-1;
                                                            var Num5 = Result5-1;
                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();


                                                            //Aqui vou ta salvando  o Nome do Cliente
                                                            
                                                            if(Robo === true && EstaNaRegra === true){

                                                            //Mudando a Fase do Chat
                                                            await db.collection("ChatCliente")
                                                            .doc(IdChat)
                                                            .update({
                                                            FaseMsg: "Msg3A",
                                                            DigiteNaRegra:true,
                                                            Robotizado:true, 
                                                            MsgFutura1:{
                                                                Ativo:true,
                                                                Msg:AutoMsg3,
                                                                Tempo:Tempo3,
                                                            },
                                                            MsgFutura2:{
                                                                Ativo:true,
                                                                Msg:AutoMsg4,
                                                                Tempo:Tempo4,
                                                            },
                                                            MsgFutura3:{
                                                                Ativo:true,
                                                                Msg:AutoMsg5,
                                                                Tempo:Tempo5,
                                                            },
                                                            UltimaMsg:{
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                date:new Date().getTime()+5000,
                                                                Type:"botao"
                                                            },
                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                Autor:IdCli,
                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                date:new Date().getTime(),
                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                            }, 
                                                            {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg}`,
                                                                date:new Date().getTime()+5000,
                                                                Type:"text"
                                                            },
                                                            {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                Botao:MsgEmp.Msg3A.Botao,
                                                                date:new Date().getTime()+10000,
                                                                Type:"botao"
                                                            }
                                                            
                                                            )
                                                            })
                                                            .then(async() => {
                                                                var MsgButon =`${NomeCli}${AutoMsg2}`
                                                                
                                                                console.log(TempMsg)
                                                                console.log(TempMsg2)
                                                                response.json({ Inf:[{Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                
                                                            }) 

                                                            } else {

                                                                await db.collection("ChatCliente")
                                                                .doc(IdChat)
                                                                .update({
                                                                FaseMsg: "Msg3A",
                                                                DigiteNaRegra:true,
                                                                Robotizado:true, 
                                                                MsgFutura1:{
                                                                Ativo:true,
                                                                Msg:AutoMsg3,
                                                                Tempo:Tempo3,
                                                            },
                                                            MsgFutura2:{
                                                                Ativo:true,
                                                                Msg:AutoMsg4,
                                                                Tempo:Tempo4,
                                                            },
                                                            MsgFutura3:{
                                                                Ativo:true,
                                                                Msg:AutoMsg5,
                                                                Tempo:Tempo5,
                                                            },
                                                                UltimaMsg:{
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                    Autor:IdCli,
                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                    date:new Date().getTime(),
                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                }, 
                                                                {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                date:new Date().getTime()+2000,
                                                                Type:"text"
                                                            },
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"text"
                                                                },
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                    Botao:MsgEmp.Msg3A.Botao,
                                                                    date:new Date().getTime()+10000,
                                                                    Type:"botao"
                                                                }
                                                            
                                                                )
                                                                })
                                                                .then(async() => {
                                                                    var MsgButon =`${NomeCli}${AutoMsg2}`
                                                                    
                                                                    console.log(TempMsg)
                                                                    console.log(TempMsg2)
                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                
                                                                }) 

                                                            }
                                                    
                                                            //Aqui vou está enviando uma mensagem

                                                        

                                                        

                                                        
                                                            
                                                            } else if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){

                                                            } else if(Mensagem.body === "3" || Mensagem.body === " 3" || Mensagem.body === "3 " || Mensagem.body === " 3 "){
                                                                
                                                            } else if(Mensagem.body === "4" || Mensagem.body === " 4" || Mensagem.body === "4 " || Mensagem.body === " 4 "){
                                                                
                                                            } else {

                                                                if(EstaNaRegra === true && Robo === true){

                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                    var Result =parseInt(Sorteio);
                                                                    var Num = Result-1;
                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                    //mensagens de estimulo para continuar o atendimento
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                    //Mudando a Fase do Chat
                                                                    
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    DigiteNaRegra:false, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    
                                                                    
                                                                    )
                                                                    })
                                                                    .then(async() => {
                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                        console.log(TempMsg)
                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                            
                                                                    }) 
                                                                } else  if(EstaNaRegra === false ){

                                                                    //mensagens de estimulo para continuar o atendimento
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                
                                                                
                                                                
                                                                
                                                                    //Mudando a Fase do Chat
                                                                    
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    Robotizado:false, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"texto"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },)
                                                                    })
                                                                    .then(async() => {
                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                        console.log(TempMsg)
                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                            
                                                                    }) 
                                                                }
                                                            }
                                                
                                                    
                                                        
                                                    


                                                    
                                                        
                                                        } else if(FaMsg === "Msg4A" ){//Recebendo a Sessão, Perguntando Qual SubSessão ou Item
                                                         
                                                             //Mensagem parabenizando que ele acertou a digitação 
                                                             var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                             var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                             var Result9 =parseInt(Sorteio9);
                                                             var Num9 = Result9-1;
                                                             var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                             var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                             

                                                             //Mensagens de estimulo 
                                                             var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                             var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                             var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                             var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                             var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                             var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                                                             var Result3 =parseInt(Sorteio3);
                                                             var Result4 =parseInt(Sorteio4);
                                                             var Result5 =parseInt(Sorteio5);

                                                             var Num3 = Result3-1;
                                                             var Num4 = Result4-1;
                                                             var Num5 = Result5-1;
                                                             var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                             var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                             var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                             var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                             var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                             var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                

                                                             var SesseaoMenus = []
                                                             await db.collection("MenusSite")
                                                             .where("Empresa", "==", EMPRESA)
                                                             .get().then(async (querySnapshot23) => {
                                                                 await querySnapshot23.forEach((doc23) => {
                                 
                                                                    SesseaoMenus.push({
                                                                         id:doc23.id,
                                                                         body:doc23.data().nome,
                                                                         GrupTamanho:doc23.data().GrupTamanho,
                                                                         MemFim:doc23.data().MemFim,
                                                                         Tamanho:doc23.data().Tamanho,
                                                                         Ativo:doc23.data().Ativo,
                                                                     })
                                                                 
                                                                     })
                                 
                                                             });




                                                                console.log(Mensagem.body)
                                                                var DivNome3 = []
                                                                for (var i = 0; i <= Mensagem.body.length-3; i++) {
                                                                    console.log(i);
                                                                    DivNome3.push(Mensagem.body.toLowerCase().slice(i, (i+3)))
                                                                    
                                                                }

                                                                var DivNome4 = []
                                                                for (var i = 0; i <= Mensagem.body.length-4; i++) {
                                                                    console.log(i);
                                                                    DivNome4.push(Mensagem.body.toLowerCase().slice(i, (i+4)))
                                                                    
                                                                }
                                                                console.log(DivNome4)
                                                              
                                                                var Desativado1 = false;
                                                                var Desativado2 = false;
                                                                var Desativado3 = false;
                                                                var Desativado4 = false;

                                                                var TextErrado1 = true;
                                                                var TextErrado2 = true;
                                                                var TextErrado3 = true;
                                                                var TextErrado4 = true;
                                                                var ProdAtivo = false;
                                                                var SessaoGuar = "";
                                                                var Borda = "com borda";
                                                               
                                                                var Nota = {};
                                                               
                                                                var VerMen = {};
                                                                var Sabor = [{id:"0", body:"Nenhum"}]
                                                                var SubMenus = [{id:"3", body:"Nenhum\n===================\n"}]
                                                                var VerSessao = []

                                                                for(let i in SesseaoMenus){
                                                                    for(let j in DivNome4){
                                                                        if(Desativado1 === false ){
                                                                          
                                                                        if(SesseaoMenus[i].body.toLowerCase().includes(DivNome4[j])){//Achando uma conbinação
                                                                            Desativado1 = true; 
                                                                            TextErrado1 = false; 
                                                                            SessaoGuar = SesseaoMenus[i].body;
                                                                            VerSessao = SesseaoMenus[i] 
                                                                            ProdAtivo = SesseaoMenus[i].Ativo
                                                                        } 
                                                                    }  
                                                                    }
                                                                 }

                                                                 if(TextErrado1 === true && ProdAtivo === false){//Quando cliente Digitar o Sabor primeiro e não digitar a sessão
                                                                    var Menus = [];
                                                                    var SubMenus = [];
                                                                    var ItensMenus = [];
                                                                    for(let i in SesseaoMenus){
                                                                        if(SesseaoMenus[i].Tamanho){
                                                                            //Pegou todos os tamanhos de cada sessão 
                                                                            for(let l in SesseaoMenus[i].GrupTamanho){
                                                                                Menus.push({
                                                                                    Descont:SesseaoMenus[i].GrupTamanho[l].DescontReal,
                                                                                    Nome: SesseaoMenus[i].GrupTamanho[l].Tamanho,
                                                                                    Preco: SesseaoMenus[i].GrupTamanho[l].PrecoReal,
                                                                                    QuantSb:SesseaoMenus[i].GrupTamanho[l].Qsabor,
                                                                                    body: SesseaoMenus[i].GrupTamanho[l].DescontReal?SesseaoMenus[i].GrupTamanho[l].Tamanho+"\n"+"❤️ De: "+"~"+SesseaoMenus[i].GrupTamanho[l].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+SesseaoMenus[i].GrupTamanho[l].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    SesseaoMenus[i].GrupTamanho[l].Tamanho+"\n"+"💰 "+SesseaoMenus[i].GrupTamanho[l].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    MemFim:SesseaoMenus[i].MemFim,
                                                                                    Sessao:SesseaoMenus[i].body,
                                                                                })
                                                                        }

                                                                        

                                                                
                                                                 
                                                                        await db.collection("ItensDaEmpresa")
                                                                        .where("Empresa", "==", EMPRESA)
                                                                        .where("Menu", "==", SesseaoMenus[i].body)
                                                                        .where("Ativo", "==", true)
                                                                        .get().then(async (querySnapshot23) => {
                                                                           
                                                                            await querySnapshot23.forEach((doc23) => {

                                                                                SubMenus.push({
                                                                                 
                                                                                    Descricao:doc23.data().Descricao,
                                                                                    Nome: doc23.data().nome,
                                                                                    Quant: doc23.data().Quant,
                                                                                    Ilimitado:doc23.data().Ilimitado,
                                                                                    foto: doc23.data().foto,
                                                                                    id: doc23.id,
                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                    Sessao:SesseaoMenus[i].body,
                                                                                })
                                                                            
                                                                                })

                                                                        });

                                                                       

                                                                   
                                                                        for(let l in SubMenus){
                                                                            for(let m in SubMenus[l].GrupTamanho){
                                                                                for(let j in Menus){
                                                                                if(SubMenus[l].Sessao === Menus[j].Sessao){
                                                                                    if(SubMenus[l].GrupTamanho[m].select === Menus[j].Nome){
                                                                                       
                                                                                            ItensMenus.push({
                                                                                                Descont: Menus[j].Descont,
                                                                                                Tamanho: Menus[j].Nome,
                                                                                                ComTam:true,
                                                                                                Preco:Menus[j].Preco,
                                                                                                QuantSb:Menus[j].QuantSb,
                                                                                                body: Menus[j].body ,
                                                                                                MemFim:Menus[j].MemFim,
                                                                                                Sessao:Menus[j].Sessao,
                                                                                                Descricao:SubMenus[l].Descricao,
                                                                                                Nome:SubMenus[l].Nome,
                                                                                                Quant:SubMenus[l].Quant,
                                                                                                Ilimitado:SubMenus[l].Ilimitado,
                                                                                                foto:SubMenus[l].foto,
                                                                                                Ativo:SubMenus[l].GrupTamanho[m].Ativo,
                                                                                               })

                                                                                           
                                                                                      
                                                                                    }

                                                                                }
                                                                                
                                                                            }
                                                                            }
                                                                        }

                                                                    
                                                                       

                                                                       

                                                                        
                                                                        

                                                                        }else {
                                                                            await db.collection("ItensDaEmpresa")
                                                                            .where("Empresa", "==", EMPRESA)
                                                                            .where("Menu", "==", SesseaoMenus[i].body)
                                                                            .where("Ativo", "==", true)
                                                                            .get().then(async (querySnapshot23) => {
                                                                               
                                                                                await querySnapshot23.forEach((doc23) => {
    
                                                                                    ItensMenus.push({
                                                                                        ComTam:false,
                                                                                        Descont:doc23.data().DescontReal,
                                                                                        Descricao:doc23.data().Descricao,
                                                                                        Nome: doc23.data().nome,
                                                                                        Preco: doc23.data().PrecoReal,
                                                                                        Quant: doc23.data().Quant,
                                                                                        Ilimitado:doc23.data().Ilimitado,
                                                                                        foto: doc23.data().foto,
                                                                                        id: doc23.id,
                                                                                        Observacao: "",
                                                                                        body:doc23.data().Descricao ?  doc23.data().DescontReal?doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"❤️ De: "+"~"+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+doc23.data().DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"💰 "+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":doc23.data().DescontReal?doc23.data().nome+"\n"+"❤️ De: "+"~"+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+doc23.data().DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"💰 "+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                        Tamanho:"",
                                                                                        ItemEspeci:false,
                                                                                        Sessao:SesseaoMenus[i].body,
                                                                                        MemFim:SesseaoMenus[i].MemFim,
                                                                                        Ativo:true,
                                                                                    })
                                                                                
                                                                                    })
    
                                                                            });
                                                                      
                                                                        }
                                                                    }

                                                                    
                                                                    ItensMenus = ItensMenus.filter(function (a) {
                                                                        return !this[JSON.stringify(a)] && (this[JSON.stringify(a)] = true);
                                                                    }, Object.create(null))
                                                                
                                                                    await db.collection("MensagensRobo").add({
                                                                       Itens:ItensMenus,
                                                                       Menus:Menus,
                                                                       SubMenus:SubMenus,
                                                                    })
                                                                    .then((docRef) => {
                                                                        console.log("Document written with ID: ", docRef.id);
                                                                    })
                                                                    .catch((error) => {
                                                                        console.error("Error adding document: ", error);
                                                                    });
                                                                  // pegando o que digitou 
                                                                   var PrimSes = [];

                                                                    for(let j in DivNome4){
                                                                        for(let i in ItensMenus){
                                                                            if(Desativado3 === false){
                                                                            console.log("Conb: "+DivNome4[j])
                                                                            console.log("Nome "+ItensMenus[i].Nome.toLowerCase())
                                                                            if(ItensMenus[i].Nome.toLowerCase().includes(DivNome4[j])){
                                                                                Desativado3 =true;
                                                                                PrimSes.push(ItensMenus[i])
                                                                            }

                                                                            }
                                                                            

                                                                        }
                                                                        
                                                                    }

                                                                    for(let j in DivNome4){
                                                                        for(let i in PrimSes){
                                                                            if(Desativado4 === false){
                                                                            console.log("Conb: "+DivNome4[j])
                                                                            console.log("Tamanho "+PrimSes[i].Tamanho.toLowerCase())
                                                                            if(PrimSes[i].Tamanho.toLowerCase().includes(DivNome4[j])){
                                                                                Desativado4 =true;
                                                                                TextErrado4 = false;
                                                                                TextErrado1 === true;
                                                                                Nota = PrimSes[i];
                                                                               
                                                                            }

                                                                            }
                                                                            

                                                                        }
                                                                        
                                                                    }
                                                                 console.log(Nota)
                                                                    
                                                                 }
                                                               


                                                                 if(TextErrado1 === false && ProdAtivo === true && TextErrado4 === true){// Preenchendo o Tamanho
                                                                    console.log("Entrou  Sessão TextErrado1")
                                                                    var Menus = []
                                                                    
                                                                    if(VerSessao.Tamanho){//Vendo se é Por tamanho 
                                                                    Menus.push(
                                                                        {id:"3", body:"Volar Para Sessões\n===================\n"}  
                                                                    )
                                                                    for(let l in VerSessao.GrupTamanho){
                                                                            Menus.push({
                                                                                Descont:VerSessao.GrupTamanho[l].DescontReal,
                                                                                Nome: VerSessao.GrupTamanho[l].Tamanho,
                                                                                Preco: VerSessao.GrupTamanho[l].PrecoReal,
                                                                                QuantSb:VerSessao.GrupTamanho[l].Qsabor,
                                                                                body: VerSessao.GrupTamanho[l].DescontReal?VerSessao.GrupTamanho[l].Tamanho+"\n"+"❤️ De: "+"~"+VerSessao.GrupTamanho[l].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+VerSessao.GrupTamanho[l].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    VerSessao.GrupTamanho[l].Tamanho+"\n"+"💰 "+VerSessao.GrupTamanho[l].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                MemFim:VerSessao.MemFim,
                                                                            })
                                                                    
                                                                        }

                                                                    


                                                                    if(Mensagem.body.toLowerCase().includes(Borda)){//Pegando os com borda
                                                                        for(let m in Menus){

                                                                            if(Menus[m].body.toLowerCase().includes(Borda)){
                                                                        for(let j in DivNome3){
                                                                            if(Desativado2 === false){

                                                                                if(Menus[m].body.toLowerCase().includes(DivNome3[j])){//Caça Se Tem Algum Sem borda digitado
                                                                                    Desativado2 = true;
                                                                                    TextErrado2 = false;
                                                                                    VerMen = Menus[m];
                                                                                }

                                                                            
                                                                          
                                                                                    }
                                                                                }
                                                                            }

                                                                        }
                                                                      

                                                                    } else {//Pegando os tamanhos sem Borda

                                                                       

                                                                           
                                                                            for(let m in Menus){

                                                                                if(Menus[m].body.toLowerCase().includes(Borda) === false){
                                                                            for(let j in DivNome3){
                                                                                if(Desativado2 === false){

                                                                                    if(Menus[m].body.toLowerCase().includes(DivNome3[j])){//Caça Se Tem Algum Sem borda digitado
                                                                                        Desativado2 = true;
                                                                                        TextErrado2 = false;
                                                                                        VerMen = Menus[m];
                                                                                    }

                                                                                
                                                                              
                                                                                        }
                                                                                    }
                                                                                }

                                                                            }

                                                                        }

                                                                    } else {

                                                                        await db.collection("ItensDaEmpresa")
                                                                        .where("Empresa", "==", EMPRESA)
                                                                        .where("Menu", "==", SessaoGuar)
                                                                        .where("Ativo", "==", true)
                                                                        .get().then(async (querySnapshot23) => {
                                                                            Menus.push(
                                                                                {id:"3", body:"Nenhum \n===================\n"}  
                                                                            )
                                                                            await querySnapshot23.forEach((doc23) => {

                                                                                Menus.push({
                                                                                    Descont:doc23.data().DescontReal,
                                                                                    Descricao:doc23.data().Descricao,
                                                                                    Nome: doc23.data().nome,
                                                                                    Preco: doc23.data().PrecoReal,
                                                                                    Quant: doc23.data().Quant,
                                                                                    Ilimitado:doc23.data().Ilimitado,
                                                                                    foto: doc23.data().foto,
                                                                                    id: doc23.id,
                                                                                    Observacao: "",
                                                                                    body:doc23.data().Descricao ?  doc23.data().DescontReal?doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"❤️ De: "+"~"+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+doc23.data().DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"💰 "+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":doc23.data().DescontReal?doc23.data().nome+"\n"+"❤️ De: "+"~"+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+doc23.data().DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"💰 "+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    SubSessao:"",
                                                                                    ItemEspeci:false,
                                                                                })
                                                                            
                                                                                })

                                                                        });
                                                                        TextErrado3 = false
                                                                    }

                                                                   

                                                                }
                                                                
                                                                if(TextErrado2 === false && ProdAtivo === true && TextErrado4 === true){
                                                                    console.log("Entrou  Sessão TextErrado2")
                                                                    //construindo a quantidade de sabor
                                                                    for(var n = 0; n < VerMen.QuantSb; n++){
                                                                    Sabor.push({
                                                                        id:n+1,
                                                                        body:`${n+1} Sabor`
                                                                    })
                                                                    } //Fim da Construção da quantidade de sabores   


                                                                      //Montagem dos sabores 
                                                                      await db.collection("ItensDaEmpresa")
                                                                      .where("Empresa", "==", EMPRESA)
                                                                      .where("Menu", "==", SessaoGuar)
                                                                      .where("Ativo", "==", true)
                                                                      .get().then(async (querySnapshot23) => {
                                                                         
                                                                          await querySnapshot23.forEach((doc23) => {
                                                                          for(let i in doc23.data().GrupTamanho){
                                                                              if(VerMen.Nome === doc23.data().GrupTamanho[i].select ){
                                                                                  SubMenus.push({
                                                                                      Descont:VerMen.Descont,
                                                                                      Descricao:doc23.data().Descricao,
                                                                                      Nome: doc23.data().nome,
                                                                                      Preco: VerMen.Preco,
                                                                                      SubSessao: VerMen.Nome,
                                                                                      Quant: 1,
                                                                                      Ilimitado: doc23.data().Ilimitado,
                                                                                      foto: doc23.data().foto,
                                                                                      id: doc23.id,
                                                                                      Observacao: "",
                                                                                      body:doc23.data().Descricao ?  VerMen.Descont?doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"❤️ De: "+"~"+VerMen.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+VerMen.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"💰 "+VerMen.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":VerMen.Descont?doc23.data().nome+"\n"+"❤️ De: "+"~"+VerMen.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+VerMen.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"💰 "+VerMen.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                      ItemEspeci:true,
                                                                                      MemFim:VerMen.MemFim,
                                                                                  })
      
                                                                              }

                                                                          }
                                                                      
                                                                       
                                                                          
                                                                          })
                                      
                                                                      });//Fim da montagem de sabores



                                                                }





                                                                
                                                                    if(TextErrado2 === false && ProdAtivo === true && TextErrado3 === true && TextErrado4 === true && TextErrado1 === false){//Se Digitou a SubSessão Com Tamanho
                                                                        console.log("Entrou  Sessão Envio Chat 1")
                                                                        //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4J.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4J.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4J.TempoSeg;


                                                                        var QMsg2= MsgEmp.Msg4I.Msg.length;
                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        var Result2 =parseInt(Sorteio2);
                                                                        var Num2 = Result2-1;
                                                                        var AutoMsg2 = MsgEmp.Msg4I.Msg[Num2];
                                                                        var TempMsg2 =  MsgEmp.Msg4I.TempoSeg;

                                                                        var MsgPedido = NomeCli+" Anotamos Seu Pedido ";
                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoGuar+"\n"
                                                                        MsgPedido = MsgPedido + "🏷️"+VerMen.Nome+"\n"
                                                                        if(VerMen.Descont){
                                                                           
                                                                            MsgPedido = MsgPedido + "💰 De:"+VerMen.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            MsgPedido = MsgPedido + "❤️ Por:"+VerMen.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                          
                                                                        
                                                                        } else {
                                                                           
                                                                            MsgPedido = MsgPedido + "💰"+VerMen.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                         
                                                                        
                                                                        }

                                                                        if(VerMen.QuantSb > 1) {//Vendo se é maior que dois sabores
                                                                            if(Robo === true && EstaNaRegra === true){
                                                                              
                                                                                
                                                                                //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                FaseMsg: "Msg4J",
                                                                                Sessao:SessaoGuar,
                                                                                SubSessao:VerMen.Nome,
                                                                                MemProdutos:SubMenus,
                                                                                MemSubSessao:Sabor,
                                                                                MemPedido:{
                                                                                    Nome:[],
                                                                                    Descricao:[],
                                                                                    Foto:[],
                                                                                    Preco:VerMen.Preco,
                                                                                    Descont:VerMen.Descont,
                                                                                    SubSessao:VerMen.Nome,
                                                                                    Quant:1,
                                                                                    Observacao:"",
                                                                                    ItemEspeci:false,
                                                                                    QuantGeral:1,
                                                                                    Sessao:SessaoGuar,
                                                                                    MemFim:VerMen.MemFim,
                                                                                
                                                                                },
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Mensagem.body,
                                                                                    date:new Date().getTime(),
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body: `${NomeCli} Você Escolheu ${VerMen.Nome}` ,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    Botao:Sabor,
                                                                                    date:new Date().getTime()+7000,
                                                                                    Type:"botao"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                   
                                                                             
                                                                                    
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    console.log(TempMsg)
                                                                                    response.json({ Inf:[{Msg: MsgPedido, Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${AutoMsg}*`:`*${AutoMsg}*` , Botao:Sabor , Tempo:TempMsg, Type:"butao"}] });
                                                                                }) 
                                                                                } else {
                                                                                    //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                FaseMsg: "Msg4J",
                                                                                Sessao:SessaoGuar,
                                                                                SubSessao:VerMen.Nome,
                                                                                MemProdutos:SubMenus,
                                                                                MemSubSessao:Sabor,
                                                                                MemPedido:{
                                                                                    Nome:[],
                                                                                    Descricao:[],
                                                                                    Foto:[],
                                                                                    Preco:VerMen.Preco,
                                                                                    Descont:VerMen.Descont,
                                                                                    SubSessao:VerMen.Nome,
                                                                                    Quant:1,
                                                                                    Observacao:"",
                                                                                    ItemEspeci:false,
                                                                                    QuantGeral:1,
                                                                                    Sessao:SessaoGuar,
                                                                                    MemFim:VerMen.MemFim,
                                                                                
                                                                                },
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Mensagem.body,
                                                                                    date:new Date().getTime(),
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                    date:new Date().getTime()+2000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body: `${NomeCli} Você Escolheu ${VerMen.Nome}` ,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    Botao:Sabor,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                   
                                                                                    
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    console.log(TempMsg)
                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${AutoMsg}*`:`*${AutoMsg}*` , Botao:Sabor , Tempo:TempMsg, Type:"butao"}] });
                                                                                }) 
                                        
                                                                                }
    
                                                                            } else {
                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                    //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4I",
                                                                                    Sessao:SessaoGuar,
                                                                                    SubSessao:VerMen.Nome,
                                                                                    MemProdutos:SubMenus,
                                                                                    MemSubSessao:Sabor,
                                                                                    MemPedido:{
                                                                                        Nome:[],
                                                                                        Descricao:[],
                                                                                        Foto:[],
                                                                                        Preco:VerMen.Preco,
                                                                                        Descont:VerMen.Descont,
                                                                                        SubSessao:VerMen.Nome,
                                                                                        Quant:1,
                                                                                        Observacao:"",
                                                                                        ItemEspeci:false,
                                                                                        QuantGeral:1,
                                                                                        Sessao:SessaoGuar,
                                                                                        MemFim:VerMen.MemFim,
                                                                                    
                                                                                    },
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body: `${NomeCli}, Você Escolheu ${VerMen.Nome}` ,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                        Botao:SubMenus,
                                                                                        date:new Date().getTime()+7000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: MsgPedido  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} Escolha o ${AutoMsg2}*`:`*Escolha o ${AutoMsg2}*` , Botao:SubMenus , Tempo:TempMsg, Type:"butao"}] });
                                                                                    }) 
                                                                                    } else {
                                                                                        //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4I",
                                                                                    Sessao:SessaoGuar,
                                                                                    SubSessao:VerMen.Nome,
                                                                                    MemPedido:{
                                                                                        Nome:[],
                                                                                        Descricao:[],
                                                                                        Foto:[],
                                                                                        Preco:VerMen.Preco,
                                                                                        Descont:VerMen.Descont,
                                                                                        SubSessao:VerMen.Nome,
                                                                                        Quant:1,
                                                                                        Observacao:"",
                                                                                        ItemEspeci:false,
                                                                                        QuantGeral:1,
                                                                                        Sessao:SessaoGuar,
                                                                                        MemFim:VerMen.MemFim,
                                                                                    
                                                                                    },
                                                                                    MemProdutos:SubMenus,
                                                                                    MemSubSessao:Sabor,
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+2000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body: `${NomeCli}, Você Escolheu ${VerMen.Nome}` ,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} Escolha o ${AutoMsg2}*`:`*Escolha o ${AutoMsg2}*` , Botao:SubMenus , Tempo:TempMsg, Type:"butao"}] });
                                                                                    }) 
                                            
                                                                                    }

                                                                            }  
                                                                    } else if(TextErrado3 === false && ProdAtivo === true && TextErrado2 === true && TextErrado4 === true && TextErrado1 === false){// Entra aqui por que ele não Tem o Tamnho e não  digitou o Sabor
                                                                        var QMsg= MsgEmp.Msg4B.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4B.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4B.TempoSeg;
                                                               
                                                                       console.log(MsgEmp.Msg4B.Msg)
                                                                       console.log("Qmsg: "+QMsg)       
                                                                       console.log("Soteio: "+Sorteio)                 
                                                                       console.log("Msg: "+AutoMsg)
   
                                
                                                                       
                                                                       if(Robo === true && EstaNaRegra === true){
                                                                           //Mudando a Fase do Chat
                                                                           await db.collection("ChatCliente")
                                                                           .doc(IdChat)
                                                                           .update({
                                                                           Sessao:SessaoGuar,
                                                                           FaseMsg: "Msg4B",
                                                                           MemSessao:Menus,
                                                                           DigiteNaRegra:true,
                                                                           Robotizado:true, 
                                                                           MsgFutura1:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg3,
                                                                               Tempo:Tempo3,
                                                                           },
                                                                           MsgFutura2:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg4,
                                                                               Tempo:Tempo4,
                                                                           },
                                                                           MsgFutura3:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg5,
                                                                               Tempo:Tempo5,
                                                                           },
                                                                           UltimaMsg:{
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               date:new Date().getTime()+5000,
                                                                               Type:"botao"
                                                                           },
                                                                           Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                               Autor:IdCli,
                                                                               body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                               date:new Date().getTime(),
                                                                               Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                           }, 
                                                                           {
                                                                           Autor:EMPRESA,
                                                                           body: `${NomeCli} Você Escolheu ${SessaoGuar}` ,
                                                                           date:new Date().getTime()+5000,
                                                                           Type:"text"
                                                                       },
                                                                           {
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               Botao:Menus,
                                                                               date:new Date().getTime()+7000,
                                                                               Type:"botao"
                                                                           },
                                                                           
                                                                           
                                                                           )
                                                                           })
                                                                           .then(async() => {
                                                                               
                                                                               //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                               console.log(TempMsg)
                                                                               response.json({ Inf:[{Msg: `${NomeCli} Você Escolheu ${SessaoGuar}`  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${AutoMsg} ${SessaoGuar}*`:`*${AutoMsg} ${SessaoGuar}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                           }) 
                                                                       } else {
                                                                               //Mudando a Fase do Chat
                                                                           await db.collection("ChatCliente")
                                                                           .doc(IdChat)
                                                                           .update({
                                                                           Sessao:SessaoGuar,
                                                                           FaseMsg: "Msg4B",
                                                                           MemSessao:Menus,
                                                                           DigiteNaRegra:true,
                                                                           Robotizado:true, 
                                                                           MsgFutura1:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg3,
                                                                               Tempo:Tempo3,
                                                                           },
                                                                           MsgFutura2:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg4,
                                                                               Tempo:Tempo4,
                                                                           },
                                                                           MsgFutura3:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg5,
                                                                               Tempo:Tempo5,
                                                                           },
                                                                           UltimaMsg:{
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               date:new Date().getTime()+5000,
                                                                               Type:"botao"
                                                                           },
                                                                           Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                               Autor:IdCli,
                                                                               body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                               date:new Date().getTime(),
                                                                               Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                           }, 
                                                                           {
                                                                           Autor:EMPRESA,
                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                           date:new Date().getTime()+2000,
                                                                           Type:"text"
                                                                       },
                                                                       {
                                                                           Autor:EMPRESA,
                                                                           body: `${NomeCli}, Você Escolheu ${SessaoGuar}` ,
                                                                           date:new Date().getTime()+5000,
                                                                           Type:"text"
                                                                       },
                                                                           {
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               Botao:Menus,
                                                                               date:new Date().getTime()+7000,
                                                                               Type:"botao"
                                                                           },
                                                                           
                                                                           
                                                                           )
                                                                           })
                                                                           .then(async() => {
                                                                               
                                                                               //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                               console.log(TempMsg)
                                                                               response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli} Você Escolheu ${SessaoGuar}`  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${SessaoGuar} ${AutoMsg}*`:`*${SessaoGuar} ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                           }) 
   
                                                                       }

                                                                    }else if(TextErrado2 === true && ProdAtivo === true && TextErrado3 === true && TextErrado4 === true && TextErrado1 === false){// Entra aqui por que ele não digitou o tamanho
                                                                        console.log("Entrou  Sessão Envio Chat 2")
                                                                        var QMsg= MsgEmp.Msg4H.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                       var AutoMsg = MsgEmp.Msg4H.Msg[Num];
                                                                       var TempMsg =  MsgEmp.Msg4H.TempoSeg;
                                                               
                                                                       console.log(MsgEmp.Msg4B.Msg)
                                                                       console.log("Qmsg: "+QMsg)       
                                                                       console.log("Soteio: "+Sorteio)                 
                                                                       console.log("Msg: "+AutoMsg)
   
                                
                                                                       
                                                                       if(Robo === true && EstaNaRegra === true){
                                                                           //Mudando a Fase do Chat
                                                                           await db.collection("ChatCliente")
                                                                           .doc(IdChat)
                                                                           .update({
                                                                           Sessao:SessaoGuar,
                                                                           FaseMsg: "Msg4H",
                                                                           MemSubSessao:Menus,
                                                                           DigiteNaRegra:true,
                                                                           Robotizado:true, 
                                                                           MsgFutura1:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg3,
                                                                               Tempo:Tempo3,
                                                                           },
                                                                           MsgFutura2:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg4,
                                                                               Tempo:Tempo4,
                                                                           },
                                                                           MsgFutura3:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg5,
                                                                               Tempo:Tempo5,
                                                                           },
                                                                           UltimaMsg:{
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               date:new Date().getTime()+5000,
                                                                               Type:"botao"
                                                                           },
                                                                           Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                               Autor:IdCli,
                                                                               body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                               date:new Date().getTime(),
                                                                               Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                           }, 
                                                                           {
                                                                           Autor:EMPRESA,
                                                                           body: `${NomeCli} Você Escolheu ${SessaoGuar}` ,
                                                                           date:new Date().getTime()+5000,
                                                                           Type:"text"
                                                                       },
                                                                           {
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               Botao:Menus,
                                                                               date:new Date().getTime()+7000,
                                                                               Type:"botao"
                                                                           },
                                                                           
                                                                           
                                                                           )
                                                                           })
                                                                           .then(async() => {
                                                                               
                                                                               //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                               console.log(TempMsg)
                                                                               response.json({ Inf:[{Msg: `${NomeCli} Você Escolheu ${SessaoGuar}`  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${AutoMsg} ${SessaoGuar}*`:`*${AutoMsg} ${SessaoGuar}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                           }) 
                                                                       } else {
                                                                               //Mudando a Fase do Chat
                                                                           await db.collection("ChatCliente")
                                                                           .doc(IdChat)
                                                                           .update({
                                                                           Sessao:SessaoGuar,
                                                                           FaseMsg: "Msg4H",
                                                                           MemSubSessao:Menus,
                                                                           DigiteNaRegra:true,
                                                                           Robotizado:true, 
                                                                           MsgFutura1:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg3,
                                                                               Tempo:Tempo3,
                                                                           },
                                                                           MsgFutura2:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg4,
                                                                               Tempo:Tempo4,
                                                                           },
                                                                           MsgFutura3:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg5,
                                                                               Tempo:Tempo5,
                                                                           },
                                                                           UltimaMsg:{
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               date:new Date().getTime()+5000,
                                                                               Type:"botao"
                                                                           },
                                                                           Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                               Autor:IdCli,
                                                                               body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                               date:new Date().getTime(),
                                                                               Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                           }, 
                                                                           {
                                                                           Autor:EMPRESA,
                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                           date:new Date().getTime()+2000,
                                                                           Type:"text"
                                                                       },
                                                                       {
                                                                           Autor:EMPRESA,
                                                                           body: `${NomeCli}, Você Escolheu ${SessaoGuar}` ,
                                                                           date:new Date().getTime()+5000,
                                                                           Type:"text"
                                                                       },
                                                                           {
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               Botao:Menus,
                                                                               date:new Date().getTime()+7000,
                                                                               Type:"botao"
                                                                           },
                                                                           
                                                                           
                                                                           )
                                                                           })
                                                                           .then(async() => {
                                                                               
                                                                               //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                               console.log(TempMsg)
                                                                               response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli} Você Escolheu ${SessaoGuar}`  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${SessaoGuar} ${AutoMsg}*`:`*${SessaoGuar} ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                           }) 
   
                                                                       }

                                                                    } else if(TextErrado2 === true && ProdAtivo === false && TextErrado3 === true && TextErrado4 === true && TextErrado1 === false){// Entra aqui por que ele digitou uma sessão desativada
                                                                        console.log("Entrou  Sessão Envio Chat 2")
                                                                        var QMsg= MsgEmp.Msg4M.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                       var AutoMsg = MsgEmp.Msg4M.Msg[Num];
                                                                       var TempMsg =  MsgEmp.Msg4M.TempoSeg;
                                                               
                                                                      
   
                                
                                                                       
                                                                       if(Robo === true && EstaNaRegra === true){
                                                                           //Mudando a Fase do Chat
                                                                           await db.collection("ChatCliente")
                                                                           .doc(IdChat)
                                                                           .update({
                                                                           DigiteNaRegra:true,
                                                                           Robotizado:true, 
                                                                           MsgFutura1:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg3,
                                                                               Tempo:Tempo3,
                                                                           },
                                                                           MsgFutura2:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg4,
                                                                               Tempo:Tempo4,
                                                                           },
                                                                           MsgFutura3:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg5,
                                                                               Tempo:Tempo5,
                                                                           },
                                                                           UltimaMsg:{
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               date:new Date().getTime()+5000,
                                                                               Type:"text"
                                                                           },
                                                                           Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                               Autor:IdCli,
                                                                               body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                               date:new Date().getTime(),
                                                                               Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                           }, 
                                                                         
                                                                           {
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               Botao:[],
                                                                               date:new Date().getTime()+7000,
                                                                               Type:"text"
                                                                           },
                                                                           
                                                                           
                                                                           )
                                                                           })
                                                                           .then(async() => {
                                                                               
                                                                               //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                               console.log(TempMsg)
                                                                               response.json({ Inf:[ {Msg:NomeCli? `${NomeCli} ${SessaoGuar} ${AutoMsg}`:`${SessaoGuar} ${AutoMsg}` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                           }) 
                                                                       } else {
                                                                               //Mudando a Fase do Chat
                                                                           await db.collection("ChatCliente")
                                                                           .doc(IdChat)
                                                                           .update({
                                                                         
                                                                           DigiteNaRegra:true,
                                                                           Robotizado:true, 
                                                                           MsgFutura1:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg3,
                                                                               Tempo:Tempo3,
                                                                           },
                                                                           MsgFutura2:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg4,
                                                                               Tempo:Tempo4,
                                                                           },
                                                                           MsgFutura3:{
                                                                               Ativo:true,
                                                                               Msg:AutoMsg5,
                                                                               Tempo:Tempo5,
                                                                           },
                                                                           UltimaMsg:{
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               date:new Date().getTime()+5000,
                                                                               Type:"text"
                                                                           },
                                                                           Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                               Autor:IdCli,
                                                                               body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                               date:new Date().getTime(),
                                                                               Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                           }, 
                                                                           {
                                                                           Autor:EMPRESA,
                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                           date:new Date().getTime()+2000,
                                                                           Type:"text"
                                                                       },
                                                                       
                                                                           {
                                                                               Autor:EMPRESA,
                                                                               body:`${NomeCli}${AutoMsg}`,
                                                                               Botao:[],
                                                                               date:new Date().getTime()+7000,
                                                                               Type:"text"
                                                                           },
                                                                           
                                                                           
                                                                           )
                                                                           })
                                                                           .then(async() => {
                                                                               
                                                                               //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                               console.log(TempMsg)
                                                                               response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},{Msg:NomeCli? `${NomeCli} ${SessaoGuar} ${AutoMsg}`:`${SessaoGuar} ${AutoMsg}` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                           }) 
   
                                                                       }

                                                                    } else  if(TextErrado2 === true && ProdAtivo === false && TextErrado3 === true && TextErrado4 === false && TextErrado1 === true){//Se Digitou Tamanho e o sabor
                                                                        console.log("Entrou  Sessão Envio Chat 1")
                                                                        //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg6A.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg6A.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg6A.TempoSeg;


                                                                        // var QMsg2= MsgEmp.Msg4I.Msg.length;
                                                                        // var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        // var Result2 =parseInt(Sorteio2);
                                                                        // var Num2 = Result2-1;
                                                                        // var AutoMsg2 = MsgEmp.Msg4I.Msg[Num2];
                                                                        // var TempMsg2 =  MsgEmp.Msg4I.TempoSeg;
                                                                        await db.collection("MesaItem")
                                                                        .doc(PedidoCri)
                                                                        .update({
                                                                            Itens:admin.firestore.FieldValue.arrayUnion({
                                                                                Descont: Nota.Descont,
                                                                                Descricao: Nota.Descricao,
                                                                                Foto: Nota.foto,
                                                                                ItemEspeci:true,
                                                                                Nome: Nota.Nome,
                                                                                Observacao:"",
                                                                                Preco: Nota.Preco,
                                                                                Quant:1,
                                                                                SubSessao: Nota.Tamanho,
                                                                                Sessao: Nota.Sessao,
                                                                            }) 
                                                                        }).then((doc)=>{
                                                                            //PedidosItens = doc.data().Itens;
                                                                        })

                                                                        var PedidosItens = []
                                                                        await db.collection("MesaItem")
                                                                        .doc(PedidoCri)
                                                                        .get().then((doc)=>{
                                                                            PedidosItens = doc.data().Itens;
                                                                        })

                                                                        var MsgPedido = NomeCli+" Anotamos Seu Pedido";
                                                                        var TotalValor = 0
                                                                        for(let i in PedidosItens){
                                                                        
                                                                        
                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                        
                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                        
                                                                           
                                                                        
                                                                        
                                                                        
                                                                        if(PedidosItens[i].ItemEspeci){
                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                        }
                                                                        if(PedidosItens[i].Descont){
                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                        
                                                                        } else {
                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                        
                                                                        }
                                                                        
                                                                        if(PedidosItens[i].Observacao){
                                                                            MsgPedido = MsgPedido + "⚠️ Ingredientes Tirados: "+PedidosItens[i].Observacao+"\n"
                                                                            }
                                                                        
                                                                        }
                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                        MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})

                                                                       
                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                    //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4A",
                                                                                   
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body: `${NomeCli}, Você Escolheu ${Nota.Nome}` ,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:SubMenus,
                                                                                        date:new Date().getTime()+7000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: MsgPedido  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${AutoMsg}*`:`*${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                    }) 
                                                                                    } else {
                                                                                        //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4A",
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+2000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body: `${NomeCli}, Você Escolheu ${Nota.Nome}` ,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:2000, Type:"text"}, {Msg:NomeCli? `*${NomeCli} ${AutoMsg}*`:`*${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                    }) 
                                            
                                                                                    }

                                                                             
                                                                    }else {

                                                                        if(EstaNaRegra === true && Robo === true){

                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                            var Result =parseInt(Sorteio);
                                                                            var Num = Result-1;
                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                            //mensagens de estimulo para continuar o atendimento
                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                
                                                                            var Result3 =parseInt(Sorteio3);
                                                                            var Result4 =parseInt(Sorteio4);
                                                                            var Result5 =parseInt(Sorteio5);
                                                                
                                                                            var Num3 = Result3-1;
                                                                            var Num4 = Result4-1;
                                                                            var Num5 = Result5-1;
                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                            //Mudando a Fase do Chat
                                                                            
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                            DigiteNaRegra:false, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },
                                                                            
                                                                            
                                                                            )
                                                                            })
                                                                            .then(async() => {
                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                console.log(TempMsg)
                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                    
                                                                            }) 
                                                                        } else  if(EstaNaRegra === false){

                                                                            //mensagens de estimulo para continuar o atendimento
                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                
                                                                            var Result3 =parseInt(Sorteio3);
                                                                            var Result4 =parseInt(Sorteio4);
                                                                            var Result5 =parseInt(Sorteio5);
                                                                
                                                                            var Num3 = Result3-1;
                                                                            var Num4 = Result4-1;
                                                                            var Num5 = Result5-1;
                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                        
                                                                        
                                                                        
                                                                        
                                                                            //Mudando a Fase do Chat
                                                                            
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                            Robotizado:false, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"texto"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },)
                                                                            })
                                                                            .then(async() => {
                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                console.log(TempMsg)
                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"nada"}] });
                                                                    
                                                                            }) 
                                                                        }
                                                                 }


                                                                    
                                                              

                                                        
                                                            
                                                            } else if(FaMsg === "Msg4B" ){//Recebendo o Item, Perguntando A Quantidade
                                                                var NumIni = parseInt(Mensagem.body)  
                                                                var QuantMen = MemoriaSessao.length;
                                                                console.log("Entrada "+NumIni)
                                                                console.log("Quantidade "+QuantMen)
                                                                if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                    var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                    await db.collection("MenusSite")
                                                                    .where("Empresa", "==", EMPRESA)
                                                                    .where("Ativo", "==", true)
                                                                    .get().then(async (querySnapshot23) => {
                                                                        await querySnapshot23.forEach((doc23) => {

                                                                            Menus.push({
                                                                                id:doc23.id,
                                                                                body:doc23.data().nome,
                                                                                GrupTamanho:doc23.data().GrupTamanho,
                                                                                MemFim:doc23.data().MemFim,
                                                                                Tamanho:doc23.data().Tamanho,
                                                                            })
                                                                        
                                                                            })

                                                                    });

                                                                console.log(Menus)
                                                                    //montar a mensagem   
                                                                var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                var Result =parseInt(Sorteio);
                                                                var Num = Result-1;
                                                                var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                var TempMsg =  MsgEmp.Msg4A.TempoSeg;

                                                                //  console.log(MsgEmp.Msg2A.Msg)
                                                                //  console.log("Qmsg: "+QMsg)       
                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                //  console.log("Msg: "+AutoMsg)


                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                var Result2 =parseInt(Sorteio2);
                                                                var Num2 = Result2-1;
                                                                var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                
                                                                //mensagens de estimulo para continuar o atendimento
                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                    
                                                                var Result3 =parseInt(Sorteio3);
                                                                var Result4 =parseInt(Sorteio4);
                                                                var Result5 =parseInt(Sorteio5);
                                                    
                                                                var Num3 = Result3-1;
                                                                var Num4 = Result4-1;
                                                                var Num5 = Result5-1;
                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                            
                                                                        // Robo sendo true, ele 
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                            console.log("Entreou A  QUI ")
                                                                await db.collection("ChatCliente")
                                                                .doc(IdChat)
                                                                .update({
                                                                FaseMsg: "Msg4A",
                                                                MsgFutura1:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg3,
                                                                    Tempo:Tempo3,
                                                                },
                                                                MsgFutura2:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg4,
                                                                    Tempo:Tempo4,
                                                                },
                                                                MsgFutura3:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg5,
                                                                    Tempo:Tempo5,
                                                                },
                                                                MemSessao:Menus,
                                                                Reclamaçoes:null,
                                                                Localização:null,
                                                                DigiteNaRegra:true,
                                                                Robotizado:true, 
                                                                UltimaMsg:{
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                    Autor:IdCli,
                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                    date:new Date().getTime(),
                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                }, 
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    Botao:Menus,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                
                                                                
                                                                )
                                                                })
                                                                .then(async() => {
                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                    console.log(TempMsg)
                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                            
                                                                }) 
                                                                    
                                                                    }else {
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4A",
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        MemSessao:Menus,
                                                                        Reclamaçoes:null,
                                                                        Localização:null,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                        {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                        date:new Date().getTime()+2000,
                                                                        Type:"text"
                                                                    },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                        
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                    
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 

                                                                    }
                                                                //Mudando a Fase do Chat
                                                                
                                                                
                                                                
                                                                    
                                                                        
                                                                
                                                
                                                                
                                                        


                                                                }else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                    
                                                                        console.log(MemoriaProduto[NumIni].id)
                                                                            //Escolhendo os itens da sessão escolhida
                                                                            var Menus = []
                                                                            var Quant = [{id:"0", body:"Voltar Para os Itens"}]; 

                                                                            console.log("Id :"+MemoriaProduto[NumIni].id)
                                                                            
                                                                            if(MemoriaProduto[NumIni].Ilimitado){
                                                                                for(var i = 1; i < 6; i++){
                                                                                    Quant.push({
                                                                                        id:i,
                                                                                        body:i+" Quantidade"
                                                                                    })
                                                                                    }

                                                                            }else {
                                                                                if(MemoriaProduto[NumIni].Quant < 6){
                                                                                    for(var i = 1; i <= MemoriaProduto[NumIni].Quant; i++){
                                                                                    Quant.push({
                                                                                        id:i,
                                                                                        body:i+" Quantidade"
                                                                                    })
                                                                                    }

                                                                                } else {
                                                                                    for(var i = 1; i < 6; i++){
                                                                                        Quant.push({
                                                                                            id:i,
                                                                                            body:i+" Quantidade"
                                                                                        })
                                                                                        }
                                                                                }

                                                                            }
                                                                        
                                                                            
                                                                        
                                                                            
                                                                        console.log(Quant)

                                                                            //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4C.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4C.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4C.TempoSeg;
                                                                
                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                        console.log("Qmsg: "+QMsg)       
                                                                        console.log("Soteio: "+Sorteio)                 
                                                                        console.log("Msg: "+AutoMsg)

                                                                        
                                                    
                                                        
                                                                        var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        var Result2 =parseInt(Sorteio2);
                                                                        var Num2 = Result2-1;
                                                                        var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                        var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                    
                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                        

                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                            var Result9 =parseInt(Sorteio9);
                                                                            var Num9 = Result9-1;
                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                                        //Mensagens de estimulo 
                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                            
                                                                        var Result3 =parseInt(Sorteio3);
                                                                        var Result4 =parseInt(Sorteio4);
                                                                        var Result5 =parseInt(Sorteio5);
                                                            
                                                                        var Num3 = Result3-1;
                                                                        var Num4 = Result4-1;
                                                                        var Num5 = Result5-1;
                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                    
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4D",
                                                                        MemPedido:{
                                                                            Nome: [MemoriaProduto[NumIni].Nome] ,
                                                                            Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                            Foto:[MemoriaProduto[NumIni].foto],
                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                            Sessao:SessaoEsta,
                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                            Quant:0,
                                                                            Observacao:"",
                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                            QuantGeral:Quant.length,
                                                                        
                                                                        },
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                            {
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}, ${AutoMsg}: ${MemoriaProduto[NumIni].Nome}`,
                                                                            Botao:[],
                                                                            date:new Date().getTime()+3000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            var MsgPedido = NomeCli+AutoMsg;
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                            if(MemoriaProduto[NumIni].Descricao){
                                                                                MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                            }
                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                            }
                                                                            
                                                                            
                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            } else {
                                                                                MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            }
                                                                                
                                                                            
                                                                                
                                                                            
                                                                            
                                                                            // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                            
                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                        }) 
                                                                        } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4D",
                                                                        MemPedido:{
                                                                            Nome: [MemoriaProduto[NumIni].Nome] ,
                                                                            Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                            Foto:[MemoriaProduto[NumIni].foto],
                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                            Sessao:SessaoEsta,
                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao,
                                                                            Quant:0,
                                                                            Observacao:"",
                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                            QuantGeral:Quant.length,
                                                                        
                                                                        },
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                            Botao:[],
                                                                            date:new Date().getTime()+1000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}, ${AutoMsg}: ${MemoriaSessao[NumIni].Nome}`,
                                                                            Botao:[],
                                                                            date:new Date().getTime()+3000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            var MsgPedido = NomeCli+AutoMsg;
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "🛍️"+SessaoEsta+"\n"
                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                            if(MemoriaProduto[NumIni].Descricao){
                                                                                MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                            }
                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                            }
                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            } else {
                                                                                MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            }
                                                                                
                                                                            
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                            
                                                                            }) 

                                                                        }


                                                                        
                                                                
                                                                    
                                                                        
                                                                    
                                                                        } else {

                                                                            if(EstaNaRegra === true && Robo === true){

                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                var Result =parseInt(Sorteio);
                                                                                var Num = Result-1;
                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                //Mudando a Fase do Chat
                                                                                
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                DigiteNaRegra:false, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    console.log(TempMsg)
                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                        
                                                                                }) 
                                                                            } else  if(EstaNaRegra === false){

                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                            
                                                                            
                                                                            
                                                                            
                                                                                //Mudando a Fase do Chat
                                                                                
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                Robotizado:false, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"texto"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },)
                                                                                })
                                                                                .then(async() => {
                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    console.log(TempMsg)
                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        
                                                                                }) 
                                                                            }
                                                                        }
                                                
                                                            
                                                                
                                                                }else if(FaMsg === "Msg4D" ){//Recebendo A Quantidade, Peguntando Se Quer Retirar um Ingrediente OU Mostra nota e Pergunta o que Deseja Fazer
                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                    var QuantMen = MemoriaSessao.length;
                                                                    console.log("Entrada "+NumIni)
                                                                    console.log("Quantidade "+QuantMen)
                                                                    if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                    
                                                                        console.log(MemoriaSessao[NumIni].body)
                                                                            //Escolhendo os itens da sessão escolhida
                                                                            var Menus = MemoriaProduto;
                                                                        
                                                                        

                                                                            
                                                                        
                                                                            console.log(Menus)


                                                                            //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4B.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4B.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4B.TempoSeg;
                                                                
                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                        console.log("Qmsg: "+QMsg)       
                                                                        console.log("Soteio: "+Sorteio)                 
                                                                        console.log("Msg: "+AutoMsg)

                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                        var Result9 =parseInt(Sorteio9);
                                                                        var Num9 = Result9-1;
                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                    
                                                        
                                                                        //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                        //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        //  var Result2 =parseInt(Sorteio2);
                                                                        //  var Num2 = Result2-1;
                                                                        //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                        //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                    
                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                        

                                                                        //Mensagens de estimulo 
                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                            
                                                                        var Result3 =parseInt(Sorteio3);
                                                                        var Result4 =parseInt(Sorteio4);
                                                                        var Result5 =parseInt(Sorteio5);
                                                            
                                                                        var Num3 = Result3-1;
                                                                        var Num4 = Result4-1;
                                                                        var Num5 = Result5-1;
                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                    
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        
                                                                        FaseMsg: "Msg4B",
                                                                        MemProdutos:Menus,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+7000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 
                                                                        } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4B",
                                                                        MemProdutos:Menus,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+2000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 

                                                                        

                                                                    }
                                                                        
                                                                
                                                                    
                                                                        
                                                                    
                                                                        } else  if(NumIni > 0 && NumIni <= MemoriaPedido.QuantGeral) {
                                                                        
                                                                        if(MemoriaPedido.MemFim){
                                                                        
                                                                            //Escolhendo os itens da sessão escolhida
                                                                            var Menus = MemoriaPedido;
                                                                            var PedidosItens = []
                                                                        
                                                                            console.log(Menus)


                                                                            //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                
                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                        console.log("Qmsg: "+QMsg)       
                                                                        console.log("Soteio: "+Sorteio)                 
                                                                        console.log("Msg: "+AutoMsg)

                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                        var Result9 =parseInt(Sorteio9);
                                                                        var Num9 = Result9-1;
                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                    
                                                        
                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        var Result2 =parseInt(Sorteio2);
                                                                        var Num2 = Result2-1;
                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                    
                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                        

                                                                        //Mensagens de estimulo 
                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                            
                                                                        var Result3 =parseInt(Sorteio3);
                                                                        var Result4 =parseInt(Sorteio4);
                                                                        var Result5 =parseInt(Sorteio5);
                                                            
                                                                        var Num3 = Result3-1;
                                                                        var Num4 = Result4-1;
                                                                        var Num5 = Result5-1;
                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                        console.log("id : "+PedidoCri)

                                                                        await db.collection("MesaItem")
                                                                        .doc(PedidoCri)
                                                                        .update({
                                                                            Itens:admin.firestore.FieldValue.arrayUnion({
                                                                                Nome:MemoriaPedido.Nome,
                                                                                Descricao:MemoriaPedido.Descricao,
                                                                                Foto:MemoriaPedido.Foto,
                                                                                Preco:MemoriaPedido.Preco,
                                                                                Descont:MemoriaPedido.Descont,
                                                                                Quant:NumIni,
                                                                                Observacao:"",
                                                                                ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                Sessao:MemoriaPedido.Sessao,
                                                                                SubSessao:MemoriaPedido.SubSessao,
                                                                                
                                                                            }) 
                                                                        }).then((doc)=>{
                                                                            //PedidosItens = doc.data().Itens;
                                                                        })

                                                                        await db.collection("MesaItem")
                                                                        .doc(PedidoCri)
                                                                        .get().then((doc)=>{
                                                                            PedidosItens = doc.data().Itens;
                                                                        })
                                                                        console.log(PedidosItens)
                                                    
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                            MemSessao:[],
                                                                            MemPedido:[],
                                                                            MemProdutos:[],
                                                                            MemSubSessao:[],
                                                                            MenSabor:0,
                                                                            EscolhaSabor:0, 
                                                                            Sessao:"",
                                                                        FaseMsg: "Msg6A",
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+7000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                            date:new Date().getTime()+8000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                            var TotalValor = 0
                                                                            for(let i in PedidosItens){
                                                                                
                                                                            
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                
                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                    if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                        
                                                                                    } else {
                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                    }
                                                                                
                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                }
                                                                                
                                                                                if(PedidosItens[i].Descont){
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                } else {
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                }

                                                                            }
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                        
                                                                                
                                                                            
                                                                        
                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                        }) 
                                                                        } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                            MemSessao:[],
                                                                            MemPedido:[],
                                                                            MemProdutos:[],
                                                                            MemSubSessao:[],
                                                                            MenSabor:0,
                                                                            EscolhaSabor:0, 
                                                                        FaseMsg: "Msg6A",
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                            date:new Date().getTime()+2000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                            date:new Date().getTime()+8000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                            var TotalValor = 0
                                                                            for(let i in PedidosItens){
                                                                                
                                                                            
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                
                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                    if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                        
                                                                                    } else {
                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                    }
                                                                                
                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                }
                                                                            
                                                                                if(PedidosItens[i].Descont){
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                } else {
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                }

                                                                            }
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                
                                                                            
                                                                        
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            
                                                                            
                                                                        }) 

                                                                        

                                                                    }
                                                                        
                                                                
                                                                    
                                                                        
                                                                    
                                                                        } else {
                                                                                    //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg4E.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg4E.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg4E.TempoSeg;
                                                                            
                                                                                //  console.log(MsgEmp.Msg4B.Msg)
                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                //  console.log("Msg: "+AutoMsg)

                                                                                    
                                                                
                                                                
                                                                                //  var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                //  var Num2 = Result2-1;
                                                                                //  var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                //  var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                                
                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                    var Num9 = Result9-1;
                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                                                    //Mensagens de estimulo 
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                            
                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                    //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4E",
                                                                                    MemPedido:{
                                                                                    Nome:MemoriaPedido.Nome,
                                                                                    Descricao:MemoriaPedido.Descricao,
                                                                                    Foto:MemoriaPedido.Foto,
                                                                                    Preco:MemoriaPedido.Preco,
                                                                                    Descont:MemoriaPedido.Descont,
                                                                                    Quant:NumIni,
                                                                                    Observacao:"",
                                                                                    ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                    Sessao:MemoriaPedido.Sessao,
                                                                                    SubSessao:MemoriaPedido.SubSessao,
                                                                                    
                                                                                },
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                                    {
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}, Sua quantidade foi preenchida no item ${MemoriaPedido.Nome}`,
                                                                                        Botao:[],
                                                                                        date:new Date().getTime()+3000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    Botao:MsgEmp.Msg4E.Botao,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                    var MsgPedido = NomeCli+", a Quantidade foi Escolhida e adicionada no pedido";
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        MsgPedido = MsgPedido + "🛍️ "+MemoriaPedido.Sessao+"\n"
                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome+"\n"
                                                                                        if(MemoriaPedido.Descricao){
                                                                                        MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao+"\n"
                                                                                        }
                                                                                        if(MemoriaPedido.ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+MemoriaPedido.SubSessao+"\n"
                                                                                        }
                                                                                    
                                                                                        if(MemoriaPedido.Descont){
                                                                                        MsgPedido = MsgPedido + "💰 De:"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+MemoriaPedido.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                        } else {
                                                                                        MsgPedido = MsgPedido + "💰"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                        }
                                                                                        
                                                                                        
                                                                                        
                                                                                        
                                                                                    
                                                                                    // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    
                                                                                        response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg4E.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                    }) 
                                                                                } else {
                                                                                        //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4E",
                                                                                    MemPedido:{
                                                                                    Nome:MemoriaPedido.Nome,
                                                                                    Descricao:MemoriaPedido.Descricao,
                                                                                    Foto:MemoriaPedido.Foto,
                                                                                    Preco:MemoriaPedido.Preco,
                                                                                    Descont:MemoriaPedido.Descont,
                                                                                    Quant:NumIni,
                                                                                    Observacao:"",
                                                                                    ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                    Sessao:MemoriaPedido.Sessao,
                                                                                    SubSessao:MemoriaPedido.SubSessao,
                                                                                },
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli} ${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}, Quantidade adicionada no item: ${MemoriaPedido.Nome}`,
                                                                                    Botao:[],
                                                                                    date:new Date().getTime()+3000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli} ${AutoMsg}`,
                                                                                    Botao:MsgEmp.Msg4E.Botao,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                    var MsgPedido = NomeCli+", a Quantidade foi Escolhida e adicionada no pedido";
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "🛍️ "+MemoriaPedido.Sessao+"\n"
                                                                                    MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome+"\n"
                                                                                    if(MemoriaPedido.Descricao){
                                                                                        MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao+"\n"
                                                                                        }
                                                                                    if(MemoriaPedido.ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+MemoriaPedido.SubSessao+"\n"
                                                                                        }
                                                                                    
                                                                                    if(MemoriaPedido.Descont){
                                                                                        MsgPedido = MsgPedido + "💰 De:"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+MemoriaPedido.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                    } else {
                                                                                        MsgPedido = MsgPedido + "💰"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                    }
                                                                                        
                                                                                        
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg4E.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                    
                                                                                    }) 

                                                                                }

                                                                        }
                                                
                                                                            
                                                
                                                
                                                                            
                                                                    
                                                                        
                                                                            
                                                                        
                                                                            } else {
                                                
                                                                                if(EstaNaRegra === true && Robo === true){

                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    DigiteNaRegra:false, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                        date:new Date().getTime(),
                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                    }, 
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                            
                                                                                    }) 
                                                                                } else  if(EstaNaRegra === false ){

                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                
                                                                                
                                                                                
                                                                                
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    Robotizado:false, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"texto"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                        date:new Date().getTime(),
                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                    }, 
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },)
                                                                                    })
                                                                                    .then(async() => {
                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                            
                                                                                    }) 
                                                                                }
                                                                            }
                                                    
                                                                
                                                                    
                                                                     } else if(FaMsg === "Msg4E" ){//Recebendo Sim ou Não de Retirar, (Não)Enviando a Nota Com A pergunta do que quer realizar ou (Sim)Perguntar o que quer retirar
                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                        var QuantMen = MemoriaSessao.length;
                                                                        console.log("Entrada "+NumIni)
                                                                        console.log("Quantidade "+QuantMen)
                                                                        if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                        
                                                                                //Escolhendo os itens da sessão escolhida
                                                                                var Menus = MemoriaPedido;
                                                                                var PedidosItens = []
                                                                            
                                                                                console.log(Menus)
                                                
                                                
                                                                                //montar a mensagem   
                                                                            var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                            var Result =parseInt(Sorteio);
                                                                            var Num = Result-1;
                                                                            var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                            var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                    
                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                            console.log("Qmsg: "+QMsg)       
                                                                            console.log("Soteio: "+Sorteio)                 
                                                                            console.log("Msg: "+AutoMsg)

                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                            var Result9 =parseInt(Sorteio9);
                                                                            var Num9 = Result9-1;
                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                        
                                                            
                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                            var Result2 =parseInt(Sorteio2);
                                                                            var Num2 = Result2-1;
                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                        
                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                            

                                                                            //Mensagens de estimulo 
                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                
                                                                            var Result3 =parseInt(Sorteio3);
                                                                            var Result4 =parseInt(Sorteio4);
                                                                            var Result5 =parseInt(Sorteio5);
                                                                
                                                                            var Num3 = Result3-1;
                                                                            var Num4 = Result4-1;
                                                                            var Num5 = Result5-1;
                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                            console.log("id : "+PedidoCri)

                                                                            await db.collection("MesaItem")
                                                                            .doc(PedidoCri)
                                                                            .update({
                                                                                Itens:admin.firestore.FieldValue.arrayUnion(MemoriaPedido) 
                                                                            }).then((doc)=>{
                                                                                //PedidosItens = doc.data().Itens;
                                                                            })

                                                                            await db.collection("MesaItem")
                                                                            .doc(PedidoCri)
                                                                            .get().then((doc)=>{
                                                                                PedidosItens = doc.data().Itens;
                                                                            })
                                                                            console.log(PedidosItens)
                                                        
                                                                            if(Robo === true && EstaNaRegra === true){
                                                                            //Mudando a Fase do Chat
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                                MemSessao:[],
                                                                                MemPedido:[],
                                                                                MemProdutos:[],
                                                                                MemSubSessao:[],
                                                                                MenSabor:0,
                                                                                EscolhaSabor:0, 
                                                                                Sessao:"",
                                                                            FaseMsg: "Msg6A",
                                                                            DigiteNaRegra:true,
                                                                            Robotizado:true, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"botao"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                            
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+7000,
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                date:new Date().getTime()+8000,
                                                                                Type:"botao"
                                                                            },
                                                                            
                                                                            
                                                                            )
                                                                            })
                                                                            .then(async() => {
                                                                                
                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                var TotalValor = 0
                                                                                for(let i in PedidosItens){
                                                                                    
                                                                                
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                    
                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                        if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                        } else {
                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                        }
                                                                                    
                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                    }
                                                                                    
                                                                                    if(PedidosItens[i].Descont){
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    } else {
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    }

                                                                                }
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                            
                                                                                    
                                                                                
                                                                            
                                                                                response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                            }) 
                                                                            } else {
                                                                                //Mudando a Fase do Chat
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                                MemSessao:[],
                                                                                MemPedido:[],
                                                                                MemProdutos:[],
                                                                                MemSubSessao:[],
                                                                                MenSabor:0,
                                                                                EscolhaSabor:0, 
                                                                            FaseMsg: "Msg6A",
                                                                            DigiteNaRegra:true,
                                                                            Robotizado:true, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"botao"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Mensagem.body,
                                                                                date:new Date().getTime(),
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                date:new Date().getTime()+2000,
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                date:new Date().getTime()+8000,
                                                                                Type:"botao"
                                                                            },
                                                                            
                                                                            
                                                                            )
                                                                            })
                                                                            .then(async() => {
                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                var TotalValor = 0
                                                                                for(let i in PedidosItens){
                                                                                    
                                                                                
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                    
                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                        if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                        } else {
                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                        }
                                                                                    
                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                    }
                                                                                
                                                                                    if(PedidosItens[i].Descont){
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    } else {
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    }

                                                                                }
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                    
                                                                                
                                                                            
                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                
                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                
                                                                                
                                                                            }) 

                                                                            
                                                
                                                                        }
                                                                            
                                                                    
                                                                        
                                                                            
                                                                        
                                                                            } else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 ") {
                                                                            
                                                                            
                                                    
                                                                                    //montar a mensagem   
                                                                                var QMsg= MsgEmp.Msg4F.Msg.length;
                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                var Result =parseInt(Sorteio);
                                                                                var Num = Result-1;
                                                                                var AutoMsg = MsgEmp.Msg4F.Msg[Num];
                                                                                var TempMsg =  MsgEmp.Msg4F.TempoSeg;
                                                                        
                                                                                //  console.log(MsgEmp.Msg4B.Msg)
                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                //  console.log("Msg: "+AutoMsg)

                                                                                
                                                            
                                                                
                                                                                //  var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                //  var Num2 = Result2-1;
                                                                                //  var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                //  var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                            
                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                    var Num9 = Result9-1;
                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                                                //Mensagens de estimulo 
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                            
                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                FaseMsg: "Msg4F",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+3000,
                                                                                    Type:"text"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                                    {
                                                                                    Autor:IdCli,
                                                                                    body:Mensagem.body,
                                                                                    date:new Date().getTime(),
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}, ${AutoMsg}`,
                                                                                    date:new Date().getTime()+3000,
                                                                                    Type:"text"
                                                                                },
                                                                                
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                
                                                                                        
                                                                                    
                                                                                        
                                                                                    
                                                                                    
                                                                                    // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    
                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}, ${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                }) 
                                                                                } else {
                                                                                    //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                    FaseMsg: "Msg4F",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli},  ${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Mensagem.body,
                                                                                    date:new Date().getTime(),
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}, ${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                
                                                                                    
                                                                                    
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    
                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}, ${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                    
                                                                                    }) 

                                                                                }
                                                    
                                                    
                                                                                
                                                                        
                                                                            
                                                                                
                                                                            
                                                                                } else {
                                                    
                                                                                    if(EstaNaRegra === true && Robo === true){
                                                
                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                        var Result =parseInt(Sorteio);
                                                                                        var Num = Result-1;
                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                
                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                            
                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                        var Result5 =parseInt(Sorteio5);
                                                                            
                                                                                        var Num3 = Result3-1;
                                                                                        var Num4 = Result4-1;
                                                                                        var Num5 = Result5-1;
                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                        //Mudando a Fase do Chat
                                                                                        
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        DigiteNaRegra:false, 
                                                                                        MsgFutura1:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg3,
                                                                                            Tempo:Tempo3,
                                                                                        },
                                                                                        MsgFutura2:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg4,
                                                                                            Tempo:Tempo4,
                                                                                        },
                                                                                        MsgFutura3:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg5,
                                                                                            Tempo:Tempo5,
                                                                                        },
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"text"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                            date:new Date().getTime(),
                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                        }, 
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"text"
                                                                                        },
                                                                                        
                                                                                        
                                                                                        )
                                                                                        })
                                                                                        .then(async() => {
                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log(TempMsg)
                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                
                                                                                        }) 
                                                                                    } else  if(EstaNaRegra === false ){
                                                
                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                            
                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                        var Result5 =parseInt(Sorteio5);
                                                                            
                                                                                        var Num3 = Result3-1;
                                                                                        var Num4 = Result4-1;
                                                                                        var Num5 = Result5-1;
                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                        //Mudando a Fase do Chat
                                                                                        
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        Robotizado:false, 
                                                                                        MsgFutura1:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg3,
                                                                                            Tempo:Tempo3,
                                                                                        },
                                                                                        MsgFutura2:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg4,
                                                                                            Tempo:Tempo4,
                                                                                        },
                                                                                        MsgFutura3:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg5,
                                                                                            Tempo:Tempo5,
                                                                                        },
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"texto"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                            date:new Date().getTime(),
                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                        }, 
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"text"
                                                                                        },)
                                                                                        })
                                                                                        .then(async() => {
                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log(TempMsg)
                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                
                                                                                        }) 
                                                                                    }
                                                                                }
                                                        
                                                                    
                                                                        
                                                                        } else if(FaMsg === "Msg4F" ){//Recebendo o Que Quer retirar, Enviando a Nota Com A pergunta do que quer realizar
                                                                            
                                                                            var QuantMen = MemoriaSessao.length;
                                                                            console.log("Entrada "+NumIni)
                                                                            console.log("Quantidade "+QuantMen)
                                                                            
                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                    var Menus = MemoriaPedido;
                                                                                    var PedidosItens = []
                                                                                
                                                                                    console.log(Menus)
                                                    
                                                    
                                                                                    //montar a mensagem   
                                                                                var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                var Result =parseInt(Sorteio);
                                                                                var Num = Result-1;
                                                                                var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                        
                                                                                console.log(MsgEmp.Msg4B.Msg)
                                                                                console.log("Qmsg: "+QMsg)       
                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                console.log("Msg: "+AutoMsg)

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                var Result9 =parseInt(Sorteio9);
                                                                                var Num9 = Result9-1;
                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                            
                                                                
                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                var Result2 =parseInt(Sorteio2);
                                                                                var Num2 = Result2-1;
                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                            
                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                

                                                                                //Mensagens de estimulo 
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                console.log("id : "+PedidoCri)

                                                                                await db.collection("MesaItem")
                                                                                .doc(PedidoCri)
                                                                                .update({
                                                                                    Itens:admin.firestore.FieldValue.arrayUnion({
                                                                                        Descont: MemoriaPedido.Descont,
                                                                                        Descricao:MemoriaPedido.Descricao,
                                                                                        Foto:MemoriaPedido.Foto,
                                                                                        ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                        Nome:MemoriaPedido.Nome,
                                                                                        Observacao:Mensagem.body,
                                                                                        Preco:MemoriaPedido.Preco,
                                                                                        Quant:MemoriaPedido.Quant,
                                                                                        ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                        SubSessao:MemoriaPedido.SubSessao,
                                                                                        Sessao:MemoriaPedido.Sessao,
                                                                                    }) 
                                                                                }).then((doc)=>{
                                                                                    //PedidosItens = doc.data().Itens;
                                                                                })

                                                                                await db.collection("MesaItem")
                                                                                .doc(PedidoCri)
                                                                                .get().then((doc)=>{
                                                                                    PedidosItens = doc.data().Itens;
                                                                                })
                                                                                console.log(PedidosItens)
                                                            
                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                    MemSessao:[],
                                                                                    MemPedido:[],
                                                                                    MemProdutos:[],
                                                                                    MemSubSessao:[],
                                                                                    MenSabor:0,
                                                                                    EscolhaSabor:0, 
                                                                                FaseMsg: "Msg6A",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+7000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                    Botao:MsgEmp.Msg6A.Botao,
                                                                                    date:new Date().getTime()+8000,
                                                                                    Type:"botao"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                    
                                                                                    var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                    var TotalValor = 0
                                                                                    for(let i in PedidosItens){
                                                                                        
                                                                                    
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                        
                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"

                                                                                            if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                            } else {
                                                                                                MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                            }
                                                                                        


                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                        }
                                                                                        if(PedidosItens[i].Descont){
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        
                                                                                        } else {
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        
                                                                                        }

                                                                                        if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Ingredientes Tirados: "+PedidosItens[i].Observacao+"\n"
                                                                                            }

                                                                                    }
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                
                                                                                        
                                                                                    
                                                                                
                                                                                    response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                }) 
                                                                                } else {
                                                                                    //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                    MemSessao:[],
                                                                                    MemPedido:[],
                                                                                    MemProdutos:[],
                                                                                    MemSubSessao:[],
                                                                                    Sessao:"",
                                                                                FaseMsg: "Msg6A",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"butao"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                    Botao:Menus,
                                                                                    date:new Date().getTime()+2000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    Botao:Menus,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                    Botao:MsgEmp.Msg6A.Botao,
                                                                                    date:new Date().getTime()+8000,
                                                                                    Type:"botao"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                    var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                    var TotalValor = 0
                                                                                    for(let i in PedidosItens){
                                                                                        
                                                                                    
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                    
                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                            if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                        } else {
                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                        }
                                                                                        
                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                        }
                                                                                        if(PedidosItens[i].Descont){
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        } else {
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        }

                                                                                    }
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                        
                                                                                    
                                                                                
                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                    
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    
                                                                                    
                                                                                }) 

                                                                                
                                                    
                                                                            }
                                                                                
                                                                        
                                                                            
                                                                                
                                                                            
                                                                                
                                                            
                                                                        
                                                                            
                                                                            } else if(FaMsg === "Msg6A" ){//Recebendo o Que Quer Realizar após a nota do Pedido, Enviando para Sessão ou Retirada de Item ou Envio de Endereço ou Adicionado Sessão
                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                var QuantMen = MemoriaSessao.length;
                                                                                console.log("Entrada "+NumIni)
                                                                                console.log("Quantidade "+QuantMen)
                                                                                if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                
                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                        var Menus = [{id:0, body:"Voltar \n===================\n"}];
                                                                                        var PedidosItens = []
                                                                                    
                                                                                        console.log(Menus)
                                                        
                                                        
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg5A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg5A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg5A.TempoSeg;
                                                                            
                                                                                    console.log(MsgEmp.Msg5A.Msg)
                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                    console.log("Msg: "+AutoMsg)

                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                    var Num9 = Result9-1;
                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                
                                                                    
                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                
                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                    

                                                                                    //Mensagens de estimulo 
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                    console.log("id : "+PedidoCri)

                                                                                    

                                                                                    await db.collection("MesaItem")
                                                                                    .doc(PedidoCri)
                                                                                    .get().then((doc)=>{
                                                                                        
                                                                                        PedidosItens = doc.data().Itens;
                                                                                    })
                                                                                    console.log(PedidosItens)

                                                                                    
                                                                                    for(let i in PedidosItens){
                                                                                        var MsgPedido = "";     
                                                                                    
                                                                                        
                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                        
                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                            if(PedidosItens[i].Descricao){
                                                                                                MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                }
                                                                                        
                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                            }
                                                                                        
                                                                                        if(PedidosItens[i].Descont){
                                                                                            
                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        } else {
                                                                                        
                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        }
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        Menus.push(
                                                                                            {
                                                                                                id:i,
                                                                                                body:MsgPedido
                                                                                            }
                                                                                            )

                                                                                    }
                                                                
                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                    //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    MemPedido: PedidosItens,
                                                                                    FaseMsg: "Msg5A",
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+8000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        
                                                                                    
                                                                                    
                                                                                            
                                                                                        
                                                                                    
                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus, Tempo:TempMsg, Type:"butao"}] });
                                                                                    }) 
                                                                                    } else {
                                                                                        //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                        MemPedido:PedidosItens,
                                                                                        FaseMsg: "Msg5A",
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+2000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                    
                                                                                            
                                                                                        
                                                                                    
                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        
                                                                                        
                                                                                    }) 

                                                                                    
                                                        
                                                                                }
                                                                                    
                                                                            
                                                                                
                                                                                    
                                                                                
                                                                                    } else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){

                                                                                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                        await db.collection("MenusSite")
                                                                                        .where("Empresa", "==", EMPRESA)
                                                                                        .where("Ativo", "==", true)
                                                                                        .get().then(async (querySnapshot23) => {
                                                                                            await querySnapshot23.forEach((doc23) => {
                                                        
                                                                                                Menus.push({
                                                                                                    id:doc23.id,
                                                                                                    body:doc23.data().nome,
                                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                                    MemFim:doc23.data().MemFim,
                                                                                                    Tamanho:doc23.data().Tamanho,
                                                                                                })
                                                                                            
                                                                                                })
                                                        
                                                                                        });
                                                        
                                                        
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                
                                                                                    //  console.log(MsgEmp.Msg2A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg)       
                                                                                    //  console.log("Soteio: "+Sorteio)                 
                                                                                    //  console.log("Msg: "+AutoMsg)
                                                                
                                                        
                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                        
                                                                                
                                                                                            // Aqui ta entrando pos não esta no modo rocbo e ele não digitou errado
                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4A",
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    MemSessao:Menus,
                                                                                    Reclamaçoes:null,
                                                                                    Localização:null,
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                
                                                                                    }) 
                                                                                        //aqui vai entrar por que ele ele digitou errado e não está mais no modo robo 
                                                                                        }else {
                                                                                            await db.collection("ChatCliente")
                                                                                            .doc(IdChat)
                                                                                            .update({
                                                                                            FaseMsg: "Msg4A",
                                                                                            MsgFutura1:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg3,
                                                                                                Tempo:Tempo3,
                                                                                            },
                                                                                            MsgFutura2:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg4,
                                                                                                Tempo:Tempo4,
                                                                                            },
                                                                                            MsgFutura3:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg5,
                                                                                                Tempo:Tempo5,
                                                                                            },
                                                                                            MemSessao:Menus,
                                                                                            Reclamaçoes:null,
                                                                                            Localização:null,
                                                                                            DigiteNaRegra:true,
                                                                                            Robotizado:true, 
                                                                                            UltimaMsg:{
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                Autor:IdCli,
                                                                                                body:Mensagem.body,
                                                                                                date:new Date().getTime(),
                                                                                                Type:"text"
                                                                                            },
                                                                                            {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                            date:new Date().getTime()+2000,
                                                                                            Type:"text"
                                                                                        },
                                                                                            {
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                Botao:Menus,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            
                                                                                            
                                                                                            )
                                                                                            })
                                                                                            .then(async() => {
                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                console.log(TempMsg)
                                                                        
                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                            }) 
                                                        
                                                                                        }
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    
                                                                                    
                                                                                        
                                                                                            
                                                                                        
                                                                    
                                                                                    
                                                                            
                                                        
                                                        
                                                                                    }  else  if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){

                                                                                       var menus = [{id:0, body:"Voltar"}]
                                                                                       for(let i in DadoEmp.BairroEntregas){
                                                                                        if(DadoEmp.BairroEntregas[i].Ativo){
                                                                                            menus.push({
                                                                                                id:i,
                                                                                                body:DadoEmp.BairroEntregas[i].Bairro,
                                                                                                Preco:DadoEmp.BairroEntregas[i].PrecoReal,
                                                                                            })
                                                                                        }
                                                                                       }
                                                                                       console.log(menus)
                                                        
                                                        
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg7E.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg7E.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg7E.TempoSeg;
                                                                
                                                                                    //  console.log(MsgEmp.Msg2A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg)       
                                                                                    //  console.log("Soteio: "+Sorteio)                 
                                                                                    //  console.log("Msg: "+AutoMsg)
                                                                
                                                        
                                                                                    //Mensagem Para Escolher o Bairro
                                                                                    var QMsg2= MsgEmp.Msg7A.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg7A.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg7A.TempoSeg;

                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                        var Num9 = Result9-1;
                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                        
                                                                                
                                                                                            // Aqui ta entrando pos não esta no modo rocbo e ele não digitou errado
                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                            FaseMsg: "Msg7E",
                                                                                                            MemBairro: menus,
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                date:new Date().getTime()+7000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}`,
                                                                                                                Botao:{},
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                Botao:menus,
                                                                                                                date:new Date().getTime()+7000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                console.log(TempMsg)
                                                                                                                response.json({ Inf:[{Msg: `${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}` , Botao:[], Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg2}*` , Botao:menus, Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        
                                                                                                            }) 
                                                                                        //aqui vai entrar por que ele ele digitou errado e não está mais no modo robo 
                                                                                                            }else {
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                                FaseMsg: "Msg7E",
                                                                                                                                MemBairro:menus,
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}`,
                                                                                                                            Botao:{},
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                            Botao:menus,
                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                            Type:"botao"
                                                                                                                        },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                            
                                                                                                        
                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg2, Type:"text"}, {Msg: `${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}` , Botao:[], Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg2}*` , Botao:menus, Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                            }) 
                                                        
                                                                                        }
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    
                                                                                    
                                                                                        
                                                                                            
                                                                                        
                                                                    
                                                                                    
                                                                            
                                                        
                                                        
                                                                                    } else {
                                                            
                                                                                            if(EstaNaRegra === true && Robo === true){
                                                        
                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                var Result =parseInt(Sorteio);
                                                                                                var Num = Result-1;
                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                        
                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                    
                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                    
                                                                                                var Num3 = Result3-1;
                                                                                                var Num4 = Result4-1;
                                                                                                var Num5 = Result5-1;
                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                //Mudando a Fase do Chat
                                                                                                
                                                                                                await db.collection("ChatCliente")
                                                                                                .doc(IdChat)
                                                                                                .update({
                                                                                                DigiteNaRegra:false, 
                                                                                                MsgFutura1:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg3,
                                                                                                    Tempo:Tempo3,
                                                                                                },
                                                                                                MsgFutura2:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg4,
                                                                                                    Tempo:Tempo4,
                                                                                                },
                                                                                                MsgFutura3:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg5,
                                                                                                    Tempo:Tempo5,
                                                                                                },
                                                                                                UltimaMsg:{
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"text"
                                                                                                },
                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                    Autor:IdCli,
                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                    date:new Date().getTime(),
                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                }, 
                                                                                                {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"text"
                                                                                                },
                                                                                                
                                                                                                
                                                                                                )
                                                                                                })
                                                                                                .then(async() => {
                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                    console.log(TempMsg)
                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                        
                                                                                                }) 
                                                                                            } else  if(EstaNaRegra === false){
                                                        
                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                    
                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                    
                                                                                                var Num3 = Result3-1;
                                                                                                var Num4 = Result4-1;
                                                                                                var Num5 = Result5-1;
                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                            
                                                                                            
                                                                                            
                                                                                            
                                                                                                //Mudando a Fase do Chat
                                                                                                
                                                                                                await db.collection("ChatCliente")
                                                                                                .doc(IdChat)
                                                                                                .update({
                                                                                                Robotizado:false, 
                                                                                                MsgFutura1:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg3,
                                                                                                    Tempo:Tempo3,
                                                                                                },
                                                                                                MsgFutura2:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg4,
                                                                                                    Tempo:Tempo4,
                                                                                                },
                                                                                                MsgFutura3:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg5,
                                                                                                    Tempo:Tempo5,
                                                                                                },
                                                                                                UltimaMsg:{
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"texto"
                                                                                                },
                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                    Autor:IdCli,
                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                    date:new Date().getTime(),
                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                }, 
                                                                                                {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"text"
                                                                                                },)
                                                                                                })
                                                                                                .then(async() => {
                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                    console.log(TempMsg)
                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        
                                                                                                }) 
                                                                                            }
                                                                                        }
                                                                
                                                                            
                                                                                
                                                                                } else if(FaMsg === "Msg4H" ){//Recebendo A subSessão, Perguntando Quantos Sabor Ele deseja Adicionar, ou Caso a SubSessão só existe 1 Sabor Pergunta Qual Sabor Ele Escolhe
                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                    var QuantMen = MemoriaSubSessao.length;
                                                                                    console.log("Entrada "+NumIni)
                                                                                    console.log("Quantidade "+QuantMen)
                                                                                    if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                        await db.collection("MenusSite")
                                                                                        .where("Empresa", "==", EMPRESA)
                                                                                        .where("Ativo", "==", true)
                                                                                        .get().then(async (querySnapshot23) => {
                                                                                            await querySnapshot23.forEach((doc23) => {
                                                        
                                                                                                Menus.push({
                                                                                                    id:doc23.id,
                                                                                                    body:doc23.data().nome,
                                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                                    MemFim:doc23.data().MemFim,
                                                                                                    Tamanho:doc23.data().Tamanho,
                                                                                                })
                                                                                            
                                                                                                })
                                                        
                                                                                        });
                                                                                console.log(Menus)
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                
                                                                                //  console.log(MsgEmp.Msg2A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                //  console.log("Msg: "+AutoMsg)
                                                                

                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                
                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                            
                                                                                        // Robo sendo true, ele 
                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                            console.log("Entreou A  QUI ")
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4A",
                                                                                    MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                    MemSessao:Menus,
                                                                                    Reclamaçoes:null,
                                                                                    Localização:null,
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log("Entreou A  QUI ")
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                            
                                                                                    }) 
                                                                                    
                                                                                    }else {
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        FaseMsg: "Msg4A",
                                                                                        MsgFutura1:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg3,
                                                                                            Tempo:Tempo3,
                                                                                        },
                                                                                        MsgFutura2:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg4,
                                                                                            Tempo:Tempo4,
                                                                                        },
                                                                                        MsgFutura3:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg5,
                                                                                            Tempo:Tempo5,
                                                                                        },
                                                                                        MemSessao:Menus,
                                                                                        Reclamaçoes:null,
                                                                                        Localização:null,
                                                                                        DigiteNaRegra:true,
                                                                                        Robotizado:true, 
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Mensagem.body,
                                                                                            date:new Date().getTime(),
                                                                                            Type:"text"
                                                                                        },
                                                                                        {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                        date:new Date().getTime()+2000,
                                                                                        Type:"text"
                                                                                    },
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            Botao:Menus,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        
                                                                                        
                                                                                        )
                                                                                        })
                                                                                        .then(async() => {
                                                                                        
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log(TempMsg)
                                                                    
                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        }) 

                                                                                    }
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                        
                                                                                    
                                                                    
                                                                                
                                                                        


                                                                                } else  if(NumIni > 0 && NumIni < QuantMen) {

                                                                                                            
                                                                                                            console.log(MemoriaSubSessao[NumIni].Nome)
                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                var Menus = []
                                                                                                                var Sabor = [{id:"0", body:"Voltar para Sessões"}]
                                                                                                                for(var i = 0; i < MemoriaSubSessao[NumIni].QuantSb; i++){
                                                                                                                Sabor.push({
                                                                                                                    id:i+1,
                                                                                                                    body:`${i+1} Sabor`
                                                                                                                })
                                                                                                                }
                                                        
                                                                                                            
                                                                                                                await db.collection("ItensDaEmpresa")
                                                                                                                .where("Empresa", "==", EMPRESA)
                                                                                                                .where("Menu", "==", SessaoEsta)
                                                                                                                .where("Ativo", "==", true)
                                                                                                                .get().then(async (querySnapshot23) => {
                                                                                                                    Menus.push(
                                                                                                                        {id:"3", body:"Volar Para Sessões\n===================\n"}  
                                                                                                                    )
                                                                                                                    await querySnapshot23.forEach((doc23) => {
                                                                                                                    for(let i in doc23.data().GrupTamanho){
                                                                                                                        if(MemoriaSubSessao[NumIni].Nome === doc23.data().GrupTamanho[i].select ){
                                                                                                                            Menus.push({
                                                                                                                                Descont:MemoriaSubSessao[NumIni].Descont,
                                                                                                                                Descricao:doc23.data().Descricao,
                                                                                                                                Nome: doc23.data().nome,
                                                                                                                                Preco: MemoriaSubSessao[NumIni].Preco,
                                                                                                                                SubSessao: MemoriaSubSessao[NumIni].Nome,
                                                                                                                                Quant: doc23.data().GrupTamanho[i].Quantidade,
                                                                                                                                Ilimitado: doc23.data().Ilimitado,
                                                                                                                                foto: doc23.data().foto,
                                                                                                                                id: doc23.id,
                                                                                                                                Observacao: "",
                                                                                                                                body:doc23.data().Descricao ?  MemoriaSubSessao[NumIni].Descont?doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"❤️ De: "+"~"+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSubSessao[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"💰 "+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSubSessao[NumIni].Descont?doc23.data().nome+"\n"+"❤️ De: "+"~"+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSubSessao[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"💰 "+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                                                                ItemEspeci:true,
                                                                                                                                MemFim:MemoriaSubSessao[NumIni].MemFim,
                                                                                                                            })
                                                
                                                                                                                        }

                                                                                                                    }
                                                                                                                
                                                                                                                    // MemPedido:{
                                                                                                                    //     Nome:MemoriaPedido.Nome,
                                                                                                                    //     Descricao:MemoriaPedido.Descricao,
                                                                                                                    //     Foto:MemoriaPedido.Foto,
                                                                                                                    //     Preco:MemoriaPedido.Preco,
                                                                                                                    //     Descont:MemoriaPedido.Descont,
                                                                                                                    //     Quant:NumIni,
                                                                                                                    //     Observacao:"",
                                                                                                                    //     ItemEspeci:false,
                                                                                                                        
                                                                                                                    // },
                                                                                                                    
                                                                                                                    })
                                                                                
                                                                                                                });
                                                                                                                console.log(Menus)
                                                                                
                                                                                
                                                                                                                //montar a mensagem   
                                                                                                            var QMsg= MsgEmp.Msg4J.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg4J.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg4J.TempoSeg;

                                                                                                            var QMsg2= MsgEmp.Msg4I.Msg.length;
                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                            var Num2 = Result2-1;
                                                                                                            var AutoMsg2 = MsgEmp.Msg4I.Msg[Num2];
                                                                                                            var TempMsg2 =  MsgEmp.Msg4I.TempoSeg;
                                                                                                    
                                                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                            console.log("Msg: "+AutoMsg)
                                                                    
                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                            var Num9 = Result9-1;
                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                        
                                                                                        
                                                                                                            //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                            //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            //  var Result2 =parseInt(Sorteio2);
                                                                                                            //  var Num2 = Result2-1;
                                                                                                            //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                            //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                        
                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                            
                                                                    
                                                                                                            //Mensagens de estimulo 
                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                
                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                
                                                                                                            var Num3 = Result3-1;
                                                                                                            var Num4 = Result4-1;
                                                                                                            var Num5 = Result5-1;
                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            //vendo se só tem um sabor 
                                                                                                            if(MemoriaSubSessao[NumIni].QuantSb > 1) {
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4J",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        Botao:Sabor,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}, Nesse Tamanho Você Tem direito de Escolher Até ${MemoriaSubSessao[NumIni].QuantSb} Sabores`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, ${AutoMsg}*` , Botao:Sabor , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4J",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        Botao:Sabor,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}*`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, ${AutoMsg}` , Botao:Sabor , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                            
                                                                                                                    }

                                                                                                            } else {
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4I",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                                        Botao:Menus,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${AutoMsg2}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4I",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        Botao:Menus,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        Botao:Menus,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${AutoMsg2}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                            
                                                                                                                    }

                                                                                                            }


                                                                                                        
                                                                                
                                                                                                        
                                                                                                            
                                                                                                    
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            } else {
                                                                                
                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                            
                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                            
                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    DigiteNaRegra:false, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                    }, 
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                            
                                                                                                                    }) 
                                                                                                                } else  if(EstaNaRegra === false ){
                                                                            
                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                
                                                                                                                
                                                                                                                
                                                                                                                
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    Robotizado:false, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"texto"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                    }, 
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },)
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                            
                                                                                                                    }) 
                                                                                                                }
                                                                                                            }
                                                                                    
                                                                                                
                                                                                                    
                                                                                    } else if(FaMsg === "Msg4J" ){//Recebendo a resposta de Quantos Sabores Ele Quer, Perguntando Qual o Sabor Que Ele Quer
                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                        var QuantMen = MemoriaSubSessao.length;
                                                                                        console.log("Entrada "+NumIni)
                                                                                        console.log("Quantidade "+QuantMen)
                                                                                            if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                                            var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                            await db.collection("MenusSite")
                                                                                            .where("Empresa", "==", EMPRESA)
                                                                                            .where("Ativo", "==", true)
                                                                                            .get().then(async (querySnapshot23) => {
                                                                                                await querySnapshot23.forEach((doc23) => {
                                                            
                                                                                                    Menus.push({
                                                                                                        id:doc23.id,
                                                                                                        body:doc23.data().nome,
                                                                                                        GrupTamanho:doc23.data().GrupTamanho,
                                                                                                        MemFim:doc23.data().MemFim,
                                                                                                        Tamanho:doc23.data().Tamanho,
                                                                                                    })
                                                                                                    
                                                                                                    })
                                                            
                                                                                            });
                                                                                    console.log(Menus)
                                                                                            //montar a mensagem   
                                                                                        var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                        var Result =parseInt(Sorteio);
                                                                                        var Num = Result-1;
                                                                                        var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                        var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                    
                                                                                    //  console.log(MsgEmp.Msg2A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg)       
                                                                                    //  console.log("Soteio: "+Sorteio)                 
                                                                                    //  console.log("Msg: "+AutoMsg)
                                                                    

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                        var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                        var Num2 = Result2-1;
                                                                                        var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                        var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                            
                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                        var Result5 =parseInt(Sorteio5);
                                                                            
                                                                                        var Num3 = Result3-1;
                                                                                        var Num4 = Result4-1;
                                                                                        var Num5 = Result5-1;
                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                                
                                                                                            // Robo sendo true, ele 
                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                console.log("Entreou A  QUI ")
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        FaseMsg: "Msg4A",
                                                                                        MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                        MemSessao:Menus,
                                                                                        Reclamaçoes:null,
                                                                                        Localização:null,
                                                                                        DigiteNaRegra:true,
                                                                                        Robotizado:true, 
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Mensagem.body,
                                                                                            date:new Date().getTime(),
                                                                                            Type:"text"
                                                                                        },
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            Botao:Menus,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        
                                                                                        
                                                                                        )
                                                                                        })
                                                                                        .then(async() => {
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log("Entreou A  QUI ")
                                                                                            console.log(TempMsg)
                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                
                                                                                        }) 
                                                                                        
                                                                                        }else {
                                                                                            await db.collection("ChatCliente")
                                                                                            .doc(IdChat)
                                                                                            .update({
                                                                                            FaseMsg: "Msg4A",
                                                                                            MsgFutura1:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg3,
                                                                                                Tempo:Tempo3,
                                                                                            },
                                                                                            MsgFutura2:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg4,
                                                                                                Tempo:Tempo4,
                                                                                            },
                                                                                            MsgFutura3:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg5,
                                                                                                Tempo:Tempo5,
                                                                                            },
                                                                                            MemSessao:Menus,
                                                                                            Reclamaçoes:null,
                                                                                            Localização:null,
                                                                                            DigiteNaRegra:true,
                                                                                            Robotizado:true, 
                                                                                            UltimaMsg:{
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                Autor:IdCli,
                                                                                                body:Mensagem.body,
                                                                                                date:new Date().getTime(),
                                                                                                Type:"text"
                                                                                            },
                                                                                            {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                            date:new Date().getTime()+2000,
                                                                                            Type:"text"
                                                                                        },
                                                                                            {
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                Botao:Menus,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            
                                                                                            
                                                                                            )
                                                                                            })
                                                                                            .then(async() => {
                                                                                            
                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                console.log(TempMsg)
                                                                        
                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                            }) 

                                                                                        }
                                                                                        //Mudando a Fase do Chat
                                                                                        
                                                                                        
                                                                                        
                                                                                        
                                                                                            
                                                                                        
                                                                        
                                                                                    
                                                                            


                                                                                    } else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                                        
                                                                                                            
                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                    var Menus = MemoriaProduto
                                                                                                                    var Sabor = [{id:"0", body:"Voltar para Sessão"}]
                                                                                                                
                                                                                                                    
                                                                                    
                                                                                                                    
                                                                                                                    console.log(Menus)
                                                                                    
                                                                                    
                                                                                                                    //montar a mensagem   
                                                                                                                var QMsg= MsgEmp.Msg4L.Msg.length;
                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                var Num = Result-1;
                                                                                                                var AutoMsg = MsgEmp.Msg4L.Msg[Num];
                                                                                                                var TempMsg =  MsgEmp.Msg4L.TempoSeg;

                                                                                                                //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                                                //  var Num2 = Result2-1;
                                                                                                                //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                                //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                                        
                                                                                                                
                                                                        
                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                var Num9 = Result9-1;
                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                            
                                                                                                                //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                                                //  var Num2 = Result2-1;
                                                                                                                //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                                //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                            
                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                
                                                                        
                                                                                                                //Mensagens de estimulo 
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                            
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg4L",
                                                                                                                MenSabor: NumIni,
                                                                                                                EscolhaSabor:0,   
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body: `${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body: `${NomeCli}, Escolha o 1° ${AutoMsg}`,
                                                                                                                    Botao:Menus,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    console.log(TempMsg)
                                                                                                                    response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o 1° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                }) 
                                                                                                                } else {
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg4L",
                                                                                                                MenSabor: NumIni,
                                                                                                                EscolhaSabor:0, 
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                    Botao:Menus,
                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}, Escolha o 1° ${AutoMsg}`,
                                                                                                                    Botao:Menus,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    console.log(TempMsg)
                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o 1° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                }) 
                                                                        
                                                                                                                }
                                                                                    
                                                                                                            
                                                                                                                
                                                                                                        
                                                                                                            
                                                                                                                
                                                                                                            
                                                                                                                } else {
                                                                                    
                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                
                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                        var Num = Result-1;
                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        DigiteNaRegra:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        Robotizado:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"texto"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },)
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    }
                                                                                                                }
                                                                                        
                                                                                                    
                                                                                                        
                                                                                        } else if(FaMsg === "Msg4I" ){//Receber o Sabor da SubSessão que só tem Um sabor, e Perguntando a Quantidade
                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                            var QuantMen = MemoriaSessao.length;
                                                                                            console.log("Entrada "+NumIni)
                                                                                            console.log("Quantidade "+QuantMen)
                                                                                                if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                        
                                                                                                var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                                await db.collection("MenusSite")
                                                                                                .where("Empresa", "==", EMPRESA)
                                                                                                .where("Ativo", "==", true)
                                                                                                .get().then(async (querySnapshot23) => {
                                                                                                    await querySnapshot23.forEach((doc23) => {
                                                                
                                                                                                        Menus.push({
                                                                                                                id:doc23.id,
                                                                                                            body:doc23.data().nome,
                                                                                                            GrupTamanho:doc23.data().GrupTamanho,
                                                                                                            MemFim:doc23.data().MemFim,
                                                                                                            Tamanho:doc23.data().Tamanho,
                                                                                                        })
                                                                                                        
                                                                                                        })
                                                                
                                                                                                });
                                                                
                                                                                            console.log(Menus)
                                                                                                    //montar a mensagem   
                                                                                                var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                var Result =parseInt(Sorteio);
                                                                                                var Num = Result-1;
                                                                                                var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                                var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                            
                                                                                            //  console.log(MsgEmp.Msg2A.Msg)
                                                                                            //  console.log("Qmsg: "+QMsg)       
                                                                                            //  console.log("Soteio: "+Sorteio)                 
                                                                                            //  console.log("Msg: "+AutoMsg)
                                                                            
                                                                
                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                var Num2 = Result2-1;
                                                                                                var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                                var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                    
                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                    
                                                                                                var Num3 = Result3-1;
                                                                                                var Num4 = Result4-1;
                                                                                                var Num5 = Result5-1;
                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                
                                                                                        
                                                                                                    // Robo sendo true, ele 
                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                        console.log("Entreou A  QUI ")
                                                                                                await db.collection("ChatCliente")
                                                                                                .doc(IdChat)
                                                                                                .update({
                                                                                                FaseMsg: "Msg4A",
                                                                                                MsgFutura1:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg3,
                                                                                                Tempo:Tempo3,
                                                                                            },
                                                                                            MsgFutura2:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg4,
                                                                                                Tempo:Tempo4,
                                                                                            },
                                                                                            MsgFutura3:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg5,
                                                                                                Tempo:Tempo5,
                                                                                            },
                                                                                                MemSessao:Menus,
                                                                                                Reclamaçoes:null,
                                                                                                Localização:null,
                                                                                                DigiteNaRegra:true,
                                                                                                Robotizado:true, 
                                                                                                UltimaMsg:{
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"botao"
                                                                                                },
                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                    Autor:IdCli,
                                                                                                    body:Mensagem.body,
                                                                                                    date:new Date().getTime(),
                                                                                                    Type:"text"
                                                                                                },
                                                                                                {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    Botao:Menus,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"botao"
                                                                                                },
                                                                                                
                                                                                                
                                                                                                )
                                                                                                })
                                                                                                .then(async() => {
                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                    console.log("Entreou A  QUI ")
                                                                                                    console.log(TempMsg)
                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        
                                                                                                }) 
                                                                                                
                                                                                                }else {
                                                                                                    await db.collection("ChatCliente")
                                                                                                    .doc(IdChat)
                                                                                                    .update({
                                                                                                    FaseMsg: "Msg4A",
                                                                                                    MsgFutura1:{
                                                                                                        Ativo:true,
                                                                                                        Msg:AutoMsg3,
                                                                                                        Tempo:Tempo3,
                                                                                                    },
                                                                                                    MsgFutura2:{
                                                                                                        Ativo:true,
                                                                                                        Msg:AutoMsg4,
                                                                                                        Tempo:Tempo4,
                                                                                                    },
                                                                                                    MsgFutura3:{
                                                                                                        Ativo:true,
                                                                                                        Msg:AutoMsg5,
                                                                                                        Tempo:Tempo5,
                                                                                                    },
                                                                                                    MemSessao:Menus,
                                                                                                    Reclamaçoes:null,
                                                                                                    Localização:null,
                                                                                                    DigiteNaRegra:true,
                                                                                                    Robotizado:true, 
                                                                                                    UltimaMsg:{
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                        Autor:IdCli,
                                                                                                        body:Mensagem.body,
                                                                                                        date:new Date().getTime(),
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                    {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                                    date:new Date().getTime()+2000,
                                                                                                    Type:"text"
                                                                                                },
                                                                                                    {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    
                                                                                                    
                                                                                                    )
                                                                                                    })
                                                                                                    .then(async() => {
                                                                                                    
                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                        console.log(TempMsg)
                                                                                
                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                    }) 
                                                                
                                                                                                }
                                                                                                //Mudando a Fase do Chat
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                    
                                                                                                
                                                                                
                                                                                            
                                                                                    
                                                                
                                                                
                                                                                            }else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                                                
                                                                                                    console.log(MemoriaProduto[NumIni].id)
                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                        var Menus = []
                                                                                                        var Quant = [{id:"0", body:"Voltar Para os Itens"}]; 
                                                        
                                                                                                        console.log("Id :"+MemoriaProduto[NumIni].id)
                                                                                                        
                                                                                                        if(MemoriaProduto[NumIni].Ilimitado){
                                                                                                            for(var i = 1; i < 11; i++){
                                                                                                                Quant.push({
                                                                                                                    id:i,
                                                                                                                    body:i+" Quantidade"
                                                                                                                })
                                                                                                                }
                                                        
                                                                                                        }else {
                                                                                                            if(MemoriaProduto[NumIni].Quant < 11){
                                                                                                                for(var i = 1; i <= MemoriaProduto[NumIni].Quant; i++){
                                                                                                                    Quant.push({
                                                                                                                    id:i,
                                                                                                                    body:i+" Quantidade"
                                                                                                                    })
                                                                                                                }
                                                            
                                                                                                            } else {
                                                                                                                for(var i = 1; i < 11; i++){
                                                                                                                    Quant.push({
                                                                                                                        id:i,
                                                                                                                        body:i+" Quantidade"
                                                                                                                    })
                                                                                                                    }
                                                                                                            }
                                                        
                                                                                                        }
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                        
                                                                                                    console.log(Quant)
                                                                        
                                                                                                            //montar a mensagem   
                                                                                                        var QMsg= MsgEmp.Msg4C.Msg.length;
                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                        var Result =parseInt(Sorteio);
                                                                                                        var Num = Result-1;
                                                                                                        var AutoMsg = MsgEmp.Msg4C.Msg[Num];
                                                                                                        var TempMsg =  MsgEmp.Msg4C.TempoSeg;
                                                                                                
                                                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                        console.log("Msg: "+AutoMsg)
                                                            
                                                                                                        
                                                                                    
                                                                                    
                                                                                                        var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                        var Num2 = Result2-1;
                                                                                                        var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                                        var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                                                    
                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                    
                                                        
                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                        var Num9 = Result9-1;
                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                            
                                                                                                        //Mensagens de estimulo 
                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                            
                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                            
                                                                                                        var Num3 = Result3-1;
                                                                                                        var Num4 = Result4-1;
                                                                                                        var Num5 = Result5-1;
                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                
                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                        //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                        FaseMsg: "Msg4D",
                                                                                                        MemPedido:{
                                                                                                        Nome:[MemoriaProduto[NumIni].Nome],
                                                                                                        Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                                                        Foto:[MemoriaProduto[NumIni].foto],
                                                                                                        Preco:MemoriaProduto[NumIni].Preco,
                                                                                                        Descont:MemoriaProduto[NumIni].Descont,
                                                                                                        SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                        Quant:0,
                                                                                                        Observacao:"",
                                                                                                        ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                        QuantGeral:Quant.length,
                                                                                                        Sessao:SessaoEsta,
                                                                                                        MemFim:MemoriaProduto[NumIni].MemFim,
                                                                                                    
                                                                                                    },
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            Botao:Quant,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                                                        {
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}, ${AutoMsg}: ${MemoriaProduto[NumIni].Nome}`,
                                                                                                            Botao:[],
                                                                                                            date:new Date().getTime()+3000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"                                                                              
                                                                                                            
                                                                                                                if( MemoriaProduto[NumIni].Descricao === ""){
                                                                                            
                                                                                                                } else {
                                                                                                                    MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                }

                                                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                            }
                                                                                                        
                                                                                                        
                                                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                                            MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            } else {
                                                                                                            MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            }
                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                        
                                                                                                        // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                                        
                                                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        }) 
                                                                                                    } else {
                                                                                                            //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                    FaseMsg: "Msg4D",
                                                                                                    MemPedido:{
                                                                                                        Nome:[MemoriaProduto[NumIni].Nome],
                                                                                                        Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                                                        Foto:[MemoriaProduto[NumIni].foto],
                                                                                                        Preco:MemoriaProduto[NumIni].Preco,
                                                                                                        Descont:MemoriaProduto[NumIni].Descont,
                                                                                                        SubSessao:MemoriaProduto[NumIni].SubSessao,
                                                                                                        Quant:0,
                                                                                                        Observacao:"",
                                                                                                        ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                        QuantGeral:Quant.length,
                                                                                                        Sessao:SessaoEsta,
                                                                                                        MemFim:MemoriaProduto[NumIni].MemFim,
                                                                                                    },
                                                                                                    DigiteNaRegra:true,
                                                                                                    Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                                                            Botao:Quant,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                        Botao:[],
                                                                                                        date:new Date().getTime()+1000,
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}, ${AutoMsg}: ${MemoriaSessao[NumIni].Nome}`,
                                                                                                        Botao:[],
                                                                                                        date:new Date().getTime()+3000,
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                    {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli} ${AutoMsg2}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"

                                                                                                            if( MemoriaProduto[NumIni].Descricao === ""){
                                                                                            
                                                                                                            } else {
                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                            }

                                                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                            }
                                                                                                        
                                                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                                            MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            } else {
                                                                                                            MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            }
                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                            console.log(TempMsg)
                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        
                                                                                                        }) 
                                                            
                                                                                                    }
                                                                        
                                                                        
                                                                                                    
                                                                                                
                                                                                                
                                                                                                    
                                                                                                    
                                                                                                    } else {
                                                                            
                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                    
                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                    
                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                //Mudando a Fase do Chat
                                                                                                            
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                            DigiteNaRegra:false, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                                UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                }, 
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                console.log(TempMsg)
                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                        
                                                                                                                }) 
                                                                                                        } else  if(EstaNaRegra === false ){
                                                                    
                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            
                                                                                                                //Mudando a Fase do Chat
                                                                                                            
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                            Robotizado:false, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"texto"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                            }, 
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },)
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                console.log(TempMsg)
                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                        
                                                                                                                }) 
                                                                                                        }
                                                                                                        }
                                                                                
                                                                                            
                                                                                                
                                                                                                } else if(FaMsg === "Msg4L" ){//Recebendo o Sabor, Perguntando o Novo Sabor ou Enviando A Quantidade Qu Ele Quer Escolher
                                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                                    var QuantMen = MemoriaSubSessao.length;
                                                                                                    console.log("Entrada "+NumIni)
                                                                                                    console.log("Quantidade "+QuantMen)
                                                                                                        if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                                                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                                        await db.collection("MenusSite")
                                                                                                        .where("Empresa", "==", EMPRESA)
                                                                                                        .where("Ativo", "==", true)
                                                                                                        .get().then(async (querySnapshot23) => {
                                                                                                            await querySnapshot23.forEach((doc23) => {
                                                                        
                                                                                                                Menus.push({
                                                                                                                    id:doc23.id,
                                                                                                                    body:doc23.data().nome,
                                                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                                                    MemFim:doc23.data().MemFim,
                                                                                                                    Tamanho:doc23.data().Tamanho,
                                                                                                                })
                                                                                                                
                                                                                                                })
                                                                        
                                                                                                        });
                                                                                                console.log(Menus)
                                                                                                        //montar a mensagem   
                                                                                                    var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                    var Result =parseInt(Sorteio);
                                                                                                    var Num = Result-1;
                                                                                                    var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                                    var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                                
                                                                                                //  console.log(MsgEmp.Msg2A.Msg)
                                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                                //  console.log("Msg: "+AutoMsg)
                                                                                

                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                    var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                    var Num2 = Result2-1;
                                                                                                    var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                                    var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                        
                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                        
                                                                                                    var Num3 = Result3-1;
                                                                                                    var Num4 = Result4-1;
                                                                                                    var Num5 = Result5-1;
                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                                            
                                                                                                        // Robo sendo true, ele 
                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                            
                                                                                                    await db.collection("ChatCliente")
                                                                                                    .doc(IdChat)
                                                                                                    .update({
                                                                                                    FaseMsg: "Msg4A",
                                                                                                    MsgFutura1:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg3,
                                                                                                    Tempo:Tempo3,
                                                                                                },
                                                                                                MsgFutura2:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg4,
                                                                                                    Tempo:Tempo4,
                                                                                                },
                                                                                                MsgFutura3:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg5,
                                                                                                    Tempo:Tempo5,
                                                                                                },
                                                                                                    MemSessao:Menus,
                                                                                                    Reclamaçoes:null,
                                                                                                    Localização:null,
                                                                                                    DigiteNaRegra:true,
                                                                                                    Robotizado:true, 
                                                                                                    UltimaMsg:{
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                        Autor:IdCli,
                                                                                                        body:Mensagem.body,
                                                                                                        date:new Date().getTime(),
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                    {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    
                                                                                                    
                                                                                                    )
                                                                                                    })
                                                                                                    .then(async() => {
                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                        console.log("Entreou A  QUI ")
                                                                                                        console.log(TempMsg)
                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                            
                                                                                                    }) 
                                                                                                    
                                                                                                    }else {
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                        FaseMsg: "Msg4A",
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        MemSessao:Menus,
                                                                                                        Reclamaçoes:null,
                                                                                                        Localização:null,
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                        date:new Date().getTime()+2000,
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            Botao:Menus,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                        
                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                            console.log(TempMsg)
                                                                                    
                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                        }) 

                                                                                                    }
                                                                                                    //Mudando a Fase do Chat
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                        
                                                                                                    
                                                                                    
                                                                                                
                                                                                        
                                                    
                                                    
                                                                                                } else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                                                
                                                                                                                        
                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                                var Menus = MemoriaProduto
                                                                                                                                var Sabor = SaboresEsco+1
                                                                                                                            
                                                                                                                                
                                                                                                
                                                                                                                                
                                                                                                                                console.log(Menus)
                                                                                                
                                                                                                
                                                                                                                                //montar a mensagem   
                                                                                                                            var QMsg= MsgEmp.Msg4L.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg4L.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg4L.TempoSeg;

                                                                                                                            var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            var Result2 = parseInt(Sorteio2);
                                                                                                                            var Num2 = Result2-1;
                                                                                                                            var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                                                            var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                                                                                    
                                                                                                                            
                                                                                    
                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                            var Num9 = Result9-1;
                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                        
                                                                                                        
                                                                                                                            //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                                            //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            //  var Result2 =parseInt(Sorteio2);
                                                                                                                            //  var Num2 = Result2-1;
                                                                                                                            //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                                            //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                                        
                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                            
                                                                                    
                                                                                                                            //Mensagens de estimulo 
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();




                                                                                                                            if(Sabor == MemoriaSabores){



                                                                                                                                var Menus = []
                                                                                                                                var Quant = [{id:"0", body:"Voltar Para os Itens"}]; 
                                                                                
                                                                                                                                console.log("Id :"+MemoriaProduto[NumIni].id)
                                                                                                                                
                                                                                                                                if(MemoriaProduto[NumIni].Ilimitado){
                                                                                                                                    for(var i = 1; i < 11; i++){
                                                                                                                                        Quant.push({
                                                                                                                                            id:i,
                                                                                                                                            body:i+" Quantidade"
                                                                                                                                        })
                                                                                                                                        }
                                                                                
                                                                                                                                }else {
                                                                                                                                    if(MemoriaProduto[NumIni].Quant < 11){
                                                                                                                                        for(var i = 1; i <= MemoriaProduto[NumIni].Quant; i++){
                                                                                                                                        Quant.push({
                                                                                                                                            id:i,
                                                                                                                                            body:i+" Quantidade"
                                                                                                                                        })
                                                                                                                                        }
                                                                                    
                                                                                                                                    } else {
                                                                                                                                        for(var i = 1; i < 11; i++){
                                                                                                                                            Quant.push({
                                                                                                                                                id:i,
                                                                                                                                                body:i+" Quantidade"
                                                                                                                                            })
                                                                                                                                            }
                                                                                                                                    }
                                                                                
                                                                                                                                }
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:Quant.length,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4D",
                                                                                                                                    EscolhaSabor:Sabor,   
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {

                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        


                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"},  {Msg: `*${NomeCli}, ${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:0,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4L",
                                                                                                                                    EscolhaSabor:Sabor, 
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"Es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    }
                                                                                                                            } else {
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:0,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4L",
                                                                                                                                    EscolhaSabor:Sabor,   
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {

                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        


                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:0,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4L",
                                                                                                                                    EscolhaSabor:Sabor, 
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"Es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    }

                                                                                                                            }
                                                                                                                        
                                                                                                
                                                                                                                        
                                                                                                                            
                                                                                                                    
                                                                                                                        
                                                                                                                            
                                                                                                                        
                                                                                                                            } else {
                                                                                                
                                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                                            
                                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    DigiteNaRegra:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                } else  if(EstaNaRegra === false ){
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    Robotizado:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"texto"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },)
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                }
                                                                                                                            }
                                                                                                    
                                                                                                                
                                                                                                                    
                                                                                                    } else if(FaMsg === "Msg5A" ){//Recebendo o Que deseja de Retirar, (Não)Enviando a Nota Com A pergunta do que quer realizar ou (Sim)Perguntar o que quer retirar
                                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                                        var NumArray = NumIni - 1;

                                                                                                        console.log("Entrada "+NumIni)
                                                                                                        console.log("Quantidade "+NumArray)
                                                                                                        if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                        
                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                            var Menus = MemoriaPedido;
                                                                                                            var PedidosItens = []
                                                                                                        
                                                                                                            console.log(Menus)
                                                                            
                                                                            
                                                                                                            //montar a mensagem   
                                                                                                        var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                        var Result =parseInt(Sorteio);
                                                                                                        var Num = Result-1;
                                                                                                        var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                                        var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                                                
                                                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                        console.log("Msg: "+AutoMsg)
                                                                
                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                        var Num9 = Result9-1;
                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                        
                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                        var Num2 = Result2-1;
                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                    
                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                        
                                                                
                                                                                                        //Mensagens de estimulo 
                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                            
                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                            
                                                                                                        var Num3 = Result3-1;
                                                                                                        var Num4 = Result4-1;
                                                                                                        var Num5 = Result5-1;
                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                        console.log("id : "+PedidoCri)
                                                        
                                                                                                        
                                                        
                                                                                                        await db.collection("MesaItem")
                                                                                                        .doc(PedidoCri)
                                                                                                        .get().then((doc)=>{
                                                                                                            PedidosItens = doc.data().Itens;
                                                                                                        })
                                                                                                        console.log(PedidosItens)
                                                                                    
                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                        //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                            MemSessao:[],
                                                                                                            MemPedido:[],
                                                                                                            MemProdutos:[],
                                                                                                            MemSubSessao:[],
                                                                                                            MenSabor:0,
                                                                                                            EscolhaSabor:0, 
                                                                                                            Sessao:"",
                                                                                                        FaseMsg: "Msg6A",
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            date:new Date().getTime()+7000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                                                            date:new Date().getTime()+8000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                            
                                                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                            var TotalValor = 0
                                                                                                            for(let i in PedidosItens){
                                                                                                                
                                                                                                            
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                    if(PedidosItens[i].Descricao){
                                                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                    }
                                                                                                                
                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                }
                                                                                                                
                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                } else {
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                }
                                                        
                                                                                                            }
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                        
                                                                                                                
                                                                                                            
                                                                                                        
                                                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        }) 
                                                                                                        } else {
                                                                                                            //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                            MemSessao:[],
                                                                                                            MemPedido:[],
                                                                                                            MemProdutos:[],
                                                                                                            MemSubSessao:[],
                                                                                                            MenSabor:0,
                                                                                                            EscolhaSabor:0, 
                                                                                                        FaseMsg: "Msg6A",
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                            Botao:Menus,
                                                                                                            date:new Date().getTime()+2000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            Botao:Menus,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                                                            date:new Date().getTime()+8000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                            var TotalValor = 0
                                                                                                            for(let i in PedidosItens){
                                                                                                                
                                                                                                            
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                    if(PedidosItens[i].Descricao){
                                                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                    }
                                                                                                                
                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                }
                                                                                                            
                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                } else {
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                }
                                                        
                                                                                                            }
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                
                                                                                                            
                                                                                                        
                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                            
                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                            
                                                                                                            
                                                                                                        }) 
                                                                
                                                                                                        
                                                                            
                                                                                                    }
                                                                                                        
                                                                                                
                                                                                                    
                                                                                                        
                                                                                                    
                                                                                                        } else if(NumArray >= 0 && NumArray < MemoriaPedido.length){
                                                                                                        
                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                var Menus = [];
                                                                                                                var PedidosItens = MemoriaPedido.filter((item, index) => index !== NumArray )
                                                                                                            
                                                                                                                console.log(Menus)
                                                                                
                                                                                
                                                                                                                //montar a mensagem   
                                                                                                            var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                                                    
                                                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                            console.log("Msg: "+AutoMsg)
                                                                    
                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                            var Num9 = Result9-1;
                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                        
                                                                                            
                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                            var Num2 = Result2-1;
                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                        
                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                            
                                                                    
                                                                                                            //Mensagens de estimulo 
                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                
                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                
                                                                                                            var Num3 = Result3-1;
                                                                                                            var Num4 = Result4-1;
                                                                                                            var Num5 = Result5-1;
                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            console.log("id : "+PedidoCri)
                                                            
                                                                                                            await db.collection("MesaItem")
                                                                                                            .doc(PedidoCri)
                                                                                                            .update({
                                                                                                                Itens:PedidosItens 
                                                                                                            }).then((doc)=>{
                                                                                                                //PedidosItens = doc.data().Itens;
                                                                                                            })
                                                            
                                                                                                            //   await db.collection("MesaItem")
                                                                                                            //   .doc(PedidoCri)
                                                                                                            //   .get().then((doc)=>{
                                                                                                            //     PedidosItens = doc.data().Itens;
                                                                                                            //   })
                                                                                                            console.log(PedidosItens)
                                                                                        
                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                            //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                                Sessao:"",
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+7000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                
                                                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                                var TotalValor = 0
                                                                                                                for(let i in PedidosItens){
                                                                                                                    
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                    
                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                        if(PedidosItens[i].Descricao){
                                                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                        }
                                                                                                                    
                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                    }
                                                                                                                    
                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    } else {
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    }
                                                            
                                                                                                                }
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                            
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                            }) 
                                                                                                            } else {
                                                                                                                //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                date:new Date().getTime()+2000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                                var TotalValor = 0
                                                                                                                for(let i in PedidosItens){
                                                                                                                    
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                    
                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                        if(PedidosItens[i].Descricao){
                                                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                        }
                                                                                                                    
                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                    }
                                                                                                                
                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    } else {
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    }
                                                            
                                                                                                                }
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                
                                                                                                                
                                                                                                            }) 
                                                                    
                                                                                                            
                                                                                
                                                                                                        }
                                                                                                            
                                                                                                    
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            }  else {
                                                                                    
                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                
                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                        var Num = Result-1;
                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        DigiteNaRegra:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        Robotizado:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"texto"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },)
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    }
                                                                                                                }
                                                                                        
                                                                                                    
                                                                                                        
                                                                                                        } else if(FaMsg === "Msg7E" ){//Recebendo o Bairro, Enviando a Pergunta da Rua
                                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                                            var NumArray = NumIni - 1;
    
                                                                                                            console.log("Entrada "+NumIni)
                                                                                                            console.log("Quantidade "+NumArray)
                                                                                                            if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                            
                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                var Menus = MemoriaPedido;
                                                                                                                var PedidosItens = []
                                                                                                            
                                                                                                                console.log(Menus)
                                                                                
                                                                                
                                                                                                                //montar a mensagem   
                                                                                                            var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                                                    
                                                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                            console.log("Msg: "+AutoMsg)
                                                                    
                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                            var Num9 = Result9-1;
                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                        
                                                                                            
                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                            var Num2 = Result2-1;
                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                        
                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                            
                                                                    
                                                                                                            //Mensagens de estimulo 
                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                
                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                
                                                                                                            var Num3 = Result3-1;
                                                                                                            var Num4 = Result4-1;
                                                                                                            var Num5 = Result5-1;
                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            console.log("id : "+PedidoCri)
                                                            
                                                                                                            
                                                            
                                                                                                            await db.collection("MesaItem")
                                                                                                            .doc(PedidoCri)
                                                                                                            .get().then((doc)=>{
                                                                                                                PedidosItens = doc.data().Itens;
                                                                                                            })
                                                                                                            console.log(PedidosItens)
                                                                                        
                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                            //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                                Sessao:"",
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                
                                                                                                               
                                                                                                            
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                            }) 
                                                                                                            } else {
                                                                                                                //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                Botao:Menus,
                                                                                                                date:new Date().getTime()+2000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                              
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                
                                                                                                                
                                                                                                            }) 
                                                                    
                                                                                                            
                                                                                
                                                                                                        }
                                                                                                            
                                                                                                    
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            } else if(NumArray >= 0 && NumArray < MemoriaBairro.length){
                                                                                                            
                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                   
                                                                                                                 var PrecoEntrega = MemoriaBairro[NumIni].Preco;
                                                                                                                 var EndPedido
                                                                                                                 await db.collection("MesaItem")
                                                                                                                 .doc(PedidoCri)
                                                                                                                 .get()
                                                                                                                 .then((doc)=>{
                                                                                                                 EndPedido = doc.data().End;
                                                                                                                 
                                                                                                                 })

                                                                                                                 
                                                                                                                 if(EndPedido.Rua){
                                                                                                                        
                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                   
                                                                                                               
                                                                                                                
                                                                                                                    
                                                                                    
                                                                                    
                                                                                                                    //montar a mensagem   
                                                                                                                var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                var Num = Result-1;
                                                                                                                var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                        
                                                                                                                console.log(MsgEmp.Msg7D.Msg)
                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                console.log("Msg: "+AutoMsg)
                                                                        
                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                var Num9 = Result9-1;
                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                                
                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                var Num2 = Result2-1;
                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                            
                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                
                                                                        
                                                                                                                //Mensagens de estimulo 
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                               
                                                                
                                                                                                                await db.collection("MesaItem")
                                                                                                                .doc(PedidoCri)
                                                                                                                .update({
                                                                                                                    ValorEntrega:PrecoEntrega,
                                                                                                                    "End.Bairro":MemoriaBairro[NumIni].body,
                                                                                                                    
                                                                                                                     
                                                                                                                }).then((doc)=>{
                                                                                                                   
                                                                                                                })

                                                                                                                var PedidoVer = {}
                                                                                                                await db.collection("MesaItem")
                                                                                                                .doc(PedidoCri)
                                                                                                                .get()
                                                                                                                .then((doc)=>{
                                                                                                                   PedidoVer = doc.data();
                                                                                                                }) 

                                                                                                           
                                                                                                               
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg7D",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    Botao:MsgEmp.Msg7D.Botao,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                  
                                                                                                                    var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                    MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                    MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                    
                                                                                                                
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                }) 
                                                                                                                } else {
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                   
                                                                                                                FaseMsg: "Msg7D",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    Botao:MsgEmp.Msg7D.Botao,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                               
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                   
                                                                                                                    var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                    MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                    MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                   
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    
                                                                                                                    
                                                                                                                }) 
                                                                        
                                                                                                                
                                                                                    
                                                                                                                }
                                                                                                                
                                                                                                        
                                                                                                            
                                                                                                                
                                                                                                            
                                                                                                                }  else {
                                                                                                                            //montar a mensagem   
                                                                                                                var QMsg= MsgEmp.Msg7B.Msg.length;
                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                var Num = Result-1;
                                                                                                                var AutoMsg = MsgEmp.Msg7B.Msg[Num];
                                                                                                                var TempMsg =  MsgEmp.Msg7B.TempoSeg;
                                                                                                        
                                                                                                                console.log(MsgEmp.Msg7B.Msg)
                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                console.log("Msg: "+AutoMsg)
                                                                        
                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                var Num9 = Result9-1;
                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                                
                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                var Num2 = Result2-1;
                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                            
                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                
                                                                        
                                                                                                                //Mensagens de estimulo 
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                               
                                                                
                                                                                                                await db.collection("MesaItem")
                                                                                                                .doc(PedidoCri)
                                                                                                                .update({
                                                                                                                    ValorEntrega:PrecoEntrega,
                                                                                                                    "End.Bairro":MemoriaBairro[NumIni].body,
                                                                                                                    
                                                                                                                     
                                                                                                                }).then((doc)=>{
                                                                                                                   
                                                                                                                })
                                                                
                                                                                                                
                                                                                                               
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg7B",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg:`Você Escolheu o Bairro ${MemoriaBairro[NumIni].body}`  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                }) 
                                                                                                                } else {
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                    MemSessao:[],
                                                                                                                    MemPedido:[],
                                                                                                                    MemProdutos:[],
                                                                                                                    MemSubSessao:[],
                                                                                                                    MenSabor:0,
                                                                                                                    EscolhaSabor:0, 
                                                                                                                FaseMsg: "Msg7B",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                               
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                   
                                                                                                                    
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg:`Você Escolheu o Bairro ${MemoriaBairro[NumIni].body}`  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    
                                                                                                                    
                                                                                                                }) 
                                                                        
                                                                                                                
                                                                                    
                                                                                                            }

                                                                                                                 }
                                                                                                               
                                                                                    
                                                                                                            
                                                                                                                
                                                                                                        
                                                                                                            
                                                                                                                
                                                                                                            
                                                                                                                }  else {
                                                                                        
                                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                                    
                                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                    
                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            DigiteNaRegra:false, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                            }, 
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                console.log(TempMsg)
                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    
                                                                                                                            }) 
                                                                                                                        } else  if(EstaNaRegra === false ){
                                                                                    
                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                        
                                                                                                                        
                                                                                                                        
                                                                                                                        
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            Robotizado:false, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"texto"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                            }, 
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },)
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                console.log(TempMsg)
                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    
                                                                                                                            }) 
                                                                                                                        }
                                                                                                                    }
                                                                                            
                                                                                                        
                                                                                                            
                                                                                                            } else if(FaMsg === "Msg7B" ){//Recebendo a Rua , Enviando a Pergunta do Numero
                                                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                                               
                                                                                                               if(Type === "chat"){
                                                                                                                
                                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                                       
                                                                                                                        var EndPedido
                                                                                                                        await db.collection("MesaItem")
                                                                                                                        .doc(PedidoCri)
                                                                                                                        .get()
                                                                                                                        .then((doc)=>{
                                                                                                                        EndPedido = doc.data().End;
                                                                                                                        
                                                                                                                        })
       
                                                                                                                        
                                                                                                                        if(EndPedido.Numero){
                                                                                                                               
                                                                                                                           //Escolhendo os itens da sessão escolhida
                                                                                                                          
                                                                                                                      
                                                                                                                       
                                                                                                                           
                                                                                           
                                                                                           
                                                                                                                           //montar a mensagem   
                                                                                                                       var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                       var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                       var Result =parseInt(Sorteio);
                                                                                                                       var Num = Result-1;
                                                                                                                       var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                       var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                               
                                                                                                                       console.log(MsgEmp.Msg7D.Msg)
                                                                                                                       console.log("Qmsg: "+QMsg)       
                                                                                                                       console.log("Soteio: "+Sorteio)                 
                                                                                                                       console.log("Msg: "+AutoMsg)
                                                                               
                                                                                                                           //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                       var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                       var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                       var Result9 =parseInt(Sorteio9);
                                                                                                                       var Num9 = Result9-1;
                                                                                                                       var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                       var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                   
                                                                                                       
                                                                                                                       var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                       var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                       var Result2 =parseInt(Sorteio2);
                                                                                                                       var Num2 = Result2-1;
                                                                                                                       var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                       var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                   
                                                                                                                       //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                       //  console.log("Qmsg: "+QMsg2)       
                                                                                                                       //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                       //  console.log("Msg: "+AutoMsg2)
                                                                                                                       
                                                                               
                                                                                                                       //Mensagens de estimulo 
                                                                                                                       var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                       var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                       var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                       var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                       var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                       var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                           
                                                                                                                       var Result3 =parseInt(Sorteio3);
                                                                                                                       var Result4 =parseInt(Sorteio4);
                                                                                                                       var Result5 =parseInt(Sorteio5);
                                                                                                           
                                                                                                                       var Num3 = Result3-1;
                                                                                                                       var Num4 = Result4-1;
                                                                                                                       var Num5 = Result5-1;
                                                                                                                       var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                       var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                       var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                       var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                      
                                                                       
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .update({
                                                                                                                         
                                                                                                                           "End.Rua":Mensagem.body,
                                                                                                                           
                                                                                                                            
                                                                                                                       }).then((doc)=>{
                                                                                                                          
                                                                                                                       })
       
                                                                                                                       var PedidoVer = {}
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .get()
                                                                                                                       .then((doc)=>{
                                                                                                                          PedidoVer = doc.data();
                                                                                                                       }) 
       
                                                                                                                  
                                                                                                                      
                                                                                                                       if(Robo === true && EstaNaRegra === true){
                                                                                                                       //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                         
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                           
                                                                                                                       
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                       }) 
                                                                                                                       } else {
                                                                                                                           //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                          
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                                                                           date:new Date().getTime()+2000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                      
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                          
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                          
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                           
                                                                                                                           //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                           
                                                                                                                           
                                                                                                                       }) 
                                                                               
                                                                                                                       
                                                                                           
                                                                                                                       }
                                                                                                                       
                                                                                                               
                                                                                                                   
                                                                                                                       
                                                                                                                   
                                                                                                                       }  else {
                                                                                                                    
                                                                                                                        
                                                                                        
                                                                                        
                                                                                                                        //montar a mensagem   
                                                                                                                    var QMsg= MsgEmp.Msg7C.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg7C.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg7C.TempoSeg;
                                                                                                            
                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                            
                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                    var Num9 = Result9-1;
                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    
                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                    var Num2 = Result2-1;
                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                
                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                    
                                                                            
                                                                                                                    //Mensagens de estimulo 
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                   
                                                                    
                                                                                                                    await db.collection("MesaItem")
                                                                                                                    .doc(PedidoCri)
                                                                                                                    .update({
                                                                                                                      
                                                                                                                        "End.Rua":Mensagem.body,
                                                                                                                        
                                                                                                                         
                                                                                                                    }).then((doc)=>{
                                                                                                                       
                                                                                                                    })
                                                                    
                                                                                                                    
                                                                                                                   
                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                    
                                                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                        MemSessao:[],
                                                                                                                        MemPedido:[],
                                                                                                                        MemProdutos:[],
                                                                                                                        MemSubSessao:[],
                                                                                                                        MenSabor:0,
                                                                                                                        EscolhaSabor:0, 
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                       
                                                                                                                        
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        
                                                                                                                        
                                                                                                                    }) 
                                                                            
                                                                                                                }
                                                                                        
                                                                                                                        }
                                                                                                                    
                                                                                                            
                                                                                                                
                                                                                                                    
                                                                                                                
                                                                                                                    }  else {
                                                                                            
                                                                                                                            if(EstaNaRegra === true && Robo === true){
                                                                                        
                                                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                var Num = Result-1;
                                                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                        
                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                DigiteNaRegra:false, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                }, 
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    console.log(TempMsg)
                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                                }) 
                                                                                                                            } else  if(EstaNaRegra === false ){
                                                                                        
                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            
                                                                                                                            
                                                                                                                            
                                                                                                                            
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                Robotizado:false, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"texto"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                }, 
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },)
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    console.log(TempMsg)
                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                        
                                                                                                                                }) 
                                                                                                                            }
                                                                                                                        }
                                                                                                
                                                                                                            
                                                                                                                
                                                                                                                } else if(FaMsg === "Msg7C" ){//Recebendo o Numero , Enviando a Pergunta do Complemento
                                                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                                                   
                                                                                                                   if(Type === "chat"){
                                                                                                                    
                                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                                           
                                                                                                                           var EndPedido
                                                                                                                        await db.collection("MesaItem")
                                                                                                                        .doc(PedidoCri)
                                                                                                                        .get()
                                                                                                                        .then((doc)=>{
                                                                                                                        EndPedido = doc.data().End;
                                                                                                                        
                                                                                                                        })
       
                                                                                                                        
                                                                                                                        if(EndPedido.Proximo){
                                                                                                                               
                                                                                                                           //Escolhendo os itens da sessão escolhida
                                                                                                                          
                                                                                                                      
                                                                                                                       
                                                                                                                           
                                                                                           
                                                                                           
                                                                                                                           //montar a mensagem   
                                                                                                                       var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                       var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                       var Result =parseInt(Sorteio);
                                                                                                                       var Num = Result-1;
                                                                                                                       var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                       var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                               
                                                                                                                       console.log(MsgEmp.Msg7D.Msg)
                                                                                                                       console.log("Qmsg: "+QMsg)       
                                                                                                                       console.log("Soteio: "+Sorteio)                 
                                                                                                                       console.log("Msg: "+AutoMsg)
                                                                               
                                                                                                                           //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                       var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                       var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                       var Result9 =parseInt(Sorteio9);
                                                                                                                       var Num9 = Result9-1;
                                                                                                                       var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                       var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                   
                                                                                                       
                                                                                                                       var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                       var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                       var Result2 =parseInt(Sorteio2);
                                                                                                                       var Num2 = Result2-1;
                                                                                                                       var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                       var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                   
                                                                                                                       //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                       //  console.log("Qmsg: "+QMsg2)       
                                                                                                                       //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                       //  console.log("Msg: "+AutoMsg2)
                                                                                                                       
                                                                               
                                                                                                                       //Mensagens de estimulo 
                                                                                                                       var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                       var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                       var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                       var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                       var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                       var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                           
                                                                                                                       var Result3 =parseInt(Sorteio3);
                                                                                                                       var Result4 =parseInt(Sorteio4);
                                                                                                                       var Result5 =parseInt(Sorteio5);
                                                                                                           
                                                                                                                       var Num3 = Result3-1;
                                                                                                                       var Num4 = Result4-1;
                                                                                                                       var Num5 = Result5-1;
                                                                                                                       var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                       var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                       var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                       var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                      
                                                                       
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .update({
                                                                                                                         
                                                                                                                           "End.Numero":Mensagem.body,
                                                                                                                           
                                                                                                                            
                                                                                                                       }).then((doc)=>{
                                                                                                                          
                                                                                                                       })
       
                                                                                                                       var PedidoVer = {}
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .get()
                                                                                                                       .then((doc)=>{
                                                                                                                          PedidoVer = doc.data();
                                                                                                                       }) 
       
                                                                                                                  
                                                                                                                      
                                                                                                                       if(Robo === true && EstaNaRegra === true){
                                                                                                                       //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                         
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                           
                                                                                                                       
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                       }) 
                                                                                                                       } else {
                                                                                                                           //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                          
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                                                                           date:new Date().getTime()+2000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                      
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                          
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                          
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                           
                                                                                                                           //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                           
                                                                                                                           
                                                                                                                       }) 
                                                                               
                                                                                                                       
                                                                                           
                                                                                                                       }
                                                                                                                       
                                                                                                               
                                                                                                                   
                                                                                                                       
                                                                                                                   
                                                                                                                       }  else {
                                                                                                                        
                                                                                                                            
                                                                                            
                                                                                            
                                                                                                                            //montar a mensagem   
                                                                                                                        var QMsg= MsgEmp.Msg7F.Msg.length;
                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                        var Num = Result-1;
                                                                                                                        var AutoMsg = MsgEmp.Msg7F.Msg[Num];
                                                                                                                        var TempMsg =  MsgEmp.Msg7F.TempoSeg;
                                                                                                                
                                                                                                                        console.log(MsgEmp.Msg7B.Msg)
                                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                                        console.log("Msg: "+AutoMsg)
                                                                                
                                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                                        var Num9 = Result9-1;
                                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                    
                                                                                                        
                                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                                        var Num2 = Result2-1;
                                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                    
                                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                                        
                                                                                
                                                                                                                        //Mensagens de estimulo 
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                       
                                                                        
                                                                                                                        await db.collection("MesaItem")
                                                                                                                        .doc(PedidoCri)
                                                                                                                        .update({
                                                                                                                          
                                                                                                                            "End.Numero":Mensagem.body,
                                                                                                                            
                                                                                                                             
                                                                                                                        }).then((doc)=>{
                                                                                                                           
                                                                                                                        })
                                                                        
                                                                                                                        
                                                                                                                       
                                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        FaseMsg: "Msg7F",
                                                                                                                        DigiteNaRegra:true,
                                                                                                                        Robotizado:true, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Mensagem.body,
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                        
                                                                                                                            response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        }) 
                                                                                                                        } else {
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                           
                                                                                                                        FaseMsg: "Msg7F",
                                                                                                                        DigiteNaRegra:true,
                                                                                                                        Robotizado:true, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Mensagem.body,
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                       
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                           
                                                                                                                            
                                                                                                                        
                                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                            
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            
                                                                                                                            
                                                                                                                        }) 
                                                                                
                                                                                                                        
                                                                                            
                                                                                                                        }
                                                                                                                        
                                                                                                                
                                                                                                                       }
                                                                                                                        
                                                                                                                    
                                                                                                                        }  else {
                                                                                                
                                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                                            
                                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    DigiteNaRegra:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                } else  if(EstaNaRegra === false ){
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    Robotizado:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"texto"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },)
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                }
                                                                                                                            }
                                                                                                    
                                                                                                                
                                                                                                                    
                                                                                                                    } else if(FaMsg === "Msg7F" ){//Recebendo o Completmento , Enviando a Pergunta Se o Endereço está correto 
                                                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                                                       
                                                                                                                       if(Type === "chat"){
                                                                                                                        
                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                               
                                                                                                                           
                                                                                                                            
                                                                                                                                
                                                                                                
                                                                                                
                                                                                                                                //montar a mensagem   
                                                                                                                            var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                                    
                                                                                                                            console.log(MsgEmp.Msg7D.Msg)
                                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                                            console.log("Msg: "+AutoMsg)
                                                                                    
                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                            var Num9 = Result9-1;
                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                        
                                                                                                            
                                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                                            var Num2 = Result2-1;
                                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                        
                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                            
                                                                                    
                                                                                                                            //Mensagens de estimulo 
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                           
                                                                            
                                                                                                                            await db.collection("MesaItem")
                                                                                                                            .doc(PedidoCri)
                                                                                                                            .update({
                                                                                                                              
                                                                                                                                "End.Proximo":Mensagem.body,
                                                                                                                                "End.Cidade":DadoEmp.Endereco.Cidade,
                                                                                                                                "End.Estado":DadoEmp.Endereco.Estado,
                                                                                                                              
                                                                                                                            })

                                                                                                                           var PedidoVer = {}
                                                                                                                           await db.collection("MesaItem")
                                                                                                                           .doc(PedidoCri)
                                                                                                                           .get()
                                                                                                                           .then((doc)=>{
                                                                                                                              PedidoVer = doc.data();
                                                                                                                           }) 
                                                                                                                           
                                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                                var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                                MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                                MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                                MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                              //  MsgPedido = MsgPedido + "💰 Valor da Entrega: "+ PedidoVer.ValorEntrega.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                
                                                                                                                            
                                                                                                                            
                                                                                                                                response.json({ Inf:[ {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            }) 
                                                                                                                            } else {
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                               
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                date:new Date().getTime()+2000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                           
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                               
                                                                                                                                var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                                MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                                MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                                MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                               // MsgPedido = MsgPedido + "💰 Valor da Entrega: "+ PedidoVer.ValorEntrega.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                            
                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                
                                                                                                                                
                                                                                                                            }) 
                                                                                    
                                                                                                                            
                                                                                                
                                                                                                                            }
                                                                                                                            
                                                                                                                    
                                                                                                                        
                                                                                                                            
                                                                                                                        
                                                                                                                            }  else {
                                                                                                    
                                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                                
                                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                        var Num = Result-1;
                                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                
                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        DigiteNaRegra:false, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                        }, 
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            console.log(TempMsg)
                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                
                                                                                                                                        }) 
                                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                                
                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                    
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        Robotizado:false, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"texto"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                        }, 
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },)
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            console.log(TempMsg)
                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                
                                                                                                                                        }) 
                                                                                                                                    }
                                                                                                                                }
                                                                                                        
                                                                                                                    
                                                                                                                        
                                                                                                                        }   else if(FaMsg === "Msg7D" ){//Recebendo Sim ou Não Se o endereço está correto , Enviando A pergunta de qula deseja mudar ou se está no endereço 
                                                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                                                           
                                                                                                                           if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                            
                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                   
                                                                                                                      
                                                                                                                                    
                                                                                                                                
                                                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                                                    //montar a mensagem   
                                                                                                                                var QMsg= MsgEmp.Msg7H.Msg.length;
                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                var Num = Result-1;
                                                                                                                                var AutoMsg = MsgEmp.Msg7H.Msg[Num];
                                                                                                                                var TempMsg =  MsgEmp.Msg7H.TempoSeg;
                                                                                                                        
                                                                                                                                console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                        
                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                var Num9 = Result9-1;
                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                            
                                                                                                                
                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                var Num2 = Result2-1;
                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                            
                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                
                                                                                        
                                                                                                                                //Mensagens de estimulo 
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                               
                                                                                
                                                                                                                              
                                                                                
                                                                                                                                
                                                                                                                               
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                FaseMsg: "Msg7H",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7H.Botao,
                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                
                                                                                                                                    response.json({ Inf:[  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7H.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                }) 
                                                                                                                                } else {
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                   
                                                                                                                                FaseMsg: "Msg7H",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7H.Botao,
                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                               
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                   
                                                                                                                                    
                                                                                                                                
                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7H.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    
                                                                                                                                    
                                                                                                                                }) 
                                                                                        
                                                                                                                                
                                                                                                    
                                                                                                                                }
                                                                                                                                
                                                                                                                        
                                                                                                                            
                                                                                                                                
                                                                                                                            
                                                                                                                                }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                            
                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                   
                                                                                                                               
                                                                                                                                
                                                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                                                    //montar a mensagem   
                                                                                                                                var QMsg= MsgEmp.Msg7G.Msg.length;
                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                var Num = Result-1;
                                                                                                                                var AutoMsg = MsgEmp.Msg7G.Msg[Num];
                                                                                                                                var TempMsg =  MsgEmp.Msg7G.TempoSeg;
                                                                                                                        
                                                                                                                                console.log(MsgEmp.Msg7G.Msg)
                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                        
                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                var Num9 = Result9-1;
                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                            
                                                                                                                
                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                var Num2 = Result2-1;
                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                            
                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                
                                                                                        
                                                                                                                                //Mensagens de estimulo 
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                               
                                                                                
                                                                                                                              
                                                                                
                                                                                                                                
                                                                                                                               
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                FaseMsg: "Msg7G",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7G.Botao,
                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                
                                                                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7G.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                }) 
                                                                                                                                } else {
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                   
                                                                                                                                FaseMsg: "Msg7G",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7G.Botao,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                               
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                   
                                                                                                                                    
                                                                                                                                
                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7G.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    
                                                                                                                                    
                                                                                                                                }) 
                                                                                        
                                                                                                                                
                                                                                                    
                                                                                                                                }
                                                                                                                                
                                                                                                                        
                                                                                                                            
                                                                                                                                
                                                                                                                            
                                                                                                                                }  else {
                                                                                                        
                                                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                                                    
                                                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                                            var Num = Result-1;
                                                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                    
                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                
                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                
                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                            
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                            DigiteNaRegra:false, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                            }, 
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            )
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                console.log(TempMsg)
                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                    
                                                                                                                                            }) 
                                                                                                                                        } else  if(EstaNaRegra === false ){
                                                                                                    
                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                
                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                
                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                        
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                            
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                            Robotizado:false, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"texto"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                            }, 
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },)
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                console.log(TempMsg)
                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    
                                                                                                                                            }) 
                                                                                                                                        }
                                                                                                                                    }
                                                                                                            
                                                                                                                        
                                                                                                                            
                                                                                                                            } else if(FaMsg === "Msg7H" ){//Recebendo o Que deseja mudar , Enviando A pergunta do que quer   mudar 
                                                                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                                                               
                                                                                                                               if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                        
                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                               
                                                                                                                           
                                                                                                                            
                                                                                                                                
                                                                                                
                                                                                                
                                                                                                                                //montar a mensagem   
                                                                                                                            var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                                    
                                                                                                                            console.log(MsgEmp.Msg7D.Msg)
                                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                                            console.log("Msg: "+AutoMsg)
                                                                                    
                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                            var Num9 = Result9-1;
                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                        
                                                                                                            
                                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                                            var Num2 = Result2-1;
                                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                        
                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                            
                                                                                    
                                                                                                                            //Mensagens de estimulo 
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                           
                                                                            
                                                                                                                        

                                                                                                                       
                                                                                                                           
                                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                              
                                                                                                                          
                                                                                                                                
                                                                                                                            
                                                                                                                            
                                                                                                                                response.json({ Inf:[  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            }) 
                                                                                                                            } else {
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                               
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                date:new Date().getTime()+2000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                           
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                               
                                                                                                                               
                                                                                                                               
                                                                                                                            
                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                
                                                                                                                                
                                                                                                                            }) 
                                                                                    
                                                                                                                            
                                                                                                
                                                                                                                            }
                                                                                                                            
                                                                                                                    
                                                                                                                        
                                                                                                                            
                                                                                                                        
                                                                                                                            }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                                //montar a mensagem   
                                                                                                                    var QMsg= MsgEmp.Msg7B.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg7B.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg7B.TempoSeg;
                                                                                                            
                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                            
                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                    var Num9 = Result9-1;
                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    
                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                    var Num2 = Result2-1;
                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                
                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                    
                                                                            
                                                                                                                    //Mensagens de estimulo 
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                   
                                                                    
                                                                                                                 
                                                                                                                    
                                                                                                                   
                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg7B",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                        MemSessao:[],
                                                                                                                        MemPedido:[],
                                                                                                                        MemProdutos:[],
                                                                                                                        MemSubSessao:[],
                                                                                                                        MenSabor:0,
                                                                                                                        EscolhaSabor:0, 
                                                                                                                    FaseMsg: "Msg6A",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                       
                                                                                                                        
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        
                                                                                                                        
                                                                                                                    }) 
                                                                            
                                                                                                                    
                                                                                        
                                                                                                                }
    
                                                                                                                     } else  if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){
                                                                                                                    
                                                                                                                        
                                                                                        
                                                                                        
                                                                                                                        //montar a mensagem   
                                                                                                                    var QMsg= MsgEmp.Msg7C.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg7C.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg7C.TempoSeg;
                                                                                                            
                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                            
                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                    var Num9 = Result9-1;
                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    
                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                    var Num2 = Result2-1;
                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                
                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                    
                                                                            
                                                                                                                    //Mensagens de estimulo 
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                   
                                                                    
                                                                                                                  
                                                                    
                                                                                                                    
                                                                                                                   
                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                    
                                                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                        MemSessao:[],
                                                                                                                        MemPedido:[],
                                                                                                                        MemProdutos:[],
                                                                                                                        MemSubSessao:[],
                                                                                                                        MenSabor:0,
                                                                                                                        EscolhaSabor:0, 
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                       
                                                                                                                        
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        
                                                                                                                        
                                                                                                                    }) 
                                                                            
                                                                                                                }
                                                                                        
                                                                                                                        }  else  if(Mensagem.body === "3" || Mensagem.body === " 3" || Mensagem.body === "3 " || Mensagem.body === " 3 "){
                                                                                                                                
                                                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                                                       
                                                                                                                                        var menus = [{id:0, body:"Voltar"}]
                                                                                                                                        for(let i in DadoEmp.BairroEntregas){
                                                                                                                                         if(DadoEmp.BairroEntregas[i].Ativo){
                                                                                                                                             menus.push({
                                                                                                                                                 id:i,
                                                                                                                                                 body:DadoEmp.BairroEntregas[i].Bairro,
                                                                                                                                                 Preco:DadoEmp.BairroEntregas[i].PrecoReal,
                                                                                                                                             })
                                                                                                                                         }
                                                                                                                                        }
                                                                                                                                    
                                                                                                                                        
                                                                                                        
                                                                                                        
                                                                                                                                        //montar a mensagem   
                                                                                                                                    var QMsg= MsgEmp.Msg7A.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg7A.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg7A.TempoSeg;
                                                                                                                            
                                                                                                                                    console.log(MsgEmp.Msg7E.Msg)
                                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                                            
                                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                                    var Num9 = Result9-1;
                                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                
                                                                                                                    
                                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                                    var Num2 = Result2-1;
                                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                
                                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                                    
                                                                                            
                                                                                                                                    //Mensagens de estimulo 
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                   
                                                                                    
                                                                                                                                  
                                                                                    
                                                                                                                                    
                                                                                                                                   
                                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    FaseMsg: "Msg7E",
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MemBairro:menus,
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        Botao:menus,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:menus, Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                       
                                                                                                                                    FaseMsg: "Msg7E",
                                                                                                                                    MemBairro:menus,
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        Botao:menus,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                   
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                       
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:menus, Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        
                                                                                                                                        
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    
                                                                                                        
                                                                                                                                    }
                                                                                                                                    
                                                                                                                            
                                                                                                                                
                                                                                                                                    
                                                                                                                                
                                                                                                                                    }  else  if(Mensagem.body === "4" || Mensagem.body === " 4" || Mensagem.body === "4 " || Mensagem.body === " 4 "){
                                                                                                                        
                                                                                                                            
                                                                                            
                                                                                            
                                                                                                                                        //montar a mensagem   
                                                                                                                                    var QMsg= MsgEmp.Msg7F.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg7F.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg7F.TempoSeg;
                                                                                                                            
                                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                                            
                                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                                    var Num9 = Result9-1;
                                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                
                                                                                                                    
                                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                                    var Num2 = Result2-1;
                                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                
                                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                                    
                                                                                            
                                                                                                                                    //Mensagens de estimulo 
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                   
                                                                                    
                                                                                    
                                                                                                                                    
                                                                                                                                   
                                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    FaseMsg: "Msg7F",
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                       
                                                                                                                                    FaseMsg: "Msg7F",
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                   
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                       
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        
                                                                                                                                        
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    
                                                                                                        
                                                                                                                                    }
                                                                                                                                    
                                                                                                                            
                                                                                                                                   } else {
                                                                                                            
                                                                                                                                            if(EstaNaRegra === true && Robo === true){
                                                                                                        
                                                                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                        
                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                DigiteNaRegra:false, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                }, 
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                        
                                                                                                                                                }) 
                                                                                                                                            } else  if(EstaNaRegra === false ){
                                                                                                        
                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                            
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                Robotizado:false, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"texto"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                }, 
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },)
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                        
                                                                                                                                                }) 
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                
                                                                                                                            
                                                                                                                                
                                                                                                                                } else if(FaMsg === "Msg7G" ){//Recebendo Sim ou Não Se O Cliente Está no endereço da Entrega , Enviando A pergunta de qula deseja mudar ou se está no endereço 
                                                                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                                                                   
                                                                                                                                   if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                                    
                                                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                                                           
                                                                                                                                            var PedidosItens = []
                                                                                                                                            var ValorEnt = 0;

                                                                                                                                            await db.collection("MesaItem")
                                                                                                                                            .doc(PedidoCri)
                                                                                                                                            .get().then((doc)=>{
                                                                                                                                                PedidosItens = doc.data().Itens;
                                                                                                                                                ValorEnt = doc.data().ValorEntrega;
                                                                                                                                            })
                                                                                                                                        
                                                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                                                            //montar a mensagem   
                                                                                                                                        var QMsg= MsgEmp.Msg10B.Msg.length;
                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                        var Num = Result-1;
                                                                                                                                        var AutoMsg = MsgEmp.Msg10B.Msg[Num];
                                                                                                                                        var TempMsg =  MsgEmp.Msg10B.TempoSeg;
                                                                                                                                
                                                                                                                                        console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                                                        console.log("Msg: "+AutoMsg)
                                                                                                
                                                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                                                        var Num9 = Result9-1;
                                                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                    
                                                                                                                        
                                                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                                                        var Num2 = Result2-1;
                                                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                    
                                                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                                                        
                                                                                                
                                                                                                                                        //Mensagens de estimulo 
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                       
                                                                                        
                                                                                                                                      
                                                                                        
                                                                                                                                        
                                                                                                                                       
                                                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        FaseMsg: "Msg10B",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"botao"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                                            Type:"botao"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                             var TotalValor = 0
                                                                                                                                                for(let i in PedidosItens){
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                    
                                                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                     
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                    }
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    } else {
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                            
                                                                                                                                                }
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                TotalValor = TotalValor+ValorEnt;
                                                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})

                                                                                                                                            response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                        }) 
                                                                                                                                        } else {
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                           
                                                                                                                                        FaseMsg: "Msg10B",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                                            Type:"botao"
                                                                                                                                        },
                                                                                                                                       
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                            var TotalValor = 0
                                                                                                                                            for(let i in PedidosItens){
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                
                                                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                    }
                                                                                                                                                } else {
                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                    }
                                                                                                                                                }
                                                                                        
                                                                                                                                            }
                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                            MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                            TotalValor = TotalValor+ValorEnt;
                                                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                            
                                                                                                                                        
                                                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                            
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            
                                                                                                                                            
                                                                                                                                        }) 
                                                                                                
                                                                                                                                        
                                                                                                            
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                
                                                                                                                                    
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                                    
                                                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                                                           
                                                                                                                                       
                                                                                                                                        
                                                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                                                            //montar a mensagem   
                                                                                                                                        var QMsg= MsgEmp.Msg8A.Msg.length;
                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                        var Num = Result-1;
                                                                                                                                        var AutoMsg = MsgEmp.Msg8A.Msg[Num];
                                                                                                                                        var TempMsg =  MsgEmp.Msg8A.TempoSeg;
                                                                                                                                
                                                                                                                                        console.log(MsgEmp.Msg8A.Msg)
                                                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                                                        console.log("Msg: "+AutoMsg)
                                                                                                
                                                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                                                        var Num9 = Result9-1;
                                                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                    
                                                                                                                        
                                                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                                                        var Num2 = Result2-1;
                                                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                    
                                                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                                                        
                                                                                                
                                                                                                                                        //Mensagens de estimulo 
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                       
                                                                                        
                                                                                                                                      
                                                                                        
                                                                                                                                        
                                                                                                                                       
                                                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        FaseMsg: "Msg8A",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:[],
                                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                            MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                           MsgInst =MsgInst+ "2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                           MsgInst = MsgInst+ "3° Passo - Clique Localização atual"
                                                                                                                                            response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                        }) 
                                                                                                                                        } else {
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                           
                                                                                                                                        FaseMsg: "Msg8A",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:[],
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                       
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                            MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                           MsgInst = MsgInst+"2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                           MsgInst = MsgInst+"3° Passo - Clique Localização atual"
                                                                                                                                            
                                                                                                                                        
                                                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                            
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            
                                                                                                                                            
                                                                                                                                        }) 
                                                                                                
                                                                                                                                        
                                                                                                            
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                
                                                                                                                                    
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        }  else {
                                                                                                                
                                                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                                                            
                                                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                                    var Num = Result-1;
                                                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                            
                                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                        
                                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                                        
                                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                    
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                    DigiteNaRegra:false, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                    }, 
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    )
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                        console.log(TempMsg)
                                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                            
                                                                                                                                                    }) 
                                                                                                                                                } else  if(EstaNaRegra === false ){
                                                                                                            
                                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                        
                                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                                        
                                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                    
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                    Robotizado:false, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"texto"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                    }, 
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },)
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                        console.log(TempMsg)
                                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                            
                                                                                                                                                    }) 
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                    
                                                                                                                                
                                                                                                                                    
                                                                                                                                    } else if(FaMsg === "Msg8A" ){//Recebendo a Localização , Enviando a Pergunta de PAgamento
                                                                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                                                                       
                                                                                                                                       if(Type === "location"){
                                                                                                                                        
                                                                                                                                        await db.collection("MesaItem")
                                                                                                                                        .doc(PedidoCri)
                                                                                                                                        .update({
                                                                                                                                          
                                                                                                                                            "End.Localizacao.lat":Mensagem.location.latitude,
                                                                                                                                            "End.Localizacao.lng":Mensagem.location.longitude,
                                                                                                                                            
                                                                                                                                             
                                                                                                                                        }).then((doc)=>{
                                                                                                                                           
                                                                                                                                        })
                                                                                        


                                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                                               
                                                                                                                                    
                                                                                                                                                //https://www.google.com/maps?q=-4.2092412,-44.443785&z=17&hl=pt-BR
                                                                                                                                          
                                                                                                                                            
                                                                                                                                                var PedidosItens = []
                                                                                                                                                var ValorEnt = 0;
    
                                                                                                                                                await db.collection("MesaItem")
                                                                                                                                                .doc(PedidoCri)
                                                                                                                                                .get().then((doc)=>{
                                                                                                                                                    PedidosItens = doc.data().Itens;
                                                                                                                                                    ValorEnt = doc.data().ValorEntrega;
                                                                                                                                                })
                                                                                                                                            
                                                                                                                                                
                                                                                                                
                                                                                                                
                                                                                                                                                //montar a mensagem   
                                                                                                                                            var QMsg= MsgEmp.Msg10B.Msg.length;
                                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                                            var Num = Result-1;
                                                                                                                                            var AutoMsg = MsgEmp.Msg10B.Msg[Num];
                                                                                                                                            var TempMsg =  MsgEmp.Msg10B.TempoSeg;
                                                                                                                                    
                                                                                                                                            console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                                                            console.log("Msg: "+AutoMsg)
                                                                                                    
                                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                                            var Num9 = Result9-1;
                                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                        
                                                                                                                            
                                                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                                                            var Num2 = Result2-1;
                                                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                        
                                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                                            
                                                                                                    
                                                                                                                                            //Mensagens de estimulo 
                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                
                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                
                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                           
                                                                                            
                                                                                                                                          
                                                                                            
                                                                                                                                            
                                                                                                                                           
                                                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                            FaseMsg: "Msg10B",
                                                                                                                                            DigiteNaRegra:true,
                                                                                                                                            Robotizado:true, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"botao"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:`https://www.google.com/maps?q=${Mensagem.location.latitude},${Mensagem.location.longitude}&z=17&hl=pt-BR`,
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:"Link"
                                                                                                                                            },
                                                                                                                                            
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                                Type:"botao"
                                                                                                                                            },
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            )
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                 var TotalValor = 0
                                                                                                                                                    for(let i in PedidosItens){
                                                                                                                                                        
                                                                                                                                                    
                                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                        
                                                                                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                         
                                                                                                                                                        
                                                                                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                        }
                                                                                                                                                        
                                                                                                                                                        if(PedidosItens[i].Descont){
                                                                                                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                            if(PedidosItens[i].Observacao){
                                                                                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                            }
                                                                                                                                                        } else {
                                                                                                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                            if(PedidosItens[i].Observacao){
                                                                                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                
                                                                                                                                                    }
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    TotalValor = TotalValor+ValorEnt;
                                                                                                                                                    MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
    
                                                                                                                                                response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                            }) 
                                                                                                                                            } else {
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                               
                                                                                                                                            FaseMsg: "Msg10B",
                                                                                                                                            DigiteNaRegra:true,
                                                                                                                                            Robotizado:true, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:`https://www.google.com/maps?q=${Mensagem.location.latitude},${Mensagem.location.longitude}&z=17&hl=pt-BR`,
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                date:new Date().getTime()+2000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                                Type:"botao"
                                                                                                                                            },
                                                                                                                                           
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            )
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                var TotalValor = 0
                                                                                                                                                for(let i in PedidosItens){
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                    
                                                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                    }
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    } else {
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                            
                                                                                                                                                }
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                TotalValor = TotalValor+ValorEnt;
                                                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                
                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                
                                                                                                                                                
                                                                                                                                            }) 
                                                                                                    
                                                                                                                                            
                                                                                                                
                                                                                                                                            }      
                                                                                                                
                                                                                                                
                                                                                                                                           
                                                                                                                                            
                                                                                                                                    
                                                                                                                                           
                                                                                                                                            
                                                                                                                                        
                                                                                                                                            }  else {
                                                                                                                    
                                                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                                                
                                                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                                        var Num = Result-1;
                                                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                                
                                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                            
                                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                                            
                                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                                        
                                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                                        .doc(IdChat)
                                                                                                                                                        .update({
                                                                                                                                                        DigiteNaRegra:false, 
                                                                                                                                                        MsgFutura1:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                                            Tempo:Tempo3,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura2:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                                            Tempo:Tempo4,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura3:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                                            Tempo:Tempo5,
                                                                                                                                                        },
                                                                                                                                                        UltimaMsg:{
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"text"
                                                                                                                                                        },
                                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                            Autor:IdCli,
                                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                            date:new Date().getTime(),
                                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                        }, 
                                                                                                                                                        {
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"text"
                                                                                                                                                        },
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                        )
                                                                                                                                                        })
                                                                                                                                                        .then(async() => {
                                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                            console.log(TempMsg)
                                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                
                                                                                                                                                        }) 
                                                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                                                
                                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                            
                                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                                            
                                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                                        
                                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                                        .doc(IdChat)
                                                                                                                                                        .update({
                                                                                                                                                        Robotizado:false, 
                                                                                                                                                        MsgFutura1:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                                            Tempo:Tempo3,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura2:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                                            Tempo:Tempo4,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura3:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                                            Tempo:Tempo5,
                                                                                                                                                        },
                                                                                                                                                        UltimaMsg:{
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"texto"
                                                                                                                                                        },
                                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                            Autor:IdCli,
                                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                            date:new Date().getTime(),
                                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                        }, 
                                                                                                                                                        {
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"text"
                                                                                                                                                        },)
                                                                                                                                                        })
                                                                                                                                                        .then(async() => {
                                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                            console.log(TempMsg)
                                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                
                                                                                                                                                        }) 
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                        
                                                                                                                                    
                                                                                                                                        
                                                                                                                                        } else if(FaMsg === "Msg10B" ){//Recebendo Qual meio de Pagamento  , Enviando A pergunta  pra ele fazer o pix  
                                                                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                                                                           
                                                                                                                                           if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                                            
                                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                                   
                                                                                                                                                    var PedidosItens = []
                                                                                                                                                    var ValorEnt = 0;
        
                                                                                                                                                    await db.collection("MesaItem")
                                                                                                                                                    .doc(PedidoCri)
                                                                                                                                                    .get().then((doc)=>{
                                                                                                                                                        PedidosItens = doc.data().Itens;
                                                                                                                                                        ValorEnt = doc.data().ValorEntrega;
                                                                                                                                                    })
                                                                                                                                                
                                                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                                                    //montar a mensagem   
                                                                                                                                                var QMsg= MsgEmp.Msg11A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg11A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg11A.TempoSeg;
                                                                                                                                        
                                                                                                                                                console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                                console.log("Msg: "+AutoMsg)

                                                                                                                                                var QMsg2= MsgEmp.Msg11B.Msg.length;
                                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                                var Num2 = Result2-1;
                                                                                                                                                var AutoMsg2 = MsgEmp.Msg11B.Msg[Num2];
                                                                                                                                                var TempMsg2 =  MsgEmp.Msg11B.TempoSeg;
                                                                                                        
                                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                                var Num9 = Result9-1;
                                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                            
                                                                                                                                
                                                                                                                                             
                                                                                                                            
                                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                
                                                                                                        
                                                                                                                                                //Mensagens de estimulo 
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                                                                                               
                                                                                                                                                var MsgPedido = NomeCli+AutoMsg+"\n";
                                                                                                                                                var TotalValor = 0
                                                                                                                                                   for(let i in PedidosItens){
                                                                                                                                              
                                                                                                                                                       
                                                                                                                                                       if(PedidosItens[i].Descont){
                                                                                                                                                           TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)

                                                                                                                                                       } else {
                                                                                                                                                           TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                
                                                                                                                                                       }
                                                                                               
                                                                                                                                                   }
                                                                                                                                                   MsgPedido = MsgPedido + "===================\n"
                                                                                                                                                   MsgPedido = MsgPedido + " Nome da Conta: "+DadoEmp.Pix.Nome+"\n"
                                                                                                                                                   MsgPedido = MsgPedido + " Tipo de Pix: "+DadoEmp.Pix.Tipo+"\n"
                                                                                                                                                   MsgPedido = MsgPedido + " Numero do Pix: "+DadoEmp.Pix.Numero
                                                                                                                                                   MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                   MsgPedido = MsgPedido + " 📦Valor do Pedido: "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                   MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                   MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                   MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                   TotalValor = TotalValor+ValorEnt;
                                                                                                                                                   MsgPedido = MsgPedido + "💰Valor A Ser Pago Via Pix: "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                              
                                                                                                
                                                                                                                                                
                                                                                                                                               
                                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                FaseMsg: "Msg11B",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${MsgPedido}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+4000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },

                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                   
        
                                                                                                                                                    response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:`*${NomeCli} ${AutoMsg2}*` , Botao:[] , Tempo:TempMsg2, Type:"text"},] });
                                                                                                                                                }) 
                                                                                                                                                } else {
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                   
                                                                                                                                                FaseMsg: "Msg11B",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${MsgPedido}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+4000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },

                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:`*${NomeCli} ${AutoMsg2}*` , Botao:[] , Tempo:TempMsg2, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                }) 
                                                                                                        
                                                                                                                                                
                                                                                                                    
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                        
                                                                                                                                            
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                                            
                                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                                   
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                                                    //montar a mensagem   
                                                                                                                                                var QMsg= MsgEmp.Msg8A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg8A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg8A.TempoSeg;
                                                                                                                                        
                                                                                                                                                console.log(MsgEmp.Msg8A.Msg)
                                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                                        
                                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                                var Num9 = Result9-1;
                                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                            
                                                                                                                                
                                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                                var Num2 = Result2-1;
                                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                            
                                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                
                                                                                                        
                                                                                                                                                //Mensagens de estimulo 
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                               
                                                                                                
                                                                                                                                              
                                                                                                
                                                                                                                                                
                                                                                                                                               
                                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst =MsgInst+ "2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+ "3° Passo - Clique Localização atual"
                                                                                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                }) 
                                                                                                                                                } else {
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                   
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst = MsgInst+"2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+"3° Passo - Clique Localização atual"
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                }) 
                                                                                                        
                                                                                                                                                
                                                                                                                    
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                        
                                                                                                                                            
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                }   else  if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){
                                                                                                                                            
                                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                                   
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                                                    //montar a mensagem   
                                                                                                                                                var QMsg= MsgEmp.Msg8A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg8A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg8A.TempoSeg;
                                                                                                                                        
                                                                                                                                                console.log(MsgEmp.Msg8A.Msg)
                                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                                        
                                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                                var Num9 = Result9-1;
                                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                            
                                                                                                                                
                                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                                var Num2 = Result2-1;
                                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                            
                                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                
                                                                                                        
                                                                                                                                                //Mensagens de estimulo 
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                               
                                                                                                
                                                                                                                                              
                                                                                                
                                                                                                                                                
                                                                                                                                               
                                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst =MsgInst+ "2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+ "3° Passo - Clique Localização atual"
                                                                                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                }) 
                                                                                                                                                } else {
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                   
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst = MsgInst+"2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+"3° Passo - Clique Localização atual"
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                }) 
                                                                                                        
                                                                                                                                                
                                                                                                                    
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                        
                                                                                                                                            
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                }else {
                                                                                                                        
                                                                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                                                                    
                                                                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                                                            var Num = Result-1;
                                                                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                                    
                                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                
                                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                                
                                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                                            
                                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                                            .doc(IdChat)
                                                                                                                                                            .update({
                                                                                                                                                            DigiteNaRegra:false, 
                                                                                                                                                            MsgFutura1:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                                Tempo:Tempo3,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura2:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                                Tempo:Tempo4,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura3:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                                Tempo:Tempo5,
                                                                                                                                                            },
                                                                                                                                                            UltimaMsg:{
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"text"
                                                                                                                                                            },
                                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                Autor:IdCli,
                                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                            }, 
                                                                                                                                                            {
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"text"
                                                                                                                                                            },
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            )
                                                                                                                                                            })
                                                                                                                                                            .then(async() => {
                                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                console.log(TempMsg)
                                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                            }) 
                                                                                                                                                        } else  if(EstaNaRegra === false ){
                                                                                                                    
                                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                
                                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                                
                                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                                            
                                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                                            .doc(IdChat)
                                                                                                                                                            .update({
                                                                                                                                                            Robotizado:false, 
                                                                                                                                                            MsgFutura1:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                                Tempo:Tempo3,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura2:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                                Tempo:Tempo4,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura3:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                                Tempo:Tempo5,
                                                                                                                                                            },
                                                                                                                                                            UltimaMsg:{
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"texto"
                                                                                                                                                            },
                                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                Autor:IdCli,
                                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                            }, 
                                                                                                                                                            {
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"text"
                                                                                                                                                            },)
                                                                                                                                                            })
                                                                                                                                                            .then(async() => {
                                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                console.log(TempMsg)
                                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                    
                                                                                                                                                            }) 
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                            
                                                                                                                                        
                                                                                                                                            
                                                                                                                                            } else if(FaMsg === "Msg11B" ){//Recebendo a Localização , Enviando a Pergunta de PAgamento
                                                                                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                                                                               
                                                                                                                                               if(Type ==="image" || Type === "document"){
                                                                                                                                                
                                                                                                                                               
        
        
                                                                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                                                                       
                                                                                                                                            
                                                                                                                                                        //https://www.google.com/maps?q=-4.2092412,-44.443785&z=17&hl=pt-BR
                                                                                                                                                  
                                                                                                                                                    
                                                                                                                                                        var PedidosItens = []
                                                                                                                                                        var ValorEnt = 0;
                                                                                                                                                        var EndCli ={}
            
                                                                                                                                                        await db.collection("MesaItem")
                                                                                                                                                        .doc(PedidoCri)
                                                                                                                                                        .get().then((doc)=>{
                                                                                                                                                            PedidosItens = doc.data().Itens;
                                                                                                                                                            ValorEnt = doc.data().ValorEntrega;
                                                                                                                                                            EndCli = doc.data().End;
                                                                                                                                                        })
                                                                                                                                                        await db.collection("ClienteEmpre")
                                                                                                                                                        .doc(IdCli)
                                                                                                                                                        .update({
                                                                                                                                                          
                                                                                                                                                          End:admin.firestore.FieldValue.arrayUnion(EndCli)
                                                                                                                                                            
                                                                                                                                                             
                                                                                                                                                        }).then((doc)=>{
                                                                                                                                                           
                                                                                                                                                        })
                                                                                                                                                        
                                                                                                                        
                                                                                                                        
                                                                                                                                                        //montar a mensagem   
                                                                                                                                                    var QMsg= MsgEmp.Msg13C.Msg.length;
                                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                                    var Num = Result-1;
                                                                                                                                                    var AutoMsg = MsgEmp.Msg13C.Msg[Num];
                                                                                                                                                    var TempMsg =  MsgEmp.Msg13C.TempoSeg;
                                                                                                                                            
                                                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                                                            
                                                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                                                    var Num9 = Result9-1;
                                                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                                
                                                                                                                                    
                                                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                                                    var Num2 = Result2-1;
                                                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                                
                                                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                    
                                                                                                            
                                                                                                                                                    //Mensagens de estimulo 
                                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                        
                                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                                        
                                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                   
                                                                                                    
                                                                                                                                                  
                                                                                                    
                                                                                                                                                    
                                                                                                                                                   
                                                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                    FaseMsg: "Msg13C",
                                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                                    Robotizado:true, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:false,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:false,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:false,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:`data:${Midia.mimetype};base64, ${Midia.data} `,
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:Type === "image"?"image":"document"
                                                                                                                                                    },
                                                                                                                                                    
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli} ${AutoMsg}`,
                                                                                                                                                        Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    )
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                         var TotalValor = 0
                                                                                                                                                            for(let i in PedidosItens){
                                                                                                                                                                
                                                                                                                                                            
                                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                                
                                                                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                                 
                                                                                                                                                                
                                                                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                                }
                                                                                                                                                                
                                                                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                    }
                                                                                                                                                                } else {
                                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                        
                                                                                                                                                            }
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            TotalValor = TotalValor+ValorEnt;
                                                                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            MsgPedido = MsgPedido + "Pago Com Pix "
                                                                                                                                                           
                                                                                                                                                            await db.collection("MesaItem")
                                                                                                                                                            .doc(PedidoCri)
                                                                                                                                                            .update({
                                                                                                                                                              
                                                                                                                                                                ConfirmacaoPedido:true,
                                                                                                                                                                ValorTotaL:TotalValor,
                                                                                                                                                                
                                                                                                                                                                 
                                                                                                                                                            }).then((doc)=>{
                                                                                                                                                               
                                                                                                                                                            })
                                                                                                            
                                                                                                                                                             
                                                                                                                                                        response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    }) 
                                                                                                                                                    } else {
                                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                       
                                                                                                                                                    FaseMsg: "Msg10B",
                                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                                    Robotizado:true, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:`https://www.google.com/maps?q=${Mensagem.location.latitude},${Mensagem.location.longitude}&z=17&hl=pt-BR`,
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                                        Type:"botao"
                                                                                                                                                    },
                                                                                                                                                   
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    )
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                        var TotalValor = 0
                                                                                                                                                        for(let i in PedidosItens){
                                                                                                                                                            
                                                                                                                                                        
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                            
                                                                                                                                                                MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            if(PedidosItens[i].ItemEspeci){
                                                                                                                                                                MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                            }
                                                                                                                                                            
                                                                                                                                                            if(PedidosItens[i].Descont){
                                                                                                                                                                TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                                MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                if(PedidosItens[i].Observacao){
                                                                                                                                                                MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                }
                                                                                                                                                            } else {
                                                                                                                                                                TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                                MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                if(PedidosItens[i].Observacao){
                                                                                                                                                                MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                    
                                                                                                                                                        }
                                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                        MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                        TotalValor = TotalValor+ValorEnt;
                                                                                                                                                        MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                        
                                                                                                                                                    
                                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                        
                                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                    }) 
                                                                                                            
                                                                                                                                                    
                                                                                                                        
                                                                                                                                                    }      
                                                                                                                        
                                                                                                                        
                                                                                                                                                   
                                                                                                                                                    
                                                                                                                                            
                                                                                                                                                   
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    }  else {
                                                                                                                            
                                                                                                                                                            if(EstaNaRegra === true && Robo === true){
                                                                                                                        
                                                                                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                                var Num = Result-1;
                                                                                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                                        
                                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                    
                                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                                    
                                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                                
                                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                                .doc(IdChat)
                                                                                                                                                                .update({
                                                                                                                                                                DigiteNaRegra:false, 
                                                                                                                                                                MsgFutura1:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura2:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura3:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                                },
                                                                                                                                                                UltimaMsg:{
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"text"
                                                                                                                                                                },
                                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                    Autor:IdCli,
                                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                                }, 
                                                                                                                                                                {
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"text"
                                                                                                                                                                },
                                                                                                                                                                
                                                                                                                                                                
                                                                                                                                                                )
                                                                                                                                                                })
                                                                                                                                                                .then(async() => {
                                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                        
                                                                                                                                                                }) 
                                                                                                                                                            } else  if(EstaNaRegra === false ){
                                                                                                                        
                                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                    
                                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                                    
                                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                                
                                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                                .doc(IdChat)
                                                                                                                                                                .update({
                                                                                                                                                                Robotizado:false, 
                                                                                                                                                                MsgFutura1:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura2:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura3:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                                },
                                                                                                                                                                UltimaMsg:{
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"texto"
                                                                                                                                                                },
                                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                    Autor:IdCli,
                                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                                }, 
                                                                                                                                                                {
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"text"
                                                                                                                                                                },)
                                                                                                                                                                })
                                                                                                                                                                .then(async() => {
                                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                        
                                                                                                                                                                }) 
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                
                                                                                                                                            
                                                                                                                                                
                                                                                                                                                }
                     } else {
                         //mensagens de estimulo para continuar o atendimento
                         var QMsg3= MsgEmp.Msg17A.Msg.length;
                         var QMsg4= MsgEmp.Msg17B.Msg.length;
                         var QMsg5= MsgEmp.Msg17C.Msg.length;
                         var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                         var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                         var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                         var Result3 =parseInt(Sorteio3);
                         var Result4 =parseInt(Sorteio4);
                         var Result5 =parseInt(Sorteio5);

                         var Num3 = Result3-1;
                         var Num4 = Result4-1;
                         var Num5 = Result5-1;
                         var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                         var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                         var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                         var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                         var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                         var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                        await db.collection("ChatCliente")
                        .doc(IdChat)
                        .update({
                        MsgFutura1:{
                            Ativo:true,
                            Msg:AutoMsg3,
                            Tempo:Tempo3,
                        },
                        MsgFutura2:{
                            Ativo:true,
                            Msg:AutoMsg4,
                            Tempo:Tempo4,
                        },
                        MsgFutura3:{
                            Ativo:true,
                            Msg:AutoMsg5,
                            Tempo:Tempo5,
                        },
                        UltimaMsg:{
                            Autor:IdCli,
                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                            date:new Date().getTime(),
                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                        },
                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                            Autor:IdCli,
                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                            date:new Date().getTime(),
                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                        }, 
    
                        
                        
                        )
                        })
                        .then(async() => {
                           
                           
                            //response.json({ Inf:true});
                    
                        }) 


                     }
                   
                    
                    
                    
                    
                    
                    
                    } else {//Não Existe Um Chat Em Anadamento Entra Aqui 
        
        
                        if(NomeCli === ""){
        
                         //Aqui vou ta salvando  o Nome do Cliente
                            await db.collection("ClienteEmpre")
                            .doc(IdCli)
                            .update({
                            Nome: Mensagem.text.message,
                            })
                            .then(async() => {
                              
                            
                            
                            }) 
                
                        //Aqui vou está enviando uma mensagem
                            setTimeout(() => {
                                axios.post(`${URL_WHATS}/send-text`, {
                                    "phone": Mensagem.phone,
                                    "message": `${AutoMsg}`,
                                }).then(function (response) {
                               
                            })
                               
                              }, MsgEmp.TempoSeg);
                           
                           
                        }
                    
                    
                    
                    
                    }
        
        
        
        
                })
        
        
              
        
        
        
        
        
        
        
            } else { //ver se o cliente está cadastrado na cwo 
           
            await db.collection("ClienteEmpre")
            .where("Telefone", "==", TelefonCli)
            .get().then(async (querySnapshot12) => {

              
                if(querySnapshot12.size  !== 0){//Aqui é se o cliente já está cadastrado na CWO  
                    var IdClient = "";

                    //Pego o id do cliente
                    await querySnapshot12.forEach((doc12) => {
                        IdClient = doc12.id;
                       })

                       //Atualizar o cliente colocando outra empresa
                    await db.collection("ClienteEmpre")
                       .doc(IdClient)
                       .update({
                        Empresa:admin.firestore.FieldValue.arrayUnion(EMPRESA)
                       })
                       .then(async() => {

                        var MsgEmp = {};

                         //Pesquiso as msgs  automatica pda emrpesa

                        await db.collection("EmrpesaSite")
                        .doc(EMPRESA)
                        .get().then(async(doc) => {
                            MsgEmp = doc.data().MsgAuto;
                        });

                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                        await db.collection("MenusSite")
                        .where("Empresa", "==", EMPRESA)
                        .where("Ativo", "==", true)
                        .get().then(async (querySnapshot23) => {
                            await querySnapshot23.forEach((doc23) => {

                                Menus.push({
                                    id:doc23.id,
                                    body:doc23.data().nome,
                                    GrupTamanho:doc23.data().GrupTamanho,
                                    MemFim:doc23.data().MemFim,
                                    Tamanho:doc23.data().Tamanho,
                                })
                            
                                })

                        });
                     
                        console.log(MsgEmp)
                        console.log(MsgEmp.Msg1A)
                        console.log(MsgEmp.Msg1A.Msg)
                        console.log(MsgEmp.Msg1B)
                        console.log(MsgEmp.Msg1B.Msg)
                        
                        // Montando as mensagens 
                        var QMsg= MsgEmp.Msg1A.Msg.length;
                        var QMsg2= MsgEmp.Msg4A.Msg.length;
                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
            
                        var Result =parseInt(Sorteio);
                        var Result2 =parseInt(Sorteio2);
            
                        var Num = Result-1;
                        var Num2 = Result2-1;
                        var AutoMsg = MsgEmp.Msg1A.Msg[Num];
                        var AutoMsg2= MsgEmp.Msg4A.Msg[Num2];
                        //mensagens de estimulo para continuar o atendimento
                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
            
                        var Result3 =parseInt(Sorteio3);
                        var Result4 =parseInt(Sorteio4);
                        var Result5 =parseInt(Sorteio5);
            
                        var Num3 = Result3-1;
                        var Num4 = Result4-1;
                        var Num5 = Result5-1;
                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                        var  Letras = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "X", "Z"];
                        var SortLet = Math.floor(Math.random() * (Letras.length - 1 + 1)) + 1;
                        var NumAr=SortLet-1
                        await  db.collection("MesaItem").add({
                            NomeCli:"",
                            TelCli:TelefonCli,
                            Ativo:true,
                            Cliente:IdClient,
                            IdChat:"",
                            Empresa:EMPRESA,
                            Codigo: Letras[NumAr]+new Date().getTime(),
                            Mesa:"Externo",
                            Itens:[],
                            ValorTotaL:0,
                            ValorEntrega:0,
                            ComissaaEntrega:0,
                            dataCriacao:new Date().getTime(),
                            Fechado:false,
                            IniciandoProducao:false,
                            IniciandoEntrega:false,
                            ConcluidoEntregado:false,
                            ConcluidoProducao:false,
                            ConfirmacaoPedido:false,
                            FormaDepagamento:null,
                            ExtratoPix:null,
                            End:{
                                Bairro:"",
                                Rua:"",
                                Numero:"",
                                Proximo:"",
                                Localizacao:{
                                    lat:null,
                                    lng:null,
                                }
                                },
                            TelEntregador:"",
                        
                            }).then(async (dif) => {

                                await db.collection("ChatCliente").add({
                                    RoboAtivo:true,
                                    Id: IdClient,
                                    DigiteNaRegra:true,
                                    MsgFutura1:{
                                        Ativo:true,
                                        Msg:AutoMsg3,
                                        Tempo:Tempo3,
                                    },
                                    MsgFutura2:{
                                        Ativo:true,
                                        Msg:AutoMsg4,
                                        Tempo:Tempo4,
                                    },
                                    MsgFutura3:{
                                        Ativo:true,
                                        Msg:AutoMsg5,
                                        Tempo:Tempo5,
                                    },
                                    MemSessao:Menus,
                                    MemPedido:{},
                                    Reclamaçoes:null,
                                    Localização:null,
                                    Pedido:dif.id,
                                    DataInicio: new Date().getTime(),
                                    Empresa:EMPRESA,
                                    Telefone:TelefonCli,
                                    Robotizado:true,
                                    Ativo:true,
                                    vizualEmp:0,
                                    VizualCli:1,
                                    DigiEmp:false,
                                    DigiCli:false,
                                    FaseMsg:"Msg4A",
                                    UltimaMsg:{
                                        Autor:IdClient,
                                        body:AutoMsg2,
                                        date:new Date().getTime()+7000,
                                        Type:"text"
                                    },
                                    Mensagem:[{
                                        Autor:IdClient,
                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                        date:new Date().getTime(),
                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                    }, 
                                    {
                                        Autor:EMPRESA,
                                        body:AutoMsg,
                                        date:new Date().getTime()+2000,
                                        Type:"text"
                                    },
                                    {
                                        Autor:EMPRESA,
                                        body:AutoMsg2,
                                        date:new Date().getTime()+7000,
                                        Type:"text"
                                    },
                                   
                                    ]
                                 
                                })
                                .then(async (docRef2) => {
                                   
                                  
                                    
            
                                    response.json({ Inf:[{Msg:AutoMsg, Tempo:MsgEmp.Msg1A.TempoSeg, Type:"text"}, {Msg:`*${AutoMsg2}*`, Tempo:MsgEmp.Msg4A.TempoSeg,  Botao:Menus , Type:"text"}] });
        
                                })
                                .catch((error) => {
                                    console.error("Error adding document: ", error);
                                });
        
                       
                               }) 

                            })
                       
                        //COntruindo Um Caht Entre a empresa e o CLiente
                      


                } else{//Aqui é se o cliente não já está cadastrado na CWO  

                    console.log("Entrou 1° Sessão ")
                    // Cadastrando o Cliente Na lista Da Empresas 
                       await db.collection("ClienteEmpre").add({
                           Nome: "",
                           Telefone: TelefonCli,
                           dataCadas:new Date().getTime(),
                           End:[],
                           Empresa:admin.firestore.FieldValue.arrayUnion(EMPRESA)
                       })
                       .then(async (docRef) => {
                           console.log("Entrou 2° Sessão ")
                           console.log("Document written with ID1: ", docRef.id);
                          
                           var IdClient = docRef.id;
           
                           var MsgEmp = {};
                           
                           await db.collection("EmrpesaSite")
                           .doc(EMPRESA)
                           .get().then(async(doc) => {
                               MsgEmp = doc.data().MsgAuto;
                           });
                        
                           var Menus = [{id:"0", body:"Voltar Para o Início"}]
                            await db.collection("MenusSite")
                            .where("Empresa", "==", EMPRESA)
                            .where("Ativo", "==", true)
                            .get().then(async (querySnapshot23) => {
                                await querySnapshot23.forEach((doc23) => {

                                    Menus.push({
                                        id:doc23.id,
                                        body:doc23.data().nome,
                                        GrupTamanho:doc23.data().GrupTamanho,
                                        MemFim:doc23.data().MemFim,
                                        Tamanho:doc23.data().Tamanho,
                                    })
                                
                                    })

                            });
           
                           var QMsg= MsgEmp.Msg1A.Msg.length;
                           var QMsg2= MsgEmp.Msg4A.Msg.length;
                           var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                           var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
               
                           var Result =parseInt(Sorteio);
                           var Result2 =parseInt(Sorteio2);
               
                           var Num = Result-1;
                           var Num2 = Result2-1;
                           var AutoMsg = MsgEmp.Msg1A.Msg[Num];
                           var AutoMsg2= MsgEmp.Msg4A.Msg[Num2];
                           
                           console.log(MsgEmp.Msg1A.Msg)
                           console.log("Qmsg: "+QMsg)
               
                           console.log("Soteio: "+Sorteio)
                        
                           console.log("Msg: "+AutoMsg)
               
                           console.log(MsgEmp.Msg1B.Msg)
                           console.log("Qmsg: "+QMsg2)
               
                           console.log("Soteio: "+Sorteio2)
                        
                           console.log("Msg: "+AutoMsg2)

                        //mensagens de estimulo para continuar o atendimento
                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
            
                        var Result3 =parseInt(Sorteio3);
                        var Result4 =parseInt(Sorteio4);
                        var Result5 =parseInt(Sorteio5);
            
                        var Num3 = Result3-1;
                        var Num4 = Result4-1;
                        var Num5 = Result5-1;
                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                       
                        var  Letras = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "X", "Z"];
                        var SortLet = Math.floor(Math.random() * (Letras.length - 1 + 1)) + 1;
                        var NumAr=SortLet-1
                       await  db.collection("MesaItem").add({
                            NomeCli:"",
                            TelCli:TelefonCli,
                            Ativo:true,
                            Cliente:IdClient,
                            IdChat:"",
                            Empresa:EMPRESA,
                            Codigo: Letras[NumAr]+new Date().getTime(),
                            Mesa:"Externo",
                            Itens:[],
                            ValorTotaL:0,
                            ValorEntrega:0,
                            ComissaaEntrega:0,
                            dataCriacao:new Date().getTime(),
                            Fechado:false,
                            IniciandoProducao:false,
                            IniciandoEntrega:false,
                            ConcluidoEntregado:false,
                            ConcluidoProducao:false,
                            ConfirmacaoPedido:false,
                            FormaDepagamento:null,
                            ExtratoPix:null,
                            End:{
                                Bairro:"",
                                Rua:"",
                                Numero:"",
                                Proximo:"",
                                Localizacao:{
                                    lat:null,
                                    lng:null,
                                }
                                },
                            TelEntregador:"",
                        
                            }).then(async (dif) => {
                                await db.collection("ChatCliente").add({
                                    RoboAtivo:true,
                                      Id: IdClient,
                                      DigiteNaRegra:true,
                                      MsgFutura1:{
                                       Ativo:true,
                                       Msg:AutoMsg3,
                                       Tempo:Tempo3,
                                   },
                                   MsgFutura2:{
                                       Ativo:true,
                                       Msg:AutoMsg4,
                                       Tempo:Tempo4,
                                   },
                                   MsgFutura3:{
                                       Ativo:true,
                                       Msg:AutoMsg5,
                                       Tempo:Tempo5,
                                   },
                                      MemSessao:Menus,
                                      MemPedido:{},
                                      Reclamaçoes:null,
                                      Localização:null,
                                      Pedido:dif.id,
                                      DataInicio: new Date().getTime(),
                                      Empresa:EMPRESA,
                                      Telefone:TelefonCli,
                                      Robotizado:true,
                                      Ativo:true,
                                      vizualEmp:0,
                                      VizualCli:1,
                                      DigiEmp:false,
                                      DigiCli:false,
                                      FaseMsg:"Msg4A",
                                      UltimaMsg:{
                                          Autor:IdClient,
                                          body:AutoMsg2,
                                          date:new Date().getTime()+7000,
                                          Type:"text"
                                      },
                                      Mensagem:[{
                                          Autor:IdClient,
                                          body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                          date:new Date().getTime(),
                                          Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                      }, 
                                      {
                                          Autor:EMPRESA,
                                          body:AutoMsg,
                                          date:new Date().getTime()+2000,
                                          Type:"text"
                                      },
                                      {
                                          Autor:EMPRESA,
                                          body:AutoMsg2,
                                          date:new Date().getTime()+7000,
                                          Type:"text"
                                      },
                                     
                                      ]
                                   
                                  })
                                  .then(async(docRef2) => {
                                  
                                    
              
                                      response.json({ Inf:[{Msg:AutoMsg, Tempo:MsgEmp.Msg1A.TempoSeg, Type:"text"}, {Msg:`*${AutoMsg2}*`, Tempo:MsgEmp.Msg4A.TempoSeg, Botao:Menus , Type:"text"}] });
        
                                  })
                                  .catch((error) => {
                                      console.error("Error adding document: ", error);
                                  });
                            })

                     
                        
               
                       })
                       .catch((error) => {
                           console.error("Error adding document: ", error);
                       });
               

                }
            })


             
        
        
            }
            })
    

    }

    

    
  


    
    
})
   
  });





  app.post("/VerMsg", async  function (request, response){
    cors(request, response, async () => { 
         var Emp = request.body.Id;
         console.log(Emp)
        var MsgAtiv = []
        await db.collection("CorreioMSg")
        .where("Ativo", "==", true)
        .where("EMPRESA", "==", Emp)
        .get().then(async (querySnapshot1) => {

        await querySnapshot1.forEach((doc1) => {
             MsgAtiv.push({
               id:doc1.id,
               Msg:doc1.data().Msg,
               Botao:doc1.data().Botao,
               Tel:doc1.data().Tel,
               Type:doc1.data().Type,
               Agenda:doc1.data().Agendamento.seconds*1000,
             })
           })

        });

        console.log(MsgAtiv)

      for(let i in MsgAtiv){

        await db.collection("CorreioMSg")
        .doc(MsgAtiv[i].id)
        .update({
        Ativo: false,
        })
        .then(async() => {

        }) 

      }
      

        // await db.collection("CorreioMSg")
        // .doc("2BN4dNFjbIyTuXVP5kaN")
        // .get().then(async(doc) => {
        //     NomeWhats = doc.data();
        // });
       
        response.json({Inf:MsgAtiv});

    }); 
});  

app.post("/MsgEstimulo1", async  function (request, response){
    cors(request, response, async () => { 
         var Emp = request.body.Id;
         console.log(Emp)
         var DataAgora = new Date().getTime();
        var MsgAtiv = []
        await db.collection("ChatCliente")
        .where("MsgFutura1.Ativo", "==", true)
        .where("Empresa", "==", Emp)
        .where("MsgFutura1.Tempo", "<=", DataAgora)
        .get().then(async (querySnapshot1) => {

        await querySnapshot1.forEach((doc1) => {
             MsgAtiv.push({
               id:doc1.id,
               Msg:doc1.data().MsgFutura1.Msg,
               Tel:doc1.data().Telefone,
               Type:"text",
               Agenda:doc1.data().MsgFutura1.Tempo,
               Botao:"",
             })
           })

        });

      

      for(let i in MsgAtiv){

        await db.collection("ChatCliente")
        .doc(MsgAtiv[i].id)
        .update({
        "MsgFutura1.Ativo": false,
        UltimaMsg:{
            Autor:Emp,
            body:MsgAtiv[i].Msg,
            date:new Date().getTime(),
            Type:"text"
        },
        Mensagem:admin.firestore.FieldValue.arrayUnion({
            Autor:Emp,
            body:MsgAtiv[i].Msg,
            date:new Date().getTime(),
            Type:"text"
        })
        })
        .then(async() => {

        }) 

      }


      
      console.log(MsgAtiv)
      
       
        response.json({Inf:MsgAtiv});

    }); 
});  

app.post("/MsgEstimulo2", async  function (request, response){
    cors(request, response, async () => { 
         var Emp = request.body.Id;
         console.log(Emp)
         var DataAgora = new Date().getTime();
        var MsgAtiv = []
      

      await db.collection("ChatCliente")
        .where("MsgFutura2.Ativo", "==", true)
        .where("Empresa", "==", Emp)
        .where("MsgFutura2.Tempo", "<=", DataAgora)
        .get().then(async (querySnapshot1) => {

        await querySnapshot1.forEach((doc1) => {
             MsgAtiv.push({
               id:doc1.id,
               Msg:doc1.data().MsgFutura2.Msg,
               Tel:doc1.data().Telefone,
               Type:"text",
               Agenda:doc1.data().MsgFutura2.Tempo,
               Botao:"",
             })
           })

        });

      

      for(let i in MsgAtiv){

        await db.collection("ChatCliente")
        .doc(MsgAtiv[i].id)
        .update({
        "MsgFutura2.Ativo": false,
        UltimaMsg:{
            Autor:Emp,
            body:MsgAtiv[i].Msg,
            date:new Date().getTime(),
            Type:"text"
        },
        Mensagem:admin.firestore.FieldValue.arrayUnion({
            Autor:Emp,
            body:MsgAtiv[i].Msg,
            date:new Date().getTime(),
            Type:"text"
        })
        })
        .then(async() => {

        }) 

      }
      
      console.log(MsgAtiv)
      
       
        response.json({Inf:MsgAtiv});

    }); 
});  
app.post("/MsgEstimulo3", async  function (request, response){
    cors(request, response, async () => { 
         var Emp = request.body.Id;
         console.log(Emp)
         var DataAgora = new Date().getTime();
        var MsgAtiv = []
      

      await db.collection("ChatCliente")
        .where("MsgFutura3.Ativo", "==", true)
        .where("Empresa", "==", Emp)
        .where("MsgFutura3.Tempo", "<=", DataAgora)
        .get().then(async (querySnapshot1) => {

        await querySnapshot1.forEach((doc1) => {
             MsgAtiv.push({
               id:doc1.id,
               Msg:doc1.data().MsgFutura3.Msg,
               Tel:doc1.data().Telefone,
               Type:"text",
               Agenda:doc1.data().MsgFutura3.Tempo,
               Botao:"",
               Pedido:doc1.data().Pedido,
             })
           })

        });

      

      for(let i in MsgAtiv){

        await db.collection("ChatCliente")
        .doc(MsgAtiv[i].id)
        .update({
        Ativo:false,
        "MsgFutura3.Ativo": false,
        UltimaMsg:{
            Autor:Emp,
            body:MsgAtiv[i].Msg,
            date:new Date().getTime(),
            Type:"text"
        },
        Mensagem:admin.firestore.FieldValue.arrayUnion({
            Autor:Emp,
            body:MsgAtiv[i].Msg,
            date:new Date().getTime(),
            Type:"text"
        })
        })
        .then(async() => {

        })
       if(MsgAtiv[i].Pedido){
        await db.collection("MesaItem")
        .doc(MsgAtiv[i].Pedido)
        .delete()
        .then(async() => {

        })

       }
        


      }
      
      console.log(MsgAtiv)
      
       
        response.json({Inf:MsgAtiv});

    }); 
}); 

app.post("/Msglojas", async  function (request, response){
    cors(request, response, async () => {
    var EMPRESA = request.body.Id
    //var URL_WHATS = "https://api.z-api.io/instances/3A9D95BC49F730DF458B76215AA2744C/token/A2A3E65C2FE0E21916E8A2AE";
    
//Guardando Mensagens Que Chegou    
var Mensagem = request.body.Msg;
var Type = request.body.Msg.type;
var Midia = request.body.Midia;
var NomeWhats = "";

    await db.collection("MensagensRobo").add({
        body: Mensagem,
        name: "Chegou Mensagem",
        Midia:Midia,
     
    })
    .then((docRef) => {
        console.log("Document written with ID: ", docRef.id);
    })
    .catch((error) => {
        console.error("Error adding document: ", error);
    });


   
   

 
      

   

    var resposta = {};
    if(Mensagem.body !== 'ATIVAR FUNIL BASICO'){
        var TelefonCli = Mensagem.from.replace("@c.us", "")
        console.log(TelefonCli)
            await db.collection("ClienteEmpre")
            .where("Empresa", "array-contains", EMPRESA)
            .where("Telefone", "==", TelefonCli)
            .get().then(async (querySnapshot1) => {
    
         
              if(querySnapshot1.size  !== 0){ //O Cliente já está cadastrado 
                
           // Aqui vai pegar os dados da Empresas, Mensgens, e o Tempo Maximo de Chat
    
                var MsgEmp = {} 
                var TempChat
                var DadoEmp = {}

                await db.collection("EmrpesaSite")
                .doc(EMPRESA)
                .get().then(async(doc) => {
                    MsgEmp = doc.data().MsgAuto;
                    TempChat = doc.data().TempoChat;
                    DadoEmp = doc.data();
                });
           
        
            
        
        
           //Pegando o Nome e o Id Do Cliente
             var NomeCli = "";
             var IdCli ="";
             await querySnapshot1.forEach((doc1) => {
                 NomeCli =  doc1.data().Nome;
                 IdCli = doc1.id;
                })
          
        
            //Montando o horario limite de chat
            var Horario = new Date().getTime() - (TempChat*3600000);
            console.log(Horario)
        
            //Aqui vamos ver se existe algum chat ja iniciado, pega o id e a fase de mensagem
              var IdChat = "";
              var FaMsg = "";
              var MemoriaSessao = [];
              var MemoriaPedido = {};
              var MemoriaProduto = [];
              var MemoriaSubSessao = [];
              var EstaNaRegra = true;
              var Robo = true;
              var PedidoCri ="";
              var SessaoEsta = "";
              var MemoriaSabores = 0;
              var SaboresEsco = 0;
              var RoboAtivado = true;
            
              await db.collection("ChatCliente")
                .where("Empresa", "==", EMPRESA)
                .where("Id", "==", IdCli)
                .where("Ativo", "==", true)
                .where("DataInicio", ">=", Horario)
                .get().then(async (querySnapshot2) => {

                    
                    if(querySnapshot2.size  !== 0){//Se Existe Um Chat Em Anadamento Entra Aqui 


                console.log("Existe um Chat")
                    await querySnapshot2.forEach((doc2) => {
                        IdChat = doc2.id;
                        FaMsg =doc2.data().FaseMsg;
                        EstaNaRegra = doc2.data().DigiteNaRegra;
                        MemoriaSessao = doc2.data().MemSessao;
                        MemoriaPedido = doc2.data().MemPedido;
                        MemoriaProduto = doc2.data().MemProdutos?doc2.data().MemProdutos:[]; 
                        MemoriaSubSessao = doc2.data().MemSubSessao?doc2.data().MemSubSessao:[]; 
                        Robo = doc2.data().Robotizado;
                        PedidoCri = doc2.data().Pedido;
                        SessaoEsta = doc2.data().Sessao?doc2.data().Sessao:""; 
                        MemoriaSabores = doc2.data().MenSabor?doc2.data().MenSabor:0;
                       SaboresEsco = doc2.data().EscolhaSabor?doc2.data().EscolhaSabor:0; 
                       MemoriaBairro = doc2.data().MemBairro?doc2.data().MemBairro:{};
                       RoboAtivado = doc2.data().RoboAtivo; 
                       console.log("Robo2 "+doc2.data().RoboAtivo)                      
                       })
                     console.log("Robo "+RoboAtivado)
                     if(RoboAtivado){//O Robo Esta Ativado Pelo Atendente
                                // Existe  um Chat que foi enviado a Mensagem de Apresentação de Pedido de Nome
                                                if(FaMsg === "Msg1B" ){// Recebendo o Nome do Cliente, Perguntando O que deseja realizar
                                                                    
                                                    //montar a mensagem   
                                                    var QMsg= MsgEmp.Msg2A.Msg.length;
                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                    var Result =parseInt(Sorteio);
                                                    var Num = Result-1;
                                                    var AutoMsg = MsgEmp.Msg2A.Msg[Num];
                                                    var TempMsg =  MsgEmp.Msg2A.TempoSeg;

                                                    console.log(MsgEmp.Msg2A.Msg)
                                                    console.log("Qmsg: "+QMsg)       
                                                    console.log("Soteio: "+Sorteio)                 
                                                    console.log("Msg: "+AutoMsg)


                                                    var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                    var Result2 =parseInt(Sorteio2);
                                                    var Num2 = Result2-1;
                                                    var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                    var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;

                                                    console.log(MsgEmp.Msg3A.Msg)
                                                    console.log("Qmsg: "+QMsg2)       
                                                    console.log("Soteio: "+Sorteio2)                 
                                                    console.log("Msg: "+AutoMsg2)

                                                    //mensagens de estimulo para continuar o atendimento
                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                                                    var Result3 =parseInt(Sorteio3);
                                                    var Result4 =parseInt(Sorteio4);
                                                    var Result5 =parseInt(Sorteio5);

                                                    var Num3 = Result3-1;
                                                    var Num4 = Result4-1;
                                                    var Num5 = Result5-1;
                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();


                                                    //Aqui vou ta salvando  o Nome do Cliente
                                                    await db.collection("ClienteEmpre")
                                                    .doc(IdCli)
                                                    .update({
                                                    Nome: Mensagem.body,
                                                    })
                                                    .then(async() => {

                                                    }) 

                                                    //Mudando a Fase do Chat
                                                    await db.collection("ChatCliente")
                                                    .doc(IdChat)
                                                    .update({
                                                    NomeCliente:Mensagem.body,
                                                    FaseMsg: "Msg3A",
                                                    MsgFutura1:{
                                                        Ativo:true,
                                                        Msg:AutoMsg3,
                                                        Tempo:Tempo3,
                                                    },
                                                    MsgFutura2:{
                                                        Ativo:true,
                                                        Msg:AutoMsg4,
                                                        Tempo:Tempo4,
                                                    },
                                                    MsgFutura3:{
                                                        Ativo:true,
                                                        Msg:AutoMsg5,
                                                        Tempo:Tempo5,
                                                    },
                                                    UltimaMsg:{
                                                        Autor:EMPRESA,
                                                        body:`${Mensagem.body}${AutoMsg2}`,
                                                        date:new Date().getTime()+5000,
                                                        Type: "botao"
                                                    },
                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                        Autor:IdCli,
                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                        date:new Date().getTime(),
                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                    }, 
                                                    {
                                                        Autor:EMPRESA,
                                                        body:`${Mensagem.body}${AutoMsg}`,
                                                        date:new Date().getTime()+5000,
                                                        Type:"text"
                                                    },
                                                    {
                                                        Autor:EMPRESA,
                                                        body:`${Mensagem.body}${AutoMsg2}`,
                                                        Botao:MsgEmp.Msg3A.Botao,
                                                        date:new Date().getTime()+10000,
                                                        Type:"botao"
                                                    }
                                                    
                                                    )
                                                    })
                                                    .then(async() => {
                                                        var MsgButon =`${Mensagem.body}${AutoMsg2}`
                                                        //Aqui vou está enviando uma mensagem
                                                        console.log(TempMsg)
                                                        console.log(TempMsg2)
                                                        response.json({ Inf:[{Msg:`${Mensagem.body}${AutoMsg}`, Tempo: TempMsg, Type:"text"}, {Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                        
                                                    }) 


                                                
                                                    
                                                    } else if(FaMsg === "Msg3A" ){//Recebendo o que Deseja realizar Um Pedido, Perguntando Qual Sessão
                                                        var NumIni = parseInt(Mensagem.body)
                                                        // Mensagem  que escolheu fazer o pedido
                                                        if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){

                                                            var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                            await db.collection("MenusSite")
                                                            .where("Empresa", "==", EMPRESA)
                                                            .where("Ativo", "==", true)
                                                            .get().then(async (querySnapshot23) => {
                                                                await querySnapshot23.forEach((doc23) => {

                                                                    Menus.push({
                                                                        id:doc23.id,
                                                                        body:doc23.data().nome,
                                                                        GrupTamanho:doc23.data().GrupTamanho,
                                                                        MemFim:doc23.data().MemFim,
                                                                        Tamanho:doc23.data().Tamanho,
                                                                    })
                                                                
                                                                    })

                                                            });


                                                            //montar a mensagem   
                                                        var QMsg= MsgEmp.Msg4A.Msg.length;
                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                        var Result =parseInt(Sorteio);
                                                        var Num = Result-1;
                                                        var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                        var TempMsg =  MsgEmp.Msg4A.TempoSeg;

                                                        //  console.log(MsgEmp.Msg2A.Msg)
                                                        //  console.log("Qmsg: "+QMsg)       
                                                        //  console.log("Soteio: "+Sorteio)                 
                                                        //  console.log("Msg: "+AutoMsg)


                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                        var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                        var Result2 =parseInt(Sorteio2);
                                                        var Num2 = Result2-1;
                                                        var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                        var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                        
                                                        //mensagens de estimulo para continuar o atendimento
                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                                                        var Result3 =parseInt(Sorteio3);
                                                        var Result4 =parseInt(Sorteio4);
                                                        var Result5 =parseInt(Sorteio5);

                                                        var Num3 = Result3-1;
                                                        var Num4 = Result4-1;
                                                        var Num5 = Result5-1;
                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                        var  Letras = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "X", "Z"];
                                                        var SortLet = Math.floor(Math.random() * (Letras.length - 1 + 1)) + 1;
                                                        var NumAr=SortLet-1
                                                        await db.collection("MesaItem").add({
                                                            NomeCli:NomeCli,
                                                            TelCli:TelefonCli,
                                                            Ativo:true,
                                                            Cliente:IdCli,
                                                            IdChat:IdChat,
                                                            Empresa:EMPRESA,
                                                            Codigo: Letras[NumAr]+new Date().getTime(),
                                                            Mesa:"Externo",
                                                            Itens:[],
                                                            ValorTotaL:0,
                                                            ValorEntrega:0,
                                                            ComissaaEntrega:0,
                                                            dataCriacao:new Date().getTime(),
                                                            Fechado:false,
                                                            IniciandoProducao:false,
                                                            IniciandoEntrega:false,
                                                            ConcluidoEntregado:false,
                                                            ConcluidoProducao:false,
                                                            ConfirmacaoPedido:false,
                                                            FormaDepagamento:null,
                                                            ExtratoPix:null,
                                                            End:{
                                                                Bairro:"",
                                                                Rua:"",
                                                                Numero:"",
                                                                Proximo:"",
                                                                Localizacao:{
                                                                    lat:null,
                                                                    lng:null,
                                                                }
                                                                },
                                                            TelEntregador:"",
                                                        
                                                            }).then(async (dif) => {
                                                                // Aqui ta entrando pos não esta no modo rocbo e ele não digitou errado
                                                                if(Robo === true && EstaNaRegra === true){
                                                        await db.collection("ChatCliente")
                                                        .doc(IdChat)
                                                        .update({
                                                        FaseMsg: "Msg4A",
                                                        MsgFutura1:{
                                                            Ativo:true,
                                                            Msg:AutoMsg3,
                                                            Tempo:Tempo3,
                                                        },
                                                        MsgFutura2:{
                                                            Ativo:true,
                                                            Msg:AutoMsg4,
                                                            Tempo:Tempo4,
                                                        },
                                                        MsgFutura3:{
                                                            Ativo:true,
                                                            Msg:AutoMsg5,
                                                            Tempo:Tempo5,
                                                        },
                                                        Pedido:dif.id,
                                                        MemSessao:Menus,
                                                        Reclamaçoes:null,
                                                        Localização:null,
                                                        DigiteNaRegra:true,
                                                        Robotizado:true, 
                                                        UltimaMsg:{
                                                            Autor:EMPRESA,
                                                            body:`${NomeCli}${AutoMsg}`,
                                                            date:new Date().getTime()+5000,
                                                            Type:"botao"
                                                        },
                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                            Autor:IdCli,
                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                            date:new Date().getTime(),
                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                        }, 
                                                        {
                                                            Autor:EMPRESA,
                                                            body:`${NomeCli}${AutoMsg}`,
                                                            Botao:Menus,
                                                            date:new Date().getTime()+5000,
                                                            Type:"botao"
                                                        },
                                                        
                                                        
                                                        )
                                                        })
                                                        .then(async() => {
                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                            console.log(TempMsg)
                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                    
                                                        }) 
                                                            //aqui vai entrar por que ele ele digitou errado e não está mais no modo robo 
                                                            }else {
                                                                await db.collection("ChatCliente")
                                                                .doc(IdChat)
                                                                .update({
                                                                FaseMsg: "Msg4A",
                                                                MsgFutura1:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg3,
                                                                    Tempo:Tempo3,
                                                                },
                                                                MsgFutura2:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg4,
                                                                    Tempo:Tempo4,
                                                                },
                                                                MsgFutura3:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg5,
                                                                    Tempo:Tempo5,
                                                                },
                                                                Pedido:dif.id,
                                                                MemSessao:Menus,
                                                                Reclamaçoes:null,
                                                                Localização:null,
                                                                DigiteNaRegra:true,
                                                                Robotizado:true, 
                                                                UltimaMsg:{
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                    Autor:IdCli,
                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                    date:new Date().getTime(),
                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                }, 
                                                                {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                date:new Date().getTime()+2000,
                                                                Type:"text"
                                                            },
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    Botao:Menus,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                
                                                                
                                                                )
                                                                })
                                                                .then(async() => {
                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                    console.log(TempMsg)

                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                }) 

                                                            }
                                                        //Mudando a Fase do Chat
                                                        
                                                        
                                                        
                                                            
                                                                
                                                            })

                                                        



                                                        } else if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                        // Cliente clicou em voltar 
                                                            //montar a mensagem   
                                                            var QMsg= MsgEmp.Msg2A.Msg.length;
                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                            var Result =parseInt(Sorteio);
                                                            var Num = Result-1;
                                                            var AutoMsg = MsgEmp.Msg2A.Msg[Num];
                                                            var TempMsg =  MsgEmp.Msg2A.TempoSeg;

                                                            console.log(MsgEmp.Msg2A.Msg)
                                                            console.log("Qmsg: "+QMsg)       
                                                            console.log("Soteio: "+Sorteio)                 
                                                            console.log("Msg: "+AutoMsg)


                                                            var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                            var Result2 =parseInt(Sorteio2);
                                                            var Num2 = Result2-1;
                                                            var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                            var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;

                                                            console.log(MsgEmp.Msg3A.Msg)
                                                            console.log("Qmsg: "+QMsg2)       
                                                            console.log("Soteio: "+Sorteio2)                 
                                                            console.log("Msg: "+AutoMsg2)

                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                        var Result9 =parseInt(Sorteio9);
                                                        var Num9 = Result9-1;
                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                            //mensagens de estimulo para continuar o atendimento
                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                
                                                            var Result3 =parseInt(Sorteio3);
                                                            var Result4 =parseInt(Sorteio4);
                                                            var Result5 =parseInt(Sorteio5);
                                                
                                                            var Num3 = Result3-1;
                                                            var Num4 = Result4-1;
                                                            var Num5 = Result5-1;
                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();


                                                            //Aqui vou ta salvando  o Nome do Cliente
                                                            
                                                            if(Robo === true && EstaNaRegra === true){

                                                            //Mudando a Fase do Chat
                                                            await db.collection("ChatCliente")
                                                            .doc(IdChat)
                                                            .update({
                                                            FaseMsg: "Msg3A",
                                                            DigiteNaRegra:true,
                                                            Robotizado:true, 
                                                            MsgFutura1:{
                                                                Ativo:true,
                                                                Msg:AutoMsg3,
                                                                Tempo:Tempo3,
                                                            },
                                                            MsgFutura2:{
                                                                Ativo:true,
                                                                Msg:AutoMsg4,
                                                                Tempo:Tempo4,
                                                            },
                                                            MsgFutura3:{
                                                                Ativo:true,
                                                                Msg:AutoMsg5,
                                                                Tempo:Tempo5,
                                                            },
                                                            UltimaMsg:{
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                date:new Date().getTime()+5000,
                                                                Type:"botao"
                                                            },
                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                Autor:IdCli,
                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                date:new Date().getTime(),
                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                            }, 
                                                            {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg}`,
                                                                date:new Date().getTime()+5000,
                                                                Type:"text"
                                                            },
                                                            {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                Botao:MsgEmp.Msg3A.Botao,
                                                                date:new Date().getTime()+10000,
                                                                Type:"botao"
                                                            }
                                                            
                                                            )
                                                            })
                                                            .then(async() => {
                                                                var MsgButon =`${NomeCli}${AutoMsg2}`
                                                                
                                                                console.log(TempMsg)
                                                                console.log(TempMsg2)
                                                                response.json({ Inf:[{Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                
                                                            }) 

                                                            } else {

                                                                await db.collection("ChatCliente")
                                                                .doc(IdChat)
                                                                .update({
                                                                FaseMsg: "Msg3A",
                                                                DigiteNaRegra:true,
                                                                Robotizado:true, 
                                                                MsgFutura1:{
                                                                Ativo:true,
                                                                Msg:AutoMsg3,
                                                                Tempo:Tempo3,
                                                            },
                                                            MsgFutura2:{
                                                                Ativo:true,
                                                                Msg:AutoMsg4,
                                                                Tempo:Tempo4,
                                                            },
                                                            MsgFutura3:{
                                                                Ativo:true,
                                                                Msg:AutoMsg5,
                                                                Tempo:Tempo5,
                                                            },
                                                                UltimaMsg:{
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                    Autor:IdCli,
                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                    date:new Date().getTime(),
                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                }, 
                                                                {
                                                                Autor:EMPRESA,
                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                date:new Date().getTime()+2000,
                                                                Type:"text"
                                                            },
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"text"
                                                                },
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                    Botao:MsgEmp.Msg3A.Botao,
                                                                    date:new Date().getTime()+10000,
                                                                    Type:"botao"
                                                                }
                                                            
                                                                )
                                                                })
                                                                .then(async() => {
                                                                    var MsgButon =`${NomeCli}${AutoMsg2}`
                                                                    
                                                                    console.log(TempMsg)
                                                                    console.log(TempMsg2)
                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                
                                                                }) 

                                                            }
                                                    
                                                            //Aqui vou está enviando uma mensagem

                                                        

                                                        

                                                        
                                                            
                                                            } else if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){

                                                            } else if(Mensagem.body === "3" || Mensagem.body === " 3" || Mensagem.body === "3 " || Mensagem.body === " 3 "){
                                                                
                                                            } else if(Mensagem.body === "4" || Mensagem.body === " 4" || Mensagem.body === "4 " || Mensagem.body === " 4 "){
                                                                
                                                            } else {

                                                                if(EstaNaRegra === true && Robo === true){

                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                    var Result =parseInt(Sorteio);
                                                                    var Num = Result-1;
                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                    //mensagens de estimulo para continuar o atendimento
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                    //Mudando a Fase do Chat
                                                                    
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    DigiteNaRegra:false, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    
                                                                    
                                                                    )
                                                                    })
                                                                    .then(async() => {
                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                        console.log(TempMsg)
                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                            
                                                                    }) 
                                                                } else  if(EstaNaRegra === false ){

                                                                    //mensagens de estimulo para continuar o atendimento
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                
                                                                
                                                                
                                                                
                                                                    //Mudando a Fase do Chat
                                                                    
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    Robotizado:false, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"texto"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },)
                                                                    })
                                                                    .then(async() => {
                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                        console.log(TempMsg)
                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                            
                                                                    }) 
                                                                }
                                                            }
                                                
                                                    
                                                        
                                                    


                                                    
                                                        
                                                        } else if(FaMsg === "Msg4A" ){//Recebendo a Sessão, Perguntando Qual SubSessão ou Item
                                                            var NumIni = parseInt(Mensagem.body)  
                                                            var QuantMen = MemoriaSessao.length;
                                                            console.log("Entrada "+NumIni)
                                                            console.log("Quantidade "+QuantMen)
                                                            if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                // Cliente clicou em voltar 
                                                                //montar a mensagem   
                                                                    var QMsg= MsgEmp.Msg2A.Msg.length;
                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                    var Result =parseInt(Sorteio);
                                                                    var Num = Result-1;
                                                                    var AutoMsg = MsgEmp.Msg2A.Msg[Num];
                                                                    var TempMsg =  MsgEmp.Msg2A.TempoSeg;

                                                                    console.log(MsgEmp.Msg2A.Msg)
                                                                    console.log("Qmsg: "+QMsg)       
                                                                    console.log("Soteio: "+Sorteio)                 
                                                                    console.log("Msg: "+AutoMsg)


                                                                    var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                    var Result2 =parseInt(Sorteio2);
                                                                    var Num2 = Result2-1;
                                                                    var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                    var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;

                                                                    console.log(MsgEmp.Msg3A.Msg)
                                                                    console.log("Qmsg: "+QMsg2)       
                                                                    console.log("Soteio: "+Sorteio2)                 
                                                                    console.log("Msg: "+AutoMsg2)
                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                var Result9 =parseInt(Sorteio9);
                                                                var Num9 = Result9-1;
                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;



                                                                    //Aqui Desativa o Pedido Criado 
                                                                    await db.collection("MesaItem")
                                                                    .doc(PedidoCri)
                                                                    .delete()
                                                                    .then(async() => {
                                                            
                                                                    })
                                                                    //Mensagens de estimulo 
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                
                                                                    if(Robo === true && EstaNaRegra === true){
                                                                    //Mudando a Fase do Chat
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    FaseMsg: "Msg3A",
                                                                    DigiteNaRegra:true,
                                                                    Robotizado:true, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    Pedido:null,
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"botao"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                        Botao:MsgEmp.Msg3A.Botao,
                                                                        date:new Date().getTime()+10000,
                                                                        Type:"botao"
                                                                    }
                                                                
                                                                    )
                                                                    })
                                                                    .then(async() => {
                                                                        var MsgButon =`${NomeCli}${AutoMsg2}`
                                                                        
                                                                        console.log(TempMsg)
                                                                        console.log(TempMsg2)
                                                                        response.json({ Inf:[{Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                    
                                                                    }) 
                                                                } else {
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg3A",
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        Pedido:null,
                                                                        UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"botao"
                                                                    },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                        date:new Date().getTime()+2000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                        Botao:MsgEmp.Msg3A.Botao,
                                                                        date:new Date().getTime()+10000,
                                                                        Type:"botao"
                                                                    }
                                                                    
                                                                    )
                                                                        })
                                                                        .then(async() => {
                                                                        var MsgButon =`${NomeCli}${AutoMsg2}`
                                                                        
                                                                        console.log(TempMsg)
                                                                        console.log(TempMsg2)
                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${MsgButon}*` , Botao:MsgEmp.Msg3A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                        
                                                                        }) 

                                                                }
                                                        
                                                                    //Aqui vou está enviando uma mensagem

                                                                

                                                                
                                                    
                                                                
                                                                    
                                                                    }else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                    
                                                                    console.log(MemoriaSessao[NumIni].body)
                                                                        //Escolhendo os itens da sessão escolhida
                                                                        var Menus = []
                                                                    
                                                                        if(MemoriaSessao[NumIni].Tamanho){
                                                                        Menus.push(
                                                                            {id:"3", body:"Volar Para Sessões\n===================\n"}  
                                                                        )
                                                                        for(let i in MemoriaSessao[NumIni].GrupTamanho){
                                                                                Menus.push({
                                                                                    Descont:MemoriaSessao[NumIni].GrupTamanho[i].DescontReal,
                                                                                    Nome: MemoriaSessao[NumIni].GrupTamanho[i].Tamanho,
                                                                                    Preco: MemoriaSessao[NumIni].GrupTamanho[i].PrecoReal,
                                                                                    QuantSb:MemoriaSessao[NumIni].GrupTamanho[i].Qsabor,
                                                                                    body: MemoriaSessao[NumIni].GrupTamanho[i].DescontReal?MemoriaSessao[NumIni].GrupTamanho[i].Tamanho+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].GrupTamanho[i].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].GrupTamanho[i].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].GrupTamanho[i].Tamanho+"\n"+"💰 "+MemoriaSessao[NumIni].GrupTamanho[i].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    MemFim:MemoriaSessao[NumIni].MemFim,
                                                                                })

                                                                            
                                                                            
                                                                        
                                                                        }

                                                                            //montar a mensagem   
                                                                    //  var QMsg= MsgEmp.Msg4B.Msg.length;
                                                                    //  var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                    //  var Result =parseInt(Sorteio);
                                                                    //  var Num = Result-1;
                                                                    var AutoMsg = MsgEmp.Msg4H.Msg[NumIni-1];
                                                                    var TempMsg =  MsgEmp.Msg4H.TempoSeg;
                                                            
                                                                    console.log(MsgEmp.Msg4B.Msg)
                                                                    console.log("Qmsg: "+QMsg)       
                                                                    console.log("Soteio: "+Sorteio)                 
                                                                    console.log("Msg: "+AutoMsg)

                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                    var Result9 =parseInt(Sorteio9);
                                                                    var Num9 = Result9-1;
                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                
                                                    
                                                                    //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                    //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                    //  var Result2 =parseInt(Sorteio2);
                                                                    //  var Num2 = Result2-1;
                                                                    //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                    //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                
                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                    

                                                                    //Mensagens de estimulo 
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                    
                                                                    if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        Sessao:MemoriaSessao[NumIni].body,
                                                                        FaseMsg: "Msg4H",
                                                                        MemSubSessao:Menus,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                        {
                                                                        Autor:EMPRESA,
                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}` ,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+7000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 
                                                                    } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        Sessao:MemoriaSessao[NumIni].body,
                                                                        FaseMsg: "Msg4H",
                                                                        MemSubSessao:Menus,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                        {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                        date:new Date().getTime()+2000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}` ,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+7000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 

                                                                    }

                                                                        


                                                                        }else {

                                                                        
                                                                        await db.collection("ItensDaEmpresa")
                                                                        .where("Empresa", "==", EMPRESA)
                                                                        .where("Menu", "==", MemoriaSessao[NumIni].body)
                                                                        .where("Ativo", "==", true)
                                                                        .get().then(async (querySnapshot23) => {
                                                                            Menus.push(
                                                                                {id:"3", body:"Volar Para Sessões\n===================\n"}  
                                                                            )
                                                                            await querySnapshot23.forEach((doc23) => {

                                                                                Menus.push({
                                                                                    Descont:doc23.data().DescontReal,
                                                                                    Descricao:doc23.data().Descricao,
                                                                                    Nome: doc23.data().nome,
                                                                                    Preco: doc23.data().PrecoReal,
                                                                                    Quant: doc23.data().Quant,
                                                                                    Ilimitado:doc23.data().Ilimitado,
                                                                                    foto: doc23.data().foto,
                                                                                    id: doc23.id,
                                                                                    Observacao: "",
                                                                                    body:doc23.data().Descricao ?  doc23.data().DescontReal?doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"❤️ De: "+"~"+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+doc23.data().DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"💰 "+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":doc23.data().DescontReal?doc23.data().nome+"\n"+"❤️ De: "+"~"+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+doc23.data().DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"💰 "+doc23.data().PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    SubSessao:"",
                                                                                    ItemEspeci:false,
                                                                                })
                                                                            
                                                                                })

                                                                        });
                                                                        console.log(Menus)


                                                                        //montar a mensagem   
                                                                    var QMsg= MsgEmp.Msg4B.Msg.length;
                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                    var Result =parseInt(Sorteio);
                                                                    var Num = Result-1;
                                                                    var AutoMsg = MsgEmp.Msg4B.Msg[Num];
                                                                    var TempMsg =  MsgEmp.Msg4B.TempoSeg;
                                                            
                                                                    console.log(MsgEmp.Msg4B.Msg)
                                                                    console.log("Qmsg: "+QMsg)       
                                                                    console.log("Soteio: "+Sorteio)                 
                                                                    console.log("Msg: "+AutoMsg)

                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                    var Result9 =parseInt(Sorteio9);
                                                                    var Num9 = Result9-1;
                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                
                                                    
                                                                    //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                    //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                    //  var Result2 =parseInt(Sorteio2);
                                                                    //  var Num2 = Result2-1;
                                                                    //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                    //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                
                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                    

                                                                    //Mensagens de estimulo 
                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                        
                                                                    var Result3 =parseInt(Sorteio3);
                                                                    var Result4 =parseInt(Sorteio4);
                                                                    var Result5 =parseInt(Sorteio5);
                                                        
                                                                    var Num3 = Result3-1;
                                                                    var Num4 = Result4-1;
                                                                    var Num5 = Result5-1;
                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                
                                                                    if(Robo === true && EstaNaRegra === true){
                                                                    //Mudando a Fase do Chat
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    Sessao:MemoriaSessao[NumIni].body,
                                                                    FaseMsg: "Msg4B",
                                                                    MemProdutos:Menus,
                                                                    DigiteNaRegra:true,
                                                                    Robotizado:true, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"botao"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}` ,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        Botao:Menus,
                                                                        date:new Date().getTime()+7000,
                                                                        Type:"botao"
                                                                    },
                                                                    
                                                                    
                                                                    )
                                                                    })
                                                                    .then(async() => {
                                                                        
                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                        console.log(TempMsg)
                                                                        response.json({ Inf:[{Msg: `*${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}*`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                    }) 
                                                                    } else {
                                                                        //Mudando a Fase do Chat
                                                                    await db.collection("ChatCliente")
                                                                    .doc(IdChat)
                                                                    .update({
                                                                    Sessao:MemoriaSessao[NumIni].body,
                                                                    FaseMsg: "Msg4B",
                                                                    MemProdutos:Menus,
                                                                    DigiteNaRegra:true,
                                                                    Robotizado:true, 
                                                                    MsgFutura1:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg3,
                                                                        Tempo:Tempo3,
                                                                    },
                                                                    MsgFutura2:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg4,
                                                                        Tempo:Tempo4,
                                                                    },
                                                                    MsgFutura3:{
                                                                        Ativo:true,
                                                                        Msg:AutoMsg5,
                                                                        Tempo:Tempo5,
                                                                    },
                                                                    UltimaMsg:{
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"botao"
                                                                    },
                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                        Autor:IdCli,
                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                        date:new Date().getTime(),
                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                    }, 
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                        Botao:Menus,
                                                                        date:new Date().getTime()+2000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}` ,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"text"
                                                                    },
                                                                    {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                        Botao:Menus,
                                                                        date:new Date().getTime()+5000,
                                                                        Type:"botao"
                                                                    },
                                                                    
                                                                    
                                                                    )
                                                                    })
                                                                    .then(async() => {
                                                                        
                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                        console.log(TempMsg)
                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${NomeCli}, Você Escolheu ${MemoriaSessao[NumIni].body}*`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                    }) 

                                                                    }

                                                                }
                                                                    
                                                            
                                                                
                                                                    
                                                                
                                                                    } else {

                                                                        if(EstaNaRegra === true && Robo === true){

                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                            var Result =parseInt(Sorteio);
                                                                            var Num = Result-1;
                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                            //mensagens de estimulo para continuar o atendimento
                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                
                                                                            var Result3 =parseInt(Sorteio3);
                                                                            var Result4 =parseInt(Sorteio4);
                                                                            var Result5 =parseInt(Sorteio5);
                                                                
                                                                            var Num3 = Result3-1;
                                                                            var Num4 = Result4-1;
                                                                            var Num5 = Result5-1;
                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                            //Mudando a Fase do Chat
                                                                            
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                            DigiteNaRegra:false, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },
                                                                            
                                                                            
                                                                            )
                                                                            })
                                                                            .then(async() => {
                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                console.log(TempMsg)
                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                    
                                                                            }) 
                                                                        } else  if(EstaNaRegra === false){

                                                                            //mensagens de estimulo para continuar o atendimento
                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                
                                                                            var Result3 =parseInt(Sorteio3);
                                                                            var Result4 =parseInt(Sorteio4);
                                                                            var Result5 =parseInt(Sorteio5);
                                                                
                                                                            var Num3 = Result3-1;
                                                                            var Num4 = Result4-1;
                                                                            var Num5 = Result5-1;
                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                        
                                                                        
                                                                        
                                                                        
                                                                            //Mudando a Fase do Chat
                                                                            
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                            Robotizado:false, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"texto"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },)
                                                                            })
                                                                            .then(async() => {
                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                console.log(TempMsg)
                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                    
                                                                            }) 
                                                                        }
                                                                    }

                                                        
                                                            
                                                            } else if(FaMsg === "Msg4B" ){//Recebendo o Item, Perguntando A Quantidade
                                                                var NumIni = parseInt(Mensagem.body)  
                                                                var QuantMen = MemoriaSessao.length;
                                                                console.log("Entrada "+NumIni)
                                                                console.log("Quantidade "+QuantMen)
                                                                if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                    var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                    await db.collection("MenusSite")
                                                                    .where("Empresa", "==", EMPRESA)
                                                                    .where("Ativo", "==", true)
                                                                    .get().then(async (querySnapshot23) => {
                                                                        await querySnapshot23.forEach((doc23) => {

                                                                            Menus.push({
                                                                                id:doc23.id,
                                                                                body:doc23.data().nome,
                                                                                GrupTamanho:doc23.data().GrupTamanho,
                                                                                MemFim:doc23.data().MemFim,
                                                                                Tamanho:doc23.data().Tamanho,
                                                                            })
                                                                        
                                                                            })

                                                                    });

                                                                console.log(Menus)
                                                                    //montar a mensagem   
                                                                var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                var Result =parseInt(Sorteio);
                                                                var Num = Result-1;
                                                                var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                var TempMsg =  MsgEmp.Msg4A.TempoSeg;

                                                                //  console.log(MsgEmp.Msg2A.Msg)
                                                                //  console.log("Qmsg: "+QMsg)       
                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                //  console.log("Msg: "+AutoMsg)


                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                var Result2 =parseInt(Sorteio2);
                                                                var Num2 = Result2-1;
                                                                var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                
                                                                //mensagens de estimulo para continuar o atendimento
                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                    
                                                                var Result3 =parseInt(Sorteio3);
                                                                var Result4 =parseInt(Sorteio4);
                                                                var Result5 =parseInt(Sorteio5);
                                                    
                                                                var Num3 = Result3-1;
                                                                var Num4 = Result4-1;
                                                                var Num5 = Result5-1;
                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                            
                                                                        // Robo sendo true, ele 
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                            console.log("Entreou A  QUI ")
                                                                await db.collection("ChatCliente")
                                                                .doc(IdChat)
                                                                .update({
                                                                FaseMsg: "Msg4A",
                                                                MsgFutura1:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg3,
                                                                    Tempo:Tempo3,
                                                                },
                                                                MsgFutura2:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg4,
                                                                    Tempo:Tempo4,
                                                                },
                                                                MsgFutura3:{
                                                                    Ativo:true,
                                                                    Msg:AutoMsg5,
                                                                    Tempo:Tempo5,
                                                                },
                                                                MemSessao:Menus,
                                                                Reclamaçoes:null,
                                                                Localização:null,
                                                                DigiteNaRegra:true,
                                                                Robotizado:true, 
                                                                UltimaMsg:{
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                    Autor:IdCli,
                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                    date:new Date().getTime(),
                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                }, 
                                                                {
                                                                    Autor:EMPRESA,
                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                    Botao:Menus,
                                                                    date:new Date().getTime()+5000,
                                                                    Type:"botao"
                                                                },
                                                                
                                                                
                                                                )
                                                                })
                                                                .then(async() => {
                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                    console.log(TempMsg)
                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                            
                                                                }) 
                                                                    
                                                                    }else {
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4A",
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        MemSessao:Menus,
                                                                        Reclamaçoes:null,
                                                                        Localização:null,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                        {
                                                                        Autor:EMPRESA,
                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                        date:new Date().getTime()+2000,
                                                                        Type:"text"
                                                                    },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                        
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                    
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 

                                                                    }
                                                                //Mudando a Fase do Chat
                                                                
                                                                
                                                                
                                                                    
                                                                        
                                                                
                                                
                                                                
                                                        


                                                                }else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                    
                                                                        console.log(MemoriaProduto[NumIni].id)
                                                                            //Escolhendo os itens da sessão escolhida
                                                                            var Menus = []
                                                                            var Quant = [{id:"0", body:"Voltar Para os Itens"}]; 

                                                                            console.log("Id :"+MemoriaProduto[NumIni].id)
                                                                            
                                                                            if(MemoriaProduto[NumIni].Ilimitado){
                                                                                for(var i = 1; i < 6; i++){
                                                                                    Quant.push({
                                                                                        id:i,
                                                                                        body:i+" Quantidade"
                                                                                    })
                                                                                    }

                                                                            }else {
                                                                                if(MemoriaProduto[NumIni].Quant < 6){
                                                                                    for(var i = 1; i <= MemoriaProduto[NumIni].Quant; i++){
                                                                                    Quant.push({
                                                                                        id:i,
                                                                                        body:i+" Quantidade"
                                                                                    })
                                                                                    }

                                                                                } else {
                                                                                    for(var i = 1; i < 6; i++){
                                                                                        Quant.push({
                                                                                            id:i,
                                                                                            body:i+" Quantidade"
                                                                                        })
                                                                                        }
                                                                                }

                                                                            }
                                                                        
                                                                            
                                                                        
                                                                            
                                                                        console.log(Quant)

                                                                            //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4C.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4C.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4C.TempoSeg;
                                                                
                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                        console.log("Qmsg: "+QMsg)       
                                                                        console.log("Soteio: "+Sorteio)                 
                                                                        console.log("Msg: "+AutoMsg)

                                                                        
                                                    
                                                        
                                                                        var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        var Result2 =parseInt(Sorteio2);
                                                                        var Num2 = Result2-1;
                                                                        var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                        var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                    
                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                        

                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                            var Result9 =parseInt(Sorteio9);
                                                                            var Num9 = Result9-1;
                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                                        //Mensagens de estimulo 
                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                            
                                                                        var Result3 =parseInt(Sorteio3);
                                                                        var Result4 =parseInt(Sorteio4);
                                                                        var Result5 =parseInt(Sorteio5);
                                                            
                                                                        var Num3 = Result3-1;
                                                                        var Num4 = Result4-1;
                                                                        var Num5 = Result5-1;
                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                    
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4D",
                                                                        MemPedido:{
                                                                            Nome: [MemoriaProduto[NumIni].Nome] ,
                                                                            Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                            Foto:[MemoriaProduto[NumIni].foto],
                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                            Sessao:SessaoEsta,
                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                            Quant:0,
                                                                            Observacao:"",
                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                            QuantGeral:Quant.length,
                                                                        
                                                                        },
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                            {
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}, ${AutoMsg}: ${MemoriaProduto[NumIni].Nome}`,
                                                                            Botao:[],
                                                                            date:new Date().getTime()+3000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            var MsgPedido = NomeCli+AutoMsg;
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                            if(MemoriaProduto[NumIni].Descricao){
                                                                                MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                            }
                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                            }
                                                                            
                                                                            
                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            } else {
                                                                                MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            }
                                                                                
                                                                            
                                                                                
                                                                            
                                                                            
                                                                            // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                            
                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                        }) 
                                                                        } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4D",
                                                                        MemPedido:{
                                                                            Nome: [MemoriaProduto[NumIni].Nome] ,
                                                                            Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                            Foto:[MemoriaProduto[NumIni].foto],
                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                            Sessao:SessaoEsta,
                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao,
                                                                            Quant:0,
                                                                            Observacao:"",
                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                            QuantGeral:Quant.length,
                                                                        
                                                                        },
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                            date:new Date().getTime(),
                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                        }, 
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                            Botao:[],
                                                                            date:new Date().getTime()+1000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}, ${AutoMsg}: ${MemoriaSessao[NumIni].Nome}`,
                                                                            Botao:[],
                                                                            date:new Date().getTime()+3000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                            Botao:Quant,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            var MsgPedido = NomeCli+AutoMsg;
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "🛍️"+SessaoEsta+"\n"
                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                            if(MemoriaProduto[NumIni].Descricao){
                                                                                MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                            }
                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                            }
                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            } else {
                                                                                MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                            }
                                                                                
                                                                            
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                            
                                                                            }) 

                                                                        }


                                                                        
                                                                
                                                                    
                                                                        
                                                                    
                                                                        } else {

                                                                            if(EstaNaRegra === true && Robo === true){

                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                var Result =parseInt(Sorteio);
                                                                                var Num = Result-1;
                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                //Mudando a Fase do Chat
                                                                                
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                DigiteNaRegra:false, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    console.log(TempMsg)
                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                        
                                                                                }) 
                                                                            } else  if(EstaNaRegra === false){

                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                            
                                                                            
                                                                            
                                                                            
                                                                                //Mudando a Fase do Chat
                                                                                
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                Robotizado:false, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"texto"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },)
                                                                                })
                                                                                .then(async() => {
                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    console.log(TempMsg)
                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        
                                                                                }) 
                                                                            }
                                                                        }
                                                
                                                            
                                                                
                                                                }else if(FaMsg === "Msg4D" ){//Recebendo A Quantidade, Peguntando Se Quer Retirar um Ingrediente OU Mostra nota e Pergunta o que Deseja Fazer
                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                    var QuantMen = MemoriaSessao.length;
                                                                    console.log("Entrada "+NumIni)
                                                                    console.log("Quantidade "+QuantMen)
                                                                    if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                    
                                                                        console.log(MemoriaSessao[NumIni].body)
                                                                            //Escolhendo os itens da sessão escolhida
                                                                            var Menus = MemoriaProduto;
                                                                        
                                                                        

                                                                            
                                                                        
                                                                            console.log(Menus)


                                                                            //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4B.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4B.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4B.TempoSeg;
                                                                
                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                        console.log("Qmsg: "+QMsg)       
                                                                        console.log("Soteio: "+Sorteio)                 
                                                                        console.log("Msg: "+AutoMsg)

                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                        var Result9 =parseInt(Sorteio9);
                                                                        var Num9 = Result9-1;
                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                    
                                                        
                                                                        //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                        //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        //  var Result2 =parseInt(Sorteio2);
                                                                        //  var Num2 = Result2-1;
                                                                        //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                        //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                    
                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                        

                                                                        //Mensagens de estimulo 
                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                            
                                                                        var Result3 =parseInt(Sorteio3);
                                                                        var Result4 =parseInt(Sorteio4);
                                                                        var Result5 =parseInt(Sorteio5);
                                                            
                                                                        var Num3 = Result3-1;
                                                                        var Num4 = Result4-1;
                                                                        var Num5 = Result5-1;
                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                    
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        
                                                                        FaseMsg: "Msg4B",
                                                                        MemProdutos:Menus,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+7000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 
                                                                        } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                        FaseMsg: "Msg4B",
                                                                        MemProdutos:Menus,
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+2000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            Botao:Menus,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            console.log(TempMsg)
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                        }) 

                                                                        

                                                                    }
                                                                        
                                                                
                                                                    
                                                                        
                                                                    
                                                                        } else  if(NumIni > 0 && NumIni <= MemoriaPedido.QuantGeral) {
                                                                        
                                                                        if(MemoriaPedido.MemFim){
                                                                        
                                                                            //Escolhendo os itens da sessão escolhida
                                                                            var Menus = MemoriaPedido;
                                                                            var PedidosItens = []
                                                                        
                                                                            console.log(Menus)


                                                                            //montar a mensagem   
                                                                        var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                        var Result =parseInt(Sorteio);
                                                                        var Num = Result-1;
                                                                        var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                        var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                
                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                        console.log("Qmsg: "+QMsg)       
                                                                        console.log("Soteio: "+Sorteio)                 
                                                                        console.log("Msg: "+AutoMsg)

                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                        var Result9 =parseInt(Sorteio9);
                                                                        var Num9 = Result9-1;
                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                    
                                                        
                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                        var Result2 =parseInt(Sorteio2);
                                                                        var Num2 = Result2-1;
                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                    
                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                        

                                                                        //Mensagens de estimulo 
                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                            
                                                                        var Result3 =parseInt(Sorteio3);
                                                                        var Result4 =parseInt(Sorteio4);
                                                                        var Result5 =parseInt(Sorteio5);
                                                            
                                                                        var Num3 = Result3-1;
                                                                        var Num4 = Result4-1;
                                                                        var Num5 = Result5-1;
                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                        console.log("id : "+PedidoCri)

                                                                        await db.collection("MesaItem")
                                                                        .doc(PedidoCri)
                                                                        .update({
                                                                            Itens:admin.firestore.FieldValue.arrayUnion({
                                                                                Nome:MemoriaPedido.Nome,
                                                                                Descricao:MemoriaPedido.Descricao,
                                                                                Foto:MemoriaPedido.Foto,
                                                                                Preco:MemoriaPedido.Preco,
                                                                                Descont:MemoriaPedido.Descont,
                                                                                Quant:NumIni,
                                                                                Observacao:"",
                                                                                ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                Sessao:MemoriaPedido.Sessao,
                                                                                SubSessao:MemoriaPedido.SubSessao,
                                                                                
                                                                            }) 
                                                                        }).then((doc)=>{
                                                                            //PedidosItens = doc.data().Itens;
                                                                        })

                                                                        await db.collection("MesaItem")
                                                                        .doc(PedidoCri)
                                                                        .get().then((doc)=>{
                                                                            PedidosItens = doc.data().Itens;
                                                                        })
                                                                        console.log(PedidosItens)
                                                    
                                                                        if(Robo === true && EstaNaRegra === true){
                                                                        //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                            MemSessao:[],
                                                                            MemPedido:[],
                                                                            MemProdutos:[],
                                                                            MemSubSessao:[],
                                                                            MenSabor:0,
                                                                            EscolhaSabor:0, 
                                                                            Sessao:"",
                                                                        FaseMsg: "Msg6A",
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+7000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                            date:new Date().getTime()+8000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            
                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                            var TotalValor = 0
                                                                            for(let i in PedidosItens){
                                                                                
                                                                            
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                
                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                    if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                        
                                                                                    } else {
                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                    }
                                                                                
                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                }
                                                                                
                                                                                if(PedidosItens[i].Descont){
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                } else {
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                }

                                                                            }
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                        
                                                                                
                                                                            
                                                                        
                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                        }) 
                                                                        } else {
                                                                            //Mudando a Fase do Chat
                                                                        await db.collection("ChatCliente")
                                                                        .doc(IdChat)
                                                                        .update({
                                                                            MemSessao:[],
                                                                            MemPedido:[],
                                                                            MemProdutos:[],
                                                                            MemSubSessao:[],
                                                                            MenSabor:0,
                                                                            EscolhaSabor:0, 
                                                                        FaseMsg: "Msg6A",
                                                                        DigiteNaRegra:true,
                                                                        Robotizado:true, 
                                                                        MsgFutura1:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg3,
                                                                            Tempo:Tempo3,
                                                                        },
                                                                        MsgFutura2:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg4,
                                                                            Tempo:Tempo4,
                                                                        },
                                                                        MsgFutura3:{
                                                                            Ativo:true,
                                                                            Msg:AutoMsg5,
                                                                            Tempo:Tempo5,
                                                                        },
                                                                        UltimaMsg:{
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"botao"
                                                                        },
                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                            Autor:IdCli,
                                                                            body:Mensagem.body,
                                                                            date:new Date().getTime(),
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                            date:new Date().getTime()+2000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                            date:new Date().getTime()+5000,
                                                                            Type:"text"
                                                                        },
                                                                        {
                                                                            Autor:EMPRESA,
                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                            date:new Date().getTime()+8000,
                                                                            Type:"botao"
                                                                        },
                                                                        
                                                                        
                                                                        )
                                                                        })
                                                                        .then(async() => {
                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                            var TotalValor = 0
                                                                            for(let i in PedidosItens){
                                                                                
                                                                            
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                
                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                    if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                        
                                                                                    } else {
                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                    }
                                                                                
                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                }
                                                                            
                                                                                if(PedidosItens[i].Descont){
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                } else {
                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                    if(PedidosItens[i].Observacao){
                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                    }
                                                                                }

                                                                            }
                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                
                                                                            
                                                                        
                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                            
                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                            
                                                                            
                                                                        }) 

                                                                        

                                                                    }
                                                                        
                                                                
                                                                    
                                                                        
                                                                    
                                                                        } else {
                                                                                    //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg4E.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg4E.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg4E.TempoSeg;
                                                                            
                                                                                //  console.log(MsgEmp.Msg4B.Msg)
                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                //  console.log("Msg: "+AutoMsg)

                                                                                    
                                                                
                                                                
                                                                                //  var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                //  var Num2 = Result2-1;
                                                                                //  var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                //  var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                                
                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                    var Num9 = Result9-1;
                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                                                    //Mensagens de estimulo 
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                            
                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                    //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4E",
                                                                                    MemPedido:{
                                                                                    Nome:MemoriaPedido.Nome,
                                                                                    Descricao:MemoriaPedido.Descricao,
                                                                                    Foto:MemoriaPedido.Foto,
                                                                                    Preco:MemoriaPedido.Preco,
                                                                                    Descont:MemoriaPedido.Descont,
                                                                                    Quant:NumIni,
                                                                                    Observacao:"",
                                                                                    ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                    Sessao:MemoriaPedido.Sessao,
                                                                                    SubSessao:MemoriaPedido.SubSessao,
                                                                                    
                                                                                },
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                                    {
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}, Sua quantidade foi preenchida no item ${MemoriaPedido.Nome}`,
                                                                                        Botao:[],
                                                                                        date:new Date().getTime()+3000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    Botao:MsgEmp.Msg4E.Botao,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                    var MsgPedido = NomeCli+", a Quantidade foi Escolhida e adicionada no pedido";
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        MsgPedido = MsgPedido + "🛍️ "+MemoriaPedido.Sessao+"\n"
                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome+"\n"
                                                                                        if(MemoriaPedido.Descricao){
                                                                                        MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao+"\n"
                                                                                        }
                                                                                        if(MemoriaPedido.ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+MemoriaPedido.SubSessao+"\n"
                                                                                        }
                                                                                    
                                                                                        if(MemoriaPedido.Descont){
                                                                                        MsgPedido = MsgPedido + "💰 De:"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+MemoriaPedido.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                        } else {
                                                                                        MsgPedido = MsgPedido + "💰"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                        }
                                                                                        
                                                                                        
                                                                                        
                                                                                        
                                                                                    
                                                                                    // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    
                                                                                        response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg4E.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                    }) 
                                                                                } else {
                                                                                        //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4E",
                                                                                    MemPedido:{
                                                                                    Nome:MemoriaPedido.Nome,
                                                                                    Descricao:MemoriaPedido.Descricao,
                                                                                    Foto:MemoriaPedido.Foto,
                                                                                    Preco:MemoriaPedido.Preco,
                                                                                    Descont:MemoriaPedido.Descont,
                                                                                    Quant:NumIni,
                                                                                    Observacao:"",
                                                                                    ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                    Sessao:MemoriaPedido.Sessao,
                                                                                    SubSessao:MemoriaPedido.SubSessao,
                                                                                },
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli} ${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}, Quantidade adicionada no item: ${MemoriaPedido.Nome}`,
                                                                                    Botao:[],
                                                                                    date:new Date().getTime()+3000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli} ${AutoMsg}`,
                                                                                    Botao:MsgEmp.Msg4E.Botao,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                    var MsgPedido = NomeCli+", a Quantidade foi Escolhida e adicionada no pedido";
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "🛍️ "+MemoriaPedido.Sessao+"\n"
                                                                                    MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome+"\n"
                                                                                    if(MemoriaPedido.Descricao){
                                                                                        MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao+"\n"
                                                                                        }
                                                                                    if(MemoriaPedido.ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+MemoriaPedido.SubSessao+"\n"
                                                                                        }
                                                                                    
                                                                                    if(MemoriaPedido.Descont){
                                                                                        MsgPedido = MsgPedido + "💰 De:"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+MemoriaPedido.Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                    } else {
                                                                                        MsgPedido = MsgPedido + "💰"+MemoriaPedido.Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+Mensagem.body
                                                                                    }
                                                                                        
                                                                                        
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg4E.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                    
                                                                                    }) 

                                                                                }

                                                                        }
                                                
                                                                            
                                                
                                                
                                                                            
                                                                    
                                                                        
                                                                            
                                                                        
                                                                            } else {
                                                
                                                                                if(EstaNaRegra === true && Robo === true){

                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;

                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    DigiteNaRegra:false, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                        date:new Date().getTime(),
                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                    }, 
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                            
                                                                                    }) 
                                                                                } else  if(EstaNaRegra === false ){

                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                
                                                                                
                                                                                
                                                                                
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    Robotizado:false, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"texto"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                        date:new Date().getTime(),
                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                    }, 
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"text"
                                                                                    },)
                                                                                    })
                                                                                    .then(async() => {
                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                            
                                                                                    }) 
                                                                                }
                                                                            }
                                                    
                                                                
                                                                    
                                                                     } else if(FaMsg === "Msg4E" ){//Recebendo Sim ou Não de Retirar, (Não)Enviando a Nota Com A pergunta do que quer realizar ou (Sim)Perguntar o que quer retirar
                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                        var QuantMen = MemoriaSessao.length;
                                                                        console.log("Entrada "+NumIni)
                                                                        console.log("Quantidade "+QuantMen)
                                                                        if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                        
                                                                                //Escolhendo os itens da sessão escolhida
                                                                                var Menus = MemoriaPedido;
                                                                                var PedidosItens = []
                                                                            
                                                                                console.log(Menus)
                                                
                                                
                                                                                //montar a mensagem   
                                                                            var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                            var Result =parseInt(Sorteio);
                                                                            var Num = Result-1;
                                                                            var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                            var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                    
                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                            console.log("Qmsg: "+QMsg)       
                                                                            console.log("Soteio: "+Sorteio)                 
                                                                            console.log("Msg: "+AutoMsg)

                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                            var Result9 =parseInt(Sorteio9);
                                                                            var Num9 = Result9-1;
                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                        
                                                            
                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                            var Result2 =parseInt(Sorteio2);
                                                                            var Num2 = Result2-1;
                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                        
                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                            

                                                                            //Mensagens de estimulo 
                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                
                                                                            var Result3 =parseInt(Sorteio3);
                                                                            var Result4 =parseInt(Sorteio4);
                                                                            var Result5 =parseInt(Sorteio5);
                                                                
                                                                            var Num3 = Result3-1;
                                                                            var Num4 = Result4-1;
                                                                            var Num5 = Result5-1;
                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                            console.log("id : "+PedidoCri)

                                                                            await db.collection("MesaItem")
                                                                            .doc(PedidoCri)
                                                                            .update({
                                                                                Itens:admin.firestore.FieldValue.arrayUnion(MemoriaPedido) 
                                                                            }).then((doc)=>{
                                                                                //PedidosItens = doc.data().Itens;
                                                                            })

                                                                            await db.collection("MesaItem")
                                                                            .doc(PedidoCri)
                                                                            .get().then((doc)=>{
                                                                                PedidosItens = doc.data().Itens;
                                                                            })
                                                                            console.log(PedidosItens)
                                                        
                                                                            if(Robo === true && EstaNaRegra === true){
                                                                            //Mudando a Fase do Chat
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                                MemSessao:[],
                                                                                MemPedido:[],
                                                                                MemProdutos:[],
                                                                                MemSubSessao:[],
                                                                                MenSabor:0,
                                                                                EscolhaSabor:0, 
                                                                                Sessao:"",
                                                                            FaseMsg: "Msg6A",
                                                                            DigiteNaRegra:true,
                                                                            Robotizado:true, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"botao"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                date:new Date().getTime(),
                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                            }, 
                                                                            
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+7000,
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                date:new Date().getTime()+8000,
                                                                                Type:"botao"
                                                                            },
                                                                            
                                                                            
                                                                            )
                                                                            })
                                                                            .then(async() => {
                                                                                
                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                var TotalValor = 0
                                                                                for(let i in PedidosItens){
                                                                                    
                                                                                
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                    
                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                        if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                        } else {
                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                        }
                                                                                    
                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                    }
                                                                                    
                                                                                    if(PedidosItens[i].Descont){
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    } else {
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    }

                                                                                }
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                            
                                                                                    
                                                                                
                                                                            
                                                                                response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                            }) 
                                                                            } else {
                                                                                //Mudando a Fase do Chat
                                                                            await db.collection("ChatCliente")
                                                                            .doc(IdChat)
                                                                            .update({
                                                                                MemSessao:[],
                                                                                MemPedido:[],
                                                                                MemProdutos:[],
                                                                                MemSubSessao:[],
                                                                                MenSabor:0,
                                                                                EscolhaSabor:0, 
                                                                            FaseMsg: "Msg6A",
                                                                            DigiteNaRegra:true,
                                                                            Robotizado:true, 
                                                                            MsgFutura1:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg3,
                                                                                Tempo:Tempo3,
                                                                            },
                                                                            MsgFutura2:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg4,
                                                                                Tempo:Tempo4,
                                                                            },
                                                                            MsgFutura3:{
                                                                                Ativo:true,
                                                                                Msg:AutoMsg5,
                                                                                Tempo:Tempo5,
                                                                            },
                                                                            UltimaMsg:{
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"botao"
                                                                            },
                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                Autor:IdCli,
                                                                                body:Mensagem.body,
                                                                                date:new Date().getTime(),
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                date:new Date().getTime()+2000,
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                date:new Date().getTime()+5000,
                                                                                Type:"text"
                                                                            },
                                                                            {
                                                                                Autor:EMPRESA,
                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                date:new Date().getTime()+8000,
                                                                                Type:"botao"
                                                                            },
                                                                            
                                                                            
                                                                            )
                                                                            })
                                                                            .then(async() => {
                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                var TotalValor = 0
                                                                                for(let i in PedidosItens){
                                                                                    
                                                                                
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                    
                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                        if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                        } else {
                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                        }
                                                                                    
                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                    }
                                                                                
                                                                                    if(PedidosItens[i].Descont){
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    } else {
                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        if(PedidosItens[i].Observacao){
                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                        }
                                                                                    }

                                                                                }
                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                    
                                                                                
                                                                            
                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                
                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                
                                                                                
                                                                            }) 

                                                                            
                                                
                                                                        }
                                                                            
                                                                    
                                                                        
                                                                            
                                                                        
                                                                            } else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 ") {
                                                                            
                                                                            
                                                    
                                                                                    //montar a mensagem   
                                                                                var QMsg= MsgEmp.Msg4F.Msg.length;
                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                var Result =parseInt(Sorteio);
                                                                                var Num = Result-1;
                                                                                var AutoMsg = MsgEmp.Msg4F.Msg[Num];
                                                                                var TempMsg =  MsgEmp.Msg4F.TempoSeg;
                                                                        
                                                                                //  console.log(MsgEmp.Msg4B.Msg)
                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                //  console.log("Msg: "+AutoMsg)

                                                                                
                                                            
                                                                
                                                                                //  var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                //  var Num2 = Result2-1;
                                                                                //  var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                //  var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                            
                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                    var Num9 = Result9-1;
                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;

                                                                                //Mensagens de estimulo 
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                            
                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                FaseMsg: "Msg4F",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+3000,
                                                                                    Type:"text"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                                    {
                                                                                    Autor:IdCli,
                                                                                    body:Mensagem.body,
                                                                                    date:new Date().getTime(),
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}, ${AutoMsg}`,
                                                                                    date:new Date().getTime()+3000,
                                                                                    Type:"text"
                                                                                },
                                                                                
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                
                                                                                        
                                                                                    
                                                                                        
                                                                                    
                                                                                    
                                                                                    // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                    
                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}, ${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                }) 
                                                                                } else {
                                                                                    //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                    FaseMsg: "Msg4F",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli},  ${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Mensagem.body,
                                                                                    date:new Date().getTime(),
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}, ${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                
                                                                                    
                                                                                    
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    
                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}, ${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                    
                                                                                    }) 

                                                                                }
                                                    
                                                    
                                                                                
                                                                        
                                                                            
                                                                                
                                                                            
                                                                                } else {
                                                    
                                                                                    if(EstaNaRegra === true && Robo === true){
                                                
                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                        var Result =parseInt(Sorteio);
                                                                                        var Num = Result-1;
                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                
                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                            
                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                        var Result5 =parseInt(Sorteio5);
                                                                            
                                                                                        var Num3 = Result3-1;
                                                                                        var Num4 = Result4-1;
                                                                                        var Num5 = Result5-1;
                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                        //Mudando a Fase do Chat
                                                                                        
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        DigiteNaRegra:false, 
                                                                                        MsgFutura1:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg3,
                                                                                            Tempo:Tempo3,
                                                                                        },
                                                                                        MsgFutura2:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg4,
                                                                                            Tempo:Tempo4,
                                                                                        },
                                                                                        MsgFutura3:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg5,
                                                                                            Tempo:Tempo5,
                                                                                        },
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"text"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                            date:new Date().getTime(),
                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                        }, 
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"text"
                                                                                        },
                                                                                        
                                                                                        
                                                                                        )
                                                                                        })
                                                                                        .then(async() => {
                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log(TempMsg)
                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                
                                                                                        }) 
                                                                                    } else  if(EstaNaRegra === false ){
                                                
                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                            
                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                        var Result5 =parseInt(Sorteio5);
                                                                            
                                                                                        var Num3 = Result3-1;
                                                                                        var Num4 = Result4-1;
                                                                                        var Num5 = Result5-1;
                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                        //Mudando a Fase do Chat
                                                                                        
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        Robotizado:false, 
                                                                                        MsgFutura1:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg3,
                                                                                            Tempo:Tempo3,
                                                                                        },
                                                                                        MsgFutura2:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg4,
                                                                                            Tempo:Tempo4,
                                                                                        },
                                                                                        MsgFutura3:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg5,
                                                                                            Tempo:Tempo5,
                                                                                        },
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"texto"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                            date:new Date().getTime(),
                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                        }, 
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"text"
                                                                                        },)
                                                                                        })
                                                                                        .then(async() => {
                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log(TempMsg)
                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                
                                                                                        }) 
                                                                                    }
                                                                                }
                                                        
                                                                    
                                                                        
                                                                        } else if(FaMsg === "Msg4F" ){//Recebendo o Que Quer retirar, Enviando a Nota Com A pergunta do que quer realizar
                                                                            
                                                                            var QuantMen = MemoriaSessao.length;
                                                                            console.log("Entrada "+NumIni)
                                                                            console.log("Quantidade "+QuantMen)
                                                                            
                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                    var Menus = MemoriaPedido;
                                                                                    var PedidosItens = []
                                                                                
                                                                                    console.log(Menus)
                                                    
                                                    
                                                                                    //montar a mensagem   
                                                                                var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                var Result =parseInt(Sorteio);
                                                                                var Num = Result-1;
                                                                                var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                        
                                                                                console.log(MsgEmp.Msg4B.Msg)
                                                                                console.log("Qmsg: "+QMsg)       
                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                console.log("Msg: "+AutoMsg)

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                var Result9 =parseInt(Sorteio9);
                                                                                var Num9 = Result9-1;
                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                            
                                                                
                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                var Result2 =parseInt(Sorteio2);
                                                                                var Num2 = Result2-1;
                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                            
                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                

                                                                                //Mensagens de estimulo 
                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                    
                                                                                var Result3 =parseInt(Sorteio3);
                                                                                var Result4 =parseInt(Sorteio4);
                                                                                var Result5 =parseInt(Sorteio5);
                                                                    
                                                                                var Num3 = Result3-1;
                                                                                var Num4 = Result4-1;
                                                                                var Num5 = Result5-1;
                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                console.log("id : "+PedidoCri)

                                                                                await db.collection("MesaItem")
                                                                                .doc(PedidoCri)
                                                                                .update({
                                                                                    Itens:admin.firestore.FieldValue.arrayUnion({
                                                                                        Descont: MemoriaPedido.Descont,
                                                                                        Descricao:MemoriaPedido.Descricao,
                                                                                        Foto:MemoriaPedido.Foto,
                                                                                        ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                        Nome:MemoriaPedido.Nome,
                                                                                        Observacao:Mensagem.body,
                                                                                        Preco:MemoriaPedido.Preco,
                                                                                        Quant:MemoriaPedido.Quant,
                                                                                        ItemEspeci:MemoriaPedido.ItemEspeci,
                                                                                        SubSessao:MemoriaPedido.SubSessao,
                                                                                        Sessao:MemoriaPedido.Sessao,
                                                                                    }) 
                                                                                }).then((doc)=>{
                                                                                    //PedidosItens = doc.data().Itens;
                                                                                })

                                                                                await db.collection("MesaItem")
                                                                                .doc(PedidoCri)
                                                                                .get().then((doc)=>{
                                                                                    PedidosItens = doc.data().Itens;
                                                                                })
                                                                                console.log(PedidosItens)
                                                            
                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                    MemSessao:[],
                                                                                    MemPedido:[],
                                                                                    MemProdutos:[],
                                                                                    MemSubSessao:[],
                                                                                    MenSabor:0,
                                                                                    EscolhaSabor:0, 
                                                                                FaseMsg: "Msg6A",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"botao"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+7000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                    Botao:MsgEmp.Msg6A.Botao,
                                                                                    date:new Date().getTime()+8000,
                                                                                    Type:"botao"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                    
                                                                                    var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                    var TotalValor = 0
                                                                                    for(let i in PedidosItens){
                                                                                        
                                                                                    
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                        
                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"

                                                                                            if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                            } else {
                                                                                                MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                            }
                                                                                        


                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                        }
                                                                                        if(PedidosItens[i].Descont){
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        
                                                                                        } else {
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                        
                                                                                        }

                                                                                        if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Ingredientes Tirados: "+PedidosItens[i].Observacao+"\n"
                                                                                            }

                                                                                    }
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                
                                                                                        
                                                                                    
                                                                                
                                                                                    response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                }) 
                                                                                } else {
                                                                                    //Mudando a Fase do Chat
                                                                                await db.collection("ChatCliente")
                                                                                .doc(IdChat)
                                                                                .update({
                                                                                    MemSessao:[],
                                                                                    MemPedido:[],
                                                                                    MemProdutos:[],
                                                                                    MemSubSessao:[],
                                                                                    Sessao:"",
                                                                                FaseMsg: "Msg6A",
                                                                                DigiteNaRegra:true,
                                                                                Robotizado:true, 
                                                                                MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                UltimaMsg:{
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"butao"
                                                                                },
                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                    Autor:IdCli,
                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                    date:new Date().getTime(),
                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                }, 
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                    Botao:Menus,
                                                                                    date:new Date().getTime()+2000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                    Botao:Menus,
                                                                                    date:new Date().getTime()+5000,
                                                                                    Type:"text"
                                                                                },
                                                                                {
                                                                                    Autor:EMPRESA,
                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                    Botao:MsgEmp.Msg6A.Botao,
                                                                                    date:new Date().getTime()+8000,
                                                                                    Type:"botao"
                                                                                },
                                                                                
                                                                                
                                                                                )
                                                                                })
                                                                                .then(async() => {
                                                                                    var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                    var TotalValor = 0
                                                                                    for(let i in PedidosItens){
                                                                                        
                                                                                    
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                    
                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                            if(PedidosItens[i].Descricao.length === 1 && PedidosItens[i].Descricao[0] === ""){
                                                                                            
                                                                                        } else {
                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                        }
                                                                                        
                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                        }
                                                                                        if(PedidosItens[i].Descont){
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        } else {
                                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        }

                                                                                    }
                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                    MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                        
                                                                                    
                                                                                
                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                    
                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                    
                                                                                    
                                                                                }) 

                                                                                
                                                    
                                                                            }
                                                                                
                                                                        
                                                                            
                                                                                
                                                                            
                                                                                
                                                            
                                                                        
                                                                            
                                                                            } else if(FaMsg === "Msg6A" ){//Recebendo o Que Quer Realizar após a nota do Pedido, Enviando para Sessão ou Retirada de Item ou Envio de Endereço ou Adicionado Sessão
                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                var QuantMen = MemoriaSessao.length;
                                                                                console.log("Entrada "+NumIni)
                                                                                console.log("Quantidade "+QuantMen)
                                                                                if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                
                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                        var Menus = [{id:0, body:"Voltar \n===================\n"}];
                                                                                        var PedidosItens = []
                                                                                    
                                                                                        console.log(Menus)
                                                        
                                                        
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg5A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg5A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg5A.TempoSeg;
                                                                            
                                                                                    console.log(MsgEmp.Msg5A.Msg)
                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                    console.log("Msg: "+AutoMsg)

                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                    var Num9 = Result9-1;
                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                
                                                                    
                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                
                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                    

                                                                                    //Mensagens de estimulo 
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                    console.log("id : "+PedidoCri)

                                                                                    

                                                                                    await db.collection("MesaItem")
                                                                                    .doc(PedidoCri)
                                                                                    .get().then((doc)=>{
                                                                                        
                                                                                        PedidosItens = doc.data().Itens;
                                                                                    })
                                                                                    console.log(PedidosItens)

                                                                                    
                                                                                    for(let i in PedidosItens){
                                                                                        var MsgPedido = "";     
                                                                                    
                                                                                        
                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                        
                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                            if(PedidosItens[i].Descricao){
                                                                                                MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                }
                                                                                        
                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                            }
                                                                                        
                                                                                        if(PedidosItens[i].Descont){
                                                                                            
                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        } else {
                                                                                        
                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                            if(PedidosItens[i].Observacao){
                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                            }
                                                                                        }
                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                        Menus.push(
                                                                                            {
                                                                                                id:i,
                                                                                                body:MsgPedido
                                                                                            }
                                                                                            )

                                                                                    }
                                                                
                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                    //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    MemPedido: PedidosItens,
                                                                                    FaseMsg: "Msg5A",
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+8000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        
                                                                                    
                                                                                    
                                                                                            
                                                                                        
                                                                                    
                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus, Tempo:TempMsg, Type:"butao"}] });
                                                                                    }) 
                                                                                    } else {
                                                                                        //Mudando a Fase do Chat
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                        MemPedido:PedidosItens,
                                                                                        FaseMsg: "Msg5A",
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+2000,
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                    
                                                                                            
                                                                                        
                                                                                    
                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        
                                                                                        
                                                                                    }) 

                                                                                    
                                                        
                                                                                }
                                                                                    
                                                                            
                                                                                
                                                                                    
                                                                                
                                                                                    } else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){

                                                                                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                        await db.collection("MenusSite")
                                                                                        .where("Empresa", "==", EMPRESA)
                                                                                        .where("Ativo", "==", true)
                                                                                        .get().then(async (querySnapshot23) => {
                                                                                            await querySnapshot23.forEach((doc23) => {
                                                        
                                                                                                Menus.push({
                                                                                                    id:doc23.id,
                                                                                                    body:doc23.data().nome,
                                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                                    MemFim:doc23.data().MemFim,
                                                                                                    Tamanho:doc23.data().Tamanho,
                                                                                                })
                                                                                            
                                                                                                })
                                                        
                                                                                        });
                                                        
                                                        
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                
                                                                                    //  console.log(MsgEmp.Msg2A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg)       
                                                                                    //  console.log("Soteio: "+Sorteio)                 
                                                                                    //  console.log("Msg: "+AutoMsg)
                                                                
                                                        
                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                        
                                                                                
                                                                                            // Aqui ta entrando pos não esta no modo rocbo e ele não digitou errado
                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4A",
                                                                                    MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                    MemSessao:Menus,
                                                                                    Reclamaçoes:null,
                                                                                    Localização:null,
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                
                                                                                    }) 
                                                                                        //aqui vai entrar por que ele ele digitou errado e não está mais no modo robo 
                                                                                        }else {
                                                                                            await db.collection("ChatCliente")
                                                                                            .doc(IdChat)
                                                                                            .update({
                                                                                            FaseMsg: "Msg4A",
                                                                                            MsgFutura1:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg3,
                                                                                                Tempo:Tempo3,
                                                                                            },
                                                                                            MsgFutura2:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg4,
                                                                                                Tempo:Tempo4,
                                                                                            },
                                                                                            MsgFutura3:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg5,
                                                                                                Tempo:Tempo5,
                                                                                            },
                                                                                            MemSessao:Menus,
                                                                                            Reclamaçoes:null,
                                                                                            Localização:null,
                                                                                            DigiteNaRegra:true,
                                                                                            Robotizado:true, 
                                                                                            UltimaMsg:{
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                Autor:IdCli,
                                                                                                body:Mensagem.body,
                                                                                                date:new Date().getTime(),
                                                                                                Type:"text"
                                                                                            },
                                                                                            {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                            date:new Date().getTime()+2000,
                                                                                            Type:"text"
                                                                                        },
                                                                                            {
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                Botao:Menus,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            
                                                                                            
                                                                                            )
                                                                                            })
                                                                                            .then(async() => {
                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                console.log(TempMsg)
                                                                        
                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                            }) 
                                                        
                                                                                        }
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    
                                                                                    
                                                                                        
                                                                                            
                                                                                        
                                                                    
                                                                                    
                                                                            
                                                        
                                                        
                                                                                    }  else  if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){

                                                                                       var menus = [{id:0, body:"Voltar"}]
                                                                                       for(let i in DadoEmp.BairroEntregas){
                                                                                        if(DadoEmp.BairroEntregas[i].Ativo){
                                                                                            menus.push({
                                                                                                id:i,
                                                                                                body:DadoEmp.BairroEntregas[i].Bairro,
                                                                                                Preco:DadoEmp.BairroEntregas[i].PrecoReal,
                                                                                            })
                                                                                        }
                                                                                       }
                                                                                       console.log(menus)
                                                        
                                                        
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg7E.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg7E.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg7E.TempoSeg;
                                                                
                                                                                    //  console.log(MsgEmp.Msg2A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg)       
                                                                                    //  console.log("Soteio: "+Sorteio)                 
                                                                                    //  console.log("Msg: "+AutoMsg)
                                                                
                                                        
                                                                                    //Mensagem Para Escolher o Bairro
                                                                                    var QMsg2= MsgEmp.Msg7A.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg7A.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg7A.TempoSeg;

                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                        var Num9 = Result9-1;
                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                        
                                                                                
                                                                                            // Aqui ta entrando pos não esta no modo rocbo e ele não digitou errado
                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                            FaseMsg: "Msg7E",
                                                                                                            MemBairro: menus,
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                date:new Date().getTime()+7000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}`,
                                                                                                                Botao:{},
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                Botao:menus,
                                                                                                                date:new Date().getTime()+7000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                console.log(TempMsg)
                                                                                                                response.json({ Inf:[{Msg: `${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}` , Botao:[], Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg2}*` , Botao:menus, Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        
                                                                                                            }) 
                                                                                        //aqui vai entrar por que ele ele digitou errado e não está mais no modo robo 
                                                                                                            }else {
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                                FaseMsg: "Msg7E",
                                                                                                                                MemBairro:menus,
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}`,
                                                                                                                            Botao:{},
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                            Botao:menus,
                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                            Type:"botao"
                                                                                                                        },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                            
                                                                                                        
                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg2, Type:"text"}, {Msg: `${DadoEmp.Endereco.Cidade}/${DadoEmp.Endereco.Estado}  ${AutoMsg}` , Botao:[], Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg2}*` , Botao:menus, Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                            }) 
                                                        
                                                                                        }
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    
                                                                                    
                                                                                        
                                                                                            
                                                                                        
                                                                    
                                                                                    
                                                                            
                                                        
                                                        
                                                                                    } else {
                                                            
                                                                                            if(EstaNaRegra === true && Robo === true){
                                                        
                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                var Result =parseInt(Sorteio);
                                                                                                var Num = Result-1;
                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                        
                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                    
                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                    
                                                                                                var Num3 = Result3-1;
                                                                                                var Num4 = Result4-1;
                                                                                                var Num5 = Result5-1;
                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                //Mudando a Fase do Chat
                                                                                                
                                                                                                await db.collection("ChatCliente")
                                                                                                .doc(IdChat)
                                                                                                .update({
                                                                                                DigiteNaRegra:false, 
                                                                                                MsgFutura1:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg3,
                                                                                                    Tempo:Tempo3,
                                                                                                },
                                                                                                MsgFutura2:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg4,
                                                                                                    Tempo:Tempo4,
                                                                                                },
                                                                                                MsgFutura3:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg5,
                                                                                                    Tempo:Tempo5,
                                                                                                },
                                                                                                UltimaMsg:{
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"text"
                                                                                                },
                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                    Autor:IdCli,
                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                    date:new Date().getTime(),
                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                }, 
                                                                                                {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"text"
                                                                                                },
                                                                                                
                                                                                                
                                                                                                )
                                                                                                })
                                                                                                .then(async() => {
                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                    console.log(TempMsg)
                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                        
                                                                                                }) 
                                                                                            } else  if(EstaNaRegra === false){
                                                        
                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                    
                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                    
                                                                                                var Num3 = Result3-1;
                                                                                                var Num4 = Result4-1;
                                                                                                var Num5 = Result5-1;
                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                            
                                                                                            
                                                                                            
                                                                                            
                                                                                                //Mudando a Fase do Chat
                                                                                                
                                                                                                await db.collection("ChatCliente")
                                                                                                .doc(IdChat)
                                                                                                .update({
                                                                                                Robotizado:false, 
                                                                                                MsgFutura1:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg3,
                                                                                                    Tempo:Tempo3,
                                                                                                },
                                                                                                MsgFutura2:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg4,
                                                                                                    Tempo:Tempo4,
                                                                                                },
                                                                                                MsgFutura3:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg5,
                                                                                                    Tempo:Tempo5,
                                                                                                },
                                                                                                UltimaMsg:{
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"texto"
                                                                                                },
                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                    Autor:IdCli,
                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                    date:new Date().getTime(),
                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                }, 
                                                                                                {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"text"
                                                                                                },)
                                                                                                })
                                                                                                .then(async() => {
                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                    console.log(TempMsg)
                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        
                                                                                                }) 
                                                                                            }
                                                                                        }
                                                                
                                                                            
                                                                                
                                                                                } else if(FaMsg === "Msg4H" ){//Recebendo A subSessão, Perguntando Quantos Sabor Ele deseja Adicionar, ou Caso a SubSessão só existe 1 Sabor Pergunta Qual Sabor Ele Escolhe
                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                    var QuantMen = MemoriaSubSessao.length;
                                                                                    console.log("Entrada "+NumIni)
                                                                                    console.log("Quantidade "+QuantMen)
                                                                                    if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                        await db.collection("MenusSite")
                                                                                        .where("Empresa", "==", EMPRESA)
                                                                                        .where("Ativo", "==", true)
                                                                                        .get().then(async (querySnapshot23) => {
                                                                                            await querySnapshot23.forEach((doc23) => {
                                                        
                                                                                                Menus.push({
                                                                                                    id:doc23.id,
                                                                                                    body:doc23.data().nome,
                                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                                    MemFim:doc23.data().MemFim,
                                                                                                    Tamanho:doc23.data().Tamanho,
                                                                                                })
                                                                                            
                                                                                                })
                                                        
                                                                                        });
                                                                                console.log(Menus)
                                                                                        //montar a mensagem   
                                                                                    var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                    var Result =parseInt(Sorteio);
                                                                                    var Num = Result-1;
                                                                                    var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                    var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                
                                                                                //  console.log(MsgEmp.Msg2A.Msg)
                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                //  console.log("Msg: "+AutoMsg)
                                                                

                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                    var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                    var Num2 = Result2-1;
                                                                                    var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                    var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                
                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                        
                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                    var Result5 =parseInt(Sorteio5);
                                                                        
                                                                                    var Num3 = Result3-1;
                                                                                    var Num4 = Result4-1;
                                                                                    var Num5 = Result5-1;
                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                            
                                                                                        // Robo sendo true, ele 
                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                            console.log("Entreou A  QUI ")
                                                                                    await db.collection("ChatCliente")
                                                                                    .doc(IdChat)
                                                                                    .update({
                                                                                    FaseMsg: "Msg4A",
                                                                                    MsgFutura1:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg3,
                                                                                    Tempo:Tempo3,
                                                                                },
                                                                                MsgFutura2:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg4,
                                                                                    Tempo:Tempo4,
                                                                                },
                                                                                MsgFutura3:{
                                                                                    Ativo:true,
                                                                                    Msg:AutoMsg5,
                                                                                    Tempo:Tempo5,
                                                                                },
                                                                                    MemSessao:Menus,
                                                                                    Reclamaçoes:null,
                                                                                    Localização:null,
                                                                                    DigiteNaRegra:true,
                                                                                    Robotizado:true, 
                                                                                    UltimaMsg:{
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                        Autor:IdCli,
                                                                                        body:Mensagem.body,
                                                                                        date:new Date().getTime(),
                                                                                        Type:"text"
                                                                                    },
                                                                                    {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                        Botao:Menus,
                                                                                        date:new Date().getTime()+5000,
                                                                                        Type:"botao"
                                                                                    },
                                                                                    
                                                                                    
                                                                                    )
                                                                                    })
                                                                                    .then(async() => {
                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                        console.log("Entreou A  QUI ")
                                                                                        console.log(TempMsg)
                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                            
                                                                                    }) 
                                                                                    
                                                                                    }else {
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        FaseMsg: "Msg4A",
                                                                                        MsgFutura1:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg3,
                                                                                            Tempo:Tempo3,
                                                                                        },
                                                                                        MsgFutura2:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg4,
                                                                                            Tempo:Tempo4,
                                                                                        },
                                                                                        MsgFutura3:{
                                                                                            Ativo:true,
                                                                                            Msg:AutoMsg5,
                                                                                            Tempo:Tempo5,
                                                                                        },
                                                                                        MemSessao:Menus,
                                                                                        Reclamaçoes:null,
                                                                                        Localização:null,
                                                                                        DigiteNaRegra:true,
                                                                                        Robotizado:true, 
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Mensagem.body,
                                                                                            date:new Date().getTime(),
                                                                                            Type:"text"
                                                                                        },
                                                                                        {
                                                                                        Autor:EMPRESA,
                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                        date:new Date().getTime()+2000,
                                                                                        Type:"text"
                                                                                    },
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            Botao:Menus,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        
                                                                                        
                                                                                        )
                                                                                        })
                                                                                        .then(async() => {
                                                                                        
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log(TempMsg)
                                                                    
                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        }) 

                                                                                    }
                                                                                    //Mudando a Fase do Chat
                                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                        
                                                                                    
                                                                    
                                                                                
                                                                        


                                                                                } else  if(NumIni > 0 && NumIni < QuantMen) {

                                                                                                            
                                                                                                            console.log(MemoriaSubSessao[NumIni].Nome)
                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                var Menus = []
                                                                                                                var Sabor = [{id:"0", body:"Voltar para Sessões"}]
                                                                                                                for(var i = 0; i < MemoriaSubSessao[NumIni].QuantSb; i++){
                                                                                                                Sabor.push({
                                                                                                                    id:i+1,
                                                                                                                    body:`${i+1} Sabor`
                                                                                                                })
                                                                                                                }
                                                        
                                                                                                            
                                                                                                                await db.collection("ItensDaEmpresa")
                                                                                                                .where("Empresa", "==", EMPRESA)
                                                                                                                .where("Menu", "==", SessaoEsta)
                                                                                                                .where("Ativo", "==", true)
                                                                                                                .get().then(async (querySnapshot23) => {
                                                                                                                    Menus.push(
                                                                                                                        {id:"3", body:"Volar Para Sessões\n===================\n"}  
                                                                                                                    )
                                                                                                                    await querySnapshot23.forEach((doc23) => {
                                                                                                                    for(let i in doc23.data().GrupTamanho){
                                                                                                                        if(MemoriaSubSessao[NumIni].Nome === doc23.data().GrupTamanho[i].select ){
                                                                                                                            Menus.push({
                                                                                                                                Descont:MemoriaSubSessao[NumIni].Descont,
                                                                                                                                Descricao:doc23.data().Descricao,
                                                                                                                                Nome: doc23.data().nome,
                                                                                                                                Preco: MemoriaSubSessao[NumIni].Preco,
                                                                                                                                SubSessao: MemoriaSubSessao[NumIni].Nome,
                                                                                                                                Quant: doc23.data().GrupTamanho[i].Quantidade,
                                                                                                                                Ilimitado: doc23.data().Ilimitado,
                                                                                                                                foto: doc23.data().foto,
                                                                                                                                id: doc23.id,
                                                                                                                                Observacao: "",
                                                                                                                                body:doc23.data().Descricao ?  MemoriaSubSessao[NumIni].Descont?doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"❤️ De: "+"~"+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSubSessao[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"📝"+doc23.data().Descricao+"\n"+"💰 "+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSubSessao[NumIni].Descont?doc23.data().nome+"\n"+"❤️ De: "+"~"+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSubSessao[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    doc23.data().nome+"\n"+"💰 "+MemoriaSubSessao[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                                                                ItemEspeci:true,
                                                                                                                                MemFim:MemoriaSubSessao[NumIni].MemFim,
                                                                                                                            })
                                                
                                                                                                                        }

                                                                                                                    }
                                                                                                                
                                                                                                                    // MemPedido:{
                                                                                                                    //     Nome:MemoriaPedido.Nome,
                                                                                                                    //     Descricao:MemoriaPedido.Descricao,
                                                                                                                    //     Foto:MemoriaPedido.Foto,
                                                                                                                    //     Preco:MemoriaPedido.Preco,
                                                                                                                    //     Descont:MemoriaPedido.Descont,
                                                                                                                    //     Quant:NumIni,
                                                                                                                    //     Observacao:"",
                                                                                                                    //     ItemEspeci:false,
                                                                                                                        
                                                                                                                    // },
                                                                                                                    
                                                                                                                    })
                                                                                
                                                                                                                });
                                                                                                                console.log(Menus)
                                                                                
                                                                                
                                                                                                                //montar a mensagem   
                                                                                                            var QMsg= MsgEmp.Msg4J.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg4J.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg4J.TempoSeg;

                                                                                                            var QMsg2= MsgEmp.Msg4I.Msg.length;
                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                            var Num2 = Result2-1;
                                                                                                            var AutoMsg2 = MsgEmp.Msg4I.Msg[Num2];
                                                                                                            var TempMsg2 =  MsgEmp.Msg4I.TempoSeg;
                                                                                                    
                                                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                            console.log("Msg: "+AutoMsg)
                                                                    
                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                            var Num9 = Result9-1;
                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                        
                                                                                        
                                                                                                            //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                            //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            //  var Result2 =parseInt(Sorteio2);
                                                                                                            //  var Num2 = Result2-1;
                                                                                                            //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                            //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                        
                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                            
                                                                    
                                                                                                            //Mensagens de estimulo 
                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                
                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                
                                                                                                            var Num3 = Result3-1;
                                                                                                            var Num4 = Result4-1;
                                                                                                            var Num5 = Result5-1;
                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            //vendo se só tem um sabor 
                                                                                                            if(MemoriaSubSessao[NumIni].QuantSb > 1) {
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4J",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        Botao:Sabor,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}, Nesse Tamanho Você Tem direito de Escolher Até ${MemoriaSubSessao[NumIni].QuantSb} Sabores`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, ${AutoMsg}*` , Botao:Sabor , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4J",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        Botao:Sabor,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}*`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, ${AutoMsg}` , Botao:Sabor , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                            
                                                                                                                    }

                                                                                                            } else {
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4I",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                                        Botao:Menus,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${AutoMsg2}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg4I",
                                                                                                                    MemProdutos:Menus,
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        Botao:Menus,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}` ,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        Botao:Menus,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"botao"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${MemoriaSubSessao[NumIni].Nome}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${AutoMsg2}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    }) 
                                                                            
                                                                                                                    }

                                                                                                            }


                                                                                                        
                                                                                
                                                                                                        
                                                                                                            
                                                                                                    
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            } else {
                                                                                
                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                            
                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                            
                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    DigiteNaRegra:false, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                    }, 
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                            
                                                                                                                    }) 
                                                                                                                } else  if(EstaNaRegra === false ){
                                                                            
                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                
                                                                                                                
                                                                                                                
                                                                                                                
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    Robotizado:false, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"texto"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                    }, 
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },)
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        console.log(TempMsg)
                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                            
                                                                                                                    }) 
                                                                                                                }
                                                                                                            }
                                                                                    
                                                                                                
                                                                                                    
                                                                                    } else if(FaMsg === "Msg4J" ){//Recebendo a resposta de Quantos Sabores Ele Quer, Perguntando Qual o Sabor Que Ele Quer
                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                        var QuantMen = MemoriaSubSessao.length;
                                                                                        console.log("Entrada "+NumIni)
                                                                                        console.log("Quantidade "+QuantMen)
                                                                                            if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                                            var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                            await db.collection("MenusSite")
                                                                                            .where("Empresa", "==", EMPRESA)
                                                                                            .where("Ativo", "==", true)
                                                                                            .get().then(async (querySnapshot23) => {
                                                                                                await querySnapshot23.forEach((doc23) => {
                                                            
                                                                                                    Menus.push({
                                                                                                        id:doc23.id,
                                                                                                        body:doc23.data().nome,
                                                                                                        GrupTamanho:doc23.data().GrupTamanho,
                                                                                                        MemFim:doc23.data().MemFim,
                                                                                                        Tamanho:doc23.data().Tamanho,
                                                                                                    })
                                                                                                    
                                                                                                    })
                                                            
                                                                                            });
                                                                                    console.log(Menus)
                                                                                            //montar a mensagem   
                                                                                        var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                        var Result =parseInt(Sorteio);
                                                                                        var Num = Result-1;
                                                                                        var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                        var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                    
                                                                                    //  console.log(MsgEmp.Msg2A.Msg)
                                                                                    //  console.log("Qmsg: "+QMsg)       
                                                                                    //  console.log("Soteio: "+Sorteio)                 
                                                                                    //  console.log("Msg: "+AutoMsg)
                                                                    

                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                        var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                        var Num2 = Result2-1;
                                                                                        var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                        var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                            
                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                        var Result5 =parseInt(Sorteio5);
                                                                            
                                                                                        var Num3 = Result3-1;
                                                                                        var Num4 = Result4-1;
                                                                                        var Num5 = Result5-1;
                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                                
                                                                                            // Robo sendo true, ele 
                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                console.log("Entreou A  QUI ")
                                                                                        await db.collection("ChatCliente")
                                                                                        .doc(IdChat)
                                                                                        .update({
                                                                                        FaseMsg: "Msg4A",
                                                                                        MsgFutura1:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg3,
                                                                                        Tempo:Tempo3,
                                                                                    },
                                                                                    MsgFutura2:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg4,
                                                                                        Tempo:Tempo4,
                                                                                    },
                                                                                    MsgFutura3:{
                                                                                        Ativo:true,
                                                                                        Msg:AutoMsg5,
                                                                                        Tempo:Tempo5,
                                                                                    },
                                                                                        MemSessao:Menus,
                                                                                        Reclamaçoes:null,
                                                                                        Localização:null,
                                                                                        DigiteNaRegra:true,
                                                                                        Robotizado:true, 
                                                                                        UltimaMsg:{
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                            Autor:IdCli,
                                                                                            body:Mensagem.body,
                                                                                            date:new Date().getTime(),
                                                                                            Type:"text"
                                                                                        },
                                                                                        {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                            Botao:Menus,
                                                                                            date:new Date().getTime()+5000,
                                                                                            Type:"botao"
                                                                                        },
                                                                                        
                                                                                        
                                                                                        )
                                                                                        })
                                                                                        .then(async() => {
                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                            console.log("Entreou A  QUI ")
                                                                                            console.log(TempMsg)
                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                
                                                                                        }) 
                                                                                        
                                                                                        }else {
                                                                                            await db.collection("ChatCliente")
                                                                                            .doc(IdChat)
                                                                                            .update({
                                                                                            FaseMsg: "Msg4A",
                                                                                            MsgFutura1:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg3,
                                                                                                Tempo:Tempo3,
                                                                                            },
                                                                                            MsgFutura2:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg4,
                                                                                                Tempo:Tempo4,
                                                                                            },
                                                                                            MsgFutura3:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg5,
                                                                                                Tempo:Tempo5,
                                                                                            },
                                                                                            MemSessao:Menus,
                                                                                            Reclamaçoes:null,
                                                                                            Localização:null,
                                                                                            DigiteNaRegra:true,
                                                                                            Robotizado:true, 
                                                                                            UltimaMsg:{
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                Autor:IdCli,
                                                                                                body:Mensagem.body,
                                                                                                date:new Date().getTime(),
                                                                                                Type:"text"
                                                                                            },
                                                                                            {
                                                                                            Autor:EMPRESA,
                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                            date:new Date().getTime()+2000,
                                                                                            Type:"text"
                                                                                        },
                                                                                            {
                                                                                                Autor:EMPRESA,
                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                Botao:Menus,
                                                                                                date:new Date().getTime()+5000,
                                                                                                Type:"botao"
                                                                                            },
                                                                                            
                                                                                            
                                                                                            )
                                                                                            })
                                                                                            .then(async() => {
                                                                                            
                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                console.log(TempMsg)
                                                                        
                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                            }) 

                                                                                        }
                                                                                        //Mudando a Fase do Chat
                                                                                        
                                                                                        
                                                                                        
                                                                                        
                                                                                            
                                                                                        
                                                                        
                                                                                    
                                                                            


                                                                                    } else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                                        
                                                                                                            
                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                    var Menus = MemoriaProduto
                                                                                                                    var Sabor = [{id:"0", body:"Voltar para Sessão"}]
                                                                                                                
                                                                                                                    
                                                                                    
                                                                                                                    
                                                                                                                    console.log(Menus)
                                                                                    
                                                                                    
                                                                                                                    //montar a mensagem   
                                                                                                                var QMsg= MsgEmp.Msg4L.Msg.length;
                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                var Num = Result-1;
                                                                                                                var AutoMsg = MsgEmp.Msg4L.Msg[Num];
                                                                                                                var TempMsg =  MsgEmp.Msg4L.TempoSeg;

                                                                                                                //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                                                //  var Num2 = Result2-1;
                                                                                                                //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                                //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                                        
                                                                                                                
                                                                        
                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                var Num9 = Result9-1;
                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                            
                                                                                                                //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                                //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                //  var Result2 =parseInt(Sorteio2);
                                                                                                                //  var Num2 = Result2-1;
                                                                                                                //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                                //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                            
                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                
                                                                        
                                                                                                                //Mensagens de estimulo 
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                            
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg4L",
                                                                                                                MenSabor: NumIni,
                                                                                                                EscolhaSabor:0,   
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body: `${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body: `${NomeCli}, Escolha o 1° ${AutoMsg}`,
                                                                                                                    Botao:Menus,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    console.log(TempMsg)
                                                                                                                    response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o 1° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                }) 
                                                                                                                } else {
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg4L",
                                                                                                                MenSabor: NumIni,
                                                                                                                EscolhaSabor:0, 
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                    Botao:Menus,
                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}, Escolha o 1° ${AutoMsg}`,
                                                                                                                    Botao:Menus,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    console.log(TempMsg)
                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"es":""}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o 1° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                }) 
                                                                        
                                                                                                                }
                                                                                    
                                                                                                            
                                                                                                                
                                                                                                        
                                                                                                            
                                                                                                                
                                                                                                            
                                                                                                                } else {
                                                                                    
                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                
                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                        var Num = Result-1;
                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        DigiteNaRegra:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        Robotizado:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"texto"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },)
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    }
                                                                                                                }
                                                                                        
                                                                                                    
                                                                                                        
                                                                                        } else if(FaMsg === "Msg4I" ){//Receber o Sabor da SubSessão que só tem Um sabor, e Perguntando a Quantidade
                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                            var QuantMen = MemoriaSessao.length;
                                                                                            console.log("Entrada "+NumIni)
                                                                                            console.log("Quantidade "+QuantMen)
                                                                                                if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                        
                                                                                                var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                                await db.collection("MenusSite")
                                                                                                .where("Empresa", "==", EMPRESA)
                                                                                                .where("Ativo", "==", true)
                                                                                                .get().then(async (querySnapshot23) => {
                                                                                                    await querySnapshot23.forEach((doc23) => {
                                                                
                                                                                                        Menus.push({
                                                                                                                id:doc23.id,
                                                                                                            body:doc23.data().nome,
                                                                                                            GrupTamanho:doc23.data().GrupTamanho,
                                                                                                            MemFim:doc23.data().MemFim,
                                                                                                            Tamanho:doc23.data().Tamanho,
                                                                                                        })
                                                                                                        
                                                                                                        })
                                                                
                                                                                                });
                                                                
                                                                                            console.log(Menus)
                                                                                                    //montar a mensagem   
                                                                                                var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                var Result =parseInt(Sorteio);
                                                                                                var Num = Result-1;
                                                                                                var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                                var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                            
                                                                                            //  console.log(MsgEmp.Msg2A.Msg)
                                                                                            //  console.log("Qmsg: "+QMsg)       
                                                                                            //  console.log("Soteio: "+Sorteio)                 
                                                                                            //  console.log("Msg: "+AutoMsg)
                                                                            
                                                                
                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                var Num2 = Result2-1;
                                                                                                var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                                var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                    
                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                    
                                                                                                var Num3 = Result3-1;
                                                                                                var Num4 = Result4-1;
                                                                                                var Num5 = Result5-1;
                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                
                                                                                        
                                                                                                    // Robo sendo true, ele 
                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                        console.log("Entreou A  QUI ")
                                                                                                await db.collection("ChatCliente")
                                                                                                .doc(IdChat)
                                                                                                .update({
                                                                                                FaseMsg: "Msg4A",
                                                                                                MsgFutura1:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg3,
                                                                                                Tempo:Tempo3,
                                                                                            },
                                                                                            MsgFutura2:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg4,
                                                                                                Tempo:Tempo4,
                                                                                            },
                                                                                            MsgFutura3:{
                                                                                                Ativo:true,
                                                                                                Msg:AutoMsg5,
                                                                                                Tempo:Tempo5,
                                                                                            },
                                                                                                MemSessao:Menus,
                                                                                                Reclamaçoes:null,
                                                                                                Localização:null,
                                                                                                DigiteNaRegra:true,
                                                                                                Robotizado:true, 
                                                                                                UltimaMsg:{
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"botao"
                                                                                                },
                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                    Autor:IdCli,
                                                                                                    body:Mensagem.body,
                                                                                                    date:new Date().getTime(),
                                                                                                    Type:"text"
                                                                                                },
                                                                                                {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                    Botao:Menus,
                                                                                                    date:new Date().getTime()+5000,
                                                                                                    Type:"botao"
                                                                                                },
                                                                                                
                                                                                                
                                                                                                )
                                                                                                })
                                                                                                .then(async() => {
                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                    console.log("Entreou A  QUI ")
                                                                                                    console.log(TempMsg)
                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                        
                                                                                                }) 
                                                                                                
                                                                                                }else {
                                                                                                    await db.collection("ChatCliente")
                                                                                                    .doc(IdChat)
                                                                                                    .update({
                                                                                                    FaseMsg: "Msg4A",
                                                                                                    MsgFutura1:{
                                                                                                        Ativo:true,
                                                                                                        Msg:AutoMsg3,
                                                                                                        Tempo:Tempo3,
                                                                                                    },
                                                                                                    MsgFutura2:{
                                                                                                        Ativo:true,
                                                                                                        Msg:AutoMsg4,
                                                                                                        Tempo:Tempo4,
                                                                                                    },
                                                                                                    MsgFutura3:{
                                                                                                        Ativo:true,
                                                                                                        Msg:AutoMsg5,
                                                                                                        Tempo:Tempo5,
                                                                                                    },
                                                                                                    MemSessao:Menus,
                                                                                                    Reclamaçoes:null,
                                                                                                    Localização:null,
                                                                                                    DigiteNaRegra:true,
                                                                                                    Robotizado:true, 
                                                                                                    UltimaMsg:{
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                        Autor:IdCli,
                                                                                                        body:Mensagem.body,
                                                                                                        date:new Date().getTime(),
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                    {
                                                                                                    Autor:EMPRESA,
                                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                                    date:new Date().getTime()+2000,
                                                                                                    Type:"text"
                                                                                                },
                                                                                                    {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    
                                                                                                    
                                                                                                    )
                                                                                                    })
                                                                                                    .then(async() => {
                                                                                                    
                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                        console.log(TempMsg)
                                                                                
                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                    }) 
                                                                
                                                                                                }
                                                                                                //Mudando a Fase do Chat
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                    
                                                                                                
                                                                                
                                                                                            
                                                                                    
                                                                
                                                                
                                                                                            }else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                                                
                                                                                                    console.log(MemoriaProduto[NumIni].id)
                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                        var Menus = []
                                                                                                        var Quant = [{id:"0", body:"Voltar Para os Itens"}]; 
                                                        
                                                                                                        console.log("Id :"+MemoriaProduto[NumIni].id)
                                                                                                        
                                                                                                        if(MemoriaProduto[NumIni].Ilimitado){
                                                                                                            for(var i = 1; i < 11; i++){
                                                                                                                Quant.push({
                                                                                                                    id:i,
                                                                                                                    body:i+" Quantidade"
                                                                                                                })
                                                                                                                }
                                                        
                                                                                                        }else {
                                                                                                            if(MemoriaProduto[NumIni].Quant < 11){
                                                                                                                for(var i = 1; i <= MemoriaProduto[NumIni].Quant; i++){
                                                                                                                    Quant.push({
                                                                                                                    id:i,
                                                                                                                    body:i+" Quantidade"
                                                                                                                    })
                                                                                                                }
                                                            
                                                                                                            } else {
                                                                                                                for(var i = 1; i < 11; i++){
                                                                                                                    Quant.push({
                                                                                                                        id:i,
                                                                                                                        body:i+" Quantidade"
                                                                                                                    })
                                                                                                                    }
                                                                                                            }
                                                        
                                                                                                        }
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                        
                                                                                                    console.log(Quant)
                                                                        
                                                                                                            //montar a mensagem   
                                                                                                        var QMsg= MsgEmp.Msg4C.Msg.length;
                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                        var Result =parseInt(Sorteio);
                                                                                                        var Num = Result-1;
                                                                                                        var AutoMsg = MsgEmp.Msg4C.Msg[Num];
                                                                                                        var TempMsg =  MsgEmp.Msg4C.TempoSeg;
                                                                                                
                                                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                        console.log("Msg: "+AutoMsg)
                                                            
                                                                                                        
                                                                                    
                                                                                    
                                                                                                        var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                        var Num2 = Result2-1;
                                                                                                        var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                                        var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                                                    
                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                    
                                                        
                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                        var Num9 = Result9-1;
                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                            
                                                                                                        //Mensagens de estimulo 
                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                            
                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                            
                                                                                                        var Num3 = Result3-1;
                                                                                                        var Num4 = Result4-1;
                                                                                                        var Num5 = Result5-1;
                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                
                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                        //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                        FaseMsg: "Msg4D",
                                                                                                        MemPedido:{
                                                                                                        Nome:[MemoriaProduto[NumIni].Nome],
                                                                                                        Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                                                        Foto:[MemoriaProduto[NumIni].foto],
                                                                                                        Preco:MemoriaProduto[NumIni].Preco,
                                                                                                        Descont:MemoriaProduto[NumIni].Descont,
                                                                                                        SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                        Quant:0,
                                                                                                        Observacao:"",
                                                                                                        ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                        QuantGeral:Quant.length,
                                                                                                        Sessao:SessaoEsta,
                                                                                                        MemFim:MemoriaProduto[NumIni].MemFim,
                                                                                                    
                                                                                                    },
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            Botao:Quant,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion(
                                                                                                        {
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}, ${AutoMsg}: ${MemoriaProduto[NumIni].Nome}`,
                                                                                                            Botao:[],
                                                                                                            date:new Date().getTime()+3000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"                                                                              
                                                                                                            
                                                                                                                if( MemoriaProduto[NumIni].Descricao === ""){
                                                                                            
                                                                                                                } else {
                                                                                                                    MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                }

                                                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                            }
                                                                                                        
                                                                                                        
                                                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                                            MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            } else {
                                                                                                            MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            }
                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                        
                                                                                                        // MemoriaSessao[NumIni].Descricao ?  MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :   MemoriaSessao[NumIni].nome+"\n"+"📝"+MemoriaSessao[NumIni].Descricao+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n":MemoriaSessao[NumIni].DescontReal?MemoriaSessao[NumIni].nome+"\n"+"❤️ De: "+"~"+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"~"+" Por "+MemoriaSessao[NumIni].DescontReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n"  :    MemoriaSessao[NumIni].nome+"\n"+"💰 "+MemoriaSessao[NumIni].PrecoReal.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"+"===================\n" ,
                                                                                                        
                                                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        }) 
                                                                                                    } else {
                                                                                                            //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                    FaseMsg: "Msg4D",
                                                                                                    MemPedido:{
                                                                                                        Nome:[MemoriaProduto[NumIni].Nome],
                                                                                                        Descricao:[MemoriaProduto[NumIni].Descricao],
                                                                                                        Foto:[MemoriaProduto[NumIni].foto],
                                                                                                        Preco:MemoriaProduto[NumIni].Preco,
                                                                                                        Descont:MemoriaProduto[NumIni].Descont,
                                                                                                        SubSessao:MemoriaProduto[NumIni].SubSessao,
                                                                                                        Quant:0,
                                                                                                        Observacao:"",
                                                                                                        ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                        QuantGeral:Quant.length,
                                                                                                        Sessao:SessaoEsta,
                                                                                                        MemFim:MemoriaProduto[NumIni].MemFim,
                                                                                                    },
                                                                                                    DigiteNaRegra:true,
                                                                                                    Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli} ${AutoMsg2}`,
                                                                                                            Botao:Quant,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                        Botao:[],
                                                                                                        date:new Date().getTime()+1000,
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}, ${AutoMsg}: ${MemoriaSessao[NumIni].Nome}`,
                                                                                                        Botao:[],
                                                                                                        date:new Date().getTime()+3000,
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                    {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli} ${AutoMsg2}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"

                                                                                                            if( MemoriaProduto[NumIni].Descricao === ""){
                                                                                            
                                                                                                            } else {
                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                            }

                                                                                                            if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                            }
                                                                                                        
                                                                                                            if(MemoriaProduto[NumIni].Descont){
                                                                                                            MsgPedido = MsgPedido + "💰 De:"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+MemoriaProduto[NumIni].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            } else {
                                                                                                            MsgPedido = MsgPedido + "💰"+MemoriaProduto[NumIni].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                            }
                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                            console.log(TempMsg)
                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        
                                                                                                        }) 
                                                            
                                                                                                    }
                                                                        
                                                                        
                                                                                                    
                                                                                                
                                                                                                
                                                                                                    
                                                                                                    
                                                                                                    } else {
                                                                            
                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                    
                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                    
                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                //Mudando a Fase do Chat
                                                                                                            
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                            DigiteNaRegra:false, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                                UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                }, 
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                console.log(TempMsg)
                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                        
                                                                                                                }) 
                                                                                                        } else  if(EstaNaRegra === false ){
                                                                    
                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            
                                                                                                                //Mudando a Fase do Chat
                                                                                                            
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                            Robotizado:false, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"texto"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                            }, 
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },)
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                console.log(TempMsg)
                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                        
                                                                                                                }) 
                                                                                                        }
                                                                                                        }
                                                                                
                                                                                            
                                                                                                
                                                                                                } else if(FaMsg === "Msg4L" ){//Recebendo o Sabor, Perguntando o Novo Sabor ou Enviando A Quantidade Qu Ele Quer Escolher
                                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                                    var QuantMen = MemoriaSubSessao.length;
                                                                                                    console.log("Entrada "+NumIni)
                                                                                                    console.log("Quantidade "+QuantMen)
                                                                                                        if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){

                                                                                                        var Menus = [{id:"0", body:"Voltar Para o Início"}]
                                                                                                        await db.collection("MenusSite")
                                                                                                        .where("Empresa", "==", EMPRESA)
                                                                                                        .where("Ativo", "==", true)
                                                                                                        .get().then(async (querySnapshot23) => {
                                                                                                            await querySnapshot23.forEach((doc23) => {
                                                                        
                                                                                                                Menus.push({
                                                                                                                    id:doc23.id,
                                                                                                                    body:doc23.data().nome,
                                                                                                                    GrupTamanho:doc23.data().GrupTamanho,
                                                                                                                    MemFim:doc23.data().MemFim,
                                                                                                                    Tamanho:doc23.data().Tamanho,
                                                                                                                })
                                                                                                                
                                                                                                                })
                                                                        
                                                                                                        });
                                                                                                console.log(Menus)
                                                                                                        //montar a mensagem   
                                                                                                    var QMsg= MsgEmp.Msg4A.Msg.length;
                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                    var Result =parseInt(Sorteio);
                                                                                                    var Num = Result-1;
                                                                                                    var AutoMsg = MsgEmp.Msg4A.Msg[Num];
                                                                                                    var TempMsg =  MsgEmp.Msg4A.TempoSeg;
                                                                                
                                                                                                //  console.log(MsgEmp.Msg2A.Msg)
                                                                                                //  console.log("Qmsg: "+QMsg)       
                                                                                                //  console.log("Soteio: "+Sorteio)                 
                                                                                                //  console.log("Msg: "+AutoMsg)
                                                                                

                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                    var QMsg2= MsgEmp.Msg16B.Msg.length;
                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                    var Num2 = Result2-1;
                                                                                                    var AutoMsg2 = MsgEmp.Msg16B.Msg[Num2];
                                                                                                    var TempMsg2 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                        
                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                        
                                                                                                    var Num3 = Result3-1;
                                                                                                    var Num4 = Result4-1;
                                                                                                    var Num5 = Result5-1;
                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                                            
                                                                                                        // Robo sendo true, ele 
                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                            
                                                                                                    await db.collection("ChatCliente")
                                                                                                    .doc(IdChat)
                                                                                                    .update({
                                                                                                    FaseMsg: "Msg4A",
                                                                                                    MsgFutura1:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg3,
                                                                                                    Tempo:Tempo3,
                                                                                                },
                                                                                                MsgFutura2:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg4,
                                                                                                    Tempo:Tempo4,
                                                                                                },
                                                                                                MsgFutura3:{
                                                                                                    Ativo:true,
                                                                                                    Msg:AutoMsg5,
                                                                                                    Tempo:Tempo5,
                                                                                                },
                                                                                                    MemSessao:Menus,
                                                                                                    Reclamaçoes:null,
                                                                                                    Localização:null,
                                                                                                    DigiteNaRegra:true,
                                                                                                    Robotizado:true, 
                                                                                                    UltimaMsg:{
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                        Autor:IdCli,
                                                                                                        body:Mensagem.body,
                                                                                                        date:new Date().getTime(),
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                    {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                        Botao:Menus,
                                                                                                        date:new Date().getTime()+5000,
                                                                                                        Type:"botao"
                                                                                                    },
                                                                                                    
                                                                                                    
                                                                                                    )
                                                                                                    })
                                                                                                    .then(async() => {
                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                        console.log("Entreou A  QUI ")
                                                                                                        console.log(TempMsg)
                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                            
                                                                                                    }) 
                                                                                                    
                                                                                                    }else {
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                        FaseMsg: "Msg4A",
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        MemSessao:Menus,
                                                                                                        Reclamaçoes:null,
                                                                                                        Localização:null,
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                        Autor:EMPRESA,
                                                                                                        body:`${NomeCli}${AutoMsg2}`,
                                                                                                        date:new Date().getTime()+2000,
                                                                                                        Type:"text"
                                                                                                    },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            Botao:Menus,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                        
                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                            console.log(TempMsg)
                                                                                    
                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg2}`, Tempo: TempMsg2, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                        }) 

                                                                                                    }
                                                                                                    //Mudando a Fase do Chat
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                        
                                                                                                    
                                                                                    
                                                                                                
                                                                                        
                                                    
                                                    
                                                                                                } else  if(NumIni > 0 && NumIni < QuantMen) {
                                                                                                
                                                                                                                        
                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                                var Menus = MemoriaProduto
                                                                                                                                var Sabor = SaboresEsco+1
                                                                                                                            
                                                                                                                                
                                                                                                
                                                                                                                                
                                                                                                                                console.log(Menus)
                                                                                                
                                                                                                
                                                                                                                                //montar a mensagem   
                                                                                                                            var QMsg= MsgEmp.Msg4L.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg4L.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg4L.TempoSeg;

                                                                                                                            var QMsg2= MsgEmp.Msg4D.Msg.length;
                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            var Result2 = parseInt(Sorteio2);
                                                                                                                            var Num2 = Result2-1;
                                                                                                                            var AutoMsg2 = MsgEmp.Msg4D.Msg[Num2];
                                                                                                                            var TempMsg2 =  MsgEmp.Msg4D.TempoSeg;
                                                                                                                    
                                                                                                                            
                                                                                    
                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                            var Num9 = Result9-1;
                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                        
                                                                                                        
                                                                                                                            //  var QMsg2= MsgEmp.Msg3A.Msg.length;
                                                                                                                            //  var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            //  var Result2 =parseInt(Sorteio2);
                                                                                                                            //  var Num2 = Result2-1;
                                                                                                                            //  var AutoMsg2 = MsgEmp.Msg3A.Msg[Num2];
                                                                                                                            //  var TempMsg2 =  MsgEmp.Msg3A.TempoSeg;
                                                                                                        
                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                            
                                                                                    
                                                                                                                            //Mensagens de estimulo 
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();




                                                                                                                            if(Sabor == MemoriaSabores){



                                                                                                                                var Menus = []
                                                                                                                                var Quant = [{id:"0", body:"Voltar Para os Itens"}]; 
                                                                                
                                                                                                                                console.log("Id :"+MemoriaProduto[NumIni].id)
                                                                                                                                
                                                                                                                                if(MemoriaProduto[NumIni].Ilimitado){
                                                                                                                                    for(var i = 1; i < 11; i++){
                                                                                                                                        Quant.push({
                                                                                                                                            id:i,
                                                                                                                                            body:i+" Quantidade"
                                                                                                                                        })
                                                                                                                                        }
                                                                                
                                                                                                                                }else {
                                                                                                                                    if(MemoriaProduto[NumIni].Quant < 11){
                                                                                                                                        for(var i = 1; i <= MemoriaProduto[NumIni].Quant; i++){
                                                                                                                                        Quant.push({
                                                                                                                                            id:i,
                                                                                                                                            body:i+" Quantidade"
                                                                                                                                        })
                                                                                                                                        }
                                                                                    
                                                                                                                                    } else {
                                                                                                                                        for(var i = 1; i < 11; i++){
                                                                                                                                            Quant.push({
                                                                                                                                                id:i,
                                                                                                                                                body:i+" Quantidade"
                                                                                                                                            })
                                                                                                                                            }
                                                                                                                                    }
                                                                                
                                                                                                                                }
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:Quant.length,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4D",
                                                                                                                                    EscolhaSabor:Sabor,   
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {

                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        


                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"},  {Msg: `*${NomeCli}, ${AutoMsg2}*` , Botao:Quant , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:0,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4L",
                                                                                                                                    EscolhaSabor:Sabor, 
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"Es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    }
                                                                                                                            } else {
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:0,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4L",
                                                                                                                                    EscolhaSabor:Sabor,   
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${NumIni>1?"es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body: `${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {

                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        


                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                        MemPedido:{
                                                                                                                                            Nome: MemoriaPedido.Nome? [...MemoriaPedido.Nome, MemoriaProduto[NumIni].Nome]: [MemoriaProduto[NumIni].Nome] ,
                                                                                                                                            Descricao:MemoriaPedido.Descricao ? [...MemoriaPedido.Descricao, MemoriaProduto[NumIni].Descricao]:[ MemoriaProduto[NumIni].Descricao],
                                                                                                                                            Foto:MemoriaPedido.Foto?[...MemoriaPedido.Foto, MemoriaProduto[NumIni].foto]:[MemoriaProduto[NumIni].foto],
                                                                                                                                            Preco:MemoriaProduto[NumIni].Preco,
                                                                                                                                            Descont:MemoriaProduto[NumIni].Descont,
                                                                                                                                            Sessao:SessaoEsta,
                                                                                                                                            SubSessao:MemoriaProduto[NumIni].SubSessao?MemoriaProduto[NumIni].SubSessao:"",
                                                                                                                                            Quant:0,
                                                                                                                                            Observacao:"",
                                                                                                                                            ItemEspeci:MemoriaProduto[NumIni].ItemEspeci?MemoriaProduto[NumIni].ItemEspeci:false,
                                                                                                                                            QuantGeral:0,
                                                                                                                                        
                                                                                                                                        },
                                                                                                                                    FaseMsg: "Msg4L",
                                                                                                                                    EscolhaSabor:Sabor, 
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Você Escolheu ${NumIni}  Sabor${NumIni>1?"Es":""}` ,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}`,
                                                                                                                                        Botao:Menus,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgPedido = NomeCli+AutoMsg;
                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+SessaoEsta+"\n"
                                                                                                                                        if(MemoriaPedido){
                                                
                                                                                                                                        for(let j in MemoriaPedido.Nome){
                                                                                                                                            MsgPedido = MsgPedido + "📦"+MemoriaPedido.Nome[j]+"\n"
                                                                                                                                            if(MemoriaPedido.Descricao[j]){
                                                                                                                                                MsgPedido = MsgPedido + "📝"+MemoriaPedido.Descricao[j]+"\n"
                                                                                                                                                }
                                                                                                                                            }   
                                                                                                                                        }
                                                                                                                                        MsgPedido = MsgPedido + "📦"+MemoriaProduto[NumIni].Nome+"\n"
                                                                                                                                        if(MemoriaProduto[NumIni].Descricao){
                                                                                                                                            MsgPedido = MsgPedido + "📝"+MemoriaProduto[NumIni].Descricao+"\n"
                                                                                                                                        }
                                                                                                                                        if(MemoriaProduto[NumIni].ItemEspeci){
                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+MemoriaProduto[NumIni].SubSessao+"\n"
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: `${NomeCli}, Você Escolheu ${Sabor}  Sabor${Sabor>1?"es":""} \n ${MsgPedido}`  , Tempo:2000, Type:"text"}, {Msg: `*${NomeCli}, Escolha o ${Sabor+1}° ${AutoMsg}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    }

                                                                                                                            }
                                                                                                                        
                                                                                                
                                                                                                                        
                                                                                                                            
                                                                                                                    
                                                                                                                        
                                                                                                                            
                                                                                                                        
                                                                                                                            } else {
                                                                                                
                                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                                            
                                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    DigiteNaRegra:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                } else  if(EstaNaRegra === false ){
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    Robotizado:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"texto"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },)
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                }
                                                                                                                            }
                                                                                                    
                                                                                                                
                                                                                                                    
                                                                                                    } else if(FaMsg === "Msg5A" ){//Recebendo o Que deseja de Retirar, (Não)Enviando a Nota Com A pergunta do que quer realizar ou (Sim)Perguntar o que quer retirar
                                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                                        var NumArray = NumIni - 1;

                                                                                                        console.log("Entrada "+NumIni)
                                                                                                        console.log("Quantidade "+NumArray)
                                                                                                        if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                        
                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                            var Menus = MemoriaPedido;
                                                                                                            var PedidosItens = []
                                                                                                        
                                                                                                            console.log(Menus)
                                                                            
                                                                            
                                                                                                            //montar a mensagem   
                                                                                                        var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                        var Result =parseInt(Sorteio);
                                                                                                        var Num = Result-1;
                                                                                                        var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                                        var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                                                
                                                                                                        console.log(MsgEmp.Msg4B.Msg)
                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                        console.log("Msg: "+AutoMsg)
                                                                
                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                        var Num9 = Result9-1;
                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                    
                                                                                        
                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                        var Num2 = Result2-1;
                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                    
                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                        
                                                                
                                                                                                        //Mensagens de estimulo 
                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                            
                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                            
                                                                                                        var Num3 = Result3-1;
                                                                                                        var Num4 = Result4-1;
                                                                                                        var Num5 = Result5-1;
                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                        console.log("id : "+PedidoCri)
                                                        
                                                                                                        
                                                        
                                                                                                        await db.collection("MesaItem")
                                                                                                        .doc(PedidoCri)
                                                                                                        .get().then((doc)=>{
                                                                                                            PedidosItens = doc.data().Itens;
                                                                                                        })
                                                                                                        console.log(PedidosItens)
                                                                                    
                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                        //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                            MemSessao:[],
                                                                                                            MemPedido:[],
                                                                                                            MemProdutos:[],
                                                                                                            MemSubSessao:[],
                                                                                                            MenSabor:0,
                                                                                                            EscolhaSabor:0, 
                                                                                                            Sessao:"",
                                                                                                        FaseMsg: "Msg6A",
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            date:new Date().getTime()+7000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                                                            date:new Date().getTime()+8000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                            
                                                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                            var TotalValor = 0
                                                                                                            for(let i in PedidosItens){
                                                                                                                
                                                                                                            
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                    if(PedidosItens[i].Descricao){
                                                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                    }
                                                                                                                
                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                }
                                                                                                                
                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                } else {
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                }
                                                        
                                                                                                            }
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                        
                                                                                                                
                                                                                                            
                                                                                                        
                                                                                                            response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                        }) 
                                                                                                        } else {
                                                                                                            //Mudando a Fase do Chat
                                                                                                        await db.collection("ChatCliente")
                                                                                                        .doc(IdChat)
                                                                                                        .update({
                                                                                                            MemSessao:[],
                                                                                                            MemPedido:[],
                                                                                                            MemProdutos:[],
                                                                                                            MemSubSessao:[],
                                                                                                            MenSabor:0,
                                                                                                            EscolhaSabor:0, 
                                                                                                        FaseMsg: "Msg6A",
                                                                                                        DigiteNaRegra:true,
                                                                                                        Robotizado:true, 
                                                                                                        MsgFutura1:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg3,
                                                                                                            Tempo:Tempo3,
                                                                                                        },
                                                                                                        MsgFutura2:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg4,
                                                                                                            Tempo:Tempo4,
                                                                                                        },
                                                                                                        MsgFutura3:{
                                                                                                            Ativo:true,
                                                                                                            Msg:AutoMsg5,
                                                                                                            Tempo:Tempo5,
                                                                                                        },
                                                                                                        UltimaMsg:{
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                            Autor:IdCli,
                                                                                                            body:Mensagem.body,
                                                                                                            date:new Date().getTime(),
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                            Botao:Menus,
                                                                                                            date:new Date().getTime()+2000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                            Botao:Menus,
                                                                                                            date:new Date().getTime()+5000,
                                                                                                            Type:"text"
                                                                                                        },
                                                                                                        {
                                                                                                            Autor:EMPRESA,
                                                                                                            body:`${NomeCli}${AutoMsg2}`,
                                                                                                            Botao:MsgEmp.Msg6A.Botao,
                                                                                                            date:new Date().getTime()+8000,
                                                                                                            Type:"botao"
                                                                                                        },
                                                                                                        
                                                                                                        
                                                                                                        )
                                                                                                        })
                                                                                                        .then(async() => {
                                                                                                            var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                            var TotalValor = 0
                                                                                                            for(let i in PedidosItens){
                                                                                                                
                                                                                                            
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                    if(PedidosItens[i].Descricao){
                                                                                                                        MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                    }
                                                                                                                
                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                }
                                                                                                            
                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                } else {
                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                    }
                                                                                                                }
                                                        
                                                                                                            }
                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                
                                                                                                            
                                                                                                        
                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                            
                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                            
                                                                                                            
                                                                                                        }) 
                                                                
                                                                                                        
                                                                            
                                                                                                    }
                                                                                                        
                                                                                                
                                                                                                    
                                                                                                        
                                                                                                    
                                                                                                        } else if(NumArray >= 0 && NumArray < MemoriaPedido.length){
                                                                                                        
                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                var Menus = [];
                                                                                                                var PedidosItens = MemoriaPedido.filter((item, index) => index !== NumArray )
                                                                                                            
                                                                                                                console.log(Menus)
                                                                                
                                                                                
                                                                                                                //montar a mensagem   
                                                                                                            var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                                                    
                                                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                            console.log("Msg: "+AutoMsg)
                                                                    
                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                            var Num9 = Result9-1;
                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                        
                                                                                            
                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                            var Num2 = Result2-1;
                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                        
                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                            
                                                                    
                                                                                                            //Mensagens de estimulo 
                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                
                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                
                                                                                                            var Num3 = Result3-1;
                                                                                                            var Num4 = Result4-1;
                                                                                                            var Num5 = Result5-1;
                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            console.log("id : "+PedidoCri)
                                                            
                                                                                                            await db.collection("MesaItem")
                                                                                                            .doc(PedidoCri)
                                                                                                            .update({
                                                                                                                Itens:PedidosItens 
                                                                                                            }).then((doc)=>{
                                                                                                                //PedidosItens = doc.data().Itens;
                                                                                                            })
                                                            
                                                                                                            //   await db.collection("MesaItem")
                                                                                                            //   .doc(PedidoCri)
                                                                                                            //   .get().then((doc)=>{
                                                                                                            //     PedidosItens = doc.data().Itens;
                                                                                                            //   })
                                                                                                            console.log(PedidosItens)
                                                                                        
                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                            //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                                Sessao:"",
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+7000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                
                                                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                                var TotalValor = 0
                                                                                                                for(let i in PedidosItens){
                                                                                                                    
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                    
                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                        if(PedidosItens[i].Descricao){
                                                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                        }
                                                                                                                    
                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                    }
                                                                                                                    
                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    } else {
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    }
                                                            
                                                                                                                }
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                            
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[{Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                            }) 
                                                                                                            } else {
                                                                                                                //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                date:new Date().getTime()+2000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                var MsgPedido = NomeCli+", "+ AutoMsg;
                                                                                                                var TotalValor = 0
                                                                                                                for(let i in PedidosItens){
                                                                                                                    
                                                                                                                
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                    
                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                        if(PedidosItens[i].Descricao){
                                                                                                                            MsgPedido = MsgPedido + "📝"+PedidosItens[i].Descricao+"\n"
                                                                                                                        }
                                                                                                                    
                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                    }
                                                                                                                
                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    } else {
                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                        }
                                                                                                                    }
                                                            
                                                                                                                }
                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                
                                                                                                                
                                                                                                            }) 
                                                                    
                                                                                                            
                                                                                
                                                                                                        }
                                                                                                            
                                                                                                    
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            }  else {
                                                                                    
                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                
                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                        var Num = Result-1;
                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        DigiteNaRegra:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                
                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        Robotizado:false, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"texto"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                        }, 
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },)
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            console.log(TempMsg)
                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                
                                                                                                                        }) 
                                                                                                                    }
                                                                                                                }
                                                                                        
                                                                                                    
                                                                                                        
                                                                                                        } else if(FaMsg === "Msg7E" ){//Recebendo o Bairro, Enviando a Pergunta da Rua
                                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                                            var NumArray = NumIni - 1;
    
                                                                                                            console.log("Entrada "+NumIni)
                                                                                                            console.log("Quantidade "+NumArray)
                                                                                                            if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                            
                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                var Menus = MemoriaPedido;
                                                                                                                var PedidosItens = []
                                                                                                            
                                                                                                                console.log(Menus)
                                                                                
                                                                                
                                                                                                                //montar a mensagem   
                                                                                                            var QMsg= MsgEmp.Msg4G.Msg.length;
                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                            var Result =parseInt(Sorteio);
                                                                                                            var Num = Result-1;
                                                                                                            var AutoMsg = MsgEmp.Msg4G.Msg[Num];
                                                                                                            var TempMsg =  MsgEmp.Msg4G.TempoSeg;
                                                                                                    
                                                                                                            console.log(MsgEmp.Msg4B.Msg)
                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                            console.log("Msg: "+AutoMsg)
                                                                    
                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                            var Num9 = Result9-1;
                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                        
                                                                                            
                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                            var Num2 = Result2-1;
                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                        
                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                            
                                                                    
                                                                                                            //Mensagens de estimulo 
                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                
                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                
                                                                                                            var Num3 = Result3-1;
                                                                                                            var Num4 = Result4-1;
                                                                                                            var Num5 = Result5-1;
                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            console.log("id : "+PedidoCri)
                                                            
                                                                                                            
                                                            
                                                                                                            await db.collection("MesaItem")
                                                                                                            .doc(PedidoCri)
                                                                                                            .get().then((doc)=>{
                                                                                                                PedidosItens = doc.data().Itens;
                                                                                                            })
                                                                                                            console.log(PedidosItens)
                                                                                        
                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                            //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                                Sessao:"",
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                                
                                                                                                               
                                                                                                            
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                            }) 
                                                                                                            } else {
                                                                                                                //Mudando a Fase do Chat
                                                                                                            await db.collection("ChatCliente")
                                                                                                            .doc(IdChat)
                                                                                                            .update({
                                                                                                                MemSessao:[],
                                                                                                                MemPedido:[],
                                                                                                                MemProdutos:[],
                                                                                                                MemSubSessao:[],
                                                                                                                MenSabor:0,
                                                                                                                EscolhaSabor:0, 
                                                                                                            FaseMsg: "Msg6A",
                                                                                                            DigiteNaRegra:true,
                                                                                                            Robotizado:true, 
                                                                                                            MsgFutura1:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg3,
                                                                                                                Tempo:Tempo3,
                                                                                                            },
                                                                                                            MsgFutura2:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg4,
                                                                                                                Tempo:Tempo4,
                                                                                                            },
                                                                                                            MsgFutura3:{
                                                                                                                Ativo:true,
                                                                                                                Msg:AutoMsg5,
                                                                                                                Tempo:Tempo5,
                                                                                                            },
                                                                                                            UltimaMsg:{
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                date:new Date().getTime()+5000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                Autor:IdCli,
                                                                                                                body:Mensagem.body,
                                                                                                                date:new Date().getTime(),
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                Botao:Menus,
                                                                                                                date:new Date().getTime()+2000,
                                                                                                                Type:"text"
                                                                                                            },
                                                                                                            {
                                                                                                                Autor:EMPRESA,
                                                                                                                body:`${NomeCli}${AutoMsg2}`,
                                                                                                                Botao:MsgEmp.Msg6A.Botao,
                                                                                                                date:new Date().getTime()+8000,
                                                                                                                Type:"botao"
                                                                                                            },
                                                                                                            
                                                                                                            
                                                                                                            )
                                                                                                            })
                                                                                                            .then(async() => {
                                                                                                              
                                                                                                                    
                                                                                                                
                                                                                                            
                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg2}*` , Botao:MsgEmp.Msg6A.Botao , Tempo:TempMsg2, Type:"butao"}] });
                                                                                                                
                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                
                                                                                                                
                                                                                                            }) 
                                                                    
                                                                                                            
                                                                                
                                                                                                        }
                                                                                                            
                                                                                                    
                                                                                                        
                                                                                                            
                                                                                                        
                                                                                                            } else if(NumArray >= 0 && NumArray < MemoriaBairro.length){
                                                                                                            
                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                   
                                                                                                                 var PrecoEntrega = MemoriaBairro[NumIni].Preco;
                                                                                                                 var EndPedido
                                                                                                                 await db.collection("MesaItem")
                                                                                                                 .doc(PedidoCri)
                                                                                                                 .get()
                                                                                                                 .then((doc)=>{
                                                                                                                 EndPedido = doc.data().End;
                                                                                                                 
                                                                                                                 })

                                                                                                                 
                                                                                                                 if(EndPedido.Rua){
                                                                                                                        
                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                   
                                                                                                               
                                                                                                                
                                                                                                                    
                                                                                    
                                                                                    
                                                                                                                    //montar a mensagem   
                                                                                                                var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                var Num = Result-1;
                                                                                                                var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                        
                                                                                                                console.log(MsgEmp.Msg7D.Msg)
                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                console.log("Msg: "+AutoMsg)
                                                                        
                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                var Num9 = Result9-1;
                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                                
                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                var Num2 = Result2-1;
                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                            
                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                
                                                                        
                                                                                                                //Mensagens de estimulo 
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                               
                                                                
                                                                                                                await db.collection("MesaItem")
                                                                                                                .doc(PedidoCri)
                                                                                                                .update({
                                                                                                                    ValorEntrega:PrecoEntrega,
                                                                                                                    "End.Bairro":MemoriaBairro[NumIni].body,
                                                                                                                    
                                                                                                                     
                                                                                                                }).then((doc)=>{
                                                                                                                   
                                                                                                                })

                                                                                                                var PedidoVer = {}
                                                                                                                await db.collection("MesaItem")
                                                                                                                .doc(PedidoCri)
                                                                                                                .get()
                                                                                                                .then((doc)=>{
                                                                                                                   PedidoVer = doc.data();
                                                                                                                }) 

                                                                                                           
                                                                                                               
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg7D",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    Botao:MsgEmp.Msg7D.Botao,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                  
                                                                                                                    var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                    MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                    MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                    
                                                                                                                
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                }) 
                                                                                                                } else {
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                   
                                                                                                                FaseMsg: "Msg7D",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    Botao:MsgEmp.Msg7D.Botao,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"botao"
                                                                                                                },
                                                                                                               
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                   
                                                                                                                    var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                    MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                    MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                    MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                    MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                   
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    
                                                                                                                    
                                                                                                                }) 
                                                                        
                                                                                                                
                                                                                    
                                                                                                                }
                                                                                                                
                                                                                                        
                                                                                                            
                                                                                                                
                                                                                                            
                                                                                                                }  else {
                                                                                                                            //montar a mensagem   
                                                                                                                var QMsg= MsgEmp.Msg7B.Msg.length;
                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                var Num = Result-1;
                                                                                                                var AutoMsg = MsgEmp.Msg7B.Msg[Num];
                                                                                                                var TempMsg =  MsgEmp.Msg7B.TempoSeg;
                                                                                                        
                                                                                                                console.log(MsgEmp.Msg7B.Msg)
                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                console.log("Msg: "+AutoMsg)
                                                                        
                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                var Num9 = Result9-1;
                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                            
                                                                                                
                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                var Num2 = Result2-1;
                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                            
                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                
                                                                        
                                                                                                                //Mensagens de estimulo 
                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                    
                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                    
                                                                                                                var Num3 = Result3-1;
                                                                                                                var Num4 = Result4-1;
                                                                                                                var Num5 = Result5-1;
                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                               
                                                                
                                                                                                                await db.collection("MesaItem")
                                                                                                                .doc(PedidoCri)
                                                                                                                .update({
                                                                                                                    ValorEntrega:PrecoEntrega,
                                                                                                                    "End.Bairro":MemoriaBairro[NumIni].body,
                                                                                                                    
                                                                                                                     
                                                                                                                }).then((doc)=>{
                                                                                                                   
                                                                                                                })
                                                                
                                                                                                                
                                                                                                               
                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                FaseMsg: "Msg7B",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg:`Você Escolheu o Bairro ${MemoriaBairro[NumIni].body}`  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                }) 
                                                                                                                } else {
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                await db.collection("ChatCliente")
                                                                                                                .doc(IdChat)
                                                                                                                .update({
                                                                                                                    MemSessao:[],
                                                                                                                    MemPedido:[],
                                                                                                                    MemProdutos:[],
                                                                                                                    MemSubSessao:[],
                                                                                                                    MenSabor:0,
                                                                                                                    EscolhaSabor:0, 
                                                                                                                FaseMsg: "Msg7B",
                                                                                                                DigiteNaRegra:true,
                                                                                                                Robotizado:true, 
                                                                                                                MsgFutura1:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg3,
                                                                                                                    Tempo:Tempo3,
                                                                                                                },
                                                                                                                MsgFutura2:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg4,
                                                                                                                    Tempo:Tempo4,
                                                                                                                },
                                                                                                                MsgFutura3:{
                                                                                                                    Ativo:true,
                                                                                                                    Msg:AutoMsg5,
                                                                                                                    Tempo:Tempo5,
                                                                                                                },
                                                                                                                UltimaMsg:{
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                    Autor:IdCli,
                                                                                                                    body:Mensagem.body,
                                                                                                                    date:new Date().getTime(),
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                                {
                                                                                                                    Autor:EMPRESA,
                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                    Type:"text"
                                                                                                                },
                                                                                                               
                                                                                                                
                                                                                                                
                                                                                                                )
                                                                                                                })
                                                                                                                .then(async() => {
                                                                                                                   
                                                                                                                    
                                                                                                                
                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg:`Você Escolheu o Bairro ${MemoriaBairro[NumIni].body}`  , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    
                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                    
                                                                                                                    
                                                                                                                }) 
                                                                        
                                                                                                                
                                                                                    
                                                                                                            }

                                                                                                                 }
                                                                                                               
                                                                                    
                                                                                                            
                                                                                                                
                                                                                                        
                                                                                                            
                                                                                                                
                                                                                                            
                                                                                                                }  else {
                                                                                        
                                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                                    
                                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                    
                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            DigiteNaRegra:false, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                            }, 
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                console.log(TempMsg)
                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    
                                                                                                                            }) 
                                                                                                                        } else  if(EstaNaRegra === false ){
                                                                                    
                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                        
                                                                                                                        
                                                                                                                        
                                                                                                                        
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            Robotizado:false, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"texto"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                            }, 
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },)
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                console.log(TempMsg)
                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                    
                                                                                                                            }) 
                                                                                                                        }
                                                                                                                    }
                                                                                            
                                                                                                        
                                                                                                            
                                                                                                            } else if(FaMsg === "Msg7B" ){//Recebendo a Rua , Enviando a Pergunta do Numero
                                                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                                               
                                                                                                               if(Type === "chat"){
                                                                                                                
                                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                                       
                                                                                                                        var EndPedido
                                                                                                                        await db.collection("MesaItem")
                                                                                                                        .doc(PedidoCri)
                                                                                                                        .get()
                                                                                                                        .then((doc)=>{
                                                                                                                        EndPedido = doc.data().End;
                                                                                                                        
                                                                                                                        })
       
                                                                                                                        
                                                                                                                        if(EndPedido.Numero){
                                                                                                                               
                                                                                                                           //Escolhendo os itens da sessão escolhida
                                                                                                                          
                                                                                                                      
                                                                                                                       
                                                                                                                           
                                                                                           
                                                                                           
                                                                                                                           //montar a mensagem   
                                                                                                                       var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                       var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                       var Result =parseInt(Sorteio);
                                                                                                                       var Num = Result-1;
                                                                                                                       var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                       var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                               
                                                                                                                       console.log(MsgEmp.Msg7D.Msg)
                                                                                                                       console.log("Qmsg: "+QMsg)       
                                                                                                                       console.log("Soteio: "+Sorteio)                 
                                                                                                                       console.log("Msg: "+AutoMsg)
                                                                               
                                                                                                                           //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                       var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                       var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                       var Result9 =parseInt(Sorteio9);
                                                                                                                       var Num9 = Result9-1;
                                                                                                                       var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                       var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                   
                                                                                                       
                                                                                                                       var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                       var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                       var Result2 =parseInt(Sorteio2);
                                                                                                                       var Num2 = Result2-1;
                                                                                                                       var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                       var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                   
                                                                                                                       //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                       //  console.log("Qmsg: "+QMsg2)       
                                                                                                                       //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                       //  console.log("Msg: "+AutoMsg2)
                                                                                                                       
                                                                               
                                                                                                                       //Mensagens de estimulo 
                                                                                                                       var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                       var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                       var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                       var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                       var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                       var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                           
                                                                                                                       var Result3 =parseInt(Sorteio3);
                                                                                                                       var Result4 =parseInt(Sorteio4);
                                                                                                                       var Result5 =parseInt(Sorteio5);
                                                                                                           
                                                                                                                       var Num3 = Result3-1;
                                                                                                                       var Num4 = Result4-1;
                                                                                                                       var Num5 = Result5-1;
                                                                                                                       var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                       var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                       var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                       var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                      
                                                                       
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .update({
                                                                                                                         
                                                                                                                           "End.Rua":Mensagem.body,
                                                                                                                           
                                                                                                                            
                                                                                                                       }).then((doc)=>{
                                                                                                                          
                                                                                                                       })
       
                                                                                                                       var PedidoVer = {}
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .get()
                                                                                                                       .then((doc)=>{
                                                                                                                          PedidoVer = doc.data();
                                                                                                                       }) 
       
                                                                                                                  
                                                                                                                      
                                                                                                                       if(Robo === true && EstaNaRegra === true){
                                                                                                                       //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                         
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                           
                                                                                                                       
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                       }) 
                                                                                                                       } else {
                                                                                                                           //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                          
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                                                                           date:new Date().getTime()+2000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                      
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                          
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                          
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                           
                                                                                                                           //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                           
                                                                                                                           
                                                                                                                       }) 
                                                                               
                                                                                                                       
                                                                                           
                                                                                                                       }
                                                                                                                       
                                                                                                               
                                                                                                                   
                                                                                                                       
                                                                                                                   
                                                                                                                       }  else {
                                                                                                                    
                                                                                                                        
                                                                                        
                                                                                        
                                                                                                                        //montar a mensagem   
                                                                                                                    var QMsg= MsgEmp.Msg7C.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg7C.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg7C.TempoSeg;
                                                                                                            
                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                            
                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                    var Num9 = Result9-1;
                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    
                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                    var Num2 = Result2-1;
                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                
                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                    
                                                                            
                                                                                                                    //Mensagens de estimulo 
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                   
                                                                    
                                                                                                                    await db.collection("MesaItem")
                                                                                                                    .doc(PedidoCri)
                                                                                                                    .update({
                                                                                                                      
                                                                                                                        "End.Rua":Mensagem.body,
                                                                                                                        
                                                                                                                         
                                                                                                                    }).then((doc)=>{
                                                                                                                       
                                                                                                                    })
                                                                    
                                                                                                                    
                                                                                                                   
                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                    
                                                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                        MemSessao:[],
                                                                                                                        MemPedido:[],
                                                                                                                        MemProdutos:[],
                                                                                                                        MemSubSessao:[],
                                                                                                                        MenSabor:0,
                                                                                                                        EscolhaSabor:0, 
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                       
                                                                                                                        
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        
                                                                                                                        
                                                                                                                    }) 
                                                                            
                                                                                                                }
                                                                                        
                                                                                                                        }
                                                                                                                    
                                                                                                            
                                                                                                                
                                                                                                                    
                                                                                                                
                                                                                                                    }  else {
                                                                                            
                                                                                                                            if(EstaNaRegra === true && Robo === true){
                                                                                        
                                                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                var Num = Result-1;
                                                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                        
                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                DigiteNaRegra:false, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                }, 
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    console.log(TempMsg)
                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                                }) 
                                                                                                                            } else  if(EstaNaRegra === false ){
                                                                                        
                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                            
                                                                                                                            
                                                                                                                            
                                                                                                                            
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                Robotizado:false, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"texto"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                }, 
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },)
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    console.log(TempMsg)
                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                        
                                                                                                                                }) 
                                                                                                                            }
                                                                                                                        }
                                                                                                
                                                                                                            
                                                                                                                
                                                                                                                } else if(FaMsg === "Msg7C" ){//Recebendo o Numero , Enviando a Pergunta do Complemento
                                                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                                                   
                                                                                                                   if(Type === "chat"){
                                                                                                                    
                                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                                           
                                                                                                                           var EndPedido
                                                                                                                        await db.collection("MesaItem")
                                                                                                                        .doc(PedidoCri)
                                                                                                                        .get()
                                                                                                                        .then((doc)=>{
                                                                                                                        EndPedido = doc.data().End;
                                                                                                                        
                                                                                                                        })
       
                                                                                                                        
                                                                                                                        if(EndPedido.Proximo){
                                                                                                                               
                                                                                                                           //Escolhendo os itens da sessão escolhida
                                                                                                                          
                                                                                                                      
                                                                                                                       
                                                                                                                           
                                                                                           
                                                                                           
                                                                                                                           //montar a mensagem   
                                                                                                                       var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                       var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                       var Result =parseInt(Sorteio);
                                                                                                                       var Num = Result-1;
                                                                                                                       var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                       var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                               
                                                                                                                       console.log(MsgEmp.Msg7D.Msg)
                                                                                                                       console.log("Qmsg: "+QMsg)       
                                                                                                                       console.log("Soteio: "+Sorteio)                 
                                                                                                                       console.log("Msg: "+AutoMsg)
                                                                               
                                                                                                                           //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                       var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                       var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                       var Result9 =parseInt(Sorteio9);
                                                                                                                       var Num9 = Result9-1;
                                                                                                                       var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                       var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                   
                                                                                                       
                                                                                                                       var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                       var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                       var Result2 =parseInt(Sorteio2);
                                                                                                                       var Num2 = Result2-1;
                                                                                                                       var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                       var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                   
                                                                                                                       //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                       //  console.log("Qmsg: "+QMsg2)       
                                                                                                                       //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                       //  console.log("Msg: "+AutoMsg2)
                                                                                                                       
                                                                               
                                                                                                                       //Mensagens de estimulo 
                                                                                                                       var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                       var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                       var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                       var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                       var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                       var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                           
                                                                                                                       var Result3 =parseInt(Sorteio3);
                                                                                                                       var Result4 =parseInt(Sorteio4);
                                                                                                                       var Result5 =parseInt(Sorteio5);
                                                                                                           
                                                                                                                       var Num3 = Result3-1;
                                                                                                                       var Num4 = Result4-1;
                                                                                                                       var Num5 = Result5-1;
                                                                                                                       var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                       var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                       var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                       var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                       var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                      
                                                                       
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .update({
                                                                                                                         
                                                                                                                           "End.Numero":Mensagem.body,
                                                                                                                           
                                                                                                                            
                                                                                                                       }).then((doc)=>{
                                                                                                                          
                                                                                                                       })
       
                                                                                                                       var PedidoVer = {}
                                                                                                                       await db.collection("MesaItem")
                                                                                                                       .doc(PedidoCri)
                                                                                                                       .get()
                                                                                                                       .then((doc)=>{
                                                                                                                          PedidoVer = doc.data();
                                                                                                                       }) 
       
                                                                                                                  
                                                                                                                      
                                                                                                                       if(Robo === true && EstaNaRegra === true){
                                                                                                                       //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                         
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                           
                                                                                                                       
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                       }) 
                                                                                                                       } else {
                                                                                                                           //Mudando a Fase do Chat
                                                                                                                       await db.collection("ChatCliente")
                                                                                                                       .doc(IdChat)
                                                                                                                       .update({
                                                                                                                          
                                                                                                                       FaseMsg: "Msg7D",
                                                                                                                       DigiteNaRegra:true,
                                                                                                                       Robotizado:true, 
                                                                                                                       MsgFutura1:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg3,
                                                                                                                           Tempo:Tempo3,
                                                                                                                       },
                                                                                                                       MsgFutura2:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg4,
                                                                                                                           Tempo:Tempo4,
                                                                                                                       },
                                                                                                                       MsgFutura3:{
                                                                                                                           Ativo:true,
                                                                                                                           Msg:AutoMsg5,
                                                                                                                           Tempo:Tempo5,
                                                                                                                       },
                                                                                                                       UltimaMsg:{
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           date:new Date().getTime()+5000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                       Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                           Autor:IdCli,
                                                                                                                           body:Mensagem.body,
                                                                                                                           date:new Date().getTime(),
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg9}`,
                                                                                                                           date:new Date().getTime()+2000,
                                                                                                                           Type:"text"
                                                                                                                       },
                                                                                                                       {
                                                                                                                           Autor:EMPRESA,
                                                                                                                           body:`${NomeCli}${AutoMsg}`,
                                                                                                                           Botao:MsgEmp.Msg7D.Botao,
                                                                                                                           date:new Date().getTime()+7000,
                                                                                                                           Type:"botao"
                                                                                                                       },
                                                                                                                      
                                                                                                                       
                                                                                                                       
                                                                                                                       )
                                                                                                                       })
                                                                                                                       .then(async() => {
                                                                                                                          
                                                                                                                           var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                           MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                           MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                           MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                           MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                          
                                                                                                                       
                                                                                                                           response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                           
                                                                                                                           //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                           
                                                                                                                           
                                                                                                                       }) 
                                                                               
                                                                                                                       
                                                                                           
                                                                                                                       }
                                                                                                                       
                                                                                                               
                                                                                                                   
                                                                                                                       
                                                                                                                   
                                                                                                                       }  else {
                                                                                                                        
                                                                                                                            
                                                                                            
                                                                                            
                                                                                                                            //montar a mensagem   
                                                                                                                        var QMsg= MsgEmp.Msg7F.Msg.length;
                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                        var Num = Result-1;
                                                                                                                        var AutoMsg = MsgEmp.Msg7F.Msg[Num];
                                                                                                                        var TempMsg =  MsgEmp.Msg7F.TempoSeg;
                                                                                                                
                                                                                                                        console.log(MsgEmp.Msg7B.Msg)
                                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                                        console.log("Msg: "+AutoMsg)
                                                                                
                                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                                        var Num9 = Result9-1;
                                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                    
                                                                                                        
                                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                                        var Num2 = Result2-1;
                                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                    
                                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                                        
                                                                                
                                                                                                                        //Mensagens de estimulo 
                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                            
                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                            
                                                                                                                        var Num3 = Result3-1;
                                                                                                                        var Num4 = Result4-1;
                                                                                                                        var Num5 = Result5-1;
                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                       
                                                                        
                                                                                                                        await db.collection("MesaItem")
                                                                                                                        .doc(PedidoCri)
                                                                                                                        .update({
                                                                                                                          
                                                                                                                            "End.Numero":Mensagem.body,
                                                                                                                            
                                                                                                                             
                                                                                                                        }).then((doc)=>{
                                                                                                                           
                                                                                                                        })
                                                                        
                                                                                                                        
                                                                                                                       
                                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                        FaseMsg: "Msg7F",
                                                                                                                        DigiteNaRegra:true,
                                                                                                                        Robotizado:true, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Mensagem.body,
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                        
                                                                                                                            response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        }) 
                                                                                                                        } else {
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                        await db.collection("ChatCliente")
                                                                                                                        .doc(IdChat)
                                                                                                                        .update({
                                                                                                                           
                                                                                                                        FaseMsg: "Msg7F",
                                                                                                                        DigiteNaRegra:true,
                                                                                                                        Robotizado:true, 
                                                                                                                        MsgFutura1:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg3,
                                                                                                                            Tempo:Tempo3,
                                                                                                                        },
                                                                                                                        MsgFutura2:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg4,
                                                                                                                            Tempo:Tempo4,
                                                                                                                        },
                                                                                                                        MsgFutura3:{
                                                                                                                            Ativo:true,
                                                                                                                            Msg:AutoMsg5,
                                                                                                                            Tempo:Tempo5,
                                                                                                                        },
                                                                                                                        UltimaMsg:{
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                            Autor:IdCli,
                                                                                                                            body:Mensagem.body,
                                                                                                                            date:new Date().getTime(),
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                        {
                                                                                                                            Autor:EMPRESA,
                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                            Type:"text"
                                                                                                                        },
                                                                                                                       
                                                                                                                        
                                                                                                                        
                                                                                                                        )
                                                                                                                        })
                                                                                                                        .then(async() => {
                                                                                                                           
                                                                                                                            
                                                                                                                        
                                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                            
                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                            
                                                                                                                            
                                                                                                                        }) 
                                                                                
                                                                                                                        
                                                                                            
                                                                                                                        }
                                                                                                                        
                                                                                                                
                                                                                                                       }
                                                                                                                        
                                                                                                                    
                                                                                                                        }  else {
                                                                                                
                                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                                            
                                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    DigiteNaRegra:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                } else  if(EstaNaRegra === false ){
                                                                                            
                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    Robotizado:false, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"texto"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                    }, 
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },)
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        console.log(TempMsg)
                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            
                                                                                                                                    }) 
                                                                                                                                }
                                                                                                                            }
                                                                                                    
                                                                                                                
                                                                                                                    
                                                                                                                    } else if(FaMsg === "Msg7F" ){//Recebendo o Completmento , Enviando a Pergunta Se o Endereço está correto 
                                                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                                                       
                                                                                                                       if(Type === "chat"){
                                                                                                                        
                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                               
                                                                                                                           
                                                                                                                            
                                                                                                                                
                                                                                                
                                                                                                
                                                                                                                                //montar a mensagem   
                                                                                                                            var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                                    
                                                                                                                            console.log(MsgEmp.Msg7D.Msg)
                                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                                            console.log("Msg: "+AutoMsg)
                                                                                    
                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                            var Num9 = Result9-1;
                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                        
                                                                                                            
                                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                                            var Num2 = Result2-1;
                                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                        
                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                            
                                                                                    
                                                                                                                            //Mensagens de estimulo 
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                           
                                                                            
                                                                                                                            await db.collection("MesaItem")
                                                                                                                            .doc(PedidoCri)
                                                                                                                            .update({
                                                                                                                              
                                                                                                                                "End.Proximo":Mensagem.body,
                                                                                                                                "End.Cidade":DadoEmp.Endereco.Cidade,
                                                                                                                                "End.Estado":DadoEmp.Endereco.Estado,
                                                                                                                              
                                                                                                                            })

                                                                                                                           var PedidoVer = {}
                                                                                                                           await db.collection("MesaItem")
                                                                                                                           .doc(PedidoCri)
                                                                                                                           .get()
                                                                                                                           .then((doc)=>{
                                                                                                                              PedidoVer = doc.data();
                                                                                                                           }) 
                                                                                                                           
                                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                                var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                                MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                                MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                                MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                              //  MsgPedido = MsgPedido + "💰 Valor da Entrega: "+ PedidoVer.ValorEntrega.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                
                                                                                                                            
                                                                                                                            
                                                                                                                                response.json({ Inf:[ {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            }) 
                                                                                                                            } else {
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                               
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                date:new Date().getTime()+2000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                           
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                               
                                                                                                                                var MsgPedido = NomeCli+", Seu Endereço  da Entrega Foi Anotado";
                                                                                                                                MsgPedido = MsgPedido + "\n===================\n";
                                                                                                                                MsgPedido = MsgPedido + "🟠Rua: "+ PedidoVer.End.Rua +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟡Numero: "+ PedidoVer.End.Numero +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟢Próximo: "+ PedidoVer.End.Proximo +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🔵Bairro: "+ PedidoVer.End.Bairro +"\n";
                                                                                                                                MsgPedido = MsgPedido + "🟤Cidade: "+ PedidoVer.End.Cidade +"\n";
                                                                                                                                MsgPedido = MsgPedido + "⚫Estado: "+ PedidoVer.End.Estado +"\n";
                                                                                                                               // MsgPedido = MsgPedido + "💰 Valor da Entrega: "+ PedidoVer.ValorEntrega.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                            
                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"}, {Msg: MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                
                                                                                                                                
                                                                                                                            }) 
                                                                                    
                                                                                                                            
                                                                                                
                                                                                                                            }
                                                                                                                            
                                                                                                                    
                                                                                                                        
                                                                                                                            
                                                                                                                        
                                                                                                                            }  else {
                                                                                                    
                                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                                
                                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                        var Num = Result-1;
                                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                
                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        DigiteNaRegra:false, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                        }, 
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            console.log(TempMsg)
                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                
                                                                                                                                        }) 
                                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                                
                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                    
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        Robotizado:false, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"texto"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                        }, 
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },)
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            console.log(TempMsg)
                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                
                                                                                                                                        }) 
                                                                                                                                    }
                                                                                                                                }
                                                                                                        
                                                                                                                    
                                                                                                                        
                                                                                                                        }   else if(FaMsg === "Msg7D" ){//Recebendo Sim ou Não Se o endereço está correto , Enviando A pergunta de qula deseja mudar ou se está no endereço 
                                                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                                                           
                                                                                                                           if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                            
                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                   
                                                                                                                      
                                                                                                                                    
                                                                                                                                
                                                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                                                    //montar a mensagem   
                                                                                                                                var QMsg= MsgEmp.Msg7H.Msg.length;
                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                var Num = Result-1;
                                                                                                                                var AutoMsg = MsgEmp.Msg7H.Msg[Num];
                                                                                                                                var TempMsg =  MsgEmp.Msg7H.TempoSeg;
                                                                                                                        
                                                                                                                                console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                        
                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                var Num9 = Result9-1;
                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                            
                                                                                                                
                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                var Num2 = Result2-1;
                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                            
                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                
                                                                                        
                                                                                                                                //Mensagens de estimulo 
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                               
                                                                                
                                                                                                                              
                                                                                
                                                                                                                                
                                                                                                                               
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                FaseMsg: "Msg7H",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7H.Botao,
                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                
                                                                                                                                    response.json({ Inf:[  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7H.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                }) 
                                                                                                                                } else {
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                   
                                                                                                                                FaseMsg: "Msg7H",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7H.Botao,
                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                               
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                   
                                                                                                                                    
                                                                                                                                
                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7H.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    
                                                                                                                                    
                                                                                                                                }) 
                                                                                        
                                                                                                                                
                                                                                                    
                                                                                                                                }
                                                                                                                                
                                                                                                                        
                                                                                                                            
                                                                                                                                
                                                                                                                            
                                                                                                                                }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                            
                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                   
                                                                                                                               
                                                                                                                                
                                                                                                                                    
                                                                                                    
                                                                                                    
                                                                                                                                    //montar a mensagem   
                                                                                                                                var QMsg= MsgEmp.Msg7G.Msg.length;
                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                var Num = Result-1;
                                                                                                                                var AutoMsg = MsgEmp.Msg7G.Msg[Num];
                                                                                                                                var TempMsg =  MsgEmp.Msg7G.TempoSeg;
                                                                                                                        
                                                                                                                                console.log(MsgEmp.Msg7G.Msg)
                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                        
                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                var Num9 = Result9-1;
                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                            
                                                                                                                
                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                var Num2 = Result2-1;
                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                            
                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                
                                                                                        
                                                                                                                                //Mensagens de estimulo 
                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                    
                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                    
                                                                                                                                var Num3 = Result3-1;
                                                                                                                                var Num4 = Result4-1;
                                                                                                                                var Num5 = Result5-1;
                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                               
                                                                                
                                                                                                                              
                                                                                
                                                                                                                                
                                                                                                                               
                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                FaseMsg: "Msg7G",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7G.Botao,
                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                
                                                                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7G.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                }) 
                                                                                                                                } else {
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                .doc(IdChat)
                                                                                                                                .update({
                                                                                                                                   
                                                                                                                                FaseMsg: "Msg7G",
                                                                                                                                DigiteNaRegra:true,
                                                                                                                                Robotizado:true, 
                                                                                                                                MsgFutura1:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                    Tempo:Tempo3,
                                                                                                                                },
                                                                                                                                MsgFutura2:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                    Tempo:Tempo4,
                                                                                                                                },
                                                                                                                                MsgFutura3:{
                                                                                                                                    Ativo:true,
                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                    Tempo:Tempo5,
                                                                                                                                },
                                                                                                                                UltimaMsg:{
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                    Autor:IdCli,
                                                                                                                                    body:Mensagem.body,
                                                                                                                                    date:new Date().getTime(),
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                    Type:"text"
                                                                                                                                },
                                                                                                                                {
                                                                                                                                    Autor:EMPRESA,
                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                    Botao:MsgEmp.Msg7G.Botao,
                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                    Type:"botao"
                                                                                                                                },
                                                                                                                               
                                                                                                                                
                                                                                                                                
                                                                                                                                )
                                                                                                                                })
                                                                                                                                .then(async() => {
                                                                                                                                   
                                                                                                                                    
                                                                                                                                
                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg7G.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    
                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                    
                                                                                                                                    
                                                                                                                                }) 
                                                                                        
                                                                                                                                
                                                                                                    
                                                                                                                                }
                                                                                                                                
                                                                                                                        
                                                                                                                            
                                                                                                                                
                                                                                                                            
                                                                                                                                }  else {
                                                                                                        
                                                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                                                    
                                                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                                            var Num = Result-1;
                                                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                    
                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                
                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                
                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                            
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                            DigiteNaRegra:false, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                            }, 
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            )
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                console.log(TempMsg)
                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                    
                                                                                                                                            }) 
                                                                                                                                        } else  if(EstaNaRegra === false ){
                                                                                                    
                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                
                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                
                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                        
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                            
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                            Robotizado:false, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"texto"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                            }, 
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },)
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                console.log(TempMsg)
                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    
                                                                                                                                            }) 
                                                                                                                                        }
                                                                                                                                    }
                                                                                                            
                                                                                                                        
                                                                                                                            
                                                                                                                            } else if(FaMsg === "Msg7H" ){//Recebendo o Que deseja mudar , Enviando A pergunta do que quer   mudar 
                                                                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                                                               
                                                                                                                               if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                        
                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                               
                                                                                                                           
                                                                                                                            
                                                                                                                                
                                                                                                
                                                                                                
                                                                                                                                //montar a mensagem   
                                                                                                                            var QMsg= MsgEmp.Msg7D.Msg.length;
                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                            var Num = Result-1;
                                                                                                                            var AutoMsg = MsgEmp.Msg7D.Msg[Num];
                                                                                                                            var TempMsg =  MsgEmp.Msg7D.TempoSeg;
                                                                                                                    
                                                                                                                            console.log(MsgEmp.Msg7D.Msg)
                                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                                            console.log("Msg: "+AutoMsg)
                                                                                    
                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                            var Num9 = Result9-1;
                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                        
                                                                                                            
                                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                                            var Num2 = Result2-1;
                                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                        
                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                            
                                                                                    
                                                                                                                            //Mensagens de estimulo 
                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                
                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                
                                                                                                                            var Num3 = Result3-1;
                                                                                                                            var Num4 = Result4-1;
                                                                                                                            var Num5 = Result5-1;
                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                           
                                                                            
                                                                                                                        

                                                                                                                       
                                                                                                                           
                                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                                            //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                              
                                                                                                                          
                                                                                                                                
                                                                                                                            
                                                                                                                            
                                                                                                                                response.json({ Inf:[  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                            }) 
                                                                                                                            } else {
                                                                                                                                //Mudando a Fase do Chat
                                                                                                                            await db.collection("ChatCliente")
                                                                                                                            .doc(IdChat)
                                                                                                                            .update({
                                                                                                                               
                                                                                                                            FaseMsg: "Msg7D",
                                                                                                                            DigiteNaRegra:true,
                                                                                                                            Robotizado:true, 
                                                                                                                            MsgFutura1:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg3,
                                                                                                                                Tempo:Tempo3,
                                                                                                                            },
                                                                                                                            MsgFutura2:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg4,
                                                                                                                                Tempo:Tempo4,
                                                                                                                            },
                                                                                                                            MsgFutura3:{
                                                                                                                                Ativo:true,
                                                                                                                                Msg:AutoMsg5,
                                                                                                                                Tempo:Tempo5,
                                                                                                                            },
                                                                                                                            UltimaMsg:{
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                Autor:IdCli,
                                                                                                                                body:Mensagem.body,
                                                                                                                                date:new Date().getTime(),
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                date:new Date().getTime()+2000,
                                                                                                                                Type:"text"
                                                                                                                            },
                                                                                                                            {
                                                                                                                                Autor:EMPRESA,
                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                Botao:MsgEmp.Msg7D.Botao,
                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                Type:"botao"
                                                                                                                            },
                                                                                                                           
                                                                                                                            
                                                                                                                            
                                                                                                                            )
                                                                                                                            })
                                                                                                                            .then(async() => {
                                                                                                                               
                                                                                                                               
                                                                                                                               
                                                                                                                            
                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:MsgEmp.Msg7D.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                
                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                
                                                                                                                                
                                                                                                                            }) 
                                                                                    
                                                                                                                            
                                                                                                
                                                                                                                            }
                                                                                                                            
                                                                                                                    
                                                                                                                        
                                                                                                                            
                                                                                                                        
                                                                                                                            }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                                //montar a mensagem   
                                                                                                                    var QMsg= MsgEmp.Msg7B.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg7B.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg7B.TempoSeg;
                                                                                                            
                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                            
                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                    var Num9 = Result9-1;
                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    
                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                    var Num2 = Result2-1;
                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                
                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                    
                                                                            
                                                                                                                    //Mensagens de estimulo 
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                   
                                                                    
                                                                                                                 
                                                                                                                    
                                                                                                                   
                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg7B",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                        MemSessao:[],
                                                                                                                        MemPedido:[],
                                                                                                                        MemProdutos:[],
                                                                                                                        MemSubSessao:[],
                                                                                                                        MenSabor:0,
                                                                                                                        EscolhaSabor:0, 
                                                                                                                    FaseMsg: "Msg6A",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                       
                                                                                                                        
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        
                                                                                                                        
                                                                                                                    }) 
                                                                            
                                                                                                                    
                                                                                        
                                                                                                                }
    
                                                                                                                     } else  if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){
                                                                                                                    
                                                                                                                        
                                                                                        
                                                                                        
                                                                                                                        //montar a mensagem   
                                                                                                                    var QMsg= MsgEmp.Msg7C.Msg.length;
                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                    var Num = Result-1;
                                                                                                                    var AutoMsg = MsgEmp.Msg7C.Msg[Num];
                                                                                                                    var TempMsg =  MsgEmp.Msg7C.TempoSeg;
                                                                                                            
                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                            
                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                    var Num9 = Result9-1;
                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                
                                                                                                    
                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                    var Num2 = Result2-1;
                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                
                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                    
                                                                            
                                                                                                                    //Mensagens de estimulo 
                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                        
                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                        
                                                                                                                    var Num3 = Result3-1;
                                                                                                                    var Num4 = Result4-1;
                                                                                                                    var Num5 = Result5-1;
                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                   
                                                                    
                                                                                                                  
                                                                    
                                                                                                                    
                                                                                                                   
                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                    //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                    
                                                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                    }) 
                                                                                                                    } else {
                                                                                                                        //Mudando a Fase do Chat
                                                                                                                    await db.collection("ChatCliente")
                                                                                                                    .doc(IdChat)
                                                                                                                    .update({
                                                                                                                        MemSessao:[],
                                                                                                                        MemPedido:[],
                                                                                                                        MemProdutos:[],
                                                                                                                        MemSubSessao:[],
                                                                                                                        MenSabor:0,
                                                                                                                        EscolhaSabor:0, 
                                                                                                                    FaseMsg: "Msg7C",
                                                                                                                    DigiteNaRegra:true,
                                                                                                                    Robotizado:true, 
                                                                                                                    MsgFutura1:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg3,
                                                                                                                        Tempo:Tempo3,
                                                                                                                    },
                                                                                                                    MsgFutura2:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg4,
                                                                                                                        Tempo:Tempo4,
                                                                                                                    },
                                                                                                                    MsgFutura3:{
                                                                                                                        Ativo:true,
                                                                                                                        Msg:AutoMsg5,
                                                                                                                        Tempo:Tempo5,
                                                                                                                    },
                                                                                                                    UltimaMsg:{
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                        Autor:IdCli,
                                                                                                                        body:Mensagem.body,
                                                                                                                        date:new Date().getTime(),
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                    {
                                                                                                                        Autor:EMPRESA,
                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                        Type:"text"
                                                                                                                    },
                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                    )
                                                                                                                    })
                                                                                                                    .then(async() => {
                                                                                                                       
                                                                                                                        
                                                                                                                    
                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                        
                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                        
                                                                                                                        
                                                                                                                    }) 
                                                                            
                                                                                                                }
                                                                                        
                                                                                                                        }  else  if(Mensagem.body === "3" || Mensagem.body === " 3" || Mensagem.body === "3 " || Mensagem.body === " 3 "){
                                                                                                                                
                                                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                                                       
                                                                                                                                        var menus = [{id:0, body:"Voltar"}]
                                                                                                                                        for(let i in DadoEmp.BairroEntregas){
                                                                                                                                         if(DadoEmp.BairroEntregas[i].Ativo){
                                                                                                                                             menus.push({
                                                                                                                                                 id:i,
                                                                                                                                                 body:DadoEmp.BairroEntregas[i].Bairro,
                                                                                                                                                 Preco:DadoEmp.BairroEntregas[i].PrecoReal,
                                                                                                                                             })
                                                                                                                                         }
                                                                                                                                        }
                                                                                                                                    
                                                                                                                                        
                                                                                                        
                                                                                                        
                                                                                                                                        //montar a mensagem   
                                                                                                                                    var QMsg= MsgEmp.Msg7A.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg7A.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg7A.TempoSeg;
                                                                                                                            
                                                                                                                                    console.log(MsgEmp.Msg7E.Msg)
                                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                                            
                                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                                    var Num9 = Result9-1;
                                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                
                                                                                                                    
                                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                                    var Num2 = Result2-1;
                                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                
                                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                                    
                                                                                            
                                                                                                                                    //Mensagens de estimulo 
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                   
                                                                                    
                                                                                                                                  
                                                                                    
                                                                                                                                    
                                                                                                                                   
                                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    FaseMsg: "Msg7E",
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MemBairro:menus,
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        Botao:menus,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:menus, Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                       
                                                                                                                                    FaseMsg: "Msg7E",
                                                                                                                                    MemBairro:menus,
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        Botao:menus,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"botao"
                                                                                                                                    },
                                                                                                                                   
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                       
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:menus, Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        
                                                                                                                                        
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    
                                                                                                        
                                                                                                                                    }
                                                                                                                                    
                                                                                                                            
                                                                                                                                
                                                                                                                                    
                                                                                                                                
                                                                                                                                    }  else  if(Mensagem.body === "4" || Mensagem.body === " 4" || Mensagem.body === "4 " || Mensagem.body === " 4 "){
                                                                                                                        
                                                                                                                            
                                                                                            
                                                                                            
                                                                                                                                        //montar a mensagem   
                                                                                                                                    var QMsg= MsgEmp.Msg7F.Msg.length;
                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                    var Num = Result-1;
                                                                                                                                    var AutoMsg = MsgEmp.Msg7F.Msg[Num];
                                                                                                                                    var TempMsg =  MsgEmp.Msg7F.TempoSeg;
                                                                                                                            
                                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                                            
                                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                                    var Num9 = Result9-1;
                                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                
                                                                                                                    
                                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                                    var Num2 = Result2-1;
                                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                
                                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                                    
                                                                                            
                                                                                                                                    //Mensagens de estimulo 
                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                        
                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                        
                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                   
                                                                                    
                                                                                    
                                                                                                                                    
                                                                                                                                   
                                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                    FaseMsg: "Msg7F",
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[ {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                    }) 
                                                                                                                                    } else {
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                    .doc(IdChat)
                                                                                                                                    .update({
                                                                                                                                       
                                                                                                                                    FaseMsg: "Msg7F",
                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                    Robotizado:true, 
                                                                                                                                    MsgFutura1:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                        Tempo:Tempo3,
                                                                                                                                    },
                                                                                                                                    MsgFutura2:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                        Tempo:Tempo4,
                                                                                                                                    },
                                                                                                                                    MsgFutura3:{
                                                                                                                                        Ativo:true,
                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                        Tempo:Tempo5,
                                                                                                                                    },
                                                                                                                                    UltimaMsg:{
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                        Autor:IdCli,
                                                                                                                                        body:Mensagem.body,
                                                                                                                                        date:new Date().getTime(),
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                    {
                                                                                                                                        Autor:EMPRESA,
                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                        Type:"text"
                                                                                                                                    },
                                                                                                                                   
                                                                                                                                    
                                                                                                                                    
                                                                                                                                    )
                                                                                                                                    })
                                                                                                                                    .then(async() => {
                                                                                                                                       
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                        
                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                        
                                                                                                                                        
                                                                                                                                    }) 
                                                                                            
                                                                                                                                    
                                                                                                        
                                                                                                                                    }
                                                                                                                                    
                                                                                                                            
                                                                                                                                   } else {
                                                                                                            
                                                                                                                                            if(EstaNaRegra === true && Robo === true){
                                                                                                        
                                                                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                        
                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                DigiteNaRegra:false, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                }, 
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                        
                                                                                                                                                }) 
                                                                                                                                            } else  if(EstaNaRegra === false ){
                                                                                                        
                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                            
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                Robotizado:false, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"texto"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                }, 
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },)
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                        
                                                                                                                                                }) 
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                
                                                                                                                            
                                                                                                                                
                                                                                                                                } else if(FaMsg === "Msg7G" ){//Recebendo Sim ou Não Se O Cliente Está no endereço da Entrega , Enviando A pergunta de qula deseja mudar ou se está no endereço 
                                                                                                                                    var NumIni = parseInt(Mensagem.body)  
                                                                                                                                   
                                                                                                                                   if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                                    
                                                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                                                           
                                                                                                                                            var PedidosItens = []
                                                                                                                                            var ValorEnt = 0;

                                                                                                                                            await db.collection("MesaItem")
                                                                                                                                            .doc(PedidoCri)
                                                                                                                                            .get().then((doc)=>{
                                                                                                                                                PedidosItens = doc.data().Itens;
                                                                                                                                                ValorEnt = doc.data().ValorEntrega;
                                                                                                                                            })
                                                                                                                                        
                                                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                                                            //montar a mensagem   
                                                                                                                                        var QMsg= MsgEmp.Msg10B.Msg.length;
                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                        var Num = Result-1;
                                                                                                                                        var AutoMsg = MsgEmp.Msg10B.Msg[Num];
                                                                                                                                        var TempMsg =  MsgEmp.Msg10B.TempoSeg;
                                                                                                                                
                                                                                                                                        console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                                                        console.log("Msg: "+AutoMsg)
                                                                                                
                                                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                                                        var Num9 = Result9-1;
                                                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                    
                                                                                                                        
                                                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                                                        var Num2 = Result2-1;
                                                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                    
                                                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                                                        
                                                                                                
                                                                                                                                        //Mensagens de estimulo 
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                       
                                                                                        
                                                                                                                                      
                                                                                        
                                                                                                                                        
                                                                                                                                       
                                                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        FaseMsg: "Msg10B",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"botao"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                                            Type:"botao"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                             var TotalValor = 0
                                                                                                                                                for(let i in PedidosItens){
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                    
                                                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                     
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                    }
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    } else {
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                            
                                                                                                                                                }
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                TotalValor = TotalValor+ValorEnt;
                                                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})

                                                                                                                                            response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                        }) 
                                                                                                                                        } else {
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                           
                                                                                                                                        FaseMsg: "Msg10B",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                                            Type:"botao"
                                                                                                                                        },
                                                                                                                                       
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                            var TotalValor = 0
                                                                                                                                            for(let i in PedidosItens){
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                
                                                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                    }
                                                                                                                                                } else {
                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                    }
                                                                                                                                                }
                                                                                        
                                                                                                                                            }
                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                            MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                            TotalValor = TotalValor+ValorEnt;
                                                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                            
                                                                                                                                        
                                                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                            
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            
                                                                                                                                            
                                                                                                                                        }) 
                                                                                                
                                                                                                                                        
                                                                                                            
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                
                                                                                                                                    
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                                    
                                                                                                                                            //Escolhendo os itens da sessão escolhida
                                                                                                                                           
                                                                                                                                       
                                                                                                                                        
                                                                                                                                            
                                                                                                            
                                                                                                            
                                                                                                                                            //montar a mensagem   
                                                                                                                                        var QMsg= MsgEmp.Msg8A.Msg.length;
                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                        var Num = Result-1;
                                                                                                                                        var AutoMsg = MsgEmp.Msg8A.Msg[Num];
                                                                                                                                        var TempMsg =  MsgEmp.Msg8A.TempoSeg;
                                                                                                                                
                                                                                                                                        console.log(MsgEmp.Msg8A.Msg)
                                                                                                                                        console.log("Qmsg: "+QMsg)       
                                                                                                                                        console.log("Soteio: "+Sorteio)                 
                                                                                                                                        console.log("Msg: "+AutoMsg)
                                                                                                
                                                                                                                                            //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                        var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                        var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                        var Result9 =parseInt(Sorteio9);
                                                                                                                                        var Num9 = Result9-1;
                                                                                                                                        var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                        var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                    
                                                                                                                        
                                                                                                                                        var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                        var Result2 =parseInt(Sorteio2);
                                                                                                                                        var Num2 = Result2-1;
                                                                                                                                        var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                        var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                    
                                                                                                                                        //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                        //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                        //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                        //  console.log("Msg: "+AutoMsg2)
                                                                                                                                        
                                                                                                
                                                                                                                                        //Mensagens de estimulo 
                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                            
                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                            
                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                       
                                                                                        
                                                                                                                                      
                                                                                        
                                                                                                                                        
                                                                                                                                       
                                                                                                                                        if(Robo === true && EstaNaRegra === true){
                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                        FaseMsg: "Msg8A",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:[],
                                                                                                                                            date:new Date().getTime()+7000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                            MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                           MsgInst =MsgInst+ "2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                           MsgInst = MsgInst+ "3° Passo - Clique Localização atual"
                                                                                                                                            response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                        }) 
                                                                                                                                        } else {
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                        .doc(IdChat)
                                                                                                                                        .update({
                                                                                                                                           
                                                                                                                                        FaseMsg: "Msg8A",
                                                                                                                                        DigiteNaRegra:true,
                                                                                                                                        Robotizado:true, 
                                                                                                                                        MsgFutura1:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                            Tempo:Tempo3,
                                                                                                                                        },
                                                                                                                                        MsgFutura2:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                            Tempo:Tempo4,
                                                                                                                                        },
                                                                                                                                        MsgFutura3:{
                                                                                                                                            Ativo:true,
                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                            Tempo:Tempo5,
                                                                                                                                        },
                                                                                                                                        UltimaMsg:{
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                            Autor:IdCli,
                                                                                                                                            body:Mensagem.body,
                                                                                                                                            date:new Date().getTime(),
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                            date:new Date().getTime()+2000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                        {
                                                                                                                                            Autor:EMPRESA,
                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                            Botao:[],
                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                            Type:"text"
                                                                                                                                        },
                                                                                                                                       
                                                                                                                                        
                                                                                                                                        
                                                                                                                                        )
                                                                                                                                        })
                                                                                                                                        .then(async() => {
                                                                                                                                            var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                            MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                           MsgInst = MsgInst+"2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                           MsgInst = MsgInst+"3° Passo - Clique Localização atual"
                                                                                                                                            
                                                                                                                                        
                                                                                                                                            response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                            
                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                            
                                                                                                                                            
                                                                                                                                        }) 
                                                                                                
                                                                                                                                        
                                                                                                            
                                                                                                                                        }
                                                                                                                                        
                                                                                                                                
                                                                                                                                    
                                                                                                                                        
                                                                                                                                    
                                                                                                                                        }  else {
                                                                                                                
                                                                                                                                                if(EstaNaRegra === true && Robo === true){
                                                                                                            
                                                                                                                                                    var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                                    var Num = Result-1;
                                                                                                                                                    var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                    var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                            
                                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                        
                                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                                        
                                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                    
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                    DigiteNaRegra:false, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                    }, 
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    )
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                        console.log(TempMsg)
                                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                            
                                                                                                                                                    }) 
                                                                                                                                                } else  if(EstaNaRegra === false ){
                                                                                                            
                                                                                                                                                    //mensagens de estimulo para continuar o atendimento
                                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                        
                                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                                        
                                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                    
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                    Robotizado:false, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"texto"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                    }, 
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },)
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                        console.log(TempMsg)
                                                                                                                                                        response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                            
                                                                                                                                                    }) 
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                    
                                                                                                                                
                                                                                                                                    
                                                                                                                                    } else if(FaMsg === "Msg8A" ){//Recebendo a Localização , Enviando a Pergunta de PAgamento
                                                                                                                                        var NumIni = parseInt(Mensagem.body)  
                                                                                                                                       
                                                                                                                                       if(Type === "location"){
                                                                                                                                        
                                                                                                                                        await db.collection("MesaItem")
                                                                                                                                        .doc(PedidoCri)
                                                                                                                                        .update({
                                                                                                                                          
                                                                                                                                            "End.Localizacao.lat":Mensagem.location.latitude,
                                                                                                                                            "End.Localizacao.lng":Mensagem.location.longitude,
                                                                                                                                            
                                                                                                                                             
                                                                                                                                        }).then((doc)=>{
                                                                                                                                           
                                                                                                                                        })
                                                                                        


                                                                                                                                                //Escolhendo os itens da sessão escolhida
                                                                                                                                               
                                                                                                                                    
                                                                                                                                                //https://www.google.com/maps?q=-4.2092412,-44.443785&z=17&hl=pt-BR
                                                                                                                                          
                                                                                                                                            
                                                                                                                                                var PedidosItens = []
                                                                                                                                                var ValorEnt = 0;
    
                                                                                                                                                await db.collection("MesaItem")
                                                                                                                                                .doc(PedidoCri)
                                                                                                                                                .get().then((doc)=>{
                                                                                                                                                    PedidosItens = doc.data().Itens;
                                                                                                                                                    ValorEnt = doc.data().ValorEntrega;
                                                                                                                                                })
                                                                                                                                            
                                                                                                                                                
                                                                                                                
                                                                                                                
                                                                                                                                                //montar a mensagem   
                                                                                                                                            var QMsg= MsgEmp.Msg10B.Msg.length;
                                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                                            var Num = Result-1;
                                                                                                                                            var AutoMsg = MsgEmp.Msg10B.Msg[Num];
                                                                                                                                            var TempMsg =  MsgEmp.Msg10B.TempoSeg;
                                                                                                                                    
                                                                                                                                            console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                            console.log("Qmsg: "+QMsg)       
                                                                                                                                            console.log("Soteio: "+Sorteio)                 
                                                                                                                                            console.log("Msg: "+AutoMsg)
                                                                                                    
                                                                                                                                                //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                            var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                            var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                            var Result9 =parseInt(Sorteio9);
                                                                                                                                            var Num9 = Result9-1;
                                                                                                                                            var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                            var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                        
                                                                                                                            
                                                                                                                                            var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                            var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                            var Result2 =parseInt(Sorteio2);
                                                                                                                                            var Num2 = Result2-1;
                                                                                                                                            var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                            var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                        
                                                                                                                                            //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                            //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                            //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                            //  console.log("Msg: "+AutoMsg2)
                                                                                                                                            
                                                                                                    
                                                                                                                                            //Mensagens de estimulo 
                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                
                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                
                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                           
                                                                                            
                                                                                                                                          
                                                                                            
                                                                                                                                            
                                                                                                                                           
                                                                                                                                            if(Robo === true && EstaNaRegra === true){
                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                            FaseMsg: "Msg10B",
                                                                                                                                            DigiteNaRegra:true,
                                                                                                                                            Robotizado:true, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"botao"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:`https://www.google.com/maps?q=${Mensagem.location.latitude},${Mensagem.location.longitude}&z=17&hl=pt-BR`,
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:"Link"
                                                                                                                                            },
                                                                                                                                            
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                                Type:"botao"
                                                                                                                                            },
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            )
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                 var TotalValor = 0
                                                                                                                                                    for(let i in PedidosItens){
                                                                                                                                                        
                                                                                                                                                    
                                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                        
                                                                                                                                                            MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                         
                                                                                                                                                        
                                                                                                                                                        if(PedidosItens[i].ItemEspeci){
                                                                                                                                                            MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                        }
                                                                                                                                                        
                                                                                                                                                        if(PedidosItens[i].Descont){
                                                                                                                                                            TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                            MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                            MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                            if(PedidosItens[i].Observacao){
                                                                                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                            }
                                                                                                                                                        } else {
                                                                                                                                                            TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                            MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                            MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                            if(PedidosItens[i].Observacao){
                                                                                                                                                            MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                
                                                                                                                                                    }
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    TotalValor = TotalValor+ValorEnt;
                                                                                                                                                    MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
    
                                                                                                                                                response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                            }) 
                                                                                                                                            } else {
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                            .doc(IdChat)
                                                                                                                                            .update({
                                                                                                                                               
                                                                                                                                            FaseMsg: "Msg10B",
                                                                                                                                            DigiteNaRegra:true,
                                                                                                                                            Robotizado:true, 
                                                                                                                                            MsgFutura1:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                Tempo:Tempo3,
                                                                                                                                            },
                                                                                                                                            MsgFutura2:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                Tempo:Tempo4,
                                                                                                                                            },
                                                                                                                                            MsgFutura3:{
                                                                                                                                                Ativo:true,
                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                Tempo:Tempo5,
                                                                                                                                            },
                                                                                                                                            UltimaMsg:{
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                Autor:IdCli,
                                                                                                                                                body:`https://www.google.com/maps?q=${Mensagem.location.latitude},${Mensagem.location.longitude}&z=17&hl=pt-BR`,
                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                date:new Date().getTime()+2000,
                                                                                                                                                Type:"text"
                                                                                                                                            },
                                                                                                                                            {
                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                date:new Date().getTime()+7000,
                                                                                                                                                Type:"botao"
                                                                                                                                            },
                                                                                                                                           
                                                                                                                                            
                                                                                                                                            
                                                                                                                                            )
                                                                                                                                            })
                                                                                                                                            .then(async() => {
                                                                                                                                                var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                var TotalValor = 0
                                                                                                                                                for(let i in PedidosItens){
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                    MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                    
                                                                                                                                                        MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].ItemEspeci){
                                                                                                                                                        MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                    }
                                                                                                                                                    
                                                                                                                                                    if(PedidosItens[i].Descont){
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    } else {
                                                                                                                                                        TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                        MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                        MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                        if(PedidosItens[i].Observacao){
                                                                                                                                                        MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                            
                                                                                                                                                }
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                TotalValor = TotalValor+ValorEnt;
                                                                                                                                                MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                
                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                
                                                                                                                                                
                                                                                                                                            }) 
                                                                                                    
                                                                                                                                            
                                                                                                                
                                                                                                                                            }      
                                                                                                                
                                                                                                                
                                                                                                                                           
                                                                                                                                            
                                                                                                                                    
                                                                                                                                           
                                                                                                                                            
                                                                                                                                        
                                                                                                                                            }  else {
                                                                                                                    
                                                                                                                                                    if(EstaNaRegra === true && Robo === true){
                                                                                                                
                                                                                                                                                        var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                        var Result =parseInt(Sorteio);
                                                                                                                                                        var Num = Result-1;
                                                                                                                                                        var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                        var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                                
                                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                            
                                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                                            
                                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                                        
                                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                                        .doc(IdChat)
                                                                                                                                                        .update({
                                                                                                                                                        DigiteNaRegra:false, 
                                                                                                                                                        MsgFutura1:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                                            Tempo:Tempo3,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura2:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                                            Tempo:Tempo4,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura3:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                                            Tempo:Tempo5,
                                                                                                                                                        },
                                                                                                                                                        UltimaMsg:{
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"text"
                                                                                                                                                        },
                                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                            Autor:IdCli,
                                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                            date:new Date().getTime(),
                                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                        }, 
                                                                                                                                                        {
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"text"
                                                                                                                                                        },
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                        )
                                                                                                                                                        })
                                                                                                                                                        .then(async() => {
                                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                            console.log(TempMsg)
                                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                
                                                                                                                                                        }) 
                                                                                                                                                    } else  if(EstaNaRegra === false ){
                                                                                                                
                                                                                                                                                        //mensagens de estimulo para continuar o atendimento
                                                                                                                                                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                            
                                                                                                                                                        var Result3 =parseInt(Sorteio3);
                                                                                                                                                        var Result4 =parseInt(Sorteio4);
                                                                                                                                                        var Result5 =parseInt(Sorteio5);
                                                                                                                                            
                                                                                                                                                        var Num3 = Result3-1;
                                                                                                                                                        var Num4 = Result4-1;
                                                                                                                                                        var Num5 = Result5-1;
                                                                                                                                                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                                        
                                                                                                                                                        await db.collection("ChatCliente")
                                                                                                                                                        .doc(IdChat)
                                                                                                                                                        .update({
                                                                                                                                                        Robotizado:false, 
                                                                                                                                                        MsgFutura1:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg3,
                                                                                                                                                            Tempo:Tempo3,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura2:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg4,
                                                                                                                                                            Tempo:Tempo4,
                                                                                                                                                        },
                                                                                                                                                        MsgFutura3:{
                                                                                                                                                            Ativo:true,
                                                                                                                                                            Msg:AutoMsg5,
                                                                                                                                                            Tempo:Tempo5,
                                                                                                                                                        },
                                                                                                                                                        UltimaMsg:{
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"texto"
                                                                                                                                                        },
                                                                                                                                                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                            Autor:IdCli,
                                                                                                                                                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                            date:new Date().getTime(),
                                                                                                                                                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                        }, 
                                                                                                                                                        {
                                                                                                                                                            Autor:EMPRESA,
                                                                                                                                                            body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                            date:new Date().getTime()+5000,
                                                                                                                                                            Type:"text"
                                                                                                                                                        },)
                                                                                                                                                        })
                                                                                                                                                        .then(async() => {
                                                                                                                                                            var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                            //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                            console.log(TempMsg)
                                                                                                                                                            response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                
                                                                                                                                                        }) 
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                        
                                                                                                                                    
                                                                                                                                        
                                                                                                                                        } else if(FaMsg === "Msg10B" ){//Recebendo Qual meio de Pagamento  , Enviando A pergunta  pra ele fazer o pix  
                                                                                                                                            var NumIni = parseInt(Mensagem.body)  
                                                                                                                                           
                                                                                                                                           if(Mensagem.body === "0" || Mensagem.body === " 0" || Mensagem.body === "0 " || Mensagem.body === " 0 "){
                                                                                                                                            
                                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                                   
                                                                                                                                                    var PedidosItens = []
                                                                                                                                                    var ValorEnt = 0;
        
                                                                                                                                                    await db.collection("MesaItem")
                                                                                                                                                    .doc(PedidoCri)
                                                                                                                                                    .get().then((doc)=>{
                                                                                                                                                        PedidosItens = doc.data().Itens;
                                                                                                                                                        ValorEnt = doc.data().ValorEntrega;
                                                                                                                                                    })
                                                                                                                                                
                                                                                                                                                   
                                                                                                                    
                                                                                                                    
                                                                                                                                                    //montar a mensagem   
                                                                                                                                                var QMsg= MsgEmp.Msg11A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg11A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg11A.TempoSeg;
                                                                                                                                        
                                                                                                                                                console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                                console.log("Msg: "+AutoMsg)

                                                                                                                                                var QMsg2= MsgEmp.Msg11B.Msg.length;
                                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                                var Num2 = Result2-1;
                                                                                                                                                var AutoMsg2 = MsgEmp.Msg11B.Msg[Num2];
                                                                                                                                                var TempMsg2 =  MsgEmp.Msg11B.TempoSeg;
                                                                                                        
                                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                                var Num9 = Result9-1;
                                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                            
                                                                                                                                
                                                                                                                                             
                                                                                                                            
                                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                
                                                                                                        
                                                                                                                                                //Mensagens de estimulo 
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                                                                                                                                               
                                                                                                                                                var MsgPedido = NomeCli+AutoMsg+"\n";
                                                                                                                                                var TotalValor = 0
                                                                                                                                                   for(let i in PedidosItens){
                                                                                                                                              
                                                                                                                                                       
                                                                                                                                                       if(PedidosItens[i].Descont){
                                                                                                                                                           TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)

                                                                                                                                                       } else {
                                                                                                                                                           TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                
                                                                                                                                                       }
                                                                                               
                                                                                                                                                   }
                                                                                                                                                   MsgPedido = MsgPedido + "===================\n"
                                                                                                                                                   MsgPedido = MsgPedido + " Nome da Conta: "+DadoEmp.Pix.Nome+"\n"
                                                                                                                                                   MsgPedido = MsgPedido + " Tipo de Pix: "+DadoEmp.Pix.Tipo+"\n"
                                                                                                                                                   MsgPedido = MsgPedido + " Numero do Pix: "+DadoEmp.Pix.Numero
                                                                                                                                                   MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                   MsgPedido = MsgPedido + " 📦Valor do Pedido: "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                   MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                   MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                   MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                   TotalValor = TotalValor+ValorEnt;
                                                                                                                                                   MsgPedido = MsgPedido + "💰Valor A Ser Pago Via Pix: "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                              
                                                                                                
                                                                                                                                                
                                                                                                                                               
                                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                FaseMsg: "Msg11B",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg2}`,
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${MsgPedido}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+4000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },

                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                   
        
                                                                                                                                                    response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:`*${NomeCli} ${AutoMsg2}*` , Botao:[] , Tempo:TempMsg2, Type:"text"},] });
                                                                                                                                                }) 
                                                                                                                                                } else {
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                   
                                                                                                                                                FaseMsg: "Msg11B",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${MsgPedido}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+4000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },

                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli} ${AutoMsg2}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:`*${NomeCli} ${AutoMsg2}*` , Botao:[] , Tempo:TempMsg2, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                }) 
                                                                                                        
                                                                                                                                                
                                                                                                                    
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                        
                                                                                                                                            
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                }  else  if(Mensagem.body === "1" || Mensagem.body === " 1" || Mensagem.body === "1 " || Mensagem.body === " 1 "){
                                                                                                                                            
                                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                                   
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                                                    //montar a mensagem   
                                                                                                                                                var QMsg= MsgEmp.Msg8A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg8A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg8A.TempoSeg;
                                                                                                                                        
                                                                                                                                                console.log(MsgEmp.Msg8A.Msg)
                                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                                        
                                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                                var Num9 = Result9-1;
                                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                            
                                                                                                                                
                                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                                var Num2 = Result2-1;
                                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                            
                                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                
                                                                                                        
                                                                                                                                                //Mensagens de estimulo 
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                               
                                                                                                
                                                                                                                                              
                                                                                                
                                                                                                                                                
                                                                                                                                               
                                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst =MsgInst+ "2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+ "3° Passo - Clique Localização atual"
                                                                                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                }) 
                                                                                                                                                } else {
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                   
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst = MsgInst+"2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+"3° Passo - Clique Localização atual"
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                }) 
                                                                                                        
                                                                                                                                                
                                                                                                                    
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                        
                                                                                                                                            
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                }   else  if(Mensagem.body === "2" || Mensagem.body === " 2" || Mensagem.body === "2 " || Mensagem.body === " 2 "){
                                                                                                                                            
                                                                                                                                                    //Escolhendo os itens da sessão escolhida
                                                                                                                                                   
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                    
                                                                                                                    
                                                                                                                    
                                                                                                                                                    //montar a mensagem   
                                                                                                                                                var QMsg= MsgEmp.Msg8A.Msg.length;
                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                var Num = Result-1;
                                                                                                                                                var AutoMsg = MsgEmp.Msg8A.Msg[Num];
                                                                                                                                                var TempMsg =  MsgEmp.Msg8A.TempoSeg;
                                                                                                                                        
                                                                                                                                                console.log(MsgEmp.Msg8A.Msg)
                                                                                                                                                console.log("Qmsg: "+QMsg)       
                                                                                                                                                console.log("Soteio: "+Sorteio)                 
                                                                                                                                                console.log("Msg: "+AutoMsg)
                                                                                                        
                                                                                                                                                    //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                var Result9 =parseInt(Sorteio9);
                                                                                                                                                var Num9 = Result9-1;
                                                                                                                                                var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                            
                                                                                                                                
                                                                                                                                                var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                                var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                var Result2 =parseInt(Sorteio2);
                                                                                                                                                var Num2 = Result2-1;
                                                                                                                                                var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                                var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                            
                                                                                                                                                //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                
                                                                                                        
                                                                                                                                                //Mensagens de estimulo 
                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                    
                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                    
                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                               
                                                                                                
                                                                                                                                              
                                                                                                
                                                                                                                                                
                                                                                                                                               
                                                                                                                                                if(Robo === true && EstaNaRegra === true){
                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+7000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst =MsgInst+ "2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+ "3° Passo - Clique Localização atual"
                                                                                                                                                    response.json({ Inf:[ {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                }) 
                                                                                                                                                } else {
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                .doc(IdChat)
                                                                                                                                                .update({
                                                                                                                                                   
                                                                                                                                                FaseMsg: "Msg8A",
                                                                                                                                                DigiteNaRegra:true,
                                                                                                                                                Robotizado:true, 
                                                                                                                                                MsgFutura1:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                },
                                                                                                                                                MsgFutura2:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                },
                                                                                                                                                MsgFutura3:{
                                                                                                                                                    Ativo:true,
                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                },
                                                                                                                                                UltimaMsg:{
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                    Autor:IdCli,
                                                                                                                                                    body:Mensagem.body,
                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                    date:new Date().getTime()+2000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                                {
                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                    Botao:[],
                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                    Type:"text"
                                                                                                                                                },
                                                                                                                                               
                                                                                                                                                
                                                                                                                                                
                                                                                                                                                )
                                                                                                                                                })
                                                                                                                                                .then(async() => {
                                                                                                                                                    var MsgInst = "Passo A Passo de Como Mandar A Localização\n"
                                                                                                                                                    MsgInst =MsgInst+ "1° Passo - Clique no Clipe 📎 que está aonde você digita e mensagem\n"
                                                                                                                                                   MsgInst = MsgInst+"2° Passo - Clique no Botão Localização 🗺️\n";
                                                                                                                                                   MsgInst = MsgInst+"3° Passo - Clique Localização atual"
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}, {Msg:MsgInst , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                }) 
                                                                                                        
                                                                                                                                                
                                                                                                                    
                                                                                                                                                }
                                                                                                                                                
                                                                                                                                        
                                                                                                                                            
                                                                                                                                                
                                                                                                                                            
                                                                                                                                                }else {
                                                                                                                        
                                                                                                                                                        if(EstaNaRegra === true && Robo === true){
                                                                                                                    
                                                                                                                                                            var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                            var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                            var Result =parseInt(Sorteio);
                                                                                                                                                            var Num = Result-1;
                                                                                                                                                            var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                            var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                                    
                                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                
                                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                                
                                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                                            
                                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                                            .doc(IdChat)
                                                                                                                                                            .update({
                                                                                                                                                            DigiteNaRegra:false, 
                                                                                                                                                            MsgFutura1:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                                Tempo:Tempo3,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura2:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                                Tempo:Tempo4,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura3:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                                Tempo:Tempo5,
                                                                                                                                                            },
                                                                                                                                                            UltimaMsg:{
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"text"
                                                                                                                                                            },
                                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                Autor:IdCli,
                                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                            }, 
                                                                                                                                                            {
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"text"
                                                                                                                                                            },
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            )
                                                                                                                                                            })
                                                                                                                                                            .then(async() => {
                                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                console.log(TempMsg)
                                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    
                                                                                                                                                            }) 
                                                                                                                                                        } else  if(EstaNaRegra === false ){
                                                                                                                    
                                                                                                                                                            //mensagens de estimulo para continuar o atendimento
                                                                                                                                                            var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                            var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                            var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                            var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                            var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                
                                                                                                                                                            var Result3 =parseInt(Sorteio3);
                                                                                                                                                            var Result4 =parseInt(Sorteio4);
                                                                                                                                                            var Result5 =parseInt(Sorteio5);
                                                                                                                                                
                                                                                                                                                            var Num3 = Result3-1;
                                                                                                                                                            var Num4 = Result4-1;
                                                                                                                                                            var Num5 = Result5-1;
                                                                                                                                                            var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                            var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                            var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                            var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                            var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                            //Mudando a Fase do Chat
                                                                                                                                                            
                                                                                                                                                            await db.collection("ChatCliente")
                                                                                                                                                            .doc(IdChat)
                                                                                                                                                            .update({
                                                                                                                                                            Robotizado:false, 
                                                                                                                                                            MsgFutura1:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg3,
                                                                                                                                                                Tempo:Tempo3,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura2:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg4,
                                                                                                                                                                Tempo:Tempo4,
                                                                                                                                                            },
                                                                                                                                                            MsgFutura3:{
                                                                                                                                                                Ativo:true,
                                                                                                                                                                Msg:AutoMsg5,
                                                                                                                                                                Tempo:Tempo5,
                                                                                                                                                            },
                                                                                                                                                            UltimaMsg:{
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"texto"
                                                                                                                                                            },
                                                                                                                                                            Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                Autor:IdCli,
                                                                                                                                                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                date:new Date().getTime(),
                                                                                                                                                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                            }, 
                                                                                                                                                            {
                                                                                                                                                                Autor:EMPRESA,
                                                                                                                                                                body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                date:new Date().getTime()+5000,
                                                                                                                                                                Type:"text"
                                                                                                                                                            },)
                                                                                                                                                            })
                                                                                                                                                            .then(async() => {
                                                                                                                                                                var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                console.log(TempMsg)
                                                                                                                                                                response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                    
                                                                                                                                                            }) 
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                            
                                                                                                                                        
                                                                                                                                            
                                                                                                                                            } else if(FaMsg === "Msg11B" ){//Recebendo a Localização , Enviando a Pergunta de PAgamento
                                                                                                                                                var NumIni = parseInt(Mensagem.body)  
                                                                                                                                               
                                                                                                                                               if(Type ==="image" || Type === "document"){
                                                                                                                                                
                                                                                                                                               
        
        
                                                                                                                                                        //Escolhendo os itens da sessão escolhida
                                                                                                                                                       
                                                                                                                                            
                                                                                                                                                        //https://www.google.com/maps?q=-4.2092412,-44.443785&z=17&hl=pt-BR
                                                                                                                                                  
                                                                                                                                                    
                                                                                                                                                        var PedidosItens = []
                                                                                                                                                        var ValorEnt = 0;
                                                                                                                                                        var EndCli ={}
            
                                                                                                                                                        await db.collection("MesaItem")
                                                                                                                                                        .doc(PedidoCri)
                                                                                                                                                        .get().then((doc)=>{
                                                                                                                                                            PedidosItens = doc.data().Itens;
                                                                                                                                                            ValorEnt = doc.data().ValorEntrega;
                                                                                                                                                            EndCli = doc.data().End;
                                                                                                                                                        })
                                                                                                                                                        await db.collection("ClienteEmpre")
                                                                                                                                                        .doc(IdCli)
                                                                                                                                                        .update({
                                                                                                                                                          
                                                                                                                                                          End:admin.firestore.FieldValue.arrayUnion(EndCli)
                                                                                                                                                            
                                                                                                                                                             
                                                                                                                                                        }).then((doc)=>{
                                                                                                                                                           
                                                                                                                                                        })
                                                                                                                                                        
                                                                                                                        
                                                                                                                        
                                                                                                                                                        //montar a mensagem   
                                                                                                                                                    var QMsg= MsgEmp.Msg13C.Msg.length;
                                                                                                                                                    var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                    var Result =parseInt(Sorteio);
                                                                                                                                                    var Num = Result-1;
                                                                                                                                                    var AutoMsg = MsgEmp.Msg13C.Msg[Num];
                                                                                                                                                    var TempMsg =  MsgEmp.Msg13C.TempoSeg;
                                                                                                                                            
                                                                                                                                                    console.log(MsgEmp.Msg7B.Msg)
                                                                                                                                                    console.log("Qmsg: "+QMsg)       
                                                                                                                                                    console.log("Soteio: "+Sorteio)                 
                                                                                                                                                    console.log("Msg: "+AutoMsg)
                                                                                                            
                                                                                                                                                        //Mensagem parabenizando que ele acertou a digitação 
                                                                                                                                                    var QMsg9= MsgEmp.Msg16B.Msg.length;
                                                                                                                                                    var Sorteio9 = Math.floor(Math.random() * (QMsg9 - 1 + 1)) + 1;
                                                                                                                                                    var Result9 =parseInt(Sorteio9);
                                                                                                                                                    var Num9 = Result9-1;
                                                                                                                                                    var AutoMsg9 = MsgEmp.Msg16B.Msg[Num9];
                                                                                                                                                    var TempMsg9 =  MsgEmp.Msg16B.TempoSeg;
                                                                                                                                
                                                                                                                                    
                                                                                                                                                    var QMsg2= MsgEmp.Msg6A.Msg.length;
                                                                                                                                                    var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
                                                                                                                                                    var Result2 =parseInt(Sorteio2);
                                                                                                                                                    var Num2 = Result2-1;
                                                                                                                                                    var AutoMsg2 = MsgEmp.Msg6A.Msg[Num2];
                                                                                                                                                    var TempMsg2 =  MsgEmp.Msg6A.TempoSeg;
                                                                                                                                
                                                                                                                                                    //  console.log(MsgEmp.Msg3A.Msg)
                                                                                                                                                    //  console.log("Qmsg: "+QMsg2)       
                                                                                                                                                    //  console.log("Soteio: "+Sorteio2)                 
                                                                                                                                                    //  console.log("Msg: "+AutoMsg2)
                                                                                                                                                    
                                                                                                            
                                                                                                                                                    //Mensagens de estimulo 
                                                                                                                                                    var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                    var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                    var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                    var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                    var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                        
                                                                                                                                                    var Result3 =parseInt(Sorteio3);
                                                                                                                                                    var Result4 =parseInt(Sorteio4);
                                                                                                                                                    var Result5 =parseInt(Sorteio5);
                                                                                                                                        
                                                                                                                                                    var Num3 = Result3-1;
                                                                                                                                                    var Num4 = Result4-1;
                                                                                                                                                    var Num5 = Result5-1;
                                                                                                                                                    var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                    var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                    var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                    var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                    var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                   
                                                                                                    
                                                                                                                                                  
                                                                                                    
                                                                                                                                                    
                                                                                                                                                   
                                                                                                                                                    if(Robo === true && EstaNaRegra === true){
                                                                                                                                                    //Mudando a Fase do Chat
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                    FaseMsg: "Msg13C",
                                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                                    Robotizado:true, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:false,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:false,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:false,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:`data:${Midia.mimetype};base64, ${Midia.data} `,
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:Type === "image"?"image":"document"
                                                                                                                                                    },
                                                                                                                                                    
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli} ${AutoMsg}`,
                                                                                                                                                        Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    )
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                         var TotalValor = 0
                                                                                                                                                            for(let i in PedidosItens){
                                                                                                                                                                
                                                                                                                                                            
                                                                                                                                                                MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                                MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                                
                                                                                                                                                                    MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                                 
                                                                                                                                                                
                                                                                                                                                                if(PedidosItens[i].ItemEspeci){
                                                                                                                                                                    MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                                }
                                                                                                                                                                
                                                                                                                                                                if(PedidosItens[i].Descont){
                                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                                    MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                    MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                    }
                                                                                                                                                                } else {
                                                                                                                                                                    TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                                    MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                    MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                    if(PedidosItens[i].Observacao){
                                                                                                                                                                    MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                        
                                                                                                                                                            }
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            TotalValor = TotalValor+ValorEnt;
                                                                                                                                                            MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            MsgPedido = MsgPedido + "Pago Com Pix "
                                                                                                                                                           
                                                                                                                                                            await db.collection("MesaItem")
                                                                                                                                                            .doc(PedidoCri)
                                                                                                                                                            .update({
                                                                                                                                                              
                                                                                                                                                                ConfirmacaoPedido:true,
                                                                                                                                                                ValorTotaL:TotalValor,
                                                                                                                                                                
                                                                                                                                                                 
                                                                                                                                                            }).then((doc)=>{
                                                                                                                                                               
                                                                                                                                                            })
                                                                                                            
                                                                                                                                                             
                                                                                                                                                        response.json({ Inf:[ {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli} ${AutoMsg}*` , Botao:[] , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                    }) 
                                                                                                                                                    } else {
                                                                                                                                                        //Mudando a Fase do Chat
                                                                                                                                                    await db.collection("ChatCliente")
                                                                                                                                                    .doc(IdChat)
                                                                                                                                                    .update({
                                                                                                                                                       
                                                                                                                                                    FaseMsg: "Msg10B",
                                                                                                                                                    DigiteNaRegra:true,
                                                                                                                                                    Robotizado:true, 
                                                                                                                                                    MsgFutura1:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg3,
                                                                                                                                                        Tempo:Tempo3,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura2:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg4,
                                                                                                                                                        Tempo:Tempo4,
                                                                                                                                                    },
                                                                                                                                                    MsgFutura3:{
                                                                                                                                                        Ativo:true,
                                                                                                                                                        Msg:AutoMsg5,
                                                                                                                                                        Tempo:Tempo5,
                                                                                                                                                    },
                                                                                                                                                    UltimaMsg:{
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        date:new Date().getTime()+5000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                        Autor:IdCli,
                                                                                                                                                        body:`https://www.google.com/maps?q=${Mensagem.location.latitude},${Mensagem.location.longitude}&z=17&hl=pt-BR`,
                                                                                                                                                        date:new Date().getTime(),
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg9}`,
                                                                                                                                                        date:new Date().getTime()+2000,
                                                                                                                                                        Type:"text"
                                                                                                                                                    },
                                                                                                                                                    {
                                                                                                                                                        Autor:EMPRESA,
                                                                                                                                                        body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                        Botao:MsgEmp.Msg10B.Botao,
                                                                                                                                                        date:new Date().getTime()+7000,
                                                                                                                                                        Type:"botao"
                                                                                                                                                    },
                                                                                                                                                   
                                                                                                                                                    
                                                                                                                                                    
                                                                                                                                                    )
                                                                                                                                                    })
                                                                                                                                                    .then(async() => {
                                                                                                                                                        var MsgPedido = NomeCli+", Nota Completa";
                                                                                                                                                        var TotalValor = 0
                                                                                                                                                        for(let i in PedidosItens){
                                                                                                                                                            
                                                                                                                                                        
                                                                                                                                                            MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                            MsgPedido = MsgPedido + "🛍️ "+PedidosItens[i].Sessao+"\n"
                                                                                                                                                            
                                                                                                                                                                MsgPedido = MsgPedido + "📦"+PedidosItens[i].Nome+"\n"
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            if(PedidosItens[i].ItemEspeci){
                                                                                                                                                                MsgPedido = MsgPedido + "🏷️"+PedidosItens[i].SubSessao+"\n"
                                                                                                                                                            }
                                                                                                                                                            
                                                                                                                                                            if(PedidosItens[i].Descont){
                                                                                                                                                                TotalValor = TotalValor + (PedidosItens[i].Descont*PedidosItens[i].Quant)
                                                                                                                                                                MsgPedido = MsgPedido + "💰 De:"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                MsgPedido = MsgPedido + "❤️ Por:"+PedidosItens[i].Descont.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                if(PedidosItens[i].Observacao){
                                                                                                                                                                MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                }
                                                                                                                                                            } else {
                                                                                                                                                                TotalValor = TotalValor + (PedidosItens[i].Preco*PedidosItens[i].Quant)
                                                                                                                                                                MsgPedido = MsgPedido + "💰"+PedidosItens[i].Preco.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})+"\n"
                                                                                                                                                                MsgPedido = MsgPedido + "🗳️ Quantidade: "+PedidosItens[i].Quant+"\n"
                                                                                                                                                                if(PedidosItens[i].Observacao){
                                                                                                                                                                MsgPedido = MsgPedido + "⚠️ Obs.: "+PedidosItens[i].Observacao+"\n"
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                    
                                                                                                                                                        }
                                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                        MsgPedido = MsgPedido + " 🛵Valor da Entrega: "+ValorEnt.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                        MsgPedido = MsgPedido + "\n===================\n"
                                                                                                                                                        TotalValor = TotalValor+ValorEnt;
                                                                                                                                                        MsgPedido = MsgPedido + "Total : "+TotalValor.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'})
                                                                                                                                                        
                                                                                                                                                    
                                                                                                                                                        response.json({ Inf:[{Msg:`${NomeCli}${AutoMsg9}`, Tempo: TempMsg9, Type:"text"},   {Msg:MsgPedido , Botao:[] , Tempo:TempMsg, Type:"text"},  {Msg: `*${NomeCli}${AutoMsg}*` , Botao:MsgEmp.Msg10B.Botao , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                        
                                                                                                                                                        //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                        
                                                                                                                                                        
                                                                                                                                                    }) 
                                                                                                            
                                                                                                                                                    
                                                                                                                        
                                                                                                                                                    }      
                                                                                                                        
                                                                                                                        
                                                                                                                                                   
                                                                                                                                                    
                                                                                                                                            
                                                                                                                                                   
                                                                                                                                                    
                                                                                                                                                
                                                                                                                                                    }  else {
                                                                                                                            
                                                                                                                                                            if(EstaNaRegra === true && Robo === true){
                                                                                                                        
                                                                                                                                                                var QMsg= MsgEmp.Msg16A.Msg.length;
                                                                                                                                                                var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                                                                                                                                                                var Result =parseInt(Sorteio);
                                                                                                                                                                var Num = Result-1;
                                                                                                                                                                var AutoMsg = MsgEmp.Msg16A.Msg[Num];
                                                                                                                                                                var TempMsg =  MsgEmp.Msg16A.TempoSeg;
                                                                                                                        
                                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                    
                                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                                    
                                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                                
                                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                                .doc(IdChat)
                                                                                                                                                                .update({
                                                                                                                                                                DigiteNaRegra:false, 
                                                                                                                                                                MsgFutura1:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura2:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura3:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                                },
                                                                                                                                                                UltimaMsg:{
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"text"
                                                                                                                                                                },
                                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                    Autor:IdCli,
                                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                                }, 
                                                                                                                                                                {
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli}${AutoMsg}`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"text"
                                                                                                                                                                },
                                                                                                                                                                
                                                                                                                                                                
                                                                                                                                                                )
                                                                                                                                                                })
                                                                                                                                                                .then(async() => {
                                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}${AutoMsg}*` , Tempo:TempMsg, Type:"text"}] });
                                                                                                                                                        
                                                                                                                                                                }) 
                                                                                                                                                            } else  if(EstaNaRegra === false ){
                                                                                                                        
                                                                                                                                                                //mensagens de estimulo para continuar o atendimento
                                                                                                                                                                var QMsg3= MsgEmp.Msg17A.Msg.length;
                                                                                                                                                                var QMsg4= MsgEmp.Msg17B.Msg.length;
                                                                                                                                                                var QMsg5= MsgEmp.Msg17C.Msg.length;
                                                                                                                                                                var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                                                                                                                                                                var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
                                                                                                                                                    
                                                                                                                                                                var Result3 =parseInt(Sorteio3);
                                                                                                                                                                var Result4 =parseInt(Sorteio4);
                                                                                                                                                                var Result5 =parseInt(Sorteio5);
                                                                                                                                                    
                                                                                                                                                                var Num3 = Result3-1;
                                                                                                                                                                var Num4 = Result4-1;
                                                                                                                                                                var Num5 = Result5-1;
                                                                                                                                                                var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                                                                                                                                                                var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                                                                                                                                                                var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                                                                                                                                                                var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                                                                                                                                                                var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                            
                                                                                                                                                                //Mudando a Fase do Chat
                                                                                                                                                                
                                                                                                                                                                await db.collection("ChatCliente")
                                                                                                                                                                .doc(IdChat)
                                                                                                                                                                .update({
                                                                                                                                                                Robotizado:false, 
                                                                                                                                                                MsgFutura1:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg3,
                                                                                                                                                                    Tempo:Tempo3,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura2:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg4,
                                                                                                                                                                    Tempo:Tempo4,
                                                                                                                                                                },
                                                                                                                                                                MsgFutura3:{
                                                                                                                                                                    Ativo:true,
                                                                                                                                                                    Msg:AutoMsg5,
                                                                                                                                                                    Tempo:Tempo5,
                                                                                                                                                                },
                                                                                                                                                                UltimaMsg:{
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"texto"
                                                                                                                                                                },
                                                                                                                                                                Mensagem:admin.firestore.FieldValue.arrayUnion({
                                                                                                                                                                    Autor:IdCli,
                                                                                                                                                                    body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                                                                                                                                                    date:new Date().getTime(),
                                                                                                                                                                    Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                                                                                                                                                                }, 
                                                                                                                                                                {
                                                                                                                                                                    Autor:EMPRESA,
                                                                                                                                                                    body:`${NomeCli} Clique nas Opções Acima`,
                                                                                                                                                                    date:new Date().getTime()+5000,
                                                                                                                                                                    Type:"text"
                                                                                                                                                                },)
                                                                                                                                                                })
                                                                                                                                                                .then(async() => {
                                                                                                                                                                    var MsgButon =`*${Mensagem.body}${AutoMsg2}*`
                                                                                                                                                                    //MsgButon = + "(Clique em Uma das Opções abaixo, Por favor!)"
                                                                                                                                                                    console.log(TempMsg)
                                                                                                                                                                    response.json({ Inf:[{Msg: `*${NomeCli}*` , Botao:Menus , Tempo:TempMsg, Type:"butao"}] });
                                                                                                                                                        
                                                                                                                                                                }) 
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                
                                                                                                                                            
                                                                                                                                                
                                                                                                                                                }
                     } else {
                         //mensagens de estimulo para continuar o atendimento
                         var QMsg3= MsgEmp.Msg17A.Msg.length;
                         var QMsg4= MsgEmp.Msg17B.Msg.length;
                         var QMsg5= MsgEmp.Msg17C.Msg.length;
                         var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                         var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                         var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;

                         var Result3 =parseInt(Sorteio3);
                         var Result4 =parseInt(Sorteio4);
                         var Result5 =parseInt(Sorteio5);

                         var Num3 = Result3-1;
                         var Num4 = Result4-1;
                         var Num5 = Result5-1;
                         var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                         var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                         var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                         var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                         var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                         var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();

                        await db.collection("ChatCliente")
                        .doc(IdChat)
                        .update({
                        MsgFutura1:{
                            Ativo:true,
                            Msg:AutoMsg3,
                            Tempo:Tempo3,
                        },
                        MsgFutura2:{
                            Ativo:true,
                            Msg:AutoMsg4,
                            Tempo:Tempo4,
                        },
                        MsgFutura3:{
                            Ativo:true,
                            Msg:AutoMsg5,
                            Tempo:Tempo5,
                        },
                        UltimaMsg:{
                            Autor:IdCli,
                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                            date:new Date().getTime(),
                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                        },
                        Mensagem:admin.firestore.FieldValue.arrayUnion({
                            Autor:IdCli,
                            body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                            date:new Date().getTime(),
                            Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                        }, 
    
                        
                        
                        )
                        })
                        .then(async() => {
                           
                           
                            //response.json({ Inf:true});
                    
                        }) 


                     }
                   
                    
                    
                    
                    
                    
                    
                    } else {//Não Existe Um Chat Em Anadamento Entra Aqui 
        
        
                        if(NomeCli === ""){
        
                         //Aqui vou ta salvando  o Nome do Cliente
                            await db.collection("ClienteEmpre")
                            .doc(IdCli)
                            .update({
                            Nome: Mensagem.text.message,
                            })
                            .then(async() => {
                              
                            
                            
                            }) 
                
                        //Aqui vou está enviando uma mensagem
                            setTimeout(() => {
                                axios.post(`${URL_WHATS}/send-text`, {
                                    "phone": Mensagem.phone,
                                    "message": `${AutoMsg}`,
                                }).then(function (response) {
                               
                            })
                               
                              }, MsgEmp.TempoSeg);
                           
                           
                        }
                    
                    
                    
                    
                    }
        
        
        
        
                })
        
        
              
        
        
        
        
        
        
        
            } else { //ver se o cliente está cadastrado na cwo 
           
            await db.collection("ClienteEmpre")
            .where("Telefone", "==", TelefonCli)
            .get().then(async (querySnapshot12) => {

              
                if(querySnapshot12.size  !== 0){//Aqui é se o cliente já está cadastrado na CWO  
                    var IdClient = "";

                    //Pego o id do cliente
                    await querySnapshot12.forEach((doc12) => {
                        IdClient = doc12.id;
                       })

                       //Atualizar o cliente colocando outra empresa
                    await db.collection("ClienteEmpre")
                       .doc(IdClient)
                       .update({
                        Empresa:admin.firestore.FieldValue.arrayUnion(EMPRESA)
                       })
                       .then(async() => {

                        var MsgEmp = {};

                         //Pesquiso as msgs  automatica pda emrpesa

                        await db.collection("EmrpesaSite")
                        .doc(EMPRESA)
                        .get().then(async(doc) => {
                            MsgEmp = doc.data().MsgAuto;
                        });
                     
                        console.log(MsgEmp)
                        console.log(MsgEmp.Msg1A)
                        console.log(MsgEmp.Msg1A.Msg)
                        console.log(MsgEmp.Msg1B)
                        console.log(MsgEmp.Msg1B.Msg)
                        
                        // Montando as mensagens 
                        var QMsg= MsgEmp.Msg1A.Msg.length;
                        var QMsg2= MsgEmp.Msg1B.Msg.length;
                        var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                        var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
            
                        var Result =parseInt(Sorteio);
                        var Result2 =parseInt(Sorteio2);
            
                        var Num = Result-1;
                        var Num2 = Result2-1;
                        var AutoMsg = MsgEmp.Msg1A.Msg[Num];
                        var AutoMsg2= MsgEmp.Msg1B.Msg[Num2];
                        //mensagens de estimulo para continuar o atendimento
                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
            
                        var Result3 =parseInt(Sorteio3);
                        var Result4 =parseInt(Sorteio4);
                        var Result5 =parseInt(Sorteio5);
            
                        var Num3 = Result3-1;
                        var Num4 = Result4-1;
                        var Num5 = Result5-1;
                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                       
                        //COntruindo Um Caht Entre a empresa e o CLiente
                        await db.collection("ChatCliente").add({
                            RoboAtivo:true,
                            Id: IdClient,
                            DigiteNaRegra:true,
                            MsgFutura1:{
                                Ativo:true,
                                Msg:AutoMsg3,
                                Tempo:Tempo3,
                            },
                            MsgFutura2:{
                                Ativo:true,
                                Msg:AutoMsg4,
                                Tempo:Tempo4,
                            },
                            MsgFutura3:{
                                Ativo:true,
                                Msg:AutoMsg5,
                                Tempo:Tempo5,
                            },
                            MemSessao:[],
                            MemPedido:{},
                            Reclamaçoes:null,
                            Localização:null,
                            Pedido:null,
                            DataInicio: new Date().getTime(),
                            Empresa:EMPRESA,
                            Telefone:TelefonCli,
                            Robotizado:true,
                            Ativo:true,
                            vizualEmp:0,
                            VizualCli:1,
                            DigiEmp:false,
                            DigiCli:false,
                            FaseMsg:"Msg1B",
                            UltimaMsg:{
                                Autor:IdClient,
                                body:AutoMsg2,
                                date:new Date().getTime()+7000,
                                Type:"text"
                            },
                            Mensagem:[{
                                Autor:IdClient,
                                body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                date:new Date().getTime(),
                                Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                            }, 
                            {
                                Autor:EMPRESA,
                                body:AutoMsg,
                                date:new Date().getTime()+2000,
                                Type:"text"
                            },
                            {
                                Autor:EMPRESA,
                                body:AutoMsg2,
                                date:new Date().getTime()+7000,
                                Type:"text"
                            },
                           
                            ]
                         
                        })
                        .then((docRef2) => {
                            console.log("Entrou 3° Sessão ")
                              //Enviando A Msg
    
                            response.json({ Inf:[{Msg:AutoMsg, Tempo:MsgEmp.Msg1A.TempoSeg, Type:"text"}, {Msg:`*${AutoMsg2}*`, Tempo:MsgEmp.Msg1B.TempoSeg, Type:"text"}] });

                        })
                        .catch((error) => {
                            console.error("Error adding document: ", error);
                        });

               
                       }) 


                } else{//Aqui é se o cliente não já está cadastrado na CWO  

                    console.log("Entrou 1° Sessão ")
                    // Cadastrando o Cliente Na lista Da Empresas 
                       await db.collection("ClienteEmpre").add({
                           Nome: "",
                           Telefone: TelefonCli,
                           dataCadas:new Date().getTime(),
                           Loc:{
                            lng:0,
                            lat:0,
                           },
                           End:{
                            Bairro:"",
                            Cidade:"",
                            Estado:"",
                            Rua:"",
                            Numero:"",
                            Proximidades:"",
                           },
                           Empresa:admin.firestore.FieldValue.arrayUnion(EMPRESA)
                       })
                       .then(async (docRef) => {
                           console.log("Entrou 2° Sessão ")
                           console.log("Document written with ID1: ", docRef.id);
                          
                           var IdClient = docRef.id;
           
                           var MsgEmp = {};
                           
                           await db.collection("EmrpesaSite")
                           .doc(EMPRESA)
                           .get().then(async(doc) => {
                               MsgEmp = doc.data().MsgAuto;
                           });
                        
                           console.log(MsgEmp)
                           console.log(MsgEmp.Msg1A)
                           console.log(MsgEmp.Msg1A.Msg)
                           console.log(MsgEmp.Msg1B)
                           console.log(MsgEmp.Msg1B.Msg)
           
                           var QMsg= MsgEmp.Msg1A.Msg.length;
                           var QMsg2= MsgEmp.Msg1B.Msg.length;
                           var Sorteio = Math.floor(Math.random() * (QMsg - 1 + 1)) + 1;
                           var Sorteio2 = Math.floor(Math.random() * (QMsg2 - 1 + 1)) + 1;
               
                           var Result =parseInt(Sorteio);
                           var Result2 =parseInt(Sorteio2);
               
                           var Num = Result-1;
                           var Num2 = Result2-1;
                           var AutoMsg = MsgEmp.Msg1A.Msg[Num];
                           var AutoMsg2= MsgEmp.Msg1B.Msg[Num2];
                           
                           console.log(MsgEmp.Msg1A.Msg)
                           console.log("Qmsg: "+QMsg)
               
                           console.log("Soteio: "+Sorteio)
                        
                           console.log("Msg: "+AutoMsg)
               
                           console.log(MsgEmp.Msg1B.Msg)
                           console.log("Qmsg: "+QMsg2)
               
                           console.log("Soteio: "+Sorteio2)
                        
                           console.log("Msg: "+AutoMsg2)

                        //mensagens de estimulo para continuar o atendimento
                        var QMsg3= MsgEmp.Msg17A.Msg.length;
                        var QMsg4= MsgEmp.Msg17B.Msg.length;
                        var QMsg5= MsgEmp.Msg17C.Msg.length;
                        var Sorteio3 = Math.floor(Math.random() * (QMsg3 - 1 + 1)) + 1;
                        var Sorteio4 = Math.floor(Math.random() * (QMsg4 - 1 + 1)) + 1;
                        var Sorteio5 = Math.floor(Math.random() * (QMsg5 - 1 + 1)) + 1;
            
                        var Result3 =parseInt(Sorteio3);
                        var Result4 =parseInt(Sorteio4);
                        var Result5 =parseInt(Sorteio5);
            
                        var Num3 = Result3-1;
                        var Num4 = Result4-1;
                        var Num5 = Result5-1;
                        var AutoMsg3 = MsgEmp.Msg17A.Msg[Num3];
                        var AutoMsg4= MsgEmp.Msg17B.Msg[Num4];
                        var AutoMsg5= MsgEmp.Msg17C.Msg[Num5];
                        var Tempo3 = MsgEmp.Msg17A.TempoSeg + new Date().getTime();
                        var Tempo4 = MsgEmp.Msg17B.TempoSeg + new Date().getTime();
                        var Tempo5 = MsgEmp.Msg17C.TempoSeg + new Date().getTime();
                
                        

                        await db.collection("ChatCliente").add({
                            RoboAtivo:true,
                              Id: IdClient,
                              DigiteNaRegra:true,
                              MsgFutura1:{
                               Ativo:true,
                               Msg:AutoMsg3,
                               Tempo:Tempo3,
                           },
                           MsgFutura2:{
                               Ativo:true,
                               Msg:AutoMsg4,
                               Tempo:Tempo4,
                           },
                           MsgFutura3:{
                               Ativo:true,
                               Msg:AutoMsg5,
                               Tempo:Tempo5,
                           },
                              MemSessao:[],
                              MemPedido:{},
                              Reclamaçoes:null,
                              Localização:null,
                              Pedido:null,
                              DataInicio: new Date().getTime(),
                              Empresa:EMPRESA,
                              Telefone:TelefonCli,
                              Robotizado:true,
                              Ativo:true,
                              vizualEmp:0,
                              VizualCli:1,
                              DigiEmp:false,
                              DigiCli:false,
                              FaseMsg:"Msg1B",
                              UltimaMsg:{
                                  Autor:IdClient,
                                  body:AutoMsg2,
                                  date:new Date().getTime()+7000,
                                  Type:"text"
                              },
                              Mensagem:[{
                                  Autor:IdClient,
                                  body:Type === "chat"? Mensagem.body:Type === "image"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "ptt"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "audio"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "video"? `Cliente Enviou Um Video, O Sistema Não Aceita, Você só poderar  Abrir o Video No WhatsApp `:Type === "location"?`Enviou a Localização`:Type === "document"? `data:${Midia.mimetype};base64, ${Midia.data} `:Type === "vcard"? Mensagem.body:"",
                                  date:new Date().getTime(),
                                  Type:Type === "chat"? "text":Type === "image"? "image":Type === "ptt"? "audio":Type === "audio"?"audio":Type === "video"? "text":Type === "location"?"text":Type === "document"? "document":Type === "vcard"? "text":"text",
                              }, 
                              {
                                  Autor:EMPRESA,
                                  body:AutoMsg,
                                  date:new Date().getTime()+2000,
                                  Type:"text"
                              },
                              {
                                  Autor:EMPRESA,
                                  body:AutoMsg2,
                                  date:new Date().getTime()+7000,
                                  Type:"text"
                              },
                             
                              ]
                           
                          })
                          .then((docRef2) => {
                              console.log("Entrou 3° Sessão ")
                              console.log("Document written with ID2: ", docRef2.id);
      
                              response.json({ Inf:[{Msg:AutoMsg, Tempo:MsgEmp.Msg1A.TempoSeg, Type:"text"}, {Msg:`*${AutoMsg2}*`, Tempo:MsgEmp.Msg1B.TempoSeg, Type:"text"}] });

                          })
                          .catch((error) => {
                              console.error("Error adding document: ", error);
                          });
                        
               
                       })
                       .catch((error) => {
                           console.error("Error adding document: ", error);
                       });
               

                }
            })


             
        
        
            }
            })
    

    }

    

    
  


    
    
})
   
  });
  
  
  exports.api = functions.https.onRequest(app);
